"use strict";(self.webpackChunkmmsp_land_hl=self.webpackChunkmmsp_land_hl||[]).push([[2131],{62131:(e,t,s)=>{s.d(t,{o:()=>Le});var i=s(76931),r=s(84735),n=s(77555),a=s(33443),o=s(5095),c=s(83936),l=s(35870),h=s(89379);function d(e){var t;let{pixelDimensions:s,texelDimensions:r,baseSize:n,referenceSize:a,strokeWidth:o,sizeRatio:c}=e;if(s||(s=e.sprite.sdf?[0,0]:[e.sprite.width,e.sprite.height]),r||(r=e.sprite.sdf?[0,0]:s),null!=e.patternHeight){const t=e.patternHeight/s[1];s[1]*=t,s[0]*=t}-1===n&&(n=s[1]),n=(0,i.Lz)(n),a=(0,i.Lz)(a),o=(0,i.Lz)(o);const l=(null!==(t=e.sprite.sdfDecodeCoeff)&&void 0!==t?t:1)*c;return(0,h.A)((0,h.A)({},e),{},{pixelDimensions:s,texelDimensions:r,baseSize:n,referenceSize:a,strokeWidth:o,sdfDecodeCoeff:l})}var u=s(90113);class m extends c.${get vertexSpec(){return{createComputedParams:d,optionalAttributes:{zoomRange:l.jo,value1Position2Value2:l.Z6,lineLength:l.bU},attributes:{id:l.id,bitset:l.Q5,pos:l.n1,offset:l.cY.marker,uv:l.uv.marker,animationPointerAndBaseSizeAndReferenceSize:l.GE,sizing:l.ve,angle:l.g7}}}_write(e,t,s){const i=this.evaluatedMeshParams.sprite,{textureBinding:n}=i;e.recordStart(this.instanceId,this.attributeLayout,n);const a=t.getDisplayId();if(this.shift&&"esriGeometryPolyline"===t.geometryType){if(!s){const s=r.z.fromFeatureSetReaderCIM(t);s&&this._writeParticles(e,t,s)}}else if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(e,t);else if("esriGeometryPolygon"===t.geometryType){const s=t.readCentroidForDisplay();if(!s)return;const[i,r]=s.coords;this._writeQuad(e,a,i,r)}else if("esriGeometryPoint"===t.geometryType){const s=t.readXForDisplay(),i=t.readYForDisplay();this._writeQuad(e,a,s,i)}else{const s=t.readGeometryForDisplay();s&&s.forEachVertex((t,s)=>{this._writeQuad(e,a,t,s)})}e.recordEnd()}_writePlacedMarkers(e,t){var s;const o=null===(s=r.z.fromFeatureSetReaderCIM(t))||void 0===s?void 0:s.clone();if(!o)return;const c=a.l.getPlacement(o,-1,this.evaluatedMeshParams.placement,(0,i.Lz)(1),e.id);if(!c)return;const l=t.getDisplayId();let h=c.next(),d=null;for(;null!=h;){const t=h.tx,s=-h.ty;if(Math.abs(t)>n.$u||Math.abs(s)>n.$u){h=c.next();continue}const i=-h.getAngle();e.recordBounds(t,s,64,64),this.shift?d&&this._writeQuad(e,l,d[0],d[1],void 0,i):this._writeQuad(e,l,t,s,void 0,i),d=[t,s],h=c.next()}}_writeParticles(e,t,s){const i=t.getDisplayId();for(;s.nextPath();){const t=[];for(;s.nextPoint();)t.push([s.x,s.y]);const r=f(t);let n=0;for(let e=1;e<t.length;e++){const s=t[e][0]-t[e-1][0],i=t[e][1]-t[e-1][1],r=Math.sqrt(s*s+i*i);n+=r}const a=t=>{for(const s of r){const{a:r,b:a}=s;this._writeQuad(e,i,r.position[0],r.position[1],[r.distance-t,a.position[0],a.position[1],a.distance-t],this.evaluatedMeshParams.angleToLine?Math.atan2(r.direction[1],r.direction[0]):0,n,!0)}},{placement:o}=this.evaluatedMeshParams;if(!o||"placementTemplate"in o||"CIMMarkerPlacementOnVertices"===o.type){let e;if(o&&"CIMMarkerPlacementOnVertices"!==o.type)e=o.placementTemplate;else{e=[0];for(const t of r){const{a:s,b:i}=t,r=s.position[0]-i.position[0],n=s.position[1]-i.position[1],a=Math.sqrt(r*r+n*n);e.push(a)}}let t=-1*n;for(;t<2*n;)for(const s of e)t+=s,a(t)}else"CIMMarkerPlacementAtExtremities"===o.type?"JustBegin"===o.extremityPlacement?a(1):"JustEnd"===o.extremityPlacement?(a(n-1),a(-1)):"Both"===o.extremityPlacement&&(a(1),a(n-1)):"CIMMarkerPlacementOnLine"===o.type&&("LineBeginning"===o.relativeTo?a(1):"LineEnd"===o.relativeTo?(a(n-1),a(-1)):"LineMiddle"===o.relativeTo&&a(n/2))}}_writeQuad(e,t,s,i,r){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=this.evaluatedMeshParams.sprite,{rect:h}=l,d=h.x+o.hM,m=h.y+o.hM,f=h.x+h.width-o.hM,p=h.y+h.height-o.hM,_=e.vertexCount();c||e.recordBounds(s,i,64,64);const g={texXmin:d,texYmin:m,texXmax:f,texYmax:p,value1Position2Value2:r,angle:n/u.rp,lineLength:a};for(let o=0;o<4;o++)this._writeVertex(e,t,s,i,g);e.indexEnsureSize(6),e.indexWrite(_),e.indexWrite(_+1),e.indexWrite(_+2),e.indexWrite(_+1),e.indexWrite(_+3),e.indexWrite(_+2)}}function f(e){const t=[];let s=0;for(let i=1;i<e.length;i++){const r=e[i-1],n=e[i],a=n[0]-r[0],o=n[1]-r[1],c=Math.sqrt(a*a+o*o),l=a/c,h=o/c;t.push({a:{position:r,distance:s,direction:[l,h]},b:{position:n,distance:s+c,direction:[l,h]}}),s+=c}return t}class p extends m{constructor(){super(...arguments),this.shift=!1}}class _ extends m{constructor(){super(...arguments),this.shift=!0}}var g=s(51703),v=s(27307),y=s(35797),x=s(28736),P=s(64346);class M extends c.${_write(e,t,s){const i=null!==s&&void 0!==s?s:r.z.fromFeatureSetReaderCIM(t);if(!i)return;const n=this.evaluatedMeshParams.sprite,{textureBinding:a}=n;e.recordStart(this.instanceId,this.attributeLayout,a);const o=t.getDisplayId();this._writePoly(e,o,i.asOptimized()),e.recordEnd()}}class b extends M{constructor(){super(...arguments),this.vertexSpec={createComputedParams:d,attributes:{id:l.id,bitset:l.Q5,pos:l.n1,offset:l.cY.fill,tlbr:l.Tx,animationPointerAndBaseSizeAndReferenceSize:l.GE,sizing:l.ve},optionalAttributes:{zoomRange:l.jo,value1Position2Value2:l.k3,lineLength:l.Sy}}}_writePoly(e,t,s){const i=this._clip(s);if(!i)return;s=i;const r=[],n=e.vertexCount();let a;if((0,y.lO)(r,s)){if(0===r.length)return;a=0;for(const i of r){const r=s.coords[2*i],n=s.coords[2*i+1];this._writeVertex(e,t,r,n),a++}}else{const{coords:i,lengths:r}=s,n=(0,g.l)(i,r);a=n.vertexCount;for(let s=0;s<n.buffer.length/2;s++){const i=n.buffer[2*s],r=n.buffer[2*s+1];this._writeVertex(e,t,i,r)}}if(a>0){e.indexEnsureSize(a);for(let t=0;t<a;t++)e.indexWrite(t+n)}}_clip(e){const t=this.hasEffects;return(0,y.FE)(e,t?256:8)}}class w{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0}}class I extends M{constructor(){super(...arguments),this.vertexSpec={createComputedParams:d,attributes:{id:l.id,bitset:l.Q5,pos:l.n1,offset:l.cY.line,tlbr:l.Tx,animationPointerAndBaseSizeAndReferenceSize:l.GE,sizing:l.ve,accumulatedDistance:l.YE,normal:l.qb,segmentDirection:l.zK},optionalAttributes:{zoomRange:l.jo,value1Position2Value2:l.k3,lineLength:l.bU}},this._tessParams=new P.sp,this._currentWrite=new w,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._lineLength=0,this._lineTessellator=new v.i((e,t,s,i,r,n,a,o,c,l,h)=>this._writeTesselatedVertex(e,t,s,i,r,n,a,o,c,l,h,this._lineLength),this._writeTriangle.bind(this),!1)}_writePoly(e,t,s){const n=(0,y.uS)(r.z.fromOptimized(s,"esriGeometryPolyline"),64);if(null==n)return;const{_currentWrite:a,_tessellationOptions:o}=this,{baseSize:c,capType:l,joinType:h,miterLimit:d}=this.evaluatedMeshParams,u=(0,i.Lz)(.5*c);o.halfWidth=u,o.capType=(0,x.ue)(l||"Round"),o.joinType=(0,x.qE)(h||"Round"),o.miterLimit=d||2,a.out=e,a.id=t,a.vertexCount=0,a.indexCount=0,a.vertexFrom=e.vertexCount(),a.vertexBounds=1;for(const{line:i,start:r,pathLength:m}of n){o.initialDistance=r%65535,a.pathLength=m,this._lineLength=0;for(let e=1;e<i.length;e++){const t=i[e].x-i[e-1].x,s=i[e].y-i[e-1].y;this._lineLength+=Math.sqrt(t*t+s*s)}this._lineTessellator.tessellate(i,o,false)}}_writeTesselatedVertex(e,t,s,i,r,n,a,o,c,l,h,d){const{out:u,id:m,vertexBounds:f,pathLength:p}=this._currentWrite;return this.hasEffects&&u.recordBounds(e,t,f,f),this._tessParams.extrusionOffsetX=a,this._tessParams.extrusionOffsetY=o,this._tessParams.normalX=c,this._tessParams.normalY=l,this._tessParams.directionX=r,this._tessParams.directionY=n,this._tessParams.distance=h,this._tessParams.pathLength=p,this._tessParams.lineLength=d,this._writeVertex(u,m,e,t,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(e,t,s){const{out:i}=this._currentWrite;i.indexEnsureSize(3),i.indexWrite(e),i.indexWrite(t),i.indexWrite(s),this._currentWrite.indexCount+=3}}var z=s(81320),L=s(13308),S=s(33346),A=s(13720),k=s(88075),E=s(38550),D=s(9410),R=s(57156),C=s(98112),B=s(87663),T=s(88685),W=s(94967),G=s(98006),O=s(19555),F=s(59422),Z=s(72745),V=s(98618),j=s(1484),q=s(19358),Q=s(19385);function Y(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e}function X(e,t){return Math.sqrt(e*e+t*t)}function N(e){const t=X(e[0],e[1]);e[0]/=t,e[1]/=t}function J(e,t){return X(e[0]-t[0],e[1]-t[1])}function $(e){return e.length-1}function H(e){let t=0;for(let s=0;s<$(e);s++)t+=K(e,s);return t}function K(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,[i,r]=function(e,t){return e[t+1]}(e,t);return[i,r]=[Math.round(i),Math.round(r)],Math.sqrt(i*i+r*r)*s}class U{constructor(e,t,s,i,r){this._segments=e,this._index=t,this._distance=s,this._xStart=i,this._yStart=r,this._done=!1}static create(e){return new U(e,0,0,e[0][0],e[0][1])}clone(){return new U(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){const e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length);let s=Math.acos(t);return e>0&&(s=2*Math.PI-s),s}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<$(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){const s=this.backwardLength;if(e<=s)return this._distance=(s-e)/this.length,this;let i=this.backwardLength;for(;this.prev();){if(i+this.length>e)return this._seekBackwards(e-i);i+=this.length}return this._distance=0,t?this:null}seek(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;let s=this.remainingLength;for(;this.next();){if(s+this.length>e)return this.seek(e-s,t);s+=this.length}return this._distance=1,t?this:null}}function ee(e,t,s){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const r=H(e),n=U.create(e),a=r/2;if(!i)return n.seek(a),void(n.x<o.CQ&&n.y<o.CQ&&n.x>=0&&n.y>=0&&s(n.clone(),0,a+0*t,r));const c=Math.max((r-t)/2,0),l=Math.floor(c/t),h=a-l*t;n.seek(h);for(let d=-l;d<=l;d++)n.x<o.CQ&&n.y<o.CQ&&n.x>=0&&n.y>=0&&s(n.clone(),d,a+d*t,r),n.seek(t)}function te(e,t){const s=t;for(let i=0;i<e.length;i++){let t=e[i];se(t,s);const r=[];r.push(t[0]);for(let e=1;e<t.length;e++){const[s,i]=t[e-1],[n,a]=t[e],o=n-s,c=a-i;r.push([o,c])}e[i]=r,t=r}return e}function se(e,t){const s=1e-6;if(t<=0)return;const i=e.length;if(i<3)return;const r=[];let n=0;r.push(0);for(let d=1;d<i;d++)n+=J(e[d],e[d-1]),r.push(n);t=Math.min(t,.2*n);const a=[];a.push(e[0][0]),a.push(e[0][1]);const o=e[i-1][0],c=e[i-1][1],l=Y([0,0],e[0],e[1]);N(l),e[0][0]+=t*l[0],e[0][1]+=t*l[1],Y(l,e[i-1],e[i-2]),N(l),e[i-1][0]+=t*l[0],e[i-1][1]+=t*l[1];for(let d=1;d<i;d++)r[d]+=t;r[i-1]+=t;const h=.5*t;for(let d=1;d<i-1;d++){let n=0,o=0,c=0;for(let i=d-1;i>=0&&!(r[i+1]<r[d]-h);i--){const a=h+r[i+1]-r[d],l=r[i+1]-r[i],u=r[d]-r[i]<h?1:a/l;if(Math.abs(u)<s)break;const m=u*u,f=u*a-.5*m*l,p=u*l/t,_=e[i+1],g=e[i][0]-_[0],v=e[i][1]-_[1];n+=p/f*(_[0]*u*a+.5*m*(a*g-l*_[0])-m*u*l*g/3),o+=p/f*(_[1]*u*a+.5*m*(a*v-l*_[1])-m*u*l*v/3),c+=p}for(let a=d+1;a<i&&!(r[a-1]>r[d]+h);a++){const i=h-r[a-1]+r[d],l=r[a]-r[a-1],u=r[a]-r[d]<h?1:i/l;if(Math.abs(u)<s)break;const m=u*u,f=u*i-.5*m*l,p=u*l/t,_=e[a-1],g=e[a][0]-_[0],v=e[a][1]-_[1];n+=p/f*(_[0]*u*i+.5*m*(i*g-l*_[0])-m*u*l*g/3),o+=p/f*(_[1]*u*i+.5*m*(i*v-l*_[1])-m*u*l*v/3),c+=p}a.push(n/c),a.push(o/c)}a.push(o),a.push(c);for(let d=0,u=0;d<i;d++)e[d][0]=a[u++],e[d][1]=a[u++]}var ie=s(81615);const re=(0,B.Bj)(e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t});class ne extends ie.G8{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,s,i){if(this._zoomLevel=i||0,null!=s)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{const s=t.readXForDisplay(),i=t.readYForDisplay();this._writePoint(e,s,i,0,t);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":{const s=t.readCentroidForDisplay();if(!s)return;const[i,r]=s.coords;this._writePoint(e,i,r,0,t);break}case"esriGeometryMultipoint":{let s=0;const i=r.z.fromFeatureSetReader(t);if(null!==i&&void 0!==i&&i.nextPath())for(;i.nextPoint();)this._writePoint(e,i.x,i.y,s++,t);break}case"esriGeometryPolyline":this._writeLines(e,t)}}_getMetricDir(){const{horizontalAlignment:e,verticalAlignment:t}=this.evaluatedMeshParams;return["center"===e?0:"right"===e?-1:1,"middle"===t?0:"bottom"===t?-1:1]}_createLineLabelMetric(e,t,s,i,r,n){var a,o,c,l;const[h,d]=this._getMetricDir(),u=null!==(a=null===(o=this.evaluatedMeshParams.scaleInfo)||void 0===o?void 0:o.maxScale)&&void 0!==a?a:0,m=null!==(c=null===(l=this.evaluatedMeshParams.scaleInfo)||void 0===l?void 0:l.minScale)&&void 0!==c?c:0,f=this.evaluatedMeshParams.labelClassId;return new Q.f(e,f,t,s,i,r,h,d,u,m,n)}_writePoint(e,t,s,i,r){var n,a,c,l;if(t<0||t>o.CQ||s<0||s>o.CQ)return;const h=this._getShaping();if(!h)return;const d=r.getDisplayId(),u=this.evaluatedMeshParams.labelClassId,m=function(e,t,s){return(0,T.Wm)("".concat(e).concat(t).concat(s))}(this.evaluatedMeshParams.layerId,r.getObjectId(),i),f=function(e,t,s){return(0,T.Wm)("".concat(e).concat(t).concat(s))}(r.getObjectId(),u,i),[p,_]=this._getMetricDir(),g=null!==(n=null===(a=this.evaluatedMeshParams.scaleInfo)||void 0===a?void 0:a.maxScale)&&void 0!==n?n:0,v=null!==(c=null===(l=this.evaluatedMeshParams.scaleInfo)||void 0===l?void 0:l.minScale)&&void 0!==c?c:0,y=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};e.metricStart(new Q.f(d,u,m,f,t,s,p,_,g,v,y)),this._writeGlyphs(e,d,t,s,h,0,y,void 0,!1),e.metricBoxWrite(h.boundsT),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const e of this._references){const t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){const{scaleInfo:s,verticalAlignment:i}=this.evaluatedMeshParams,r=this.evaluatedMeshParams.repeatLabelDistance||128,n=this._getShaping("middle");if(!n)return;const a=(e,t,s,i)=>this._placeSubdivGlyphs(e,t,s,i),o=(n.bounds.width+r)/2;this._current={out:e,id:t.getDisplayId(),objId:t.getObjectId(),shaping:n,zoomRange:(0,x.My)(s,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null,pathIndex:0},this._verticalPlacement="bottom"===i?"above":"top"===i?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,a,o):this._writeCenterAlong(t,a,o)}_writeAboveAndBelowAlong(e,t,s){const{repeatLabel:i}=this.evaluatedMeshParams,{shaping:r}=this._current,n=r.bounds.halfHeight,a=e.readGeometryForDisplay();if(!a)return;const o=new j.A;(0,V.kz)(o,a,!1,!1,"esriGeometryPolyline",1);const c=ae(new j.A,o,n),l=ae(new j.A,o,-n),h=(0,V.zv)(l,"esriGeometryPolyline",!1,!1),d=te((0,V.zv)(c,"esriGeometryPolyline",!1,!1).paths,r.bounds.width),u=te(h.paths,r.bounds.width);this._current.offsetDirection="above";for(let m=0;m<d.length;m++)this._current.pathIndex=m,ee(d[m],s,t,!!i);this._current.offsetDirection="below";for(let m=0;m<u.length;m++)this._current.pathIndex=m,ee(u[m],s,t,!!i)}_writeCenterAlong(e,t,s){const{repeatLabel:i}=this.evaluatedMeshParams,{shaping:r}=this._current,n=te(e.readLegacyGeometryForDisplay().paths,r.bounds.width);for(let a=0;a<n.length;a++)this._current.pathIndex=a,ee(n[a],s,t,!!i)}_placeSubdivGlyphs(e,t,s,i){const{allowOverrun:r,labelPosition:n,repeatLabelDistance:a,layerId:o,labelClassId:c}=this.evaluatedMeshParams,{objId:l,shaping:h,pathIndex:d}=this._current,u=this._current.zoomRange[0],m=re(t),f=this._current.shaping.bounds.width/2,p=Math.sqrt(a||128)/2,_=Math.min(s,i-s),g=h.isMultiline?ie.GJ:Math.log2(_/(p+f/2)),v=0===t?g:Math.min(m,g),y=Math.max(u,this._zoomLevel+1-v),x=this._zoomLevel-y,P=h.bounds.width/2*2**x,M=function(e,t,s,i,r){return(0,T.Wm)("".concat(e).concat(t).concat(s).concat(i*2**(ie.GJ-r)))}(o,l,d,t,this._zoomLevel),b=function(e,t,s,i,r){return(0,T.Wm)("".concat(e).concat(r).concat(t).concat(s*2**(ie.GJ-i)))}(l,d,t,this._zoomLevel,c);this._current.shaping.isMultiline?0===t&&this._placeStraight(e,y,M,b):r&&x<0?this._placeStraightAlong(e,u,M,b):"parallel"===n?this._placeStraightAlong(e,y,M,b):"curved"===n&&this._placeCurved(e,y,P,M,b)}_placeStraight(e,t,s,i){const{out:r,id:n,shaping:a,referenceBounds:o}=this._current,{x:c,y:l}=e;r.metricStart(this._createLineLabelMetric(n,s,i,c,l)),r.metricBoxWrite(a.boundsT);const h=e.angle*(180/Math.PI)%360,d=(e.angle*(180/Math.PI)+180)%360;if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const e={clipAngle:h,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(r,n,c,l,a,0,o,e,!1)}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const e={clipAngle:d,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(r,n,c,l,a,0,o,e,!1)}r.metricEnd()}_placeCurved(e,t,s,i,r){const{out:n,id:a}=this._current;n.metricStart(this._createLineLabelMetric(a,i,r,e.x,e.y));const o=e.clone(),c=e.angle*(180/Math.PI)%360,l=(e.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(o,t,1,c),this._placeBack(e,o,t,s,1,c),this._placeForward(e,o,t,s,1,c)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(o,t,0,l),this._placeBack(e,o,t,s,0,l),this._placeForward(e,o,t,s,0,l)),n.metricEnd()}_placeStraightAlong(e,t,s,r){const{out:n,id:a,shaping:o,zoomRange:c,referenceBounds:l}=this._current,{boxBorderLineColor:h,boxBackgroundColor:d}=this.evaluatedMeshParams,u=e.clone(),m=e.angle*(180/Math.PI)%360,f=(e.angle*(180/Math.PI)+180)%360,p=o.glyphs.length>0&&!(!h&&!d);if(n.metricStart(this._createLineLabelMetric(a,s,r,e.x,e.y)),p){const s=Math.max(t,c[0],0),r=Math.min(ie.GJ,c[1]),h=(0,W.$0)((0,G.vt)(),-e.angle),d={minZoom:s,maxZoom:r,clipAngle:m,mapAligned:!0,isLineLabel:!0},u=(0,i.Lz)(this.evaluatedMeshParams.offsetX),p=(0,i.Lz)(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const t=(0,F.fA)(u,-1*p),[s,i]=o.shapeBackground((0,W.Tl)((0,G.vt)(),h,t));n.recordStart(this.instanceId,this.attributeLayout,o.glyphs[0].textureBinding),this._writeTextBox(n,a,e.x,e.y,i,l,d),n.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const t=(0,F.fA)(u,p),[s,i]=o.shapeBackground((0,W.Tl)((0,G.vt)(),h,t));d.clipAngle=f,n.recordStart(this.instanceId,this.attributeLayout,o.glyphs[0].textureBinding),this._writeTextBox(n,a,e.x,e.y,i,l,d),n.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(u,t,1,m,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(u,t,0,f,!0),n.metricEnd()}_placeBack(e,t,s,i,r,n){const a=e.clone();let o=e.backwardLength+0;for(;a.prev()&&!(o>=i);)this._placeOnSegment(a,t,o,s,-1,r,n),o+=a.length+0}_placeForward(e,t,s,i,r,n){const a=e.clone();let o=e.remainingLength+0;for(;a.next()&&!(o>=i);)this._placeOnSegment(a,t,o,s,1,r,n),o+=a.length+0}_placeFirst(e,t,s,r){let n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const{out:a,id:o,shaping:c,zoomRange:l,referenceBounds:h}=this._current,d=c.glyphs,u=(0,i.Lz)(this.evaluatedMeshParams.offsetX),m=(0,i.Lz)(this.evaluatedMeshParams.offsetY),f=(0,F.fA)(u,m),p=(0,W.$0)((0,G.vt)(),-e.angle);(0,O.l0)(f,f,p);for(const i of d){const d=i.x>c.bounds.x?s:1-s,u=d*e.remainingLength+(1-d)*e.backwardLength,m=Math.abs(i.x+i.width/2-c.bounds.x),p=Math.max(0,this._zoomLevel+Math.log2(m/(u+0))),_=Math.max(t,n?0:p);if(i.maxZoom=Math.min(l[1],ie.GJ),i.angle=e.angle+(1-s)*Math.PI,i.minZoom=Math.max(l[0],_),this._writeLineGlyph(a,o,e.x,e.y,i,r,h,!0),(s||this._current.offsetDirection)&&this._isVisible(i.minZoom,i.maxZoom)){const e=new q.A(i.bounds.x+f[0],i.bounds.y+f[1],i.bounds.width,i.bounds.height);a.metricBoxWrite(e)}}}_placeOnSegment(e,t,s,r,n,a,o){const{out:c,id:l,shaping:h,referenceBounds:d}=this._current,u=h.glyphs,m=e.dx/e.length,f=e.dy/e.length,p={x:e.x+s*-n*m,y:e.y+s*-n*f},_=(0,i.Lz)(this.evaluatedMeshParams.offsetX),g=(0,i.Lz)(this.evaluatedMeshParams.offsetY),v=(0,F.fA)(_,g),y=(0,W.$0)((0,G.vt)(),-e.angle);(0,O.l0)(v,v,y);for(const i of u){const t=i.x>h.bounds.x?a:1-a;if(!(t&&1===n||!t&&-1===n))continue;const u=Math.abs(i.x+i.width/2-h.bounds.x),m=Math.max(0,this._zoomLevel+Math.log2(u/s)-.1),f=Math.max(r,this._zoomLevel+Math.log2(u/(s+e.length+0)));if(0!==m&&(i.angle=e.angle+(1-a)*Math.PI,i.minZoom=f,i.maxZoom=m,this._writeLineGlyph(c,l,p.x,p.y,i,o,d,!0),(a||this._current.offsetDirection)&&this._isVisible(i.minZoom,i.maxZoom))){const e=new q.A(i.bounds.x+v[0],i.bounds.y+v[1],i.bounds.width,i.bounds.height);c.metricBoxWrite(e)}}}_writeLineGlyph(e,t,s,i,r,n,a,c){if(s<0||s>o.CQ||i<0||i>o.CQ)return;e.recordStart(this.instanceId,this.attributeLayout,r.textureBinding);const{texcoords:l,offsets:h}=r,{fontSize:d,haloSize:u,outlineSize:m}=this._textMeshTransformProps;this._writeQuad(e,t,s,i,{texcoords:l,offsets:h,fontSize:d,haloSize:u,outlineSize:m,color:(0,x.Jb)(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:a,minZoom:Math.max(this._current.zoomRange[0],r.minZoom),maxZoom:Math.min(this._current.zoomRange[1],r.maxZoom),clipAngle:n,mapAligned:c,isLineLabel:!0}),e.recordEnd()}_packedZoom(e){return Math.floor(e*o.fq)/o.fq}_isVisible(e,t){let s=Math.max(this._current.zoomRange[0],e),i=Math.min(this._current.zoomRange[1],t);s=this._packedZoom(s),i=this._packedZoom(i);const r=this._packedZoom(this._zoomLevel);return s<=r&&r<=i}}function ae(e,t,s){const{coords:i,lengths:r}=t,n=(0,Z.vt)(),a=(0,Z.vt)(),o=(0,Z.vt)(),c=(0,Z.vt)(),l=(0,Z.vt)(),h=(0,Z.vt)();let d=0;for(let u=0;u<r.length;u++){const t=r[u];for(let r=0;r<t;r++){const u=2*(r+d-1),m=2*(r+d),f=2*(r+d+1);r>0?(0,O.hZ)(n,i[u],i[u+1]):(0,O.hZ)(n,0,0),(0,O.hZ)(a,i[m],i[m+1]),r<t-1?(0,O.hZ)(o,i[f],i[f+1]):(0,O.hZ)(o,0,0),0===r?(0,O.hZ)(c,0,0):((0,O.jb)(c,a,n),(0,O.S8)(c,c),(0,O.hZ)(c,c[1],-c[0])),r===t-1?(0,O.hZ)(l,0,0):((0,O.jb)(l,o,a),(0,O.S8)(l,l),(0,O.hZ)(l,l[1],-l[0])),(0,O.WQ)(h,c,l),(0,O.S8)(h,h);const p=h[0]*l[0]+h[1]*l[1];0!==p&&(0,O.hs)(h,h,p),(0,O.hs)(h,h,s),e.coords.push(a[0]+h[0],a[1]+h[1])}e.lengths.push(t),d+=t}return e}var oe=s(29300),ce=s(26455),le=s(4480),he=s(18690),de=s(50076),ue=s(53084),me=s(76460),fe=s(81456),pe=s(95776),_e=s(59872),ge=s(32252),ve=s(27534),ye=s(74014);const xe=()=>me.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator");async function Pe(e,t,s,i){const{defaultValue:r,valueExpressionInfo:n,value:a}=t;if(n){if("dictionary-template"===n.type)return(0,h.A)((0,h.A)({},t),{},{computed:e.createDictionaryTemplateField(n,s),defaultValue:r});const{expression:a}=n,o=await e.createComputedField({expression:a},i);return o?(0,h.A)((0,h.A)({},t),{},{computed:o,defaultValue:r}):null}return(0,h.A)((0,h.A)({},t),{},{computed:new ye.G(a),defaultValue:r})}async function Me(e,t,s){const{valueExpressionInfo:i}=t,r="dictionary-template"===i.type?e.createDictionaryTemplateField(i,s):await e.createComputedField({expression:i.expression});return r?(0,h.A)((0,h.A)({},t),{},{computed:r}):null}function be(e){return"object"==typeof e&&null!=e&&(!(!("valueExpressionInfo"in e)||!e.valueExpressionInfo)||"type"in e&&"Process"===e.type&&"op"in e&&"Random"===e.op)}function we(e){if(Array.isArray(e))for(const t of e)if(we(t))return!0;if("object"==typeof e){if(be(e))return!0;for(const t in e)if(we(e[t]))return!0}return!1}class Ie{static async create(e,t,s,i){const r={},n=new Map,a=new Map,o=new Map,c=new Map,l=new Map,h=new Map;for(const m in s){const f=s[m];if(null!=f&&"object"==typeof f)if(Array.isArray(f)){if("object"==typeof f[0])throw new Error("InternalError: Cannot handle ".concat(m,". Nested array params are not supported"));r[m]=f}else{if("valueExpressionInfo"in f){if(f.value){r[m]=f.value;continue}const t=await Me(e,f,i);if(!t){r[m]=f.defaultValue;continue}n.set(m,t),r[m]=null;continue}switch(f.type){case"cim-effect-infos":if(f.effectInfos.some(e=>e.overrides.length)){a.set(m,{effects:await Promise.all(f.effectInfos.map(async t=>{const s=t.overrides.map(t=>Pe(e,t,i,!1));return{effect:t.effect,compiledOverrides:(await Promise.all(s)).filter(he.Ru)}}))});break}r[m]=f.effectInfos.map(e=>e.effect);break;case"cim-marker-placement-param":f.overrides.length&&o.set(m,{placementInfo:f,compiledOverrides:(await Promise.all(f.overrides.map(t=>Pe(e,t,i,!1)))).filter(he.Ru)}),r[m]=f.placement;break;case"text-rasterization-param":{var d;if(f.overrides.length){const t=f.overrides.map(t=>{var s;return Pe(e,t,i,null!==(s=f.useLegacyLabelEvaluationRules)&&void 0!==s&&s)});c.set(m,{compiledOverrides:(await Promise.all(t)).filter(he.Ru),rasterizationParam:f,objectIdToResourceId:new Map});continue}const s={type:"cim-rasterization-info",resource:f.resource};r[m]=null!==(d=await t.fetchResourceImmediate(s))&&void 0!==d?d:null;break}case"sprite-rasterization-param":{var u;if(f.overrides.length){const t=f.overrides.map(t=>Pe(e,t,i,!1));c.set(m,{compiledOverrides:(await Promise.all(t)).filter(he.Ru),rasterizationParam:f,objectIdToResourceId:new Map});continue}if("animated"===f.resource.type){c.set(m,{compiledOverrides:[],rasterizationParam:f,objectIdToResourceId:new Map});continue}const s={type:"cim-rasterization-info",resource:f.resource};r[m]=null!==(u=await t.fetchResourceImmediate(s))&&void 0!==u?u:null;break}case"cim-marker-transform-param":{const{params:t}=f;if(we(t)){const s={compiledMarkerInfos:[]};await Promise.all(t.map(async t=>{const r={props:{}};for(const s in t)if(be(t[s])){const n=await Me(e,t[s],i);r.compiledExpressionMap||(r.compiledExpressionMap=new Map);const a=r.compiledExpressionMap;n&&a.set(s,n)}else r.props[s]=t[s];s.compiledMarkerInfos.push(r)})),l.set(m,s)}else r[m]={type:"cim-marker-transform-info",infos:t};break}case"animation-params":{const{params:s}=f,i=(0,ge.oo)(s);if(we(i)){const t=await Promise.all(i.map(t=>(0,ge.N)(t,e)));h.set(m,{params:t,propertyIdToResourceId:new Map,key:m})}else{const e=(0,ge.rS)(i),s=await t.fetchResourceImmediate({type:"animation-info",resource:e});null!=s&&"sprite"===s.type&&(r[m]={dataRow:s.rect.y,dataColumn:s.rect.x})}break}default:r[m]=f}}else r[m]=f}return new Ie(s,r,n,a,o,c,l,h)}constructor(e,t,s,i,r,n,a,o){this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=s,this._dynamicEffectProperties=i,this._dynamicPlacementProperties=r,this._dynamicAsyncProperties=n,this._dynamicTransformProperties=a,this._dynamicAsyncAnimations=o,this.evaluator=e=>e,this._arcadeDependencies=new Set;for(const c of this._expressions())(0,fe.QY)(this._arcadeDependencies,c)}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,s){for(const i of this._dynamicAsyncProperties.values()){const r=(0,ue.o8)(i.rasterizationParam.resource);"animated"===i.rasterizationParam.resource.type&&i.rasterizationParam.resource.randomizeStartTime&&(r.primitiveName="__RESERVED__PRIMITIVE__NAME__",r.startGroup=(0,pe.A)(t.getObjectId()||0));for(const{primitiveName:e,propertyName:a,computed:o,defaultValue:c,valueExpressionInfo:l}of i.compiledOverrides)try{const n="animated"===i.rasterizationParam.resource.type?r.primitiveName:e;(0,ve.Ph)(r,n,a,o,t,s,c)}catch(X){xe().errorOnce(new de.A("invalid-arcade-expression","Encountered an error when evaluating the arcade expression",{error:X,valueExpressionInfo:l}))}const n=e.enqueueRequest({type:"cim-rasterization-info",resource:r});i.objectIdToResourceId.set(t.getObjectId(),n)}for(const i of this._dynamicAsyncAnimations.values()){const r=i.params.map(e=>(0,ge.SM)(e,t,s)).map(_e.Qv).map(e=>e.simplify()),n=(0,ge.aM)(r),a=e.enqueueRequest({type:"animation-info",resource:n});i.propertyIdToResourceId.set(t.getObjectId()+"."+i.key,a)}}evaluateMeshParams(e,t,s){for(const[i,r]of this._dynamicProperties.entries())this._resolvedMeshParams[i]=r.computed.readWithDefault(t,s,r.defaultValue);for(const[i,r]of this._dynamicPlacementProperties.entries())for(const{computed:e,defaultValue:n,propertyName:a}of r.compiledOverrides){const o=e.readWithDefault(t,s,n);r.placementInfo.placement[a]=o,this._resolvedMeshParams[i]=r.placementInfo.placement}for(const[i,r]of this._dynamicEffectProperties.entries())for(const e of r.effects){for(const{computed:i,defaultValue:r,propertyName:n}of e.compiledOverrides){const a=i.readWithDefault(t,s,r);e.effect[n]=a}this._resolvedMeshParams[i]=r.effects.map(e=>e.effect)}for(const[i,r]of this._dynamicTransformProperties.entries()){const e={type:"cim-marker-transform-info",infos:[]};for(const i of r.compiledMarkerInfos){const r=(0,h.A)({},i.props);if(i.compiledExpressionMap)for(const[e,n]of i.compiledExpressionMap){const i=n.computed.readWithDefault(t,s,n.defaultValue);r[e]="number"==typeof i||"boolean"==typeof i?i:n.defaultValue}e.infos.push(r)}this._resolvedMeshParams[i]=e}for(const[i,r]of this._dynamicAsyncProperties.entries()){const s=r.objectIdToResourceId.get(t.getObjectId());if(null==s)continue;const n=e.getResource(s);this._resolvedMeshParams[i]=n}for(const[i,r]of this._dynamicAsyncAnimations.entries()){const s=r.propertyIdToResourceId.get(t.getObjectId()+"."+i);if(null==s)continue;const n=e.getResource(s);this._resolvedMeshParams[i]={dataRow:n.rect.y,dataColumn:n.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}*_expressions(){for(const e of this._dynamicProperties.values())yield e.computed;for(const e of this._dynamicEffectProperties.values())for(const t of e.effects)for(const e of t.compiledOverrides)yield e.computed;for(const e of this._dynamicPlacementProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicAsyncProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicTransformProperties.values())for(const t of e.compiledMarkerInfos)if(null!=t.compiledExpressionMap)for(const e of t.compiledExpressionMap.values())yield e.computed;for(const e of this._dynamicAsyncAnimations.values())for(const t of e.params)yield*(0,ge.ci)(t)}}var ze=s(41406);class Le{async createMeshWriter(e,t,s,i,r){const n=this._getMeshWriter(i.techniqueType),a=await Ie.create(e,t,i.inputParams,r),o=new n(i.id,a,i.optionalAttributes,s);return await o.loadDependencies(),o}_getMeshWriter(e){switch(e){case 13:return A.Y;case 11:return z.k;case 9:return L.KE;case 26:return D.m;case 14:return k.S;case 24:return E.w0;case 27:return R.Q;case 10:return S.O;case 21:return le.H;case 28:return ze.v;case 30:return ie.G8;case 19:return P.Bw;case 31:return ce.K;case 15:return oe.F;case 17:return C.h;case 18:return ne;case 2:return p;case 3:return _;case 0:return b;case 1:return I;default:throw new Error("Internal Error: Mesh writer not in the registry")}}}},74014:(e,t,s)=>{s.d(t,{G:()=>r});var i=s(33219);class r extends i.L{constructor(e){super(),this._value=e}resize(e){}read(e,t){return this._value}readWithDefault(e,t,s){return this._value}hasArcadeDependency(e){return!1}}}}]);
//# sourceMappingURL=2131.faef6f80.chunk.js.map