"use strict";(self.webpackChunkmmsp_land_hl=self.webpackChunkmmsp_land_hl||[]).push([[5971],{2687:(t,e,i)=>{i.d(e,{N5:()=>c});var n,r,s=i(50076),o=(i(81806),i(76460));const a=()=>o.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class l{constructor(){this._includedModules=new Map}include(t,e){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,e),t(this.builder,e))}}class c extends l{constructor(){super(...arguments),this.vertex=new f,this.fragment=new f,this.attributes=new v,this.varyings=new p,this.extensions=new g,this.outputs=new m}get fragmentUniforms(){return this.fragment.uniforms.entries}get attributeNames(){return this.attributes.names}get builder(){return this}generate(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this.extensions.generateSource(t),n=this.attributes.generateSource(t),r=this.varyings.generateSource(t),s="vertex"===t?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=s.main.generateSource(e),c="vertex"===t?x:y,u=s.constants.generateSource(),h=this.outputs.generateSource(t);return"#version 300 es\n".concat(i.join("\n"),"\n").concat(c,"\n").concat(u.join("\n"),"\n").concat(o.join("\n"),"\n").concat(n.join("\n"),"\n").concat(r.join("\n"),"\n").concat(h.join("\n"),"\n").concat(a.join("\n"),"\n").concat(l.join("\n"))}generateBind(t){const e=new Map;this.vertex.uniforms.entries.forEach(t=>{const i=t.bind[0];i&&e.set(t.name,i)}),this.fragment.uniforms.entries.forEach(t=>{const i=t.bind[0];i&&e.set(t.name,i)});const i=Array.from(e.values()),n=i.length;return e=>{for(let r=0;r<n;++r)i[r](t,e)}}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach(t=>{const i=t.bind[1];i&&e.set(t.name,i)}),this.fragment.uniforms.entries.forEach(t=>{const i=t.bind[1];i&&e.set(t.name,i)});const i=Array.from(e.values()),n=i.length;return(e,r)=>{for(let s=0;s<n;++s)i[s](t,e,r)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach(t=>{const i=t.bind[2];i&&e.set(t.name,i)}),this.fragment.uniforms.entries.forEach(t=>{const i=t.bind[2];i&&e.set(t.name,i)});const i=Array.from(e.values()),n=i.length;return(e,r,s)=>{for(let o=0;o<n;++o)i[o](t,s,e,r)}}}class u{constructor(t){this._stage=t,this._entries=new Map}add(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];for(const n of e)this._add(n);return this._stage}get(t){return this._entries.get(t)}_add(t){if(null!=t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new s.A("shaderbuilder:duplicate-uniform","Duplicate uniform name ".concat(t.name," for different uniform type"));this._entries.set(t.name,t)}else a().error("Trying to add null Uniform from ".concat((new Error).stack,"."))}generateSource(){return Array.from(this._entries.values()).map(t=>{let{name:e,arraySize:i,type:n}=t;return null!=i?"uniform ".concat(n," ").concat(e,"[").concat(i,"];"):"uniform ".concat(n," ").concat(e,";")})}get entries(){return Array.from(this._entries.values())}}class h{constructor(t){this._stage=t,this._bodies=new Array}add(t){return this._bodies.push(t),this._stage}generateSource(t){if(this._bodies.length>0)return["void main() {\n ".concat(this._bodies.join("\n")||""," \n}")];if(t)throw new s.A("shaderbuilder:missing-main","Shader does not contain main function body.");return[]}}class d{constructor(t){this._stage=t,this._entries=new Array}add(t){return this._entries.push(t),this._stage}generateSource(){return this._entries}}class f extends l{constructor(){super(...arguments),this.uniforms=new u(this),this.main=new h(this),this.code=new d(this),this.constants=new _(this)}get builder(){return this}}class v{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map(t=>"in ".concat(t[1]," ").concat(t[0],";"))}get names(){return this._entries.map(t=>{let[e]=t;return e})}}class p{constructor(){this._entries=new Map}add(t,e,i){var n;this._entries.has(t)?a().warn("Ignoring duplicate varying ".concat(e," ").concat(t)):this._entries.set(t,{type:e,invariant:null!==(n=null===i||void 0===i?void 0:i.invariant)&&void 0!==n&&n})}generateSource(t){const e=new Array;return this._entries.forEach((i,n)=>e.push((i.invariant&&"vertex"===t?"invariant ":"")+("int"===i.type?"flat ":"")+("vertex"===t?"out":"in")+" ".concat(i.type," ").concat(n,";"))),e}}class g{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?g.ALLOWLIST_VERTEX:g.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(t=>e.includes(t)).map(t=>"#extension ".concat(t," : enable"))}}(n=g).ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],n.ALLOWLIST_VERTEX=[];class m{constructor(){this._entries=new Map}add(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=this._entries.get(i);(null===n||void 0===n?void 0:n.name)!==t||(null===n||void 0===n?void 0:n.type)!==e?this._entries.set(i,{name:t,type:e}):a().warn("Fragment shader output location ".concat(i," occupied"))}generateSource(t){if("vertex"===t)return[];0===this._entries.size&&this._entries.set(0,{name:m.DEFAULT_NAME,type:m.DEFAULT_TYPE});const e=new Array;return this._entries.forEach((t,i)=>e.push("layout(location = ".concat(i,") out ").concat(t.type," ").concat(t.name,";"))),e}}(r=m).DEFAULT_TYPE="vec4",r.DEFAULT_NAME="fragColor";class _{constructor(t){this._stage=t,this._entries=new Set}add(t,e,i){let n="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":n=_._numberToFloatStr(i);break;case"int":n=_._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n="vec2(".concat(_._numberToFloatStr(i[0]),",                            ").concat(_._numberToFloatStr(i[1]),")");break;case"vec3":n="vec3(".concat(_._numberToFloatStr(i[0]),",                            ").concat(_._numberToFloatStr(i[1]),",                            ").concat(_._numberToFloatStr(i[2]),")");break;case"vec4":n="vec4(".concat(_._numberToFloatStr(i[0]),",                            ").concat(_._numberToFloatStr(i[1]),",                            ").concat(_._numberToFloatStr(i[2]),",                            ").concat(_._numberToFloatStr(i[3]),")");break;case"ivec2":n="ivec2(".concat(_._numberToIntStr(i[0]),",                             ").concat(_._numberToIntStr(i[1]),")");break;case"ivec3":n="ivec3(".concat(_._numberToIntStr(i[0]),",                             ").concat(_._numberToIntStr(i[1]),",                             ").concat(_._numberToIntStr(i[2]),")");break;case"ivec4":n="ivec4(".concat(_._numberToIntStr(i[0]),",                             ").concat(_._numberToIntStr(i[1]),",                             ").concat(_._numberToIntStr(i[2]),",                             ").concat(_._numberToIntStr(i[3]),")");break;case"uvec2":n="uvec2(".concat(_._numberToIntStr(i[0]),",                             ").concat(_._numberToIntStr(i[1]),")");break;case"uvec3":n="uvec3(".concat(_._numberToIntStr(i[0]),",                             ").concat(_._numberToIntStr(i[1]),",                             ").concat(_._numberToIntStr(i[2]),")");break;case"uvec4":n="uvec4(".concat(_._numberToIntStr(i[0]),",                             ").concat(_._numberToIntStr(i[1]),",                             ").concat(_._numberToIntStr(i[2]),",                             ").concat(_._numberToIntStr(i[3]),")");break;case"mat2":case"mat3":case"mat4":n="".concat(e,"(").concat(Array.prototype.map.call(i,t=>_._numberToFloatStr(t)).join(", "),")")}return this._entries.add("const ".concat(e," ").concat(t," = ").concat(n,";")),this._stage}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const y="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n  precision highp usampler2D;\n  precision highp sampler2DArray;\n  precision highp sampler2DShadow;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n  precision mediump usampler2D;\n  precision mediump sampler2DArray;\n  precision mediump sampler2DShadow;\n#endif",x="precision highp float;\n precision highp sampler2D;\n precision highp usampler2D;\n precision highp sampler2DArray;\n precision highp sampler2DShadow;\n\n\n invariant gl_Position;\n "},3799:(t,e,i)=>{i.d(e,{NB:()=>f,Nz:()=>m,S7:()=>g,yu:()=>d});var n=i(34761),r=i(13191),s=i(20664),o=i(9392),a=i(84115),l=i(72468),c=i(23148),u=i(23687),h=i(12216);function d(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",o.uY):t.uniforms.add(new l.W("cameraPosition",(t,e)=>(0,s.j)(p,e.camera.viewInverseTransposeMatrix[3]-t.origin[0],e.camera.viewInverseTransposeMatrix[7]-t.origin[1],e.camera.viewInverseTransposeMatrix[11]-t.origin[2])))}function f(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new u.F("proj",t=>t.camera.projectionMatrix),new h.S("view",(t,e)=>(0,n.Tl)(v,e.camera.viewMatrix,t.origin)),new l.W("localOrigin",t=>t.origin));const i=t=>{let{camera:e}=t;return(0,s.j)(p,e.viewInverseTransposeMatrix[3],e.viewInverseTransposeMatrix[7],e.viewInverseTransposeMatrix[11])};t.uniforms.add(new u.F("proj",t=>t.camera.projectionMatrix),new u.F("view",t=>(0,n.Tl)(v,t.camera.viewMatrix,i(t))),new a.d("localOrigin",t=>i(t)))}const v=(0,r.vt)(),p=(0,o.vt)();function g(t){t.uniforms.add(new u.F("viewNormal",t=>t.camera.viewInverseTransposeMatrix))}function m(t){t.uniforms.add(new c.U("pixelRatio",t=>t.camera.pixelRatio/t.overlayStretch))}},4653:(t,e,i)=>{i.d(e,{x:()=>r});var n=i(87003);class r extends n.n{constructor(t,e){super(t,"sampler2D",0,(i,n)=>i.bindTexture(t,e(n)))}}},4763:(t,e,i)=>{i.d(e,{C:()=>v,DV:()=>g,Qy:()=>f,ST:()=>x,bU:()=>w,c8:()=>S,ig:()=>y,m7:()=>m,pw:()=>_,ui:()=>p,vt:()=>d});var n=i(97467),r=i(34761),s=i(20664),o=i(9392),a=i(43047),l=i(55855),c=i(49595),u=i(13927),h=i(75762);function d(t){return t?[(0,u.vt)(t[0]),(0,u.vt)(t[1]),(0,u.vt)(t[2]),(0,u.vt)(t[3]),(0,u.vt)(t[4]),(0,u.vt)(t[5])]:[(0,u.vt)(),(0,u.vt)(),(0,u.vt)(),(0,u.vt)(),(0,u.vt)(),(0,u.vt)()]}function f(){return[(0,o.vt)(),(0,o.vt)(),(0,o.vt)(),(0,o.vt)(),(0,o.vt)(),(0,o.vt)(),(0,o.vt)(),(0,o.vt)()]}function v(t,e){for(let i=0;i<A;i++)(0,u.C)(t[i],e[i]);return t}function p(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:E;const o=(0,r.lw)(h.Rc.get(),e,t);(0,r.B8)(o,o);for(let r=0;r<T;++r){const t=(0,a.t)(h.Km.get(),M[r],o);(0,s.j)(n[r],t[0]/t[3],t[1]/t[3],t[2]/t[3])}g(i,n)}function g(t,e){(0,u.Cr)(e[4],e[0],e[3],t[0]),(0,u.Cr)(e[1],e[5],e[6],t[1]),(0,u.Cr)(e[4],e[5],e[1],t[2]),(0,u.Cr)(e[3],e[2],e[6],t[3]),(0,u.Cr)(e[0],e[1],e[2],t[4]),(0,u.Cr)(e[5],e[4],e[7],t[5])}function m(t,e){for(let i=0;i<A;i++){const n=t[i];if(n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]>=e[3])return!1}return!0}function _(t,e){return b(t,(0,c.$e)(e,C.get()))}function y(t,e){for(let i=0;i<A;i++){const n=t[i];if(!(0,u.b6)(n,e))return!1}return!0}function x(t,e,i){return b(t,(0,c.Eo)(e,i,C.get()))}function w(t,e){for(let i=0;i<A;i++)if((0,u.mN)(t[i],e)>0)return!1;return!0}function b(t,e){for(let i=0;i<A;i++)if(!(0,u.$Q)(t[i],e))return!1;return!0}const S={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},A=6,T=8,M=[(0,l.fA)(-1,-1,-1,1),(0,l.fA)(1,-1,-1,1),(0,l.fA)(1,1,-1,1),(0,l.fA)(-1,1,-1,1),(0,l.fA)(-1,-1,1,1),(0,l.fA)(1,-1,1,1),(0,l.fA)(1,1,1,1),(0,l.fA)(-1,1,1,1)],C=new n.I(c.vt),E=f()},4998:(t,e,i)=>{i.d(e,{TA:()=>T,uH:()=>A});var n=i(15941),r=i(20664),s=i(9392),o=i(71011);function a(t,e,i){(i=i||t).length=t.length;for(let n=0;n<t.length;n++)i[n]=t[n]*e[n];return i}function l(t,e,i){(i=i||t).length=t.length;for(let n=0;n<t.length;n++)i[n]=t[n]*e;return i}function c(t,e,i){(i=i||t).length=t.length;for(let n=0;n<t.length;n++)i[n]=t[n]+e[n];return i}function u(t){return(t+1)*(t+1)}function h(t,e,i){const n=t[0],r=t[1],s=t[2],o=i||[];return o.length=u(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*n,o[2]=.4886025119*s,o[3]=.4886025119*r),e>=2&&(o[4]=1.09254843059*n*r,o[5]=1.09254843059*r*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*n*s,o[8]=.54627421529*(n*n-r*r)),o}function d(t,e){const i=u(t),n=e||{r:[],g:[],b:[]};n.r.length=n.g.length=n.b.length=i;for(let r=0;r<i;r++)n.r[r]=n.g[r]=n.b[r]=0;return n}function f(t,e){const i=function(t){return(0,n.qE)(Math.floor(Math.sqrt(t)-1),0,2)}(e.r.length);for(const n of t)(0,r.u)(x,n.direction),h(x,i,_),a(_,w),l(_,n.intensity[0],y),c(e.r,y),l(_,n.intensity[1],y),c(e.g,y),l(_,n.intensity[2],y),c(e.b,y);return e}function v(t,e){h(x,0,_);for(const i of t)e.r[0]+=_[0]*w[0]*i.intensity[0]*4*Math.PI,e.g[0]+=_[0]*w[0]*i.intensity[1]*4*Math.PI,e.b[0]+=_[0]*w[0]*i.intensity[2]*4*Math.PI;return e}const p=[],g=[],m=[],_=[0],y=[0],x=(0,s.vt)(),w=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];class b{constructor(){this.color=(0,s.vt)(),this.intensity=1}}class S{constructor(){this.direction=(0,s.vt)(),this.ambient=new b,this.diffuse=new b}}const A=.4;class T{constructor(){this._shOrder=2,this._legacy=new S,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new o.e_,this._mainLight=new o.Qx((0,s.vt)(),(0,s.fA)(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(t){(function(t,e,i,n){d(e,n),(0,r.j)(i.intensity,0,0,0);let s=!1;const a=p,l=g,u=m;a.length=0,l.length=0,u.length=0;for(const c of t)c instanceof o.Qx&&!s?((0,r.d)(i.direction,c.direction),(0,r.d)(i.intensity,c.intensity),i.specularStrength=c.specularStrength,i.environmentStrength=c.environmentStrength,i.castShadows=c.castShadows,s=!0):c instanceof o.Qx||c instanceof o._y?a.push(c):c instanceof o.$p?l.push(c):c instanceof o.e_&&u.push(c);f(a,n),v(l,n);for(const r of u)c(n.r,r.r),c(n.g,r.g),c(n.b,r.b)})(t,this._shOrder,this._mainLight,this._sphericalHarmonics),this.updateLegacy()}updateLegacy(){(0,r.d)(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,(0,r.h)(this._legacy.diffuse.color,this._mainLight.intensity,t),(0,r.d)(M,this._legacy.diffuse.color),(0,r.h)(M,M,A*this.globalFactor),(0,r.g)(this._legacy.ambient.color,this._legacy.ambient.color,M)}copyFrom(t){this._sphericalHarmonics.r=Array.from(t.sh.r),this._sphericalHarmonics.g=Array.from(t.sh.g),this._sphericalHarmonics.b=Array.from(t.sh.b),(0,r.d)(this._mainLight.direction,t.mainLight.direction),(0,r.d)(this._mainLight.intensity,t.mainLight.intensity),this._mainLight.castShadows=t.mainLight.castShadows,this._mainLight.specularStrength=t.mainLight.specularStrength,this._mainLight.environmentStrength=t.mainLight.environmentStrength,this.globalFactor=t.globalFactor,this.noonFactor=t.noonFactor}lerpLighting(t,e,i){if((0,r.l)(this._mainLight.intensity,t.mainLight.intensity,e.mainLight.intensity,i),this._mainLight.environmentStrength=(0,n.Cc)(t.mainLight.environmentStrength,e.mainLight.environmentStrength,i),this._mainLight.specularStrength=(0,n.Cc)(t.mainLight.specularStrength,e.mainLight.specularStrength,i),(0,r.d)(this._mainLight.direction,e.mainLight.direction),this._mainLight.castShadows=e.mainLight.castShadows,this.globalFactor=(0,n.Cc)(t.globalFactor,e.globalFactor,i),this.noonFactor=(0,n.Cc)(t.noonFactor,e.noonFactor,i),t.sh.r.length===e.sh.r.length)for(let r=0;r<e.sh.r.length;r++)this._sphericalHarmonics.r[r]=(0,n.Cc)(t.sh.r[r],e.sh.r[r],i),this._sphericalHarmonics.g[r]=(0,n.Cc)(t.sh.g[r],e.sh.g[r],i),this._sphericalHarmonics.b[r]=(0,n.Cc)(t.sh.b[r],e.sh.b[r],i);else for(let n=0;n<e.sh.r.length;n++)this._sphericalHarmonics.r[n]=e.sh.r[n],this._sphericalHarmonics.g[n]=e.sh.g[n],this._sphericalHarmonics.b[n]=e.sh.b[n];this.updateLegacy()}}const M=(0,s.vt)()},5517:(t,e,i)=>{i.d(e,{t:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"vec3",1,(n,r,s)=>n.setUniform3fv(t,e(r,s),i))}}},6381:(t,e,i)=>{function n(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":case"f16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}i.d(e,{GJ:()=>n})},6485:(t,e,i)=>{i.d(e,{K:()=>a,W:()=>l});var n=i(50076),r=i(18690);class s{constructor(t){this._bits=[...t]}equals(t){return(0,r.aI)(this._bits,t.bits)}get code(){var t;return null!==(t=this._code)&&void 0!==t||(this._code=String.fromCharCode(...this._bits)),this._code}get bits(){return this._bits}}var o=i(31432);class a extends o.Y{constructor(){var t,e,i;super(),this._parameterBits=null!==(t=null===(e=this._parameterBits)||void 0===e?void 0:e.map(()=>0))&&void 0!==t?t:[],null!==(i=this._parameterNames)&&void 0!==i||(this._parameterNames=[])}get key(){var t;return null!==(t=this._key)&&void 0!==t||(this._key=new s(this._parameterBits)),this._key}decode(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.key;const e=this._parameterBits;this._parameterBits=[...t.bits];const i=this._parameterNames.map(t=>"    ".concat(t,": ").concat(this[t])).join("\n");return this._parameterBits=e,i}}function l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(e,i)=>{var r,s,o,a;e.hasOwnProperty("_parameterNames")||Object.defineProperty(e,"_parameterNames",{value:null!==(r=null===(s=e._parameterNames)||void 0===s?void 0:s.slice())&&void 0!==r?r:[],configurable:!0,writable:!0}),e.hasOwnProperty("_parameterBits")||Object.defineProperty(e,"_parameterBits",{value:null!==(o=null===(a=e._parameterBits)||void 0===a?void 0:a.slice())&&void 0!==o?o:[0],configurable:!0,writable:!0}),e._parameterNames.push(i);const l=t.count||2,c=Math.ceil(Math.log2(l)),u=e._parameterBits;let h=0;for(;u[h]+c>16;)h++,h>=u.length&&u.push(0);const d=u[h],f=(1<<c)-1<<d;u[h]+=c,t.count?Object.defineProperty(e,i,{get(){return(this._parameterBits[h]&f)>>d},set(e){if(this[i]!==e){if(this._key=null,this._parameterBits[h]=this._parameterBits[h]&~f|+e<<d&f,"number"!=typeof e)throw new n.A("internal:invalid-shader-configuration","Configuration value for ".concat(i," must be a number, got ").concat(typeof e));if(null==t.count)throw new n.A("internal:invalid-shader-configuration","Configuration value for ".concat(i," must provide a count option"))}}}):Object.defineProperty(e,i,{get(){return!!((this._parameterBits[h]&f)>>d)},set(t){if(this[i]!==t&&(this._key=null,this._parameterBits[h]=this._parameterBits[h]&~f|+t<<d&f,"boolean"!=typeof t))throw new n.A("internal:invalid-shader-configuration","Configuration value for ".concat(i," must be boolean, got ").concat(typeof t))}})}}},9243:(t,e,i)=>{i.d(e,{R:()=>r});var n=i(76718);class r extends n.g{constructor(t,e,i){super(t,34962,arguments.length>3&&void 0!==arguments[3]?arguments[3]:35044,i),this.layout=e}}},9937:(t,e,i)=>{i.d(e,{n:()=>r});var n=i(6485);class r extends n.K{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}},11850:(t,e,i)=>{i.d(e,{Nx:()=>c,wR:()=>o});var n=i(93345),r=i(75757),s=i(21812);const o=[],a=[new s._("position",3,n.pe.FLOAT,0,12)],l=[new s._("position",2,n.pe.FLOAT,0,8)],c=(0,r.Xk)(l);(0,r.Xk)(a),new s._("position",2,n.pe.FLOAT,0,12),new s._("uv0",2,n.pe.HALF_FLOAT,8,12),new s._("position",2,n.pe.FLOAT,0,16),new s._("uv0",2,n.pe.FLOAT,8,16)},12028:(t,e,i)=>{i.d(e,{PS:()=>r,fc:()=>s,tl:()=>o});i(81806);var n=i(15941);class r{constructor(){this._scale=0,this._angleFactor=0,this._minScale=0}update(t,e,i,n){i?(this._scale=Math.min(i.divisor/(e-i.offset),1),this._angleFactor=function(t){return Math.abs(t)**3}(t),this._minScale=null!=n?Math.min(i.minPixelSize/n,1):0):(this._scale=1,this._minScale=1,this._angleFactor=1)}apply(t){const{_scale:e,_angleFactor:i,_minScale:r}=this;return t*(0,n.qE)((0,n.Cc)(e,1,i),r,1)}applyVec2(t,e){t[0]=this.apply(e[0]),t[1]=this.apply(e[1])}}class s{constructor(){this.evaluator=new r,this.alignmentEvaluator=new r}update(t,e,i,n,r,s){var o;this.evaluator.update(t,e,i,n),this.alignmentEvaluator.update(t,e,null!==r&&void 0!==r?r:i,null!==(o=r?s:null)&&void 0!==o?o:n)}}function o(t){return!!t&&!0}},12216:(t,e,i)=>{i.d(e,{S:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"mat4",2,(n,r,s)=>n.setUniformMatrix4fv(t,e(r,s),i))}}},15796:(t,e,i)=>{i.d(e,{F:()=>o});var n=i(89379),r=i(90632),s=i(38496);class o{constructor(t){this.id=(0,r.c)(),this._attributes=new Map;for(const[e,i]of t)this._attributes.set(e,(0,n.A)((0,n.A)({},i),{},{indices:(0,s.Dg)(i.indices)}))}get attributes(){return this._attributes}}},16506:(t,e,i)=>{i.d(e,{$:()=>n});class n{constructor(t,e){this._module=t,this._load=e}get(){return this._module}async reload(){return this._module=await this._load(),this._module}}},17345:(t,e,i)=>{i.d(e,{V:()=>y});var n=i(89379),r=i(13191),s=i(20664),o=i(38496),a=i(19059),l=i(85086),c=i(15796),u=i(9392),h=i(45097);const d=(0,u.vt)(),f=(0,u.vt)(),v=(0,u.vt)(),p=(0,u.vt)();var g=i(35416),m=i(86994),_=i(61678);class y extends c.F{constructor(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1,o=arguments.length>6?arguments[6]:void 0;super(e),this.material=t,this.mapPositions=i,this.type=n,this.olidColor=r,this.edgeIndicesLength=s,this.baseGeometry=o,this._highlights=null,this._highlightOptionsCounts=null,this.visible=!0,this._boundingInfo=null;const a=this.positionAttribute;null!=a&&this.edgeIndicesLength<0&&(this.edgeIndicesLength=a.indices.length)}instantiate(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=new y(t.material||this.material,[],this.mapPositions,this.type,this.olidColor,this.edgeIndicesLength,this.baseGeometry);return this._attributes.forEach((t,i)=>{t.exclusive=!1,e._attributes.set(i,t)}),e._boundingInfo=this._boundingInfo,e.transformation=t.transformation||this.transformation,e}getMutableAttribute(t){let e=this._attributes.get(t);return e&&!e.exclusive&&(e=(0,n.A)((0,n.A)({},e),{},{exclusive:!0,data:(0,a.S)(e.data)}),this._attributes.set(t,e)),e}setAttributeData(t,e){const i=this._attributes.get(t);i?this._attributes.set(t,(0,n.A)((0,n.A)({},i),{},{exclusive:!0,data:e})):(0,_.en)()&&console.warn("Setting undefined attribute ".concat(t," data"))}get positionAttribute(){var t,e;return null!==(t=this.attributes.get("position"))&&void 0!==t?t:null===(e=this.baseGeometry)||void 0===e?void 0:e.attributes.get("position")}get indexCount(){var t,e;const i=null===(t=this._attributes.values().next().value)||void 0===t?void 0:t.indices;return null!==(e=null===i||void 0===i?void 0:i.length)&&void 0!==e?e:0}get faceCount(){return this.indexCount/3}get boundingInfo(){var t;return null!==(t=this._boundingInfo)&&void 0!==t||(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(t){return!!(0===this.type?this._computeAttachmentOriginTriangles(t):2===this.type?this._computeAttachmentOriginLines(t):this._computeAttachmentOriginPoints(t))&&(null!=this._transformation&&(0,s.t)(t,t,this._transformation),!0)}_computeAttachmentOriginTriangles(t){return function(t,e){if(!t)return!1;const{size:i,data:n,indices:r}=t;(0,s.j)(e,0,0,0),(0,s.j)(p,0,0,0);let o=0,a=0;for(let l=0;l<r.length-2;l+=3){const t=r[l]*i,c=r[l+1]*i,u=r[l+2]*i;(0,s.j)(d,n[t],n[t+1],n[t+2]),(0,s.j)(f,n[c],n[c+1],n[c+2]),(0,s.j)(v,n[u],n[u+1],n[u+2]);const g=(0,h.Q7)(d,f,v);g?((0,s.g)(d,d,f),(0,s.g)(d,d,v),(0,s.h)(d,d,1/3*g),(0,s.g)(e,e,d),o+=g):((0,s.g)(p,p,d),(0,s.g)(p,p,f),(0,s.g)(p,p,v),a+=3)}return(0!==a||0!==o)&&(0!==o?((0,s.h)(e,e,1/o),!0):0!==a&&((0,s.h)(e,p,1/a),!0))}(this.positionAttribute,t)}_computeAttachmentOriginLines(t){const e=this.positionAttribute;return function(t,e,i){if(!t)return!1;(0,s.j)(i,0,0,0),(0,s.j)(p,0,0,0);let n=0,r=0;const{size:o,data:a,indices:l}=t,c=l.length-1,u=c+(e?2:0);for(let h=0;h<u;h+=2){const t=h<c?h+1:0,e=l[h<c?h:c]*o,u=l[t]*o;d[0]=a[e],d[1]=a[e+1],d[2]=a[e+2],f[0]=a[u],f[1]=a[u+1],f[2]=a[u+2],(0,s.h)(d,(0,s.g)(d,d,f),.5);const v=(0,s.F)(d,f);v>0?((0,s.g)(i,i,(0,s.h)(d,d,v)),n+=v):0===n&&((0,s.g)(p,p,d),r++)}return 0!==n?((0,s.h)(i,i,1/n),!0):0!==r&&((0,s.h)(i,p,1/r),!0)}(e,function(t,e){return!(!("isClosed"in t)||!t.isClosed)&&e.indices.length>2}(this.material.parameters,e),t)}_computeAttachmentOriginPoints(t){return function(t,e){if(!t)return!1;const{size:i,data:n,indices:r}=t;(0,s.j)(e,0,0,0);let o=-1,a=0;for(let s=0;s<r.length;s++){const t=r[s]*i;o!==t&&(e[0]+=n[t],e[1]+=n[t+1],e[2]+=n[t+2],a++),o=t}return a>1&&(0,s.h)(e,e,1/a),a>0}(this.positionAttribute,t)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const t=this.positionAttribute;if(!t||0===t.indices.length)return null;const e=0===this.type?3:1;(0,m.vA)(t.indices.length%e===0,"Indexing error: "+t.indices.length+" not divisible by "+e);const i=(0,o.tM)(t.indices.length/e);return new l.j(i,e,t)}get transformation(){var t;return null!==(t=this._transformation)&&void 0!==t?t:r.zK}set transformation(t){this._transformation=t&&t!==r.zK?(0,r.o8)(t):null}get highlights(){return this._highlights||x}get hasHighlights(){var t,e;return(null!==(t=null===(e=this._highlightOptionsCounts)||void 0===e?void 0:e.size)&&void 0!==t?t:0)>0}foreachHighlightOptions(t){var e;null===(e=this._highlightOptionsCounts)||void 0===e||e.forEach((e,i)=>t(i))}allocateIdAndHighlight(t){const e=new g.h(t);return this.addHighlight(e)}addHighlight(t){var e,i;this._ensureHighlights().add(t);const{highlightName:n}=t,r=(null!==(e=null===(i=this._highlightOptionsCounts)||void 0===i?void 0:i.get(n))&&void 0!==e?e:0)+1;return this._ensureHighlightOptionsCounts().set(n,r),t}_ensureHighlights(){let t=this._highlights;return t||(t=new Set,this._highlights=t),t}_ensureHighlightOptionsCounts(){let t=this._highlightOptionsCounts;return t||(t=new Map,this._highlightOptionsCounts=t),t}removeHighlight(t){var e;if(null!==(e=this._highlights)&&void 0!==e&&e.delete(t)){var i,n,r;const{highlightName:e}=t,s=null!==(i=null===(n=this._highlightOptionsCounts)||void 0===n?void 0:n.get(e))&&void 0!==i?i:0;s<=1?null===(r=this._highlightOptionsCounts)||void 0===r||r.delete(e):this._ensureHighlightOptionsCounts().set(e,s-1)}}}const x=new Set},19059:(t,e,i)=>{i.d(e,{S:()=>s});var n=i(78393),r=i(62984);function s(t){if(t.length<n.y9)return Array.from(t);if(Array.isArray(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return(0,n.LW)(t)?(0,r.pX)().from(t):(0,n.jq)(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}},19771:(t,e,i)=>{i.d(e,{J:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"float",2,(n,r,s)=>n.setUniform1f(t,e(r,s),i))}}},21390:(t,e,i)=>{i.d(e,{m:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"float",1,(n,r,s)=>n.setUniform1f(t,e(r,s),i))}}},21812:(t,e,i)=>{i.d(e,{_:()=>n});class n{constructor(t,e,i,n,r){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;this.name=t,this.count=e,this.type=i,this.offset=n,this.stride=r,this.normalized=s,this.divisor=o}}},22955:(t,e,i)=>{i.d(e,{b:()=>l});var n=i(6326),r=i(91967),s=i(46053),o=(i(81806),i(76460),i(47249),i(87990));let a=class extends r.A{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};(0,n.Cg)([(0,s.MZ)()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"LABELS_SHOW_BORDER",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"TEXT_SHOW_BASELINE",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"TEXT_SHOW_BORDER",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"OVERLAY_SHOW_CENTER",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"SHOW_POI",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"I3S_TREE_SHOW_TILES",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),(0,n.Cg)([(0,s.MZ)()],a.prototype,"LINE_WIREFRAMES",void 0),a=(0,n.Cg)([(0,o.$)("esri.views.3d.support.debugFlags")],a);const l=new a},23079:(t,e,i)=>{i.d(e,{i:()=>r});var n=i(79053);function r(t,e){return new Promise((i,r)=>{t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?i():(e((0,n.Oo)(t,"canplay",i)),e((0,n.Oo)(t,"error",r)))})}},23148:(t,e,i)=>{i.d(e,{U:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"float",0,(n,r)=>n.setUniform1f(t,e(r),i))}}},23687:(t,e,i)=>{i.d(e,{F:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"mat4",0,(n,r)=>n.setUniformMatrix4fv(t,e(r),i))}}},25530:(t,e,i)=>{i.d(e,{Ge:()=>_,VQ:()=>x,yc:()=>m});var n,r,s,o,a,l,c=i(57528),u=i(76931),h=i(43047),d=i(55855),f=i(69817),v=i(3799),p=i(58350),g=i(86955);class m{constructor(t){var e,i;this.screenLength=(0,u.Lz)(t.screenLength),this.minWorldLength=null!==(e=t.minWorldLength)&&void 0!==e?e:0,this.maxWorldLength=null!==(i=t.maxWorldLength)&&void 0!==i?i:1/0}}function _(t,e){const i=t.vertex;e.hasVerticalOffset?(x(i),e.hasScreenSizePerspective&&(t.include(f.Y6),(0,f.OH)(i),(0,v.yu)(t.vertex,e)),i.code.add((0,g.H)(n||(n=(0,c.A)(["\n      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);\n        ","\n        ","\n        // Screen sized offset in world space, used for example for line callouts\n        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\n        return worldNormal * worldOffset;\n      }\n\n      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {\n        return worldPos + calculateVerticalOffset(worldPos, localOrigin);\n      }\n    "])),e.spherical?(0,g.H)(r||(r=(0,c.A)(["vec3 worldNormal = normalize(worldPos + localOrigin);"]))):(0,g.H)(s||(s=(0,c.A)(["vec3 worldNormal = vec3(0.0, 0.0, 1.0);"]))),e.hasScreenSizePerspective?(0,g.H)(o||(o=(0,c.A)(["\n            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));\n            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);"]))):(0,g.H)(a||(a=(0,c.A)(["\n            float verticalOffsetScreenHeight = verticalOffset.x;"])))))):i.code.add((0,g.H)(l||(l=(0,c.A)(["vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }"]))))}const y=(0,d.vt)();function x(t){t.uniforms.add(new p.E("verticalOffset",(t,e)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:r}=t.verticalOffset,s=Math.tan(.5*e.camera.fovY)/(.5*e.camera.fullViewport[3]),o=e.camera.pixelRatio||1;return(0,h.s)(y,r*o,s,i,n)}))}},26917:(t,e,i)=>{i.d(e,{HQ:()=>f,rA:()=>v});var n,r,s=i(57528),o=i(34761),a=i(13191),l=i(20664),c=i(9392),u=i(72468),h=(i(5517),i(86955)),d=i(31432);d.Y;function f(t,e){m(t,e,new u.W("slicePlaneOrigin",(t,i)=>w(e,t,i)),new u.W("slicePlaneBasis1",(t,i)=>{var n;return b(e,t,i,null===(n=i.slicePlane)||void 0===n?void 0:n.basis1)}),new u.W("slicePlaneBasis2",(t,i)=>{var n;return b(e,t,i,null===(n=i.slicePlane)||void 0===n?void 0:n.basis2)}))}function v(t,e){g(t,e,new u.W("slicePlaneOrigin",(t,i)=>w(e,t,i)),new u.W("slicePlaneBasis1",(t,i)=>{var n;return b(e,t,i,null===(n=i.slicePlane)||void 0===n?void 0:n.basis1)}),new u.W("slicePlaneBasis2",(t,i)=>{var n;return b(e,t,i,null===(n=i.slicePlane)||void 0===n?void 0:n.basis2)}))}const p=(0,h.H)(n||(n=(0,s.A)(["struct SliceFactors {\nfloat front;\nfloat side0;\nfloat side1;\nfloat side2;\nfloat side3;\n};\nSliceFactors calculateSliceFactors(vec3 pos) {\nvec3 rel = pos - slicePlaneOrigin;\nvec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);\nfloat slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);\nfloat basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);\nfloat basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);\nfloat basis1Dot = dot(slicePlaneBasis1, rel);\nfloat basis2Dot = dot(slicePlaneBasis2, rel);\nreturn SliceFactors(\ndot(slicePlaneNormal, pos) + slicePlaneW,\n-basis1Dot - basis1Len2,\nbasis1Dot - basis1Len2,\n-basis2Dot - basis2Len2,\nbasis2Dot - basis2Len2\n);\n}\nbool sliceByFactors(SliceFactors factors) {\nreturn factors.front < 0.0\n&& factors.side0 < 0.0\n&& factors.side1 < 0.0\n&& factors.side2 < 0.0\n&& factors.side3 < 0.0;\n}\nbool sliceEnabled() {\nreturn dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;\n}\nbool sliceByPlane(vec3 pos) {\nreturn sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));\n}\nbool rejectBySlice(vec3 pos) {\nreturn sliceByPlane(pos);\n}"])));function g(t,e){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];e.hasSlicePlane?(t.uniforms.add(...n),t.code.add(p)):t.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function m(t,e){for(var i=arguments.length,n=new Array(i>2?i-2:0),o=2;o<i;o++)n[o-2]=arguments[o];g(t,e,...n),e.hasSlicePlane?t.code.add("\n    void discardBySlice(vec3 pos) {\n      if (sliceByPlane(pos)) {\n        discard;\n      }\n    }\n\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\n      SliceFactors factors = calculateSliceFactors(pos);\n\n      factors.front /= 2.0 * fwidth(factors.front);\n      factors.side0 /= 2.0 * fwidth(factors.side0);\n      factors.side1 /= 2.0 * fwidth(factors.side1);\n      factors.side2 /= 2.0 * fwidth(factors.side2);\n      factors.side3 /= 2.0 * fwidth(factors.side3);\n\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\n      if (sliceByFactors(factors)) {\n        return color;\n      }\n\n      float outlineFactor = (1.0 - step(0.5, factors.front))\n        * (1.0 - step(0.5, factors.side0))\n        * (1.0 - step(0.5, factors.side1))\n        * (1.0 - step(0.5, factors.side2))\n        * (1.0 - step(0.5, factors.side3));\n\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\n    }\n\n    vec4 applySlice(vec4 color, vec3 pos) {\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\n    }\n  "):t.code.add((0,h.H)(r||(r=(0,s.A)(["void discardBySlice(vec3 pos) { }\nvec4 applySlice(vec4 color, vec3 pos) { return color; }"]))))}function _(t,e,i){return t.instancedDoublePrecision?(0,l.j)(S,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function y(t,e){return null!=t?(0,l.e)(A,e.origin,t):e.origin}function x(t,e,i){return t.hasSliceTranslatedView?null!=e?(0,o.Tl)(M,i.camera.viewMatrix,e):i.camera.viewMatrix:null}function w(t,e,i){if(null==i.slicePlane)return c.uY;const n=_(t,e,i),r=y(n,i.slicePlane),s=x(t,n,i);return null!=s?(0,l.t)(A,r,s):r}function b(t,e,i,n){if(null==n||null==i.slicePlane)return c.uY;const r=_(t,e,i),s=y(r,i.slicePlane),o=x(t,r,i);return null!=o?((0,l.g)(T,n,s),(0,l.t)(A,s,o),(0,l.t)(T,T,o),(0,l.e)(T,T,A)):n}const S=(0,c.vt)(),A=(0,c.vt)(),T=(0,c.vt)(),M=(0,a.vt)()},27374:(t,e,i)=>{i.d(e,{o:()=>r});var n=i(87003);class r extends n.n{constructor(t,e){super(t,"sampler2D",2,(i,n,r)=>i.bindTexture(t,e(n,r)))}}},27963:(t,e,i)=>{i.d(e,{Ir:()=>d});var n,r=i(57528),s=i(19555),o=i(72745),a=i(43047),l=i(55855),c=i(28450),u=i(51596),h=i(86955);function d(t){t.fragment.uniforms.add(new u.I("projInfo",t=>function(t){const e=t.projectionMatrix;return 0===e[11]?(0,a.s)(f,2/(t.fullWidth*e[0]),2/(t.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):(0,a.s)(f,-2/(t.fullWidth*e[0]),-2/(t.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}(t.camera))),t.fragment.uniforms.add(new c.E("zScale",t=>function(t){return 0===t.projectionMatrix[11]?(0,s.hZ)(v,0,1):(0,s.hZ)(v,1,0)}(t.camera))),t.fragment.code.add((0,h.H)(n||(n=(0,r.A)(["vec3 reconstructPosition(vec2 fragCoord, float depth) {\nreturn vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\n}"]))))}const f=(0,l.vt)();const v=(0,o.vt)()},28450:(t,e,i)=>{i.d(e,{E:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"vec2",0,(n,r)=>n.setUniform2fv(t,e(r),i))}}},31432:(t,e,i)=>{i.d(e,{Y:()=>n});const n=class{};new n},33062:(t,e,i)=>{i.d(e,{A:()=>S});var n,r=i(6326),s=i(91967),o=i(76460),a=i(15941),l=i(76931),c=i(46053),u=(i(81806),i(47249),i(87990)),h=i(34761),d=i(13191),f=i(19555),v=i(72745),p=i(20664),g=i(9392),m=i(43047),_=i(55855),y=i(4763),x=i(95925),w=i(96190);let b=n=class extends s.A{constructor(t){super(t),this._ray=(0,x.vt)(),this._viewport=(0,_.fA)(0,0,1,1),this._padding=(0,_.fA)(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=(0,v.fA)(1,1e3),this._viewDirty=!0,this._viewMatrix=(0,d.vt)(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=(0,d.vt)(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=(0,d.vt)(),this._frustumDirty=!0,this._frustum=(0,y.vt)(),this._fullViewport=(0,_.vt)(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=(0,g.vt)(),this._up=(0,g.vt)(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get rows(){return this._rows}set rows(t){this._rows=Math.max(1,t)}get columns(){return this._columns}set columns(t){this._columns=Math.max(1,t)}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return(0,p.e)(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){(0,h.C)(this._viewMatrix,t),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),(0,p.j)((0,g.vt)(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),(0,p.j)((0,g.vt)(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),(0,p.j)((0,g.vt)(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const t=(0,m.c)((0,_.vt)(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&(0,m.e)(t,e)?e:t}get screenPadding(){if(1===this.pixelRatio)return this._padding;const t=(0,m.c)((0,_.vt)(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&(0,m.e)(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[3],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[2],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(t){this.width=t-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(t){this.height=t-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){(0,m.a)(this._padding,t)||(this._viewport[0]+=t[3]-this._padding[3],this._viewport[1]+=t[2]-this._padding[2],this._viewport[2]-=t[1]+t[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=t[0]+t[2]-(this._padding[0]+this._padding[2]),(0,m.d)(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&((0,h.lw)(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return(0,h.B8)((0,d.vt)(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||(0,d.vt)()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return function(t,e,i){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}(this._fov,this.width,this.height)}set fovX(t){this._fov=function(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/e)}(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return function(t,e,i){return 2*Math.atan(i*Math.tan(.5*t)/Math.sqrt(e*e+i*i))}(this._fov,this.width,this.height)}set fovY(t){this._fov=function(t,e,i){return 2*Math.atan(Math.sqrt(e*e+i*i)*Math.tan(.5*t)/i)}(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return(0,p.k)(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&((0,h.B8)(this._viewInverseTransposeMatrix,this.viewMatrix),(0,h.mg)(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const{near:e,far:i}=this;return 2*e*i/(i+e-t*(i-e))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const t=this.width,e=this.height,i=this.near*Math.tan(this.fovY/2)*2,n=i*this._aspect,r=i/this.rows,s=n/this.columns,o=-n/2+this.column*s,a=o+s,l=-i/2+this.row*r,c=l+r,u=(0,h.$h)((0,d.vt)(),o*(1+2*this._padding[3]/t),a*(1+2*this._padding[1]/t),l*(1+2*this._padding[2]/e),c*(1+2*this._padding[0]/e),this.near,this.far),f=this._get("projectionMatrix");return f&&(0,h.aI)(f,u)?f:u}copyFrom(t){(0,p.d)(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,(0,m.d)(this._viewport,t.viewport),this.notifyChange("_viewport"),(0,m.d)(this._padding,t.padding),this.notifyChange("_padding"),(0,f.C)(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.row=t.row,this.column=t.column,this.rows=t.rows,this.columns=t.columns,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||((0,h.C)(this._viewMatrix,t.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||((0,y.C)(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:((0,h.C)(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),(0,m.d)(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up,this.fov=t.fov}clone(){return(new n).copyFrom(this)}equals(t){return(0,p.q)(this.eye,t.eye)&&(0,p.q)(this.center,t.center)&&(0,p.q)(this.up,t.up)&&(0,m.a)(this._viewport,t.viewport)&&(0,m.a)(this._padding,t.padding)&&(0,f.t2)(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation&&this.row===t.row&&this.column===t.column&&this.rows===t.rows&&this.columns===t.columns}almostEquals(t){const e=Math.max(1,1/this.pixelRatio,1/t.pixelRatio);if(Math.abs(t.fov-this._fov)>=.001||(0,m.f)(t.screenPadding,this.screenPadding)>=e||(0,m.f)(this.screenViewport,t.screenViewport)>=e||this.row!==t.row||this.column!==t.column||this.rows!==t.rows||this.columns!==t.columns)return!1;(0,p.a)(M,t.eye,t.center),(0,p.a)(C,this.eye,this.center);const i=(0,p.f)(M,C),n=(0,p.y)(M),r=(0,p.y)(C),s=5e-4;return i*i>=(1-1e-10)*n*r&&(0,p.x)(t.eye,this.eye)<Math.max(n,r)*s*s}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perRenderPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs((0,w.gr)(this.viewForward,(0,p.e)(M,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,l.gs)();return t[0]=(this.padding[3]+this.width/2)/this.pixelRatio,t[1]=(this.padding[0]+this.height/2)/this.pixelRatio,t}getRenderCenter(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;return t[0]=this.padding[3]+this.width*e,t[1]=this.padding[2]+this.height*i,t[2]=.5,t}setGLViewport(t){const e=this.viewport,i=this.padding;t.setViewport(e[0]-i[3],e[1]-i[2],e[2]+i[1]+i[3],e[3]+i[0]+i[2])}applyProjection(t,e){t!==A&&(0,p.d)(A,t),A[3]=1,(0,m.t)(A,A,this.projectionMatrix);const i=Math.abs(A[3]);(0,p.h)(A,A,1/i);const n=this.fullViewport;e[0]=(0,a.Cc)(0,n[0]+n[2],.5+.5*A[0]),e[1]=(0,a.Cc)(0,n[1]+n[3],.5+.5*A[1]),e[2]=.5*(A[2]+1),e[3]=i}unapplyProjection(t,e){const i=this.fullViewport;A[0]=(t[0]/(i[0]+i[2])*2-1)*t[3],A[1]=(t[1]/(i[1]+i[3])*2-1)*t[3],A[2]=(2*t[2]-1)*t[3],A[3]=t[3],null!=this.inverseProjectionMatrix&&((0,m.t)(A,A,this.inverseProjectionMatrix),e[0]=A[0],e[1]=A[1],e[2]=A[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,E),this.renderToScreen(E,e),e}projectToRenderScreen(t,e){if(A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=1,(0,m.t)(A,A,this.viewProjectionMatrix),0===A[3])return null;const i=A;(0,p.h)(i,i,1/Math.abs(A[3]));const n=this.fullViewport,r=(0,a.Cc)(0,n[0]+n[2],.5+.5*i[0]),s=(0,a.Cc)(0,n[1]+n[3],.5+.5*i[1]);return"x"in e?(e.x=r,e.y=s):(e[0]=r,e[1]=s,e.length>2&&(e[2]=.5*(i[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,E),e)}unprojectFromRenderScreen(t,e){if((0,h.lw)(T,this.projectionMatrix,this.viewMatrix),!(0,h.B8)(T,T))return null;const i=this.fullViewport;return A[0]=2*(t[0]-i[0])/i[2]-1,A[1]=2*(t[1]-i[1])/i[3]-1,A[2]=2*t[2]-1,A[3]=1,(0,m.t)(A,A,T),0===A[3]?null:(e[0]=A[0]/A[3],e[1]=A[1]/A[3],e[2]=A[2]/A[3],e)}constrainWindowSize(t,e,i,n){const r=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(r-i/2,0),a=Math.max(this.fullHeight-s-n/2,0),l=-Math.min(r-i/2,0),c=-Math.min(this.fullHeight-s-n/2,0),u=i-l- -Math.min(this.fullWidth-r-i/2,0),h=n-c- -Math.min(s-n/2,0);return[Math.round(o),Math.round(a),Math.round(u),Math.round(h)]}computeUp(t){1===t?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const i=t[0]*this.pixelRatio,n=this.fullHeight-t[1]*this.pixelRatio;return e[0]=i,e[1]=n,e}renderToScreen(t,e){const i=t[0]/this.pixelRatio,n=(this.fullHeight-t[1])/this.pixelRatio;e[0]=i,e[1]=n}_computeUpGlobal(){(0,p.e)(M,this.center,this.eye);const t=(0,p.b)(this.center);t<1?(0,p.q)(this._up,g.Cb)&&((0,p.d)(this._up,g.Cb),this._markViewDirty(),this.notifyChange("_up")):Math.abs((0,p.f)(M,this.center))>.9999*(0,p.b)(M)*t||((0,p.i)(C,M,this.center),(0,p.i)(C,C,M),(0,p.n)(C,C),(0,p.q)(this._up,C)||((0,p.d)(this._up,C),this.notifyChange("_up"),this._markViewDirty()))}_computeUpLocal(){(0,p.E)(M,this.eye,this.center),Math.abs(M[2])<=.9999&&((0,p.h)(M,M,M[2]),(0,p.j)(M,-M[0],-M[1],1-M[2]),(0,p.n)(M,M),(0,p.q)(this._up,M)||((0,p.d)(this._up,M),this.notifyChange("_up"),this._markViewDirty()))}_compareAndSetView(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";"number"==typeof t[0]&&isFinite(t[0])&&"number"==typeof t[1]&&isFinite(t[1])&&"number"==typeof t[2]&&isFinite(t[2])?(0,p.q)(t,e)||((0,p.d)(e,t),this._markViewDirty(),i.length&&this.notifyChange(i)):o.A.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&((0,y.ui)(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&((0,h.t5)(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};(0,r.Cg)([(0,c.MZ)()],b.prototype,"_viewport",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_padding",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_fov",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_nearFar",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_viewDirty",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_viewMatrix",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_pixelRatio",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"pixelRatio",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"row",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"column",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_rows",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"rows",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_columns",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"columns",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"eye",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"center",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_center",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"up",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"_up",void 0),(0,r.Cg)([(0,c.MZ)()],b.prototype,"viewMatrix",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"viewForward",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"viewUp",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"viewRight",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"nearFar",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"near",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"far",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"viewport",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"screenViewport",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"screenPadding",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"x",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"y",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"width",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"height",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"fullWidth",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"fullHeight",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"_aspect",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"padding",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"projectionMatrix",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"inverseProjectionMatrix",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"fov",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"fovX",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"fovY",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"viewInverseTransposeMatrix",null),(0,r.Cg)([(0,c.MZ)({readOnly:!0})],b.prototype,"_projectionMatrixInternal",null),(0,r.Cg)([(0,c.MZ)()],b.prototype,"relativeElevation",void 0),b=n=(0,r.Cg)([(0,u.$)("esri.views.3d.webgl.RenderCamera")],b);const S=b,A=(0,_.vt)(),T=(0,d.vt)(),M=(0,g.vt)(),C=(0,g.vt)(),E=(0,l.r_)()},34981:(t,e,i)=>{function n(t){return 4===t||5===t||6===t||7===t||8===t}function r(t){return h(t)||3===t}function s(t){return 9===t||10===t}function o(t){return a(t)||s(t)}function a(t){return 0===t}function l(t){return a(t)||f(t)}function c(t){return l(t)||10===t}function u(t){return l(t)||s(t)}function h(t){return u(t)||d(t)}function d(t){return 2===t}function f(t){return 1===t}function v(t){return d(t)||n(t)}i.d(e,{Bf:()=>n,CL:()=>s,Dz:()=>v,LG:()=>f,Mb:()=>u,QG:()=>c,RN:()=>l,T2:()=>h,_o:()=>a,eh:()=>d,i3:()=>o,iq:()=>r})},35416:(t,e,i)=>{i.d(e,{h:()=>s,p:()=>o});var n=i(90632);class r{constructor(){this.uid=(0,n.c)()}}class s extends r{constructor(t){super(),this.highlightName=t,this.channel=0}}class o extends r{constructor(){super(...arguments),this.channel=1}}},36324:(t,e,i)=>{function n(t){const e=.3183098861837907;t.constants.add("PI","float",3.141592653589793),t.constants.add("LIGHT_NORMALIZATION","float",e),t.constants.add("INV_PI","float",e),t.constants.add("HALF_PI","float",1.570796326794897),t.constants.add("TWO_PI","float",6.28318530717958)}i.d(e,{p:()=>n})},36358:(t,e,i)=>{i.d(e,{EM:()=>l,dO:()=>a});var n=i(44680),r=i(13191),s=i(9392),o=(i(89299),i(72468),i(5517),i(86955),i(42759),i(72106),i(43425),i(31432));class a extends o.Y{constructor(){super(...arguments),this.transformWorldFromViewTH=(0,s.vt)(),this.transformWorldFromViewTL=(0,s.vt)(),this.transformViewFromCameraRelativeRS=(0,n.vt)(),this.transformProjFromView=(0,r.vt)()}}class l extends o.Y{constructor(){super(...arguments),this.transformWorldFromModelRS=(0,n.vt)(),this.transformWorldFromModelTH=(0,s.vt)(),this.transformWorldFromModelTL=(0,s.vt)()}}},36451:(t,e,i)=>{i.d(e,{A:()=>u});var n=i(6326),r=i(91967),s=(i(81806),i(50076)),o=i(68134),a=i(46053),l=i(87990),c=i(74628);let u=class extends r.A{constructor(t){super(t),this.view=null,this.consumes={required:[]},this.produces=c.hM.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([(0,o.wB)(()=>this.view.ready,t=>{var e;t&&(null===(e=this.view.stage)||void 0===e||e.renderer.addRenderNode(this))},o.Vh)])}destroy(){var t;null===(t=this.view.stage)||void 0===t||null===(t=t.renderer)||void 0===t||t.removeRenderNode(this)}precompile(){}render(){throw new s.A("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view.stage.renderView.renderingContext.gl}get techniques(){return this.view.stage.renderView.techniques}acquireOutputFramebuffer(){var t,e,i,n;const r=null===(t=this._frameBuffer)||void 0===t||null===(t=t.getTexture())||void 0===t?void 0:t.descriptor,s=this.view.stage.renderer.fboCache.acquire(null!==(e=null===r||void 0===r?void 0:r.width)&&void 0!==e?e:640,null!==(i=null===r||void 0===r?void 0:r.height)&&void 0!==i?i:480,this.produces);return null!==(n=s.fbo)&&void 0!==n&&n.initializeAndBind(),s}bindRenderTarget(){var t;return null!==(t=this._frameBuffer)&&void 0!==t&&null!==(t=t.fbo)&&void 0!==t&&t.initializeAndBind(),this._frameBuffer}requestRender(t){var e;switch(t){case 2:this.view.state.fading=!0;case 1:null===(e=this.view.stage)||void 0===e||e.renderView.requestRender(t);case 0:case void 0:this._dirty=!0}}resetWebGLState(){var t;this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(null===(t=this._frameBuffer)||void 0===t?void 0:t.fbo)}get fboCache(){return this.view.stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view.stage.renderView.renderingContext}get renderContext(){var t;return null===(t=this.view.stage)||void 0===t?void 0:t.renderer.renderContext}updateAnimation(t){return!!this._dirty&&(this._dirty=!1,!0)}doRender(t){this._frameBuffer=t.find(t=>{let{name:e}=t;return e===this.produces});try{return this.render(t)}finally{this._frameBuffer=null}}};(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],u.prototype,"view",void 0),(0,n.Cg)([(0,a.MZ)({constructOnly:!0})],u.prototype,"consumes",void 0),(0,n.Cg)([(0,a.MZ)()],u.prototype,"produces",void 0),(0,n.Cg)([(0,a.MZ)({readOnly:!0})],u.prototype,"techniques",null),u=(0,n.Cg)([(0,l.$)("esri.views.3d.webgl.RenderNode")],u)},38496:(t,e,i)=>{i.d(e,{Dg:()=>s,EH:()=>v,JH:()=>a,my:()=>o,tM:()=>h,uW:()=>r});var n=i(78393);function r(t){return s(t,!0)}function s(t,e){if(Array.isArray(t)){if(t.length<n.y9)return t}else if(t.length<n.y9)return Array.from(t);let i=!0,r=!0;return t.some((t,e)=>(i=i&&0===t,r=r&&t===e,!i&&!r)),i?v(t.length):r?h(t.length):(0,n.iu)(t)&&t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:function(t,e){for(const i of t){if(i>=65536)return(0,n.iu)(t)?t:new Uint32Array(t);i>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}(t,!e)}function o(t){return t<=n.y9?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function a(t){return t<=n.y9?new Array(t):new Uint32Array(t)}let l=d(131072);const c=[0],u=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function h(t){return 1===t?c:t<n.y9?Array.from(new Uint16Array(u.buffer,0,t)):t<u.length?new Uint16Array(u.buffer,0,t):(t>l.length&&(l=d(Math.max(2*l.length,t))),new Uint32Array(l.buffer,0,t))}function d(t){const e=new Uint32Array(t);for(let i=0;i<e.length;i++)e[i]=i;return e}let f=new Uint8Array(65536);function v(t){if(1===t)return c;if(t<n.y9)return new Array(t).fill(0);if(t>f.length){const e=Math.max(2*f.length,t);f=new Uint8Array(e)}return new Uint8Array(f.buffer,0,t)}},42717:(t,e,i)=>{i.d(e,{NL:()=>g});var n,r=i(57528),s=i(34981),o=i(95352),a=i(94759),l=i(72468),c=i(5517),u=i(19771),h=i(21390),d=i(86955),f=i(27374),v=i(70367);i(75803);const p=1;function g(t,e){if(!(0,s.RN)(e.output))return;t.fragment.include(a.C);const{emissionSource:i,hasEmissiveTextureTransform:g,bindType:m}=e,_=3===i||4===i||5===i;_&&(t.include(o.r,e),t.fragment.uniforms.add(1===m?new v.N("texEmission",t=>t.textureEmissive):new f.o("texEmission",t=>t.textureEmissive)));const y=2===i||_;y&&t.fragment.uniforms.add(1===m?new c.t("emissiveBaseColor",t=>t.emissiveBaseColor):new l.W("emissiveBaseColor",t=>t.emissiveBaseColor));const x=0!==i;x&&7!==i&&6!==i&&4!==i&&5!==i&&t.fragment.uniforms.add(1===m?new h.m("emissiveStrength",t=>t.emissiveStrength):new u.J("emissiveStrength",t=>t.emissiveStrength));const w=7===i,b=5===i,S=1===i||6===i||w;t.fragment.code.add((0,d.H)(n||(n=(0,r.A)(["\n    vec4 getEmissions(vec3 symbolColor) {\n      vec4 emissions = ",";\n      ","\n      ","\n      return emissions;\n    }\n  "])),y?b?"emissiveSource == 0 ? vec4(emissiveBaseColor, 1.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(emissiveBaseColor, 1.0)":S?w?"emissiveSource == 0 ? vec4(0.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(linearizeGamma(symbolColor), 1.0)":"vec4(0.0)",(0,d.If)(_,"".concat((0,d.If)(b,"if(emissiveSource == 0) {\n              vec4 emissiveFromTex = textureLookup(texEmission, ".concat(g?"emissiveUV":"vuv0",");\n              emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);\n           }"),"vec4 emissiveFromTex = textureLookup(texEmission, ".concat(g?"emissiveUV":"vuv0",");\n           emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);")),"\n        emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;")),(0,d.If)(x,"emissions.rgb *= emissiveStrength * ".concat(d.H.float(p),";"))))}},42759:(t,e,i)=>{i.d(e,{h:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"mat3",2,(n,r,s)=>n.setUniformMatrix3fv(t,e(r,s),i))}}},43425:(t,e,i)=>{i.d(e,{X:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"mat4",1,(n,r,s)=>n.setUniformMatrix4fv(t,e(r,s),i))}}},45463:(t,e,i)=>{i.d(e,{i:()=>a,q:()=>l});var n=i(90632),r=i(92656),s=i(99362),o=i(31432);class a{constructor(t,e){this.id=(0,n.c)(),this.supportsEdges=!1,this._renderPriority=0,this._parameters=new e,(0,s.MB)(this._parameters,t),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(t){return!1}setParameters(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];(0,s.MB)(this._parameters,t)&&(this.validateParameters(this._parameters),e&&this._parametersChanged())}validateParameters(t){}shouldRender(t){return this.visible&&this.isVisibleForOutput(t.output)&&(!this.parameters.isDecoration||t.bind.decorations)&&0!==(this.parameters.renderOccluded&t.renderOccludedMask)}isVisibleForOutput(t){return!0}get renderPriority(){return this._renderPriority}set renderPriority(t){t!==this._renderPriority&&(this._renderPriority=t,this._parametersChanged())}_parametersChanged(){var t;null===(t=this.repository)||void 0===t||t.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:0}get hasEmissions(){return!1}getConfiguration(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new r.E;return i.output=t,i.hasHighlightMixTexture=9===t&&null!=e.highlightMixTexture,i}}class l extends o.Y{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}},48168:(t,e,i)=>{i.d(e,{JG:()=>a,Uy:()=>c,Wb:()=>A,Z$:()=>f,b_:()=>p,gz:()=>v});var n=i(20664),r=i(9392),s=i(42294),o=i(86994);class a{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.tolerance=t,this.isVerticalRay=e,this.normalRequired=i}}const l=(0,s.vt)();function c(t,e,i,r,s,l){if(!t.visible)return;const c=(0,n.a)(C,r,i),u=(t,e,i)=>l(t,i,e),{tolerance:d}=e,f=new a(d,!1,e.options.normalRequired);if(t.boundingInfo)(0,o.vA)(0===t.type),h(t.boundingInfo,i,c,d,s,f,u);else{const e=t.positionAttribute,n=e.indices;g(i,c,0,n.length/3,n,e.data,e.stride,s,f,u)}}const u=(0,r.vt)();function h(t,e,i,r,o,a,c){if(null==t)return;const f=function(t,e){return(0,n.j)(e,1/t[0],1/t[1],1/t[2])}(i,u);if((0,s.Ne)(l,t.bbMin),(0,s.vI)(l,t.bbMax),null!=o&&o.applyToAabb(l),A(l,e,f,r)){const{primitiveIndices:n,position:s}=t,l=n?n.length:s.indices.length/3;if(l>T){const n=t.getChildren();if(void 0!==n){for(const t of n)h(t,e,i,r,o,a,c);return}}!function(t,e,i,n,r,s,o,a,l,c,u){const h=t[0],f=t[1],v=t[2],p=e[0],g=e[1],m=e[2],{normalRequired:_}=c;for(let y=i;y<n;++y){const t=a[y],e=3*t,i=o*r[e];let n=s[i],c=s[i+1],w=s[i+2];const b=o*r[e+1];let S=s[b],A=s[b+1],T=s[b+2];const C=o*r[e+2];let E=s[C],I=s[C+1],F=s[C+2];null!=l&&([n,c,w]=l.applyToVertex(n,c,w,y),[S,A,T]=l.applyToVertex(S,A,T,y),[E,I,F]=l.applyToVertex(E,I,F,y));const O=S-n,P=A-c,D=T-w,L=E-n,z=I-c,R=F-w,H=g*R-z*m,N=m*L-R*p,V=p*z-L*g,B=O*H+P*N+D*V;if(Math.abs(B)<=M)continue;const U=h-n,k=f-c,j=v-w,W=U*H+k*N+j*V;if(B>0){if(W<0||W>B)continue}else if(W>0||W<B)continue;const q=k*D-P*j,G=j*O-D*U,Z=U*P-O*k,X=p*q+g*G+m*Z;if(B>0){if(X<0||W+X>B)continue}else if(X>0||W+X<B)continue;const Y=(L*q+z*G+R*Z)/B;Y>=0&&u(Y,t,_?x(O,P,D,L,z,R,d):null)}}(e,i,0,l,s.indices,s.data,s.stride,n,o,a,c)}}const d=(0,r.vt)();function f(t,e,i,r,s,o,a,l,c){const{data:u,stride:h}=o;g(t,(0,n.a)(C,e,t),i,r,s,u,h,a,l,c)}function v(t,e,i,n){if(!i.visible)return;const{boundingInfo:r}=i;if(r){const{bbMin:i,bbMax:n}=r;if(t<i[0]||t>n[0]||e<i[1]||e>n[1])return}const s=i.positionAttribute,o=s.indices;!function(t,e,i,n,r,s,o){const{data:a,stride:l}=s;for(let c=i;c<n;++c){const i=3*c,n=l*r[i],s=l*r[i+1],u=l*r[i+2],h=a[n+0]-t,d=a[n+1]-e,f=a[s+0]-t,v=a[s+1]-e,p=a[u+0]-t,g=a[u+1]-e,m=p*v-g*f,_=h*g-d*p,y=f*d-v*h;(m<0||_<0||y<0)&&(m>0||_>0||y>0)||o(0,c,null)}}(t,e,0,o.length/3,o,s,(t,e,i)=>n(t,i,e))}function p(t,e,i,n,r,s,o,a){const l=t[0],c=t[1],u=t[2],h=e[0],f=e[1],v=e[2];for(let p=i;p<n;++p){const t=3*p,e=t+1,i=t+2,n=s*t,g=r[n],m=r[n+1],_=r[n+2],y=s*e,w=s*i,b=r[y]-g,S=r[y+1]-m,A=r[y+2]-_,T=r[w]-g,C=r[w+1]-m,E=r[w+2]-_,I=f*E-C*v,F=v*T-E*h,O=h*C-T*f,P=b*I+S*F+A*O;if(Math.abs(P)<=M)continue;const D=l-g,L=c-m,z=u-_,R=D*I+L*F+z*O;if(P>0){if(R<0||R>P)continue}else if(R>0||R<P)continue;const H=L*A-S*z,N=z*b-A*D,V=D*S-b*L,B=h*H+f*N+v*V;if(P>0){if(B<0||R+B>P)continue}else if(B>0||R+B<P)continue;const U=(T*H+C*N+E*V)/P;U>=0&&a(U,p,o?x(b,S,A,T,C,E,d):null)}}function g(t,e,i,r,s,o,a,l,c,u){const h=e,d=E,f=Math.abs(h[0]),v=Math.abs(h[1]),p=Math.abs(h[2]),g=f>=v?f>=p?0:2:v>=p?1:2,x=g,b=h[x]<0?2:1,S=(g+b)%3,A=(g+(3-b))%3,T=h[S]/h[x],M=h[A]/h[x],C=1/h[x],I=m,F=_,O=y,{normalRequired:P}=c;for(let m=i;m<r;++m){const e=3*m,i=a*s[e];(0,n.j)(d[0],o[i+0],o[i+1],o[i+2]);const r=a*s[e+1];(0,n.j)(d[1],o[r+0],o[r+1],o[r+2]);const c=a*s[e+2];(0,n.j)(d[2],o[c+0],o[c+1],o[c+2]),l&&((0,n.d)(d[0],l.applyToVertex(d[0][0],d[0][1],d[0][2],m)),(0,n.d)(d[1],l.applyToVertex(d[1][0],d[1][1],d[1][2],m)),(0,n.d)(d[2],l.applyToVertex(d[2][0],d[2][1],d[2][2],m))),(0,n.a)(I,d[0],t),(0,n.a)(F,d[1],t),(0,n.a)(O,d[2],t);const h=I[S]-T*I[x],f=I[A]-M*I[x],v=F[S]-T*F[x],p=F[A]-M*F[x],g=O[S]-T*O[x],_=O[A]-M*O[x],y=g*p-_*v,b=h*_-f*g,E=v*f-p*h;if((y<0||b<0||E<0)&&(y>0||b>0||E>0))continue;const D=y+b+E;if(0===D)continue;const L=y*(C*I[x])+b*(C*F[x])+E*(C*O[x]);if(L*Math.sign(D)<0)continue;const z=L/D;z>=0&&u(z,m,P?w(d):null)}}const m=(0,r.vt)(),_=(0,r.vt)(),y=(0,r.vt)();function x(t,e,i,r,s,o,a){return(0,n.j)(b,t,e,i),(0,n.j)(S,r,s,o),(0,n.i)(a,b,S),(0,n.n)(a,a),a}function w(t){return(0,n.a)(b,t[1],t[0]),(0,n.a)(S,t[2],t[0]),(0,n.i)(d,b,S),(0,n.n)(d,d),d}const b=(0,r.vt)(),S=(0,r.vt)();function A(t,e,i,n){return function(t,e,i,n,r){const s=(t[0]-n-e[0])*i[0],o=(t[3]+n-e[0])*i[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-n-e[1])*i[1],u=(t[4]+n-e[1])*i[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const h=(t[2]-n-e[2])*i[2],d=(t[5]+n-e[2])*i[2];return l=Math.min(l,Math.max(h,d)),!(l<0)&&(a=Math.max(a,Math.min(h,d)),!(a>l)&&a<r)}(t,e,i,n,1/0)}const T=1e3,M=1e-7,C=(0,r.vt)(),E=[(0,r.vt)(),(0,r.vt)(),(0,r.vt)()]},48549:(t,e,i)=>{i.d(e,{BP:()=>d,l5:()=>f,q3:()=>h});var n=i(89379),r=i(62984),s=i(88105),o=i(6381),a=i(57481),l=i(86994),c=i(75757);class u{constructor(t,e){this.layout=t,this.buffer="number"==typeof e?new ArrayBuffer(e*t.stride):e;for(const i of t.fields.keys()){const e=t.fields.get(i);this[i]=new e.constructor(this.buffer,e.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(t,e){const i=this[t];return i&&i.elementCount===e.ElementCount&&i.elementType===e.ElementType?i:null}slice(t,e){return new u(this.layout,this.buffer.slice(t*this.stride,e*this.stride))}copyFrom(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.count;const r=this.stride;if(r%4==0){const s=new Uint32Array(t.buffer,e*r,n*r/4);new Uint32Array(this.buffer,i*r,n*r/4).set(s)}else{const s=new Uint8Array(t.buffer,e*r,n*r);new Uint8Array(this.buffer,i*r,n*r).set(s)}return this}get usedMemory(){return this.byteLength}dispose(){}}class h{constructor(t){this._stride=0,this._fields=new Map,t&&(this._stride=t.stride,t.fields.forEach(t=>this._fields.set(t[0],(0,n.A)((0,n.A)({},t[1]),{},{constructor:g(t[1].constructor)}))))}freeze(){return this}get locations(){return(0,c.Xk)((0,a.U)(this))}vec2f16(t,e){return this._appendField(t,r.SX?s.ZD:s.gH,e),this}vec2f(t,e){return this._appendField(t,s.gH,e),this}vec2f64(t,e){return this._appendField(t,s.si,e),this}vec3f16(t,e){return this._appendField(t,r.SX?s.EC:s.xs,e),this}vec3f(t,e){return this._appendField(t,s.xs,e),this}vec3f64(t,e){return this._appendField(t,s.Xm,e),this}vec4f16(t,e){return this._appendField(t,r.SX?s.jz:s.Eq,e),this}vec4f(t,e){return this._appendField(t,s.Eq,e),this}vec4f64(t,e){return this._appendField(t,s.Aj,e),this}mat3f(t,e){return this._appendField(t,s.jZ,e),this}mat3f64(t,e){return this._appendField(t,s.j0,e),this}mat4f(t,e){return this._appendField(t,s.Sx,e),this}mat4f64(t,e){return this._appendField(t,s.E$,e),this}vec4u8(t,e){return this._appendField(t,s.XP,e),this}f16(t,e){return this._appendField(t,r.SX?s.XW:s.Y$,e),this}f32(t,e){return this._appendField(t,s.Y$,e),this}f64(t,e){return this._appendField(t,s.qB,e),this}u8(t,e){return this._appendField(t,s.SL,e),this}u16(t,e){return this._appendField(t,s.h,e),this}i8(t,e){return this._appendField(t,s.bf,e),this}vec2i8(t,e){return this._appendField(t,s.D6,e),this}vec2i16(t,e){return this._appendField(t,s.mJ,e),this}vec2u8(t,e){return this._appendField(t,s.LC,e),this}vec2u16(t,e){return this._appendField(t,s.Yi,e),this}vec4u16(t,e){return this._appendField(t,s.Uz,e),this}vec4i16(t,e){return this._appendField(t,s.E7,e),this}u32(t,e){return this._appendField(t,s.P,e),this}_appendField(t,e,i){this._fields.has(t)&&(0,l.vA)(!1,"".concat(t," already added to vertex buffer layout"));const n=e.ElementCount*(0,o.GJ)(e.ElementType),r=this._stride;this._fields.set(t,{constructor:e,size:n,offset:r,optional:i}),this._alignFields()}_alignFields(){let t=0,e=1;this._fields.forEach(i=>{const n=(0,o.GJ)(i.constructor.ElementType);t=Math.floor((t+n-1)/n)*n,i.offset=t,t+=i.size,e=Math.max(e,n)}),t=Math.floor((t+e-1)/e)*e,this._stride=t}createBuffer(t){return new u(this,t)}createView(t){return new u(this,t)}clone(){const t=new h;return t._stride=this._stride,t._fields=new Map,this._fields.forEach((e,i)=>t._fields.set(i,e)),t.BufferType=this.BufferType,t}get stride(){return this._stride}get fields(){return this._fields}}function d(){return new h}class f{constructor(t){this.fields=new Array,t.fields.forEach((t,e)=>{const i=(0,n.A)((0,n.A)({},t),{},{constructor:p(t.constructor)});this.fields.push([e,i])}),this.stride=t.stride}}const v=[s.Y$,s.gH,s.xs,s.Eq,s.jZ,s.Sx,s.qB,s.si,s.Xm,s.Aj,s.j0,s.E$,s.SL,s.LC,s.eI,s.XP,s.h,s.Yi,s.nS,s.Uz,s.P,s.An,s.H$,s.ml,s.bf,s.D6,s.m8,s.TX,s.Qt,s.mJ,s.Vp,s.E7,s.My,s.UL,s.zD,s.Y4];function p(t){return"".concat(t.ElementType,"_").concat(t.ElementCount)}function g(t){return m.get(t)}const m=new Map;v.forEach(t=>m.set(p(t),t))},49003:(t,e,i)=>{i.d(e,{D:()=>s});var n=i(89379),r=i(3825);async function s(t,e){const{data:i}=await(0,r.A)(t,(0,n.A)({responseType:"image"},e));return i}},49595:(t,e,i)=>{i.d(e,{$e:()=>a,Eo:()=>l,j1:()=>c,mO:()=>u,vt:()=>o});var n=i(97467),r=i(20664),s=i(95925);function o(t){return t?{ray:(0,s.vt)(t.ray),c0:t.c0,c1:t.c1}:{ray:(0,s.vt)(),c0:0,c1:Number.MAX_VALUE}}function a(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o();return(0,s.C)(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function l(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o();const n=(0,r.b)(t.vector);return(0,s.fA)(t.origin,e,i.ray),i.c0=0,i.c1=n,i}function c(t,e){return h(t,t.c0,e)}function u(t,e){return h(t,t.c1,e)}function h(t,e,i){return(0,r.g)(i,t.ray.origin,(0,r.h)(i,t.ray.direction,e))}new n.I(()=>o())},51596:(t,e,i)=>{i.d(e,{I:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"vec4",0,(n,r)=>n.setUniform4fv(t,e(r),i))}}},52757:(t,e,i)=>{i.d(e,{Ap:()=>x,Hk:()=>f,Pq:()=>d,Ue:()=>c,Ut:()=>h,Wu:()=>g,p1:()=>v,tb:()=>p,uO:()=>l,vJ:()=>y,vx:()=>_});var n=i(20664),r=i(9392),s=i(34761),o=i(88105),a=i(86994);function l(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const{data:r,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,1===n)for(let c=0;c<l;++c)o[i]=r[s[c]],i+=a;else for(let c=0;c<l;++c){const t=r[s[c]];for(let e=0;e<n;e++)o[i]=t,i+=a}}function c(t,e,i){const{data:n,indices:r}=t,s=e.typedBuffer,o=e.typedBufferStride,a=r.length;i*=o;for(let l=0;l<a;++l){const t=2*r[l];s[i]=n[t],s[i+1]=n[t+1],i+=o}}function u(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const{data:r,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,1===n)for(let c=0;c<l;++c){const t=3*s[c];o[i]=r[t],o[i+1]=r[t+1],o[i+2]=r[t+2],i+=a}else for(let c=0;c<l;++c){const t=3*s[c];for(let e=0;e<n;++e)o[i]=r[t],o[i+1]=r[t+1],o[i+2]=r[t+2],i+=a}}function h(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;const{data:r,indices:s}=t,o=e.typedBuffer,a=e.typedBufferStride,l=s.length;if(i*=a,1===n)for(let c=0;c<l;++c){const t=4*s[c];o[i]=r[t],o[i+1]=r[t+1],o[i+2]=r[t+2],o[i+3]=r[t+3],i+=a}else for(let c=0;c<l;++c){const t=4*s[c];for(let e=0;e<n;++e)o[i]=r[t],o[i+1]=r[t+1],o[i+2]=r[t+2],o[i+3]=r[t+3],i+=a}}function d(t,e,i){const n=t.typedBuffer,r=t.typedBufferStride;e*=r;for(let s=0;s<i;++s)n[e]=0,n[e+1]=0,n[e+2]=0,n[e+3]=0,e+=r}function f(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!e)return void u(t,i,n,r);const{data:o,indices:a}=t,l=i.typedBuffer,c=i.typedBufferStride,h=a.length,d=e[0],f=e[1],v=e[2],p=e[4],g=e[5],m=e[6],_=e[8],y=e[9],x=e[10],w=e[12],b=e[13],S=e[14];n*=c;let A=0,T=0,M=0;const C=(0,s.tZ)(e)?t=>{A=o[t]+w,T=o[t+1]+b,M=o[t+2]+S}:t=>{const e=o[t],i=o[t+1],n=o[t+2];A=d*e+p*i+_*n+w,T=f*e+g*i+y*n+b,M=v*e+m*i+x*n+S};if(1===r)for(let s=0;s<h;++s)C(3*a[s]),l[n]=A,l[n+1]=T,l[n+2]=M,n+=c;else for(let s=0;s<h;++s){C(3*a[s]);for(let t=0;t<r;++t)l[n]=A,l[n+1]=T,l[n+2]=M,n+=c}}function v(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!e)return void u(t,i,n,r);const{data:o,indices:a}=t,l=e,c=i.typedBuffer,h=i.typedBufferStride,d=a.length,f=l[0],v=l[1],p=l[2],g=l[4],m=l[5],_=l[6],y=l[8],x=l[9],w=l[10],b=!(0,s.ut)(l),S=1e-6,A=1-S;n*=h;let T=0,M=0,C=0;const E=(0,s.tZ)(l)?t=>{T=o[t],M=o[t+1],C=o[t+2]}:t=>{const e=o[t],i=o[t+1],n=o[t+2];T=f*e+g*i+y*n,M=v*e+m*i+x*n,C=p*e+_*i+w*n};if(1===r)if(b)for(let s=0;s<d;++s){E(3*a[s]);const t=T*T+M*M+C*C;if(t<A&&t>S){const e=1/Math.sqrt(t);c[n]=T*e,c[n+1]=M*e,c[n+2]=C*e}else c[n]=T,c[n+1]=M,c[n+2]=C;n+=h}else for(let s=0;s<d;++s)E(3*a[s]),c[n]=T,c[n+1]=M,c[n+2]=C,n+=h;else for(let s=0;s<d;++s){if(E(3*a[s]),b){const t=T*T+M*M+C*C;if(t<A&&t>S){const e=1/Math.sqrt(t);T*=e,M*=e,C*=e}}for(let t=0;t<r;++t)c[n]=T,c[n+1]=M,c[n+2]=C,n+=h}}function p(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{data:s,indices:o}=t,a=i.typedBuffer,l=i.typedBufferStride,c=o.length;if(n*=l,e===s.length&&4===e){a[n]=s[0],a[n+1]=s[1],a[n+2]=s[2],a[n+3]=s[3];const t=new Uint32Array(i.typedBuffer.buffer,i.start),e=l/4,o=t[n/=4];n+=e;const u=c*r;for(let i=1;i<u;++i)t[n]=o,n+=e;return}if(1!==r)if(4!==e)for(let u=0;u<c;++u){const t=3*o[u];for(let e=0;e<r;++e)a[n]=s[t],a[n+1]=s[t+1],a[n+2]=s[t+2],a[n+3]=255,n+=l}else for(let u=0;u<c;++u){const t=4*o[u];for(let e=0;e<r;++e)a[n]=s[t],a[n+1]=s[t+1],a[n+2]=s[t+2],a[n+3]=s[t+3],n+=l}else{if(4===e){for(let t=0;t<c;++t){const e=4*o[t];a[n]=s[e],a[n+1]=s[e+1],a[n+2]=s[e+2],a[n+3]=s[e+3],n+=l}return}for(let t=0;t<c;++t){const e=3*o[t];a[n]=s[e],a[n+1]=s[e+1],a[n+2]=s[e+2],a[n+3]=255,n+=l}}}function g(t,e,i,r){(0,n.e)(m,t,e);const s=Math.max(Math.sqrt((0,n.b)(m)),1e-4);(0,n.h)(m,m,1/s),i[r++]=m[0],i[r++]=m[1],i[r++]=m[2],i[r++]=s}const m=(0,r.vt)();function _(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=e.typedBuffer,o=e.typedBufferStride;if(n*=o,1===r)for(let a=0;a<i;++a)s[n]=t[0],s[n+1]=t[1],s[n+2]=t[2],s[n+3]=t[3],n+=o;else for(let a=0;a<i;++a)for(let e=0;e<r;++e)s[n]=t[0],s[n+1]=t[1],s[n+2]=t[2],s[n+3]=t[3],n+=o}function y(t,e,i,n,r,s,a){let l={numItems:0,numVerticesPerItem:0};for(const u of i.fields.keys()){const i=t.get(u),h=null===i||void 0===i?void 0:i.indices;if(i&&h)"position"===u&&(l={numItems:1,numVerticesPerItem:h.length}),x(u,i,n,r,s,a);else if("olidColor"===u&&null!=e){var c;const i=null===(c=t.get("position"))||void 0===c?void 0:c.indices;if(i){const t=i.length;_(e,s.getField(u,o.XP),t,a)}}}return l}function x(t,e,i,n,r,l){switch(t){case"position":{(0,a.vA)(3===e.size);const n=r.getField(t,o.xs);(0,a.vA)(!!n,"No buffer view for ".concat(t)),f(e,i,n,l);break}case"normal":{(0,a.vA)(3===e.size);const i=r.getField(t,o.xs);(0,a.vA)(!!i,"No buffer view for ".concat(t)),v(e,n,i,l);break}case"normalCompressed":case"profileRight":case"profileUp":{(0,a.vA)(2===e.size);const i=r.getField(t,o.mJ);(0,a.vA)(!!i,"No buffer view for ".concat(t)),c(e,i,l);break}case"uv0":{var d;(0,a.vA)(2===e.size);const i=null!==(d=r.getField(t,o.ZD))&&void 0!==d?d:r.getField(t,o.gH);(0,a.vA)(!!i,"No buffer view for ".concat(t)),c(e,i,l);break}case"uvi":{(0,a.vA)(2===e.size);const i=r.getField(t,o.mJ);(0,a.vA)(!!i,"No buffer view for ".concat(t)),c(e,i,l);break}case"color":case"symbolColor":{const i=r.getField(t,o.XP);(0,a.vA)(!!i,"No buffer view for ".concat(t)),(0,a.vA)(3===e.size||4===e.size),p(e,e.size,i,l);break}case"colorFeatureAttribute":case"opacityFeatureAttribute":case"sizeFeatureAttribute":{var g;const i=null!==(g=r.getField(t,o.Y$))&&void 0!==g?g:r.getField(t,o.Y$);(0,a.vA)(!!i,"No buffer view for ".concat(t)),(0,a.vA)(1===e.size),function(t,e,i){const{data:n,indices:r}=t,s=e.typedBuffer,o=e.typedBufferStride,a=r.length,l=n[0];i*=o;for(let c=0;c<a;++c)s[i]=l,i+=o}(e,i,l);break}case"tangent":{(0,a.vA)(4===e.size);const n=r.getField(t,o.Eq);(0,a.vA)(!!n,"No buffer view for ".concat(t)),function(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(!e)return void h(t,i,n,r);const{data:o,indices:a}=t,l=e,c=i.typedBuffer,u=i.typedBufferStride,d=a.length,f=l[0],v=l[1],p=l[2],g=l[4],m=l[5],_=l[6],y=l[8],x=l[9],w=l[10],b=!(0,s.ut)(l),S=1e-6,A=1-S;if(n*=u,1===r)for(let s=0;s<d;++s){const t=4*a[s],e=o[t],i=o[t+1],r=o[t+2],l=o[t+3];let h=f*e+g*i+y*r,d=v*e+m*i+x*r,T=p*e+_*i+w*r;if(b){const t=h*h+d*d+T*T;if(t<A&&t>S){const e=1/Math.sqrt(t);h*=e,d*=e,T*=e}}c[n]=h,c[n+1]=d,c[n+2]=T,c[n+3]=l,n+=u}else for(let s=0;s<d;++s){const t=4*a[s],e=o[t],i=o[t+1],l=o[t+2],h=o[t+3];let d=f*e+g*i+y*l,T=v*e+m*i+x*l,M=p*e+_*i+w*l;if(b){const t=d*d+T*T+M*M;if(t<A&&t>S){const e=1/Math.sqrt(t);d*=e,T*=e,M*=e}}for(let s=0;s<r;++s)c[n]=d,c[n+1]=T,c[n+2]=M,c[n+3]=h,n+=u}}(e,i,n,l);break}case"profileVertexAndNormal":{var m;(0,a.vA)(4===e.size);const i=null!==(m=r.getField(t,o.jz))&&void 0!==m?m:r.getField(t,o.Eq);(0,a.vA)(!!i,"No buffer view for ".concat(t)),h(e,i,l);break}case"profileAuxData":{var _;(0,a.vA)(3===e.size);const i=null!==(_=r.getField(t,o.EC))&&void 0!==_?_:r.getField(t,o.xs);(0,a.vA)(!!i,"No buffer view for ".concat(t)),u(e,i,l);break}}}},53908:(t,e,i)=>{i.d(e,{W:()=>r});var n=i(87003);class r extends n.n{constructor(t,e){super(t,"int",0,(i,n)=>i.setUniform1i(t,e(n)))}}},54478:(t,e,i)=>{i.d(e,{c:()=>l});var n,r,s,o=i(57528),a=i(86955);function l(t,e){e.hasVertexColors?(t.attributes.add("color","vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add((0,a.H)(n||(n=(0,o.A)(["void forwardVertexColor() { vColor = color; }"])))),t.vertex.code.add((0,a.H)(r||(r=(0,o.A)(["\n      void forwardNormalizedVertexColor() { vColor = color * ","; }\n    "])),a.H.float(1/255)))):t.vertex.code.add((0,a.H)(s||(s=(0,o.A)(["void forwardVertexColor() {}\nvoid forwardNormalizedVertexColor() {}"]))))}},56289:(t,e,i)=>{i.d(e,{t:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"vec2",2,(n,r,s,o)=>n.setUniform2fv(t,e(r,s,o),i))}}},57162:(t,e,i)=>{i.d(e,{Ey:()=>S,Ms:()=>q,RC:()=>a,T8:()=>l,Uy:()=>d,Xt:()=>h,hG:()=>u,iD:()=>o,kn:()=>f,p3:()=>s});var n=i(89379);function r(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:32774,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0,0,0];return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:i,opAlpha:i,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}}function s(t,e,i,n){let r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0,0,0];return{srcRgb:t,srcAlpha:e,dstRgb:i,dstAlpha:n,opRgb:arguments.length>4&&void 0!==arguments[4]?arguments[4]:32774,opAlpha:arguments.length>5&&void 0!==arguments[5]?arguments[5]:32774,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}const o=r(0,771),a=(r(1,0),r(1,1),r(1,771)),l=s(770,1,771,771),c=(s(0,0,768,1),{face:1029,mode:2305}),u={face:1028,mode:2305},h=t=>2===t?c:1===t?u:null,d={zNear:0,zFar:1},f={r:!0,g:!0,b:!0,a:!0};function v(t){return M.intern(t)}function p(t){return E.intern(t)}function g(t){return F.intern(t)}function m(t){return P.intern(t)}function _(t){return L.intern(t)}function y(t){return R.intern(t)}function x(t){return N.intern(t)}function w(t){return B.intern(t)}function b(t){return k.intern(t)}function S(t){return W.intern(t)}class A{constructor(t,e){this._makeKey=t,this._makeRef=e,this._interns=new Map}intern(t){var e;if(!t)return null;const i=this._makeKey(t),n=this._interns;return n.has(i)||n.set(i,this._makeRef(t)),null!==(e=n.get(i))&&void 0!==e?e:null}}function T(t){return"["+t.join(",")+"]"}const M=new A(C,t=>(0,n.A)({__tag:"Blending"},t));function C(t){return t?T([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const E=new A(I,t=>(0,n.A)({__tag:"Culling"},t));function I(t){return t?T([t.face,t.mode]):null}const F=new A(O,t=>(0,n.A)({__tag:"PolygonOffset"},t));function O(t){return t?T([t.factor,t.units]):null}const P=new A(D,t=>(0,n.A)({__tag:"DepthTest"},t));function D(t){return t?T([t.func]):null}const L=new A(z,t=>(0,n.A)({__tag:"StencilTest"},t));function z(t){return t?T([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const R=new A(H,t=>(0,n.A)({__tag:"DepthWrite"},t));function H(t){return t?T([t.zNear,t.zFar]):null}const N=new A(V,t=>(0,n.A)({__tag:"ColorWrite"},t));function V(t){return t?T([t.r,t.g,t.b,t.a]):null}const B=new A(U,t=>(0,n.A)({__tag:"StencilWrite"},t));function U(t){return t?T([t.mask]):null}const k=new A(j,t=>(0,n.A)({__tag:"DrawBuffers"},t));function j(t){return t?T(t.buffers):null}const W=new A(function(t){return t?T([C(t.blending),I(t.culling),O(t.polygonOffset),D(t.depthTest),z(t.stencilTest),H(t.depthWrite),V(t.colorWrite),U(t.stencilWrite),j(t.drawBuffers)]):null},t=>({blending:v(t.blending),culling:p(t.culling),polygonOffset:g(t.polygonOffset),depthTest:m(t.depthTest),stencilTest:_(t.stencilTest),depthWrite:y(t.depthWrite),colorWrite:x(t.colorWrite),stencilWrite:w(t.stencilWrite),drawBuffers:b(t.drawBuffers)}));class q{constructor(t){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=t}setPipeline(t){(this._pipelineInvalid||t!==this._pipeline)&&(this._setBlending(t.blending),this._setCulling(t.culling),this._setPolygonOffset(t.polygonOffset),this._setDepthTest(t.depthTest),this._setStencilTest(t.stencilTest),this._setDepthWrite(t.depthWrite),this._setColorWrite(t.colorWrite),this._setStencilWrite(t.stencilWrite),this._setDrawBuffers(t.drawBuffers),this._pipeline=t),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(t){this._blending=this._setSubState(t,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(t){this._culling=this._setSubState(t,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(t){this._polygonOffset=this._setSubState(t,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(t){this._depthTest=this._setSubState(t,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(t){this._stencilTest=this._setSubState(t,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(t){this._depthWrite=this._setSubState(t,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(t){this._colorWrite=this._setSubState(t,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(t){this._stencilWrite=this._setSubState(t,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(t){this._drawBuffers=this._setSubState(t,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(t,e,i,n){return(i||t!==e)&&(n(t),this._pipelineInvalid=!0),t}}},57481:(t,e,i)=>{i.d(e,{U:()=>s});i(81806);var n=i(93345),r=i(21812);function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=t.stride;return Array.from(t.fields.keys()).map(s=>{var o,a;const l=t.fields.get(s),c=l.constructor.ElementCount,u=function(t){switch(t){case"u8":return n.pe.UNSIGNED_BYTE;case"u16":return n.pe.UNSIGNED_SHORT;case"u32":return n.pe.UNSIGNED_INT;case"i8":return n.pe.BYTE;case"i16":return n.pe.SHORT;case"i32":return n.pe.INT;case"f16":return n.pe.HALF_FLOAT;case"f32":return n.pe.FLOAT;default:throw new Error("BufferType not supported in WebGL")}}(l.constructor.ElementType),h=l.offset,d=null!==(o=null===(a=l.optional)||void 0===a?void 0:a.glNormalized)&&void 0!==o&&o;return new r._(s,c,u,h,i,d,e)})}},58350:(t,e,i)=>{i.d(e,{E:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"vec4",1,(n,r,s)=>n.setUniform4fv(t,e(r,s),i))}}},59246:(t,e,i)=>{i.d(e,{w:()=>u,L:()=>h});var n=i(76460),r=i(30726),s=i(34981),o=(i(81806),i(61678));class a{constructor(t,e,i){this._context=t,this.locations=i,this._textures=new Map,this.source=(0,o.en)()?e:null,e.attributeNames.forEach(t=>{i.has(t)||console.error("Missing VertexAttributeLocation for ".concat(t," used in shader"))}),this._glProgram=t.programCache.acquire(e.generate("vertex",!0),e.generate("fragment",!0),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=e.generateBind(this),this.bindPass=e.generateBindPass(this),this.bindDraw=e.generateBindDraw(this)}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(t,e){this._glProgram.setUniform1i(t,e?1:0)}setUniform1i(t,e){this._glProgram.setUniform1i(t,e)}setUniform1f(t,e,i){this._glProgram.setUniform1f(t,e,i)}setUniform2fv(t,e,i){this._glProgram.setUniform2fv(t,e,i)}setUniform3fv(t,e,i){this._glProgram.setUniform3fv(t,e,i)}setUniform4fv(t,e,i){this._glProgram.setUniform4fv(t,e,i)}setUniformMatrix3fv(t,e,i){this._glProgram.setUniformMatrix3fv(t,e,!1,i)}setUniformMatrix4fv(t,e,i){this._glProgram.setUniformMatrix4fv(t,e,!1,i)}setUniformMatrices4fv(t,e,i){this._glProgram.setUniformMatrices4fv(t,e,!1,i)}setUniform1fv(t,e,i){this._glProgram.setUniform1fv(t,e,i)}setUniform1iv(t,e){this._glProgram.setUniform1iv(t,e)}setUniform2iv(t,e){this._glProgram.setUniform2iv(t,e)}setUniform3iv(t,e){this._glProgram.setUniform3iv(t,e)}setUniform4iv(t,e){this._glProgram.setUniform4iv(t,e)}assertCompatibleVertexAttributeLocations(t,e){let i=t.locations;if(e){const t=new Map(i);e.forEach((e,n)=>t.set(n,i.size+e)),i=t}i.size!==this.locations.size&&console.error("VertexAttributeLocations are incompatible: ".concat(i,", ").concat(this.locations)),this.locations.forEach((t,e)=>{i.get(e)!==t&&console.error("VertexAttributeLocations are incompatible: Program has ".concat(e," at position ").concat(t,", VAO has it at position ").concat(i.get(e),"."))})}stop(){this._textures.clear()}bindTexture(t,e){var i;(null===(i=e)||void 0===i?void 0:i.glName)||((0,o.en)()&&console.error("Texture sampler ".concat(t," has no given Texture in ").concat((new Error).stack," ")),e=this._context.emptyTexture);const n=this._ensureTextureUnit(t,e);this._context.useProgram(this),this.setUniform1i(t,n.unit),this._context.bindTexture(e,n.unit)}_ensureTextureUnit(t,e){let i=this._textures.get(t);return null==i?(i={texture:e,unit:this._textures.size},this._textures.set(t,i)):i.texture=e,i}}var l=i(93345),c=i(57162);class u{constructor(t,e,i,s){this.primitiveType=l.WR.TRIANGLES,this.key=e.key,this._program=new a(t.rctx,i.get().build(e),s),this._pipeline=this.initializePipeline(e),this.reload=async o=>{o&&await i.reload(),this.key.equals(e.key)||n.A.getLogger("esri.views.3d.webgl.ShaderTechnique").warn("Configuration was changed after construction, cannot reload shader.",i),(0,r.WD)(this._program),this._program=new a(t.rctx,i.get().build(e),s),this._pipeline=this.initializePipeline(e)}}destroy(){this._program=(0,r.WD)(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(t){this.program.assertCompatibleVertexAttributeLocations(t)}getPipeline(t,e){return this._pipeline}initializePipeline(t){return(0,c.Ey)({blending:c.RC,colorWrite:c.kn})}}function h(t,e){return(0,s.Dz)(t)?{buffers:[l.$0]}:null!==e&&void 0!==e?e:null}},59395:(t,e,i)=>{i.d(e,{d:()=>l});var n,r,s=i(57528),o=i(67078),a=i(86955);function l(t){(0,o.i$)(t),t.vertex.code.add((0,a.H)(n||(n=(0,s.A)(["vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {\nvec4 eye = view * vec4(pos, 1.0);\ndepth = calculateLinearDepth(nearFar,eye.z);\nreturn proj * eye;\n}"])))),t.vertex.code.add((0,a.H)(r||(r=(0,s.A)(["vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {\nreturn proj * (view * vec4(pos, 1.0));\n}"]))))}},59696:(t,e,i)=>{i.d(e,{A:()=>n});class n{constructor(t){this._material=t.material,this._techniques=t.techniques,this._output=t.output}dispose(){}get _stippleTextures(){var t;return null===(t=this._techniques.context)||void 0===t?void 0:t.stippleTextures}get _markerTextures(){var t;return null===(t=this._techniques.context)||void 0===t?void 0:t.markerTextures}getTechnique(t,e){return this._techniques.get(t,this._material.getConfiguration(this._output,e))}ensureResources(t){return 2}}},60205:(t,e,i)=>{i.d(e,{x:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i,n){super(t,"float",1,(i,r,s)=>i.setUniform1fv(t,e(r,s),n),i)}}},60322:(t,e,i)=>{i.d(e,{K_:()=>d,SE:()=>u,Yf:()=>a,m6:()=>f,mE:()=>h,xt:()=>c,z5:()=>l});var n=i(34981),r=i(93345),s=i(57162);const o=(0,s.p3)(1,0,1,771);function a(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];switch(t){case 0:return e?s.RC:s.T8;case 1:return o;case 2:case 3:return null}}function l(t){if(t.draped)return null;switch(t.oitPass){case 0:case 2:return t.writeDepth?s.Uy:null;case 1:case 3:return null}}const c=5e5,u={factor:-1,units:-2};function h(t){let{oitPass:e,enableOffset:i}=t;return i&&1===e?u:null}function d(t){return 0===t||2===t?arguments.length>1&&void 0!==arguments[1]?arguments[1]:513:515}function f(t,e){const i=(0,n.LG)(e);return 1===t?i?{buffers:[r.r6,r.yI,r.Fq]}:{buffers:[r.r6,r.yI]}:i?{buffers:[r.r6,r.yI]}:null}},61785:(t,e,i)=>{i.d(e,{E:()=>r});var n=i(81806);function r(){return!!(0,n.A)("enable-feature:objectAndLayerId-rendering")}},63048:(t,e,i)=>{i.d(e,{Gd:()=>L,J_:()=>P,VC:()=>H,b3:()=>R,s_:()=>O,ul:()=>N,wI:()=>E});i(81806);var n=i(15941),r=i(86300),s=i(44680),o=i(34761),a=i(13191),l=i(20664),c=i(9392),u=i(43047),h=i(55855),d=i(3454),f=i(85632),v=i(22955),p=i(61785),g=i(31432);class m{constructor(t){this.field=t}}class _ extends m{constructor(t){super(t),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[0,0,0],this.fallback=[0,0,0]}}class y extends m{constructor(t){super(t),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}}class x extends m{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;super(t),this.fallback=e,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class w{}function b(t){return null!=t}function S(t,e){t&&t.push(e)}function A(t,e,i,n,r){const s=t.minSize,o=t.maxSize;if(t.useSymbolValue){const t=n.symbolSize[i];return e.minSize[i]=t,e.maxSize[i]=t,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=1,!0}if(b(t.field))return b(t.stops)?2===t.stops.length&&(0,f.Et)(t.stops[0].size)&&(0,f.Et)(t.stops[1].size)?(T(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,i),e.type[i]=1,!0):(S(r,"Could not convert size info: stops only supported with 2 elements"),!1):(0,f.Et)(s)&&(0,f.Et)(o)&&b(t.minDataValue)&&b(t.maxDataValue)?(T(s,o,t.minDataValue,t.maxDataValue,e,i),e.type[i]=1,!0):"unknown"===t.valueUnit?(S(r,"Could not convert size info: proportional size not supported"),!1):null!=d.j[t.valueUnit]?(e.minSize[i]=-1/0,e.maxSize[i]=1/0,e.offset[i]=0,e.factor[i]=1/d.j[t.valueUnit],e.type[i]=1,!0):(S(r,"Could not convert size info: scale-dependent size not supported"),!1);if(!b(t.field)){var a;if(null!==(a=t.stops)&&void 0!==a&&a[0]&&(0,f.Et)(t.stops[0].size))return e.minSize[i]=t.stops[0].size,e.maxSize[i]=t.stops[0].size,e.offset[i]=e.minSize[i],e.factor[i]=0,e.type[i]=1,!0;if((0,f.Et)(s))return e.minSize[i]=s,e.maxSize[i]=s,e.offset[i]=s,e.factor[i]=0,e.type[i]=1,!0}return S(r,"Could not convert size info: unsupported variant of sizeInfo"),!1}function T(t,e,i,n,r,s){const o=Math.abs(n-i)>0?(e-t)/(n-i):0;r.minSize[s]=o>0?t:e,r.maxSize[s]=o>0?e:t,r.offset[s]=t-i*o,r.factor[s]=o}function M(t,e,i){t[4*e]=i.r/255,t[4*e+1]=i.g/255,t[4*e+2]=i.b/255,t[4*e+3]=i.a}function C(t,e,i){const n=2===i&&"arithmetic"===t.rotationType;e.offset[i]=n?90:0,e.factor[i]=n?-1:1,e.type[i]=1}class E{constructor(t){let{supports:e,modelSize:i,symbolSize:n,unitInMeters:r,anchor:s,scale:o,rotation:a,fallbackColor:l,fallbackSize:u}=t;this.supports=e,this.modelSize=null!==i&&void 0!==i?i:(0,c.S)(),this.symbolSize=null!==n&&void 0!==n?n:(0,c.S)(),this.unitInMeters=null!==r&&void 0!==r?r:1,this.anchor=null!==s&&void 0!==s?s:(0,c.Ul)(),this.scale=null!==o&&void 0!==o?o:(0,c.S)(),this.rotation=null!==a&&void 0!==a?a:(0,c.Ul)(),this.fallbackColor=null!==l&&void 0!==l?l:(0,h.S)(),this.fallbackSize=null!==u&&void 0!==u?u:(0,c.S)()}}function I(t,e,i){if(!t)return null;const n=t.reduce((t,n)=>{if(!t)return t;if(n.valueExpression)return S(i,"Could not convert visual variables: arcade expressions not supported"),null;switch(n.type){case"size":return e.supports.size?function(t,e,i,n){if(t.normalizationField||t.valueRepresentation)return S(n,"Could not convert size info: unsupported property"),null;if(!(0,f.CO)(t.field))return S(n,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return S(n,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new _(t.field),(0,l.d)(e.size.fallback,i.fallbackSize);let r;switch(t.axis){case"width":return r=A(t,e.size,0,i,n),r?e:null;case"height":return r=A(t,e.size,2,i,n),r?e:null;case"depth":return r=A(t,e.size,1,i,n),r?e:null;case"width-and-depth":return r=A(t,e.size,0,i,n),r&&A(t,e.size,1,i,n),r?e:null;case null:case void 0:case"all":return r=A(t,e.size,0,i,n),r=r&&A(t,e.size,1,i,n),r=r&&A(t,e.size,2,i,n),r?e:null;default:return S(n,'Could not convert size info: unknown axis "'.concat(t.axis,'""')),null}}(n,t,e,i):t;case"color":return e.supports.color?function(t,e,i,n){if(t.normalizationField)return S(n,"Could not convert color info: unsupported property"),null;if((0,f.Kg)(t.field)){if(!t.stops)return S(n,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return S(n,"Could not convert color info: too many color stops"),null;e.color=new y(t.field);const r=t.stops;for(let t=0;t<8;++t){const i=r[Math.min(t,r.length-1)];e.color.values[t]=i.value,M(e.color.colors,t,i.color)}(0,u.d)(e.color.fallback,i.fallbackColor)}}else{if(!(t.stops&&t.stops.length>=0))return S(n,"Could not convert color info: no field and no colors/stops"),null;{const n=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color=new y(null);for(let t=0;t<8;t++)e.color.values[t]=1/0,M(e.color.colors,t,n);(0,u.d)(e.color.fallback,i.fallbackColor)}}return e}(n,t,e,i):t;case"opacity":return e.supports.opacity?function(t,e,i,n){if(t.normalizationField)return S(n,"Could not convert opacity info: unsupported property"),null;if((0,f.Kg)(t.field)){if(!t.stops)return S(n,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return S(n,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new x(t.field,i.fallbackColor[3]);const r=t.stops;for(let t=0;t<8;++t){const i=r[Math.min(t,r.length-1)];e.opacity.values[t]=i.value,e.opacity.opacityValues[t]=i.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return S(n,"Could not convert opacity info: no field and no opacities/stops"),null;{const n=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:i.fallbackColor[3]};for(let t=0;t<8;t++)e.opacity.values[t]=1/0,e.opacity.opacityValues[t]=n}}return e}(n,t,e,i):null;case"rotation":return e.supports.rotation?function(t,e,i){if(!(0,f.Kg)(t.field))return S(i,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return S(i,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return C(t,e.rotation,0),e;case"roll":return C(t,e.rotation,1),e;case null:case void 0:case"heading":return C(t,e.rotation,2),e;default:return S(i,'Could not convert rotation info: unknown axis "'.concat(t.axis,'""')),null}}(n,t,i):t;default:return null}},new w);return!(t.length>0&&n)||n.size||n.color||n.opacity||n.rotation?null!==n&&void 0!==n&&n.size&&!function(t,e,i){for(let r=0;r<3;++r){let i=e.unitInMeters;1===t.type[r]&&(i*=e.modelSize[r],t.type[r]=2),t.minSize[r]=t.minSize[r]/i,t.maxSize[r]=t.maxSize[r]/i,t.offset[r]=t.offset[r]/i,t.factor[r]=t.factor[r]/i}let n;if(0!==t.type[0])n=0;else if(0!==t.type[1])n=1;else{if(0===t.type[2])return S(i,"No size axis contains a valid size or scale"),!1;n=2}for(let r=0;r<3;++r)0===t.type[r]&&(t.minSize[r]=t.minSize[n],t.maxSize[r]=t.maxSize[n],t.offset[r]=t.offset[n],t.factor[r]=t.factor[n],t.type[r]=t.type[n]);return!0}(n.size,e,i)?null:n:null}class F{constructor(t,e,i){this.visualVariables=t,this.materialParameters=e,this.requiresShaderTransformation=i}}function O(t,e){if(!t)return null;if((0,p.E)())return null;if(v.b.TESTS_DISABLE_FAST_UPDATES)return null;const i=I(t.visualVariables,e);return i?new F(i,z(i,e),!!i.size):null}function P(t,e,i){if(!e||!t)return!1;const n=t.visualVariables,r=I(e.visualVariables,i);return!!r&&!!(D(n.size,r.size,"size")&&D(n.color,r.color,"color")&&D(n.rotation,r.rotation,"rotation")&&D(n.opacity,r.opacity,"opacity"))&&(t.visualVariables=r,t.materialParameters=z(r,i),t.requiresShaderTransformation=!!r.size,!0)}function D(t,e,i){if(!!t!=!!e)return!1;if(t&&t.field!==(null===e||void 0===e?void 0:e.field))return!1;if(t&&"rotation"===i){const i=t,n=e;for(let t=0;t<3;t++)if(i.type[t]!==n.type[t]||i.offset[t]!==n.offset[t]||i.factor[t]!==n.factor[t])return!1}return!0}class L extends g.Y{constructor(t){var e,i,n;super(),this.vvSize=null!==(e=null===t||void 0===t?void 0:t.size)&&void 0!==e?e:null,this.vvColor=null!==(i=null===t||void 0===t?void 0:t.color)&&void 0!==i?i:null,this.vvOpacity=null!==(n=null===t||void 0===t?void 0:t.opacity)&&void 0!==n?n:null}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}function z(t,e){const i=new L(t);return i.vvSize&&(i.vvSymbolAnchor=e.anchor,(0,o.D_)(U),function(t,e,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,a.vt)();const r=t||0,s=e||0,l=i||0;0!==r&&(0,o.Qr)(n,n,-r/180*Math.PI),0!==s&&(0,o.eL)(n,n,s/180*Math.PI),0!==l&&(0,o.Z8)(n,n,l/180*Math.PI)}(e.rotation[2],e.rotation[0],e.rotation[1],U),i.vvSymbolRotationMatrix=i.vvSymbolRotationMatrix||(0,s.vt)(),(0,r.z0)(i.vvSymbolRotationMatrix,U)),i}function R(t,e,i){if(!t.vvSize)return i;(0,o.C)(V,i);const n=t.vvSymbolRotationMatrix;return(0,o.hZ)(U,n[0],n[1],n[2],0,n[3],n[4],n[5],0,n[6],n[7],n[8],0,0,0,0,1),(0,o.lw)(V,V,U),H(B,t,e),(0,o.hs)(V,V,B),(0,o.Tl)(V,V,t.vvSymbolAnchor),V}function H(t,e,i){if(!e.vvSize)return(0,l.j)(t,1,1,1),t;if(Number.isNaN(i[0]))return(0,l.d)(t,e.vvSize.fallback);for(let r=0;r<3;++r){const s=e.vvSize.offset[r]+i[0]*e.vvSize.factor[r];t[r]=(0,n.qE)(s,e.vvSize.minSize[r],e.vvSize.maxSize[r])}return t}function N(t,e){const i=null==t?0:e.attributes[t];return"number"==typeof i&&isFinite(i)?i:NaN}const V=(0,a.vt)(),B=(0,c.vt)(),U=(0,a.vt)()},65058:(t,e,i)=>{i.d(e,{E:()=>d});var n,r,s,o,a=i(57528),l=i(19555),c=i(72745),u=i(28450),h=i(86955);function d(t){t.uniforms.add(new u.E("zProjectionMap",t=>function(t){const e=t.projectionMatrix;return(0,l.hZ)(f,e[14],e[10])}(t.camera))),t.code.add((0,h.H)(n||(n=(0,a.A)(["float linearizeDepth(float depth) {\nfloat depthNdc = depth * 2.0 - 1.0;\nfloat c1 = zProjectionMap[0];\nfloat c2 = zProjectionMap[1];\nreturn -(c1 / (depthNdc + c2 + 1e-7));\n}"])))),t.code.add((0,h.H)(r||(r=(0,a.A)(["float delinearizeDepth(float linearDepth) {\nfloat c1 = zProjectionMap[0];\nfloat c2 = zProjectionMap[1];\nfloat depthNdc = (-c1/linearDepth) - c2 - 1e-7;\nfloat depthNonlinear01 = (depthNdc + 1.0 ) / 2.0;\nreturn depthNonlinear01;\n}"])))),t.code.add((0,h.H)(s||(s=(0,a.A)(["float depthFromTexture(sampler2D depthTexture, vec2 uv) {\nivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));\nfloat depth = texelFetch(depthTexture, iuv, 0).r;\nreturn depth;\n}"])))),t.code.add((0,h.H)(o||(o=(0,a.A)(["float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {\nreturn linearizeDepth(depthFromTexture(depthTexture, uv));\n}"]))))}const f=(0,c.vt)()},66701:(t,e,i)=>{i.d(e,{F:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i,n){super(t,"vec4",1,(i,r,s)=>i.setUniform4fv(t,e(r,s),n),i)}}},66763:(t,e,i)=>{i.d(e,{A:()=>x});var n,r,s,o,a,l,c,u,h=i(57528),d=i(85793),f=i(5517),v=i(58350),p=i(66701),g=i(60205),m=i(86955),_=i(72106),y=i(93684);function x(t,e){const{vertex:i,attributes:x}=t;e.hasVVInstancing&&(e.hasVVSize||e.hasVVColor)&&x.add("instanceFeatureAttribute","vec4"),e.hasVVSize?(i.uniforms.add(new f.t("vvSizeMinSize",t=>t.vvSize.minSize)),i.uniforms.add(new f.t("vvSizeMaxSize",t=>t.vvSize.maxSize)),i.uniforms.add(new f.t("vvSizeOffset",t=>t.vvSize.offset)),i.uniforms.add(new f.t("vvSizeFactor",t=>t.vvSize.factor)),i.uniforms.add(new f.t("vvSizeFallback",t=>t.vvSize.fallback)),i.uniforms.add(new _.k("vvSymbolRotationMatrix",t=>t.vvSymbolRotationMatrix)),i.uniforms.add(new f.t("vvSymbolAnchor",t=>t.vvSymbolAnchor)),i.code.add((0,m.H)(n||(n=(0,h.A)(["vec3 vvScale(vec4 _featureAttribute) {\nif (isnan(_featureAttribute.x)) {\nreturn vvSizeFallback;\n}\nreturn clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\n}\nvec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {\nreturn vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);\n}"])))),i.code.add((0,m.H)(r||(r=(0,h.A)(["\n      const float eps = 1.192092896e-07;\n      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {\n        vec3 scale = max(vvScale(_featureAttribute), eps);\n        return vec4(vvSymbolRotationMatrix * _normal / scale, 1.0);\n      }\n\n      ","\n    "])),e.hasVVInstancing?(0,m.H)(s||(s=(0,h.A)(["\n      vec4 vvLocalNormal(vec3 _normal) {\n        return vvTransformNormal(_normal, instanceFeatureAttribute);\n      }\n\n      vec4 localPosition() {\n        return vvTransformPosition(position, instanceFeatureAttribute);\n      }"]))):""))):i.code.add((0,m.H)(o||(o=(0,h.A)(["vec4 localPosition() { return vec4(position, 1.0); }\nvec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }"])))),t.vertex.include(d.WD),e.hasVVColor?(i.constants.add("vvColorNumber","int",y.p),i.uniforms.add(new g.x("vvColorValues",t=>t.vvColor.values,y.p),new p.F("vvColorColors",t=>t.vvColor.colors,y.p),new v.E("vvColorFallback",t=>t.vvColor.fallback,{supportsNaN:!0})),e.hasVVInstancing&&(t.vertex.include(d.ML),t.vertex.include(d.oF)),i.code.add((0,m.H)(a||(a=(0,h.A)(["\n      vec4 interpolateVVColor(float value) {\n        if (isnan(value)) {\n          return vvColorFallback;\n        }\n\n        if (value <= vvColorValues[0]) {\n          return vvColorColors[0];\n        }\n\n        for (int i = 1; i < vvColorNumber; ++i) {\n          if (vvColorValues[i] >= value) {\n            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);\n            return mix(vvColorColors[i-1], vvColorColors[i], f);\n          }\n        }\n        return vvColorColors[vvColorNumber - 1];\n      }\n\n      vec4 vvGetColor(vec4 featureAttribute) {\n        return interpolateVVColor(featureAttribute.y);\n      }\n\n      ","\n    "])),e.hasVVInstancing?(0,m.H)(l||(l=(0,h.A)(["\n            vec4 vvColor() {\n              return vvGetColor(instanceFeatureAttribute);\n            }\n\n            MaskedColor applyVVColor(MaskedColor color) {\n              return multiplyMaskedColors(color, createMaskedFromNaNColor(vvColor()));\n            }\n            "]))):(0,m.H)(c||(c=(0,h.A)(["\n            vec4 vvColor() {\n              return vec4(1.0);\n            }\n\n            MaskedColor applyVVColor(MaskedColor color) {\n              return color;\n            }\n            "])))))):i.code.add((0,m.H)(u||(u=(0,h.A)(["vec4 vvColor() {\nreturn vec4(1.0);\n}\nMaskedColor applyVVColor(MaskedColor color) {\nreturn color;\n}"]))))}},67078:(t,e,i)=>{i.d(e,{i$:()=>l,xJ:()=>a});var n,r=i(57528),s=(i(72412),i(36358),i(28450)),o=i(86955);function a(t){t.vertex.uniforms.add(new s.E("nearFar",t=>t.camera.nearFar))}function l(t){t.vertex.code.add((0,o.H)(n||(n=(0,r.A)(["float calculateLinearDepth(vec2 nearFar,float z) {\nreturn (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);\n}"]))))}},67582:(t,e,i)=>{i.d(e,{o:()=>r});var n=i(87003);class r extends n.n{constructor(t,e){super(t,"bool",0,(i,n)=>i.setUniform1b(t,e(n)))}}},69817:(t,e,i)=>{i.d(e,{OH:()=>g,Y6:()=>v,pM:()=>p});var n,r,s,o,a,l,c=i(57528),u=i(20664),h=i(9392),d=i(5517),f=i(86955);function v(t){t.vertex.code.add((0,f.H)(n||(n=(0,c.A)(["float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\nreturn absCosAngle * absCosAngle * absCosAngle;\n}"])))),t.vertex.code.add((0,f.H)(r||(r=(0,c.A)(["vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {\nreturn vec3(\nmin(params.x / (distanceToCamera - params.y), 1.0),\nscreenSizePerspectiveViewAngleDependentFactor(absCosAngle),\nparams.z\n);\n}"])))),t.vertex.code.add((0,f.H)(s||(s=(0,c.A)(["float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {\nreturn size * clamp(mix(factor.x, 1.0, factor.y), factor.z, 1.0);\n}"])))),t.vertex.code.add((0,f.H)(o||(o=(0,c.A)(["float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {\nreturn applyScreenSizePerspectiveScaleFactorFloat(\nsize,\nscreenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)\n);\n}"])))),t.vertex.code.add((0,f.H)(a||(a=(0,c.A)(["vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {\nreturn size * clamp(mix(factor.x, 1.0, factor.y), factor.z, 1.0);\n}"])))),t.vertex.code.add((0,f.H)(l||(l=(0,c.A)(["vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {\nreturn applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\n}"]))))}function p(t){t.uniforms.add(new d.t("screenSizePerspective",t=>m(t.screenSizePerspective,t.screenSizePerspectiveMinPixelReferenceSize)))}function g(t){t.uniforms.add(new d.t("screenSizePerspectiveAlignment",t=>m(t.screenSizePerspectiveAlignment||t.screenSizePerspective,t.screenSizePerspectiveAlignment?null:t.screenSizePerspectiveMinPixelReferenceSize)))}function m(t,e){const i=null!=e&&null!=t?Math.min(t.minPixelSize/e,1):0;return t?(0,u.j)(_,t.divisor,t.offset,i):(0,u.j)(_,0,0,0)}const _=(0,h.vt)()},70367:(t,e,i)=>{i.d(e,{N:()=>r});var n=i(87003);class r extends n.n{constructor(t,e){super(t,"sampler2D",1,(i,n,r)=>i.bindTexture(t,e(n,r)))}}},71011:(t,e,i)=>{i.d(e,{$p:()=>r,Qx:()=>o,_y:()=>s,e_:()=>a});var n=i(9392);class r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Ul)();this.intensity=t}}class s{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Ul)(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.fA)(.57735,.57735,.57735);this.intensity=t,this.direction=e}}class o{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.Ul)(),e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,n.fA)(.57735,.57735,.57735),i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.intensity=t,this.direction=e,this.castShadows=i,this.specularStrength=r,this.environmentStrength=s}}class a{constructor(){this.r=[0],this.g=[0],this.b=[0]}}},72106:(t,e,i)=>{i.d(e,{k:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"mat3",1,(n,r,s)=>n.setUniformMatrix3fv(t,e(r,s),i))}}},72412:(t,e,i)=>{i.d(e,{o:()=>o});var n,r=i(57528),s=i(86955);function o(t,e){e&&function(t){t.varyings.add("linearDepth","float",{invariant:!0})}(t),t.vertex.code.add((0,s.H)(n||(n=(0,r.A)(["\n    void forwardLinearDepth(float _linearDepth) { "," }\n  "])),(0,s.If)(e,"linearDepth = _linearDepth;")))}},72468:(t,e,i)=>{i.d(e,{W:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"vec3",2,(n,r,s,o)=>n.setUniform3fv(t,e(r,s,o),i))}}},72790:(t,e,i)=>{i.d(e,{c:()=>r});var n=i(87003);class r extends n.n{constructor(t,e){super(t,"int",1,(i,n,r)=>i.setUniform1i(t,e(n,r)))}}},73398:(t,e,i)=>{i.d(e,{c:()=>a});var n,r,s=i(57528),o=i(86955);function a(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t.attributes.add("position","vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.main.add((0,o.H)(n||(n=(0,s.A)(["\n      gl_Position = vec4(position, 0.0, 1.0);\n      ","\n  "])),e?(0,o.H)(r||(r=(0,s.A)(["uv = position * 0.5 + vec2(0.5);"]))):""))}},74628:(t,e,i)=>{i.d(e,{OG:()=>yt,hM:()=>_t});i(30358);var n=i(15941),r=i(13191),s=i(20664),o=i(9392),a=(i(19247),i(13312)),l=(i(5809),i(45308),i(64232)),c=i(14487),u=i(34111);i(2413),i(33062),i(89596),i(96342);(0,o.vt)(),(0,o.vt)(),(0,o.vt)(),new WeakMap;var h=i(34761),d=i(72745),f=i(76797),v=i(65215),p=i(5262),g=i(19555);function m(t,e,i,n){const r=function(t,e){const i=0===e||2===e?0:1,n=t[e],r=0===e||1===e?1:-1,s=0===i?1:0;return(t,e,o)=>{if(e[i]<n&&o[i]<n)return 1===r?0:1;if(e[i]>n&&o[i]>n)return 1===r?1:0;const a=(o[s]-e[s])/(o[i]-e[i]),l=e[s]+a*(n-e[i]);return t[i]=n,t[s]=l,(e[i]<n?1:-1)*r>0?2:3}}(i,n);if(t.length=0,e.length){1===r(y,e[0],e[0])&&_(t,e[0]);for(let i=0;i<e.length;i++){const n=e[i===e.length-1?0:i+1];switch(r(y,e[i],n)){case 1:_(t,n);break;case 3:_(t,(0,d.o8)(y));break;case 2:_(t,(0,d.o8)(y)),_(t,n)}}}}function _(t,e){0!==t.length&&(0,g.aI)(t.at(-1),e)||t.push(e)}const y=(0,d.vt)();var x=i(95925),w=i(44230),b=i(13927);const S=(0,o.vt)(),A=(0,o.vt)();function T(){return{direction:(0,o.vt)(),up:(0,o.vt)()}}function M(t,e,i,r,o){let a=(0,s.n)(S,t),l=(0,s.f)(a,r);const c=l>0;l=Math.abs(l),l>.99&&(l=Math.abs((0,s.f)(e,r)),l<.99?((0,s.d)(a,e),c&&(0,s.h)(a,a,-1)):a=null);let u=0;if(a){(0,s.h)(A,r,(0,s.f)(r,a)),(0,s.e)(a,a,A);const t=(0,s.f)(a,o)/((0,s.b)(a)*(0,s.b)(o));(0,s.i)(A,a,o),u=((0,s.f)(A,r)>0?1:-1)*(0,n.KJ)((0,n.XM)(t))}const h=(0,n.KJ)((0,n.XM)(-(0,s.f)(r,t)/(0,s.b)(t)));return i?(i.heading=u,i.tilt=h,i):{heading:u,tilt:h}}function C(t,e,i,n){(0,s.e)(E,i,e),(0,b.T7)(n,(0,w.LV)(e,E),t)||t===i||(0,s.d)(t,i)}const E=(0,o.vt)(),I=(0,o.fA)(0,1,0),F=(0,o.fA)(0,0,1),O=(0,r.vt)(),P=(0,o.vt)(),D=(0,o.vt)();function L(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T();const{direction:o,up:a}=r;return(0,h.N9)(O,-(0,n.kU)(e)),(0,h.eL)(O,O,(0,n.kU)(i)),(0,s.t)(o,F,O),(0,s.h)(o,o,-1),(0,s.t)(a,I,O),r}function z(t,e,i,n,r){const o=e.lines[11].direction,a=(r-i.getAltitude(n))/o[2];(0,s.c)(t,n,o,a)}const R=(0,o.vt)();Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(t,e,i,n){return M(e,i,n,F,I)},eyeForCenterWithHeadingTilt:function(t,e,i,n){const r=L(t,i,n),a=(0,o.vt)();return(0,s.h)(a,r.direction,-e),(0,s.g)(a,a,t),{up:r.up,eye:a,heading:i,tilt:n}},eyeTiltToLookAtTilt:function(t){return(0,n.kU)(t)},headingTiltToDirectionUp:L,lookAtTiltToEyeTilt:function(t){return(0,n.KJ)(t)},toArea:function(t,e){const i=t.frustum,{renderCoordsHelper:n}=t,r=n.getAltitude(e),o=t.spatialReference,a=t.state.camera.eye,l=[],c=i.planes[5];for(let s=0;s<4;s++){const t=i.lines[s];n.intersectInfiniteManifold((0,x.LV)(t.origin,t.direction),r,R)||z(R,i,n,t.endpoint,r),C(R,a,R,c),l.push((0,d.fA)(R[0],R[1]))}return function(t,e,i){const n=t.map(t=>((0,s.j)(R,t[0],t[1],0),e.fromRenderCoords(R,R,i),[R[0],R[1]]));return n.length<=2?new v.A({spatialReference:i}):(n.push(n[0].slice()),(0,p.$3)(n)||n.reverse(),new v.A({rings:[n],spatialReference:i}))}(function(t,e){const i=[],n=[];return m(i,t,e,0),m(n,i,e,1),m(i,n,e,2),m(n,i,e,3),n}(l,n.extent),n,o)},toExtent:function(t,e,i,n,r){var s;const o=t.renderSpatialReference,a=null!==(s=t.spatialReference)&&void 0!==s?s:e.spatialReference;return(0,l.g)(e,P,o),(0,l.g)(e,D,o),P[0]-=i/2,D[0]+=i/2,P[1]-=n/2,D[1]+=n/2,(0,c.F)(P,o,P,a),(0,c.F)(D,o,D,a),r?(r.xmin=P[0],r.ymin=P[1],r.xmax=D[0],r.ymax=D[1],r.spatialReference=a):r=new f.A(P[0],P[1],D[0],D[1],a),r}},Symbol.toStringTag,{value:"Module"}));var H,N=i(73582),V=i(43047),B=i(55855),U=i(53494),k=i(1438),j=i(78315),W=i(45417),q=i(4763);class G{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(t){this.renderCoordsHelper=t,this.frustum=(0,q.vt)(),this._points=(0,q.Qy)(),this.lines=new Array(12),this._origin=(0,o.vt)(),this._direction=(0,o.vt)(),this._altitude=null;for(let e=0;e<12;e++)this.lines[e]={origin:null,direction:(0,o.vt)(),endpoint:null}}update(t){(0,q.ui)(t.viewMatrix,t.projectionMatrix,this.frustum,this._points),(0,s.d)(this._origin,t.eye),(0,s.d)(this._direction,t.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(t){for(let e=0;e<this._points.length;e++)(0,s.d)(this._points[e],t[e]);(0,q.DV)(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(t){return(0,q.m7)(this.frustum,t)}intersectsRay(t){return(0,q.pw)(this.frustum,t)}intersectsLineSegment(t,e){return(0,q.ST)(this.frustum,t,e)}intersectsPoint(t){return(0,q.bU)(this.frustum,t)}_updateLines(){const t=this._points;for(let e=0;e<4;e++){const i=e+4;Z(this.lines[e],t[e],t[i]),Z(this.lines[e+4],t[e],3===e?t[0]:t[e+1]),Z(this.lines[e+8],t[i],3===e?t[4]:t[i+1])}}}function Z(t,e,i){t.origin=e,t.endpoint=i,(0,s.E)(t.direction,e,i)}(H=G).planePointIndices=q.c8,H.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];i(31633);const X=(0,o.fA)(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),Y=(0,o.fA)(3*parseFloat(Number(65e-8).toFixed(6)),3*parseFloat(Number(1881e-9).toFixed(6)),3*parseFloat(Number(85e-9).toFixed(6)));(0,o.fA)(parseFloat(Number(X[0]+Y[0]).toFixed(6)),parseFloat(Number(X[1]+Y[1]).toFixed(6)),parseFloat(Number(X[2]+Y[2]).toFixed(6)));const Q=2;(0,o.vt)(),(0,o.vt)(),(0,j.c)(),(0,x.vt)();const K=(0,o.vt)(),$=(0,o.vt)();var J=i(94966);const tt=(0,o.fA)(0,0,1),et=(0,s.n)((0,o.vt)(),(0,o.fA)(1,1,1)),it=(0,r.vt)(),nt=(0,o.vt)(),rt=(0,o.vt)();function st(t,e,i){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T();(0,s.i)(nt,t,tt),0===(0,s.f)(nt,nt)&&(0,s.i)(nt,t,et),(0,h.$0)(it,-(0,n.kU)(e),t),(0,h.e$)(it,it,-(0,n.kU)(i),nt);const{up:o,direction:a}=r;return(0,s.i)(o,nt,t),(0,s.n)(o,o),(0,s.t)(o,o,it),(0,s.n)(a,t),(0,s.u)(a,a),(0,s.t)(a,a,it),r}function ot(t){const e=t[1];t[1]=-t[2],t[2]=e}function at(t,e){const i=st(e,t.heading,t.tilt);return t.up=i.up,t}function lt(t,e){const i=[],n=[],r=(0,U.FD)();for(let l=0;l<t.length;l++){const a=t[l],c=l===t.length-1?t[0]:t[l+1],u=(0,w.Cr)(a,c,gt),h=(0,b.vE)(e,u.origin,u.vector,0,vt);switch(h){case 2:i.push(a);break;case 3:n.push(a);break;case 0:case 1:{const[t,l,c]=0===h?[1,i,n]:[-1,n,i],u=(0,b.Qj)(e),d=(0,s.c)((0,o.vt)(),vt,u,t*r),f=(0,s.c)((0,o.vt)(),vt,u,t*-r);l.push(a),l.push(d),c.push(f)}}}const a=[];return i.length&&a.push(i),n.length&&a.push(n),a}const ct={minCurvature:(0,n.kU)(5),maxCurvature:(0,n.kU)(50),minSamples:1,maxSamples:6},ut=(0,o.fA)(1,0,0),ht=(0,o.fA)(0,1,0),dt=(0,o.vt)(),ft=(0,o.vt)(),vt=(0,o.vt)(),pt=(0,j.c)(),gt=(0,w.vt)(),mt=(0,B.vt)();Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:function(t,e,i,n){const r=nt,o=rt;return(0,s.n)(r,t),(0,s.i)(rt,r,tt),0===(0,s.f)(rt,rt)&&(0,s.i)(rt,r,et),(0,s.i)(o,rt,r),M(e,i,n,r,o)},eyeForCenterWithHeadingTilt:function(t,e,i,r){const a={eye:(0,o.vt)(),up:null,tilt:r,heading:i},l=nt;l[0]=t[0],l[1]=t[2],l[2]=-t[1];const c=e,u=(0,n.kU)(i),h=(0,n.kU)(r),d=Math.sin(u),f=Math.cos(u),v=Math.sin(h),p=Math.cos(h),g=(0,s.b)(l);let m;if(Math.abs(h)<1e-8)m=c+g;else{const t=g/v,e=(0,n.YN)(c/t),i=Math.PI-h-e;m=t*Math.sin(i)}const _=p*c,y=c*c*(v*v),x=f*f*y,w=m-_,b=w*w,S=x*(x+b-l[1]*l[1]);if(S<0)return(0,s.h)(a.eye,l,m/g),a.tilt=0,at(a,t);const A=Math.sqrt(S),T=l[1]*w,M=x+b;let C;if(C=f>0?-A+T:A+T,Math.abs(M)<1e-8)return g<1e-8?(a.eye[0]=0,a.eye[1]=0,a.eye[2]=c):(0,s.h)(a.eye,l,m/g),a.tilt=0,ot(a.eye),at(a,t);a.eye[1]=C/M;const E=d*d*y,I=v*c,F=f*I*a.eye[1],O=a.eye[1]*a.eye[1],P=1-O,D=Math.sqrt(P),L=x*O+E-2*F*D*w+P*b;return Math.abs(L)<1e-8?((0,s.h)(a.eye,l,m/g),a.tilt=0,ot(a.eye),at(a,t)):(a.eye[0]=(P*(m*l[0]-_*l[0])-I*D*(l[0]*a.eye[1]*f+l[2]*d))/L,a.eye[2]=(P*(m*l[2]-_*l[2])-I*D*(l[2]*a.eye[1]*f-l[0]*d))/L,(0,s.h)(a.eye,a.eye,m),ot(a.eye),at(a,t))},eyeTiltToLookAtTilt:function(t,e,i){const r=(0,n.kU)(t),o=(0,s.b)(e);return(0,n.YN)(i/(o/Math.sin(r)))+r},headingTiltToDirectionUp:st,lookAtTiltToEyeTilt:function(t,e,i){const r=(0,s.b)(e),o=Math.sqrt(i*i+r*r-2*i*r*Math.cos(Math.PI-t)),a=(0,n.YN)(i/(o/Math.sin(t)));return(0,n.KJ)(t-a)},toArea:function(t,e){const{renderCoordsHelper:i}=t,r=t.state.camera.clone(),a=new G(i);r.near=Q,a.update(r);const l=i.getAltitude(e),c=t.spatialReference,u=i.referenceEllipsoid.radius,h=r.eye,d=1+(0,s.k)(h,e)/(u+l),f=Math.sqrt(d*d-1),{minCurvature:g,maxCurvature:m,minSamples:_,maxSamples:y}=ct,w=function(t){const{renderCoordsHelper:e,state:{camera:i}}=t,{center:r,eye:o}=i,a=Math.abs(e.getAltitude(r)),l=Math.abs(Math.PI/2-function(t,e,i){t.worldUpAtPosition(e,K),(0,s.e)($,i,e);const r=(0,s.b)($);return 0===r?0:(0,n.XM)((0,s.f)($,K)/r)}(e,r,o));return(0,j.b)(pt,e.referenceEllipsoid.radius+a),(0,j.d)(pt,l,i.distance,i.fovY)}(t),S=(0,n.qE)((f-g)/(m-g),0,1),A=Math.round((0,n.Cc)(_,y,S)),T=r.aboveGround,M=a.planes[5],E=[],I=(0,b.O_)(o.uY,ut,(0,b.vt)()),F=(0,b.O_)(o.uY,ht,(0,b.vt)());(0,V.s)(mt,0,0,0,0);const O=t=>{};for(let v=0;v<4;v++){const t=1===v&&!T||3===v&&T?1-w:0,e=1===v&&T||3===v&&!T?w:1,r=a.lines[v],c=a.lines[3===v?0:v+1];for(let a=0;a<A;a++){const u=a/A,d=0===a?0:(0,n.Cc)(t,e,1===v?1-(1-u)**2:3===v?u**2:u),f=(0,s.l)(ft,r.origin,c.origin,d),p=(0,J.nu)(r.direction,c.direction,d,dt);i.intersectManifoldClosestSilhouette((0,x.LV)(f,p),l,vt),C(vt,h,vt,M),E.push((0,o.o8)(vt)),0!==E.length&&O((0,s.x)(E.at(-1),vt));const g=((0,b.Tj)(I,vt)?1:0)|((0,b.Tj)(F,vt)?2:0);mt[g]=1}}E.length>2&&(0,s.x)(E[0],E.at(-1));const P=function(t,e,i){const n=2*(0,U.FD)();return t.map(t=>{const r=[];let s=!1;for(const o of t)e.fromRenderCoords(o,vt,i),Math.abs(o[0])<n&&Math.abs(o[1])<n?(r.push([null,vt[1]]),r.push([null,vt[1]]),s=!0):r.push([vt[0],vt[1]]);if(s)for(let e=0;e<r.length;e++){const t=r[e];if(null!=t[0])continue;const i=r[e+1],n=r.at(0===e?-1:e-1);t[0]=n[0],e++;const s=r.at(e===r.length-1?0:e+1);i[0]=s[0]}return r.push(r[0]),(0,p.$3)(r)||r.reverse(),r})}((0,V.b)(mt)>1?function(t,e){const i=[];for(const n of t)i.push(...lt(n,e));return i}(lt(E,I),F):[E],i,c);return new v.A({rings:P,spatialReference:c})},toExtent:function(t,e,i,r,s){let o,l,c,h;const d=e.latitude,v=(0,u.tO)(t.spatialReference).radius,p=e.longitude,g=function(t,e,i){const r=e/i,s=(0,n.kU)(t),o=Math.sin(r/2),a=Math.cos(s),l=2*(0,n.YN)(Math.sqrt(o*o/(a*a)));return(0,n.KJ)(l)}(d,i,v)/2;o=p-g,l=p+g;const m=(0,n.kU)(d),_=(1+Math.sin(m))/(1-Math.sin(m)),y=(_+1)*Math.tan(r/v/2),x=y*y;function w(t){const e=Math.PI/2;return(t=N.uC.normalize(t,-e))>e&&(t=Math.PI-t),t}if(c=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*_+x))),h=c+r/v,c=w(c),h=w(h),h<c){const t=h;h=c,c=t}if(c=Math.max((0,n.KJ)(c),-90),h=Math.min((0,n.KJ)(h),90),l=k.Y_.monotonic(o,l),l-o>180){const t=(l-o-180)/2;o+=t,l-=t}const b=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:a.A.WGS84;return s?(s.xmin=o,s.ymin=c,s.xmax=l,s.ymax=h,s.spatialReference=b):s=new f.A(o,c,l,h,b),t.spatialReference&&t.spatialReference.isWebMercator&&(0,W.Gh)(s,!1,s),s}},Symbol.toStringTag,{value:"Module"}));const _t={OPAQUE:"opaque-color",TRANSPARENT:"transparent-color",COMPOSITE:"composite-color",FINAL:"final-color"},yt={SSAO:"ssao",LASERLINES:"laserline-color",ANTIALIASING:"aa-color",HIGHLIGHTS:"highlight-color",MAGNIFIER:"magnifier-color",OCCLUDED:"occluded-color",VIEWSHED:"viewshed-color",CUTFILL_DEPTH:"cutfill-depth",CUTFILL_COLOR:"cutfill-color",OPAQUE_TERRAIN:"opaque-terrain-color",OPAQUE_ENVIRONMENT:"opaque-environment-color",TRANSPARENT_ENVIRONMENT:"transparent-environment-color",FOCUSAREA:"focusarea",FOCUSAREA_COLOR:"focusarea-color"};(0,o.vt)()},75002:(t,e,i)=>{i.d(e,{AK:()=>o,Wz:()=>s,oe:()=>r});var n=i(78393);function r(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return t<=n.y9?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function s(t){return(Array.isArray(t)?t.length:t.byteLength/8)<=n.y9?Array.from(t):new Float32Array(t)}function o(t,e,i){return Array.isArray(t)?t.slice(e,e+i):t.subarray(e,e+i)}},75569:(t,e,i)=>{i.d(e,{Q:()=>n});const n=1/255.5},75757:(t,e,i)=>{function n(t){let e=0;return new Map(t.map(t=>{let{name:i,count:n}=t;const r=[i,e];return 16===n?e+=4:9===n?e+=3:++e,r}))}function r(t){const e=new Map;let i=0;return t.forEach(t=>t.forEach(t=>{let{name:n,count:r}=t;e.set(n,i),16===r?i+=4:9===r?i+=3:++i})),e}function s(t){return r(Array.from(t.values()).map(t=>{let{layout:e}=t;return e}))}i.d(e,{Sk:()=>s,Xk:()=>n,_u:()=>r})},75803:(t,e,i)=>{i.d(e,{NV:()=>c,m8:()=>a});var n=i(30726),r=i(50346),s=i(59696),o=i(31432);class a extends s.A{constructor(t){super(t),this._numLoading=0,this._disposed=!1,this._textures=t.textures,this.updateTexture(t.textureId),this._acquire(t.normalTextureId,t=>this._textureNormal=t),this._acquire(t.emissiveTextureId,t=>this._textureEmissive=t),this._acquire(t.occlusionTextureId,t=>this._textureOcclusion=t),this._acquire(t.metallicRoughnessTextureId,t=>this._textureMetallicRoughness=t)}dispose(){super.dispose(),this._texture=(0,n.Gz)(this._texture),this._textureNormal=(0,n.Gz)(this._textureNormal),this._textureEmissive=(0,n.Gz)(this._textureEmissive),this._textureOcclusion=(0,n.Gz)(this._textureOcclusion),this._textureMetallicRoughness=(0,n.Gz)(this._textureMetallicRoughness),this._disposed=!0}ensureResources(t){return 0===this._numLoading?2:1}get textureBindParameters(){var t,e,i,n,r,s,o,a,l,u;return new c(null!==(t=null===(e=this._texture)||void 0===e?void 0:e.glTexture)&&void 0!==t?t:null,null!==(i=null===(n=this._textureNormal)||void 0===n?void 0:n.glTexture)&&void 0!==i?i:null,null!==(r=null===(s=this._textureEmissive)||void 0===s?void 0:s.glTexture)&&void 0!==r?r:null,null!==(o=null===(a=this._textureOcclusion)||void 0===a?void 0:a.glTexture)&&void 0!==o?o:null,null!==(l=null===(u=this._textureMetallicRoughness)||void 0===u?void 0:u.glTexture)&&void 0!==l?l:null)}updateTexture(t){null!=this._texture&&t===this._texture.id||(this._texture=(0,n.Gz)(this._texture),this._acquire(t,t=>this._texture=t))}_acquire(t,e){if(null==t)return void e(null);const i=this._textures.acquire(t);if((0,r.$X)(i))return++this._numLoading,void i.then(t=>{if(this._disposed)return(0,n.Gz)(t),void e(null);e(t)}).finally(()=>--this._numLoading);e(i)}}class l extends o.Y{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;super(),this.textureEmissive=t}}class c extends l{constructor(t,e,i,n,r,s,o){super(i),this.texture=t,this.textureNormal=e,this.textureOcclusion=n,this.textureMetallicRoughness=r,this.scale=s,this.normalTextureTransformMatrix=o}}},76632:(t,e,i)=>{i.d(e,{g:()=>N});var n=i(89379),r=(i(81806),i(50076)),s=i(54099),o=i(30726),a=i(50346),l=i(78393),c=i(90632),u=i(90534),h=i(23079),d=i(49003),f=i(76312),v=i(28899);let p;var g=i(93345),m=i(80895),_=i(27207);let y=null,x=null;async function w(){return null==x&&(null!==p&&void 0!==p||(p=(async()=>{const t=await i.e(4027).then(i.bind(i,84027)),e=await t.default({locateFile:t=>(0,v.s)("esri/libs/basisu/".concat(t))});return e.initializeBasis(),e})()),x=p,y=await x),x}function b(t,e){if(null==y)return t.byteLength;const i=new y.BasisFile(new Uint8Array(t)),n=T(i)?A(i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),e):0;return i.close(),i.delete(),n}function S(t,e){if(null==y)return t.byteLength;const i=new y.KTX2File(new Uint8Array(t)),n=M(i)?A(i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),e):0;return i.close(),i.delete(),n}function A(t,e,i,n,r){const s=(0,_.MW)(e?g.CQ.COMPRESSED_RGBA8_ETC2_EAC:g.CQ.COMPRESSED_RGB8_ETC2),o=r&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(i*n*s*o)}function T(t){return t.getNumImages()>=1&&!t.isUASTC()}function M(t){return t.getFaces()>=1&&t.isETC1S()}function C(t,e,i,n,r,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,h]=l?n?[1,g.CQ.COMPRESSED_RGBA8_ETC2_EAC]:[0,g.CQ.COMPRESSED_RGB8_ETC2]:c?n?[3,g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[2,g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT]:[13,6408],d=e.hasMipmap?i:Math.min(1,i),f=[];for(let v=0;v<d;v++)f.push(new Uint8Array(o(v,u))),a(v,u,f[v]);return e.internalFormat=h,e.hasMipmap=f.length>1,e.samplingMode=e.hasMipmap?9987:9729,e.width=r,e.height=s,new m.g(t,e,{type:"compressed",levels:f})}var E=i(76460);const I=()=>E.A.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function F(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}const O=F("DXT1"),P=F("DXT3"),D=F("DXT5");function L(t,e){const i=new Int32Array(t.buffer,t.byteOffset,31);if(542327876!==i[0])return I().error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return I().error("Unsupported format, must contain a FourCC code"),null;const n=i[21];let r,s;switch(n){case O:r=8,s=g.CQ.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case P:r=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case D:r=16,s=g.CQ.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return I().error("Unsupported FourCC code:",function(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}(n)),null}let o=1,a=i[4],l=i[3];(3&a||3&l)&&(I().warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,d;131072&i[2]&&!1!==e&&(o=Math.max(1,i[7]));let f=t.byteOffset+i[1]+4;const v=[];for(let p=0;p<o;++p)d=(a+3>>2)*(l+3>>2)*r,h=new Uint8Array(t.buffer,f,d),v.push(h),f+=d,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:v},internalFormat:s,width:c,height:u}}var z=i(81330),R=i(86994),H=i(96673);class N{constructor(t,e){this._data=t,this.id=(0,c.c)(),this.events=new s.bk,this._parameters=(0,n.A)((0,n.A)({},B),e),this._startPreload(t)}dispose(){this.unload(),this._data=this.update=void 0}_startPreload(t){t instanceof HTMLVideoElement?(this.update=e=>this._update(t,e),this._startPreloadVideoElement(t)):t instanceof HTMLImageElement&&this._startPreloadImageElement(t)}_startPreloadVideoElement(t){if(!((0,u.w8)(t.src)||"auto"===t.preload&&t.crossOrigin)&&(t.preload="auto",t.crossOrigin="anonymous",t.src=t.src,t.paused&&t.autoplay)){const e=[];(0,h.i)(t,t=>e.push(t)).then(()=>{t.play()}).finally(()=>e.forEach(t=>t.remove()))}}_startPreloadImageElement(t){(0,u.DB)(t.src)||(0,u.w8)(t.src)||t.crossOrigin||(t.crossOrigin="anonymous",t.src=t.src)}_createDescriptor(t){var e,i,n,r,s;const o=new H.R;return o.wrapMode=null!==(e=this._parameters.wrap)&&void 0!==e?e:10497,o.flipped=!this._parameters.noUnpackFlip,o.samplingMode=this._parameters.mipmap?9987:9729,o.hasMipmap=!!this._parameters.mipmap,o.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,o.maxAnisotropy=null!==(i=this._parameters.maxAnisotropy)&&void 0!==i?i:this._parameters.mipmap?t.parameters.maxMaxAnisotropy:1,o.dataType=null!==(n=this._parameters.dataType)&&void 0!==n?n:o.dataType,o.pixelFormat=null!==(r=this._parameters.pixelFormat)&&void 0!==r?r:o.pixelFormat,o.internalFormat=null!==(s=this._parameters.internalFormat)&&void 0!==s?s:o.internalFormat,o}get glTexture(){var t;return null!==(t=this._glTexture)&&void 0!==t?t:this._emptyTexture}get loaded(){return null!=this._glTexture}get usedMemory(){var t;return(null===(t=this._glTexture)||void 0===t?void 0:t.usedMemory)||function(t,e){var i;if(null==t)return 0;if((0,l.mw)(t)||(0,l.mg)(t))return"image/ktx2"===e.encoding?S(t,!!e.mipmap):"image/x.basis"===e.encoding?b(t,!!e.mipmap):t.byteLength;const{width:n,height:r}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?V(t):e,s=null!==(i=e.pixelFormat)&&void 0!==i?i:6408,o=(0,_.wH)(s);return(e.mipmap?4/3:1)*n*r*o||0}(this._data,this._parameters)}load(t){if(this._loadingPromise)return this._loadingPromise;if(this._glTexture)return this._glTexture;const e=this._data;return null==e?(this._glTexture=new m.g(t,this._createDescriptor(t),null),this._glTexture):(this._emptyTexture=t.emptyTexture,this._parameters.reloadable||(this._data=void 0),"string"==typeof e?this._loadFromURL(t,e):e instanceof Image?this._loadFromImageElement(t,e):e instanceof HTMLVideoElement?this._loadFromVideoElement(t,e):e instanceof ImageData||e instanceof HTMLCanvasElement?this._loadFromImage(t,e):(0,l.mg)(e)&&"image/vnd-ms.dds"===this._parameters.encoding?this._loadFromDDSData(t,e):(0,l.mw)(e)&&"image/vnd-ms.dds"===this._parameters.encoding?this._loadFromDDSData(t,new Uint8Array(e)):((0,l.mw)(e)||(0,l.mg)(e))&&"image/ktx2"===this._parameters.encoding?this._loadFromKTX2(t,e):((0,l.mw)(e)||(0,l.mg)(e))&&"image/x.basis"===this._parameters.encoding?this._loadFromBasis(t,e):(0,l.mw)(e)?this._loadFromPixelData(t,new Uint8Array(e)):(0,l.iu)(e)?this._loadFromPixelData(t,e):null)}_update(t,e){return null==this._glTexture||t.readyState<HTMLMediaElement.HAVE_CURRENT_DATA||e===t.currentTime?e:(this._glTexture.setData(t),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),t.currentTime)}_loadFromDDSData(t,e){return this._glTexture=function(t,e,i){var n;const r=L(i,null!==(n=e.hasMipmap)&&void 0!==n&&n);if(null==r)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:o,width:a,height:l}=r;return e.samplingMode=s.levels.length>1?9987:9729,e.hasMipmap=s.levels.length>1,e.internalFormat=o,e.width=a,e.height=l,new m.g(t,e,s)}(t,this._createDescriptor(t),e),this._emptyTexture=null,this._glTexture}_loadFromKTX2(t,e){return this._loadAsync(()=>async function(t,e,i){null==y&&(y=await w());const n=new y.KTX2File(new Uint8Array(i));if(!M(n))return null;n.startTranscoding();const r=C(t,e,n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),(t,e)=>n.getImageTranscodedSizeInBytes(t,0,0,e),(t,e,i)=>n.transcodeImage(i,t,0,0,e,0,-1,-1));return n.close(),n.delete(),r}(t,this._createDescriptor(t),e).then(t=>(this._glTexture=t,t)))}_loadFromBasis(t,e){return this._loadAsync(()=>async function(t,e,i){null==y&&(y=await w());const n=new y.BasisFile(new Uint8Array(i));if(!T(n))return null;n.startTranscoding();const r=C(t,e,n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),(t,e)=>n.getImageTranscodedSizeInBytes(0,t,e),(t,e,i)=>n.transcodeImage(i,0,t,e,0,0));return n.close(),n.delete(),r}(t,this._createDescriptor(t),e).then(t=>(this._glTexture=t,t)))}_loadFromPixelData(t,e){var i,n;(0,R.vA)(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(t);return 6407!==r.pixelFormat&&6408!==r.pixelFormat||(r.compress=this._parameters.compressionOptions),r.width=null!==(i=this._parameters.width)&&void 0!==i?i:0,r.height=null!==(n=this._parameters.height)&&void 0!==n?n:0,this._glTexture=new m.g(t,r,e),this._glTexture}_loadFromURL(t,e){return this._loadAsync(async i=>{const n=await(0,d.D)(e,{signal:i});return(0,a.Te)(i),this._loadFromImage(t,n)})}_loadFromImageElement(t,e){return e.complete?this._loadFromImage(t,e):this._loadAsync(async i=>{const n=await(0,f.Sx)(e,e.src,!1,i);return(0,a.Te)(i),this._loadFromImage(t,n)})}_loadFromVideoElement(t,e){return e.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?this._loadFromImage(t,e):this._loadFromVideoElementAsync(t,e)}_loadFromVideoElementAsync(t,e){return this._loadAsync(i=>new Promise((n,s)=>{const l=()=>{e.removeEventListener("loadeddata",c),e.removeEventListener("error",u),(0,o.xt)(h)},c=()=>{e.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&(l(),n(this._loadFromImage(t,e)))},u=t=>{l(),s(t||new r.A("texture:load-error","Failed to load video"))};e.addEventListener("loadeddata",c),e.addEventListener("error",u);const h=(0,a.u7)(i,()=>u((0,a.NK)()))}))}_loadFromImage(t,e){let i=e;i instanceof HTMLVideoElement||(i=(0,z.vM)(i,t.parameters));const n=V(i);this._parameters.width=n.width,this._parameters.height=n.height;const r=this._createDescriptor(t);return r.width=n.width,r.height=n.height,r.compress=this._parameters.compressionOptions,this._glTexture=new m.g(t,r,i),this._emptyTexture=null,this.events.emit("loaded"),this._glTexture}_loadAsync(t){const e=new AbortController;this._loadingController=e;const i=t(e.signal);this._loadingPromise=i;const n=()=>{this._loadingController===e&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null),this._emptyTexture=null};return i.then(n,n),i}unload(){if(this._glTexture=(0,o.WD)(this._glTexture),this._emptyTexture=null,null!=this._loadingController){const t=this._loadingController;this._loadingController=null,this._loadingPromise=null,t.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}}function V(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}const B={wrap:{s:10497,t:10497},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1}},76718:(t,e,i)=>{i.d(e,{g:()=>h});var n=i(18690),r=i(81806),s=i(76460),o=i(78393),a=i(61678),l=i(93345);const c=()=>s.A.getLogger("esri.views.webgl.BufferObject"),u=!!(0,r.A)("esri-tests-disable-gpu-memory-measurements");class h{static createIndex(t,e,i){return new h(t,34963,e,i)}static createUniform(t,e,i){return new h(t,35345,e,i)}static createPixelPack(t){let e=arguments.length>2?arguments[2]:void 0;const i=new h(t,35051,arguments.length>1&&void 0!==arguments[1]?arguments[1]:35041);return e&&i.setSize(e),i}static createPixelUnpack(t){return new h(t,35052,arguments.length>1&&void 0!==arguments[1]?arguments[1]:35040,arguments.length>2?arguments[2]:void 0)}static createTransformFeedback(t){let e=arguments.length>2?arguments[2]:void 0;const i=new h(t,35982,arguments.length>1&&void 0!==arguments[1]?arguments[1]:35044);return i.setSize(e),i}constructor(t,e,i,n){this._context=t,this.bufferType=e,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,t.instanceCounter.increment(l.vt.BufferObject,this),this._glName=this._context.gl.createBuffer(),(0,a.Y2)(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(34963===this.bufferType){if(this._indexType===l.pe.UNSIGNED_INT)return 4*this._size;if(this._indexType===l.pe.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return u?0:this.sizeBytes}get _isVAOAware(){return 34963===this.bufferType||34962===this.bufferType}dispose(){var t;null!==(t=this._context)&&void 0!==t&&t.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(l.vt.BufferObject,this),this._context=null):this._glName&&c().warn("Leaked WebGL buffer object")}setSize(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(34963===this.bufferType&&null!=e)switch(this._indexType=e,e){case l.pe.UNSIGNED_SHORT:t*=2;break;case l.pe.UNSIGNED_INT:t*=4}this._setBufferData(t)}setData(t){if(!t)return;let e=t.byteLength;34963===this.bufferType&&((0,o.mg)(t)?this._indexType=l.pe.UNSIGNED_BYTE:(0,o.jq)(t)?(e/=2,this._indexType=l.pe.UNSIGNED_SHORT):(0,o.XJ)(t)&&(e/=4,this._indexType=l.pe.UNSIGNED_INT)),this._setBufferData(e,t)}_setBufferData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._size=t;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;null!=e?n.bufferData(this.bufferType,e,this.usage):n.bufferData(this.bufferType,t,this.usage),(0,a.Y2)(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(t,e,i,n){if(!t)return;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:s}=this._context;s.bufferSubData(this.bufferType,e*t.BYTES_PER_ELEMENT,t,i,n-i),(0,a.Y2)(s),this._isVAOAware&&this._context.bindVAO(r)}getSubData(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(i<0||r<0)return;const s=function(t){return(0,n.Xj)(t)}(t)?t.BYTES_PER_ELEMENT:1;if(s*((null!==i&&void 0!==i?i:0)+(null!==r&&void 0!==r?r:0))>t.byteLength)return;e+s*(null!==r&&void 0!==r?r:0)>this.usedMemory&&c().warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;35982===this.bufferType?(this._context.bindBuffer(this,35982),o.getBufferSubData(35982,e,t,i,r),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),o.getBufferSubData(36662,e,t,i,r),this._context.unbindBuffer(36662))}async getSubDataAsync(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;await this._context.clientWaitAsync(),this.getSubData(t,e,i,n)}}},79138:(t,e,i)=>{i.d(e,{y:()=>o});var n,r=i(57528),s=i(86955);function o(t){const{fragment:e}=t;e.code.add((0,s.H)(n||(n=(0,r.A)(["uint readChannelBits(uint channel, int highlightLevel) {\nint llc = (highlightLevel & 3) << 1;\nreturn (channel >> llc) & 3u;\n}\nuint readChannel(uvec2 texel, int highlightLevel) {\nint lic = (highlightLevel >> 2) & 1;\nreturn texel[lic];\n}\nuint readLevelBits(uvec2 texel, int highlightLevel) {\nreturn readChannelBits(readChannel(texel, highlightLevel), highlightLevel);\n}"]))))}},80883:(t,e,i)=>{i.d(e,{a:()=>o});var n,r=i(57528),s=i(86955);function o(t){t.code.add((0,s.H)(n||(n=(0,r.A)(["vec4 premultiplyAlpha(vec4 v) {\nreturn vec4(v.rgb * v.a, v.a);\n}\nvec3 rgb2hsv(vec3 c) {\nvec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);\nvec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);\nfloat d = q.x - min(q.w, q.y);\nfloat e = 1.0e-10;\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);\n}\nvec3 hsv2rgb(vec3 c) {\nvec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\nreturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nfloat rgb2v(vec3 c) {\nreturn max(c.x, max(c.y, c.z));\n}"]))))}},81330:(t,e,i)=>{i.d(e,{FC:()=>o,Mv:()=>s,vM:()=>a});var n=i(50076);const r=16;function s(t,e){return e=Math.floor(e/r)*r,Math.min(Math.round(t/r)*r,e)}function o(t,e){return e=Math.floor(e/r)*r,Math.min(Math.ceil(t/r)*r,e)}function a(t,e){const[i,n]=l(t,e);return t.width===i&&t.height===n?t:c(t,i,n)}function l(t,e){let{width:i,height:n}=t,{maxPreferredTexturePixels:r,maxTextureSize:o}=e;const a=Math.max(i,n),l=i*n;if(a<=o&&l<=r)return[i,n];const c=Math.min(Math.sqrt(r/l),o/a);return[s(Math.round(i*c),o),s(Math.round(n*c),o)]}function c(t,e,i){if(t instanceof ImageData)return c(function(t){const e=document.createElement("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");if(null==i)throw new n.A("texture:context-failed","Failed to create 2d context from HTMLCanvasElement");return i.putImageData(t,0,0),e}(t),e,i);const r=document.createElement("canvas");return r.width=e,r.height=i,r.getContext("2d").drawImage(t,0,0,r.width,r.height),r}},82805:(t,e,i)=>{i.d(e,{i:()=>u});var n=i(34761),r=i(13191),s=i(20664),o=i(9392),a=i(43047),l=i(55855),c=i(95925);class u{get ray(){return this._ray}get distanceInRenderSpace(){return null==this.distance?null:((0,s.h)(d,this.ray.direction,this.distance),(0,s.b)(d))}withinDistance(t){return!!h(this)&&this.distanceInRenderSpace<=t}getIntersectionPoint(t){return!!h(this)&&((0,s.h)(d,this.ray.direction,this.distance),(0,s.g)(t,this.ray.origin,d),!0)}getTransformedNormal(t){return(0,s.d)(f,this.normal),f[3]=0,(0,a.t)(f,f,this.transformation),(0,s.d)(t,f),(0,s.n)(t,t)}constructor(t){this.intersector=4,this.normal=(0,o.vt)(),this.transformation=(0,r.vt)(),this._ray=(0,c.vt)(),this.init(t)}init(t){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=4,(0,c.C)(t,this._ray)}set(t,e,i,a,l,c,u){this.intersector=t,this.distance=i,(0,s.d)(this.normal,null!==a&&void 0!==a?a:o.Cb),(0,n.C)(this.transformation,null!==l&&void 0!==l?l:r.zK),this.target=e,this.drapedLayerOrder=c,this.renderPriority=u}copy(t){(0,c.C)(t.ray,this._ray),this.intersector=t.intersector,this.distance=t.distance,this.target=t.target,this.drapedLayerOrder=t.drapedLayerOrder,this.renderPriority=t.renderPriority,(0,s.d)(this.normal,t.normal),(0,n.C)(this.transformation,t.transformation)}}function h(t){return null!=(null===t||void 0===t?void 0:t.distance)}const d=(0,o.vt)(),f=(0,l.vt)()},82809:(t,e,i)=>{i.d(e,{Z:()=>l});var n=i(20664),r=i(9392),s=i(88105),o=i(48168),a=i(52757);class l{constructor(t){this.layout=t}elementCount(t){return t.get("position").indices.length}write(t,e,i,n,r,s){return(0,a.vJ)(i,n,this.layout,t,e,r,s)}intersect(t,e,i,r,a,l,u){const h=this.layout.createView(t).getField("position",s.xs);if(null==h)return;const d=(0,n.a)(c,l,a),f=h.count/3,v=r.options.normalRequired;(0,o.b_)(a,d,0,f,h.typedBuffer,h.typedBufferStride,v,(t,e,i)=>u(t,i,e))}}const c=(0,r.vt)()},84115:(t,e,i)=>{i.d(e,{d:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"vec3",0,(n,r)=>n.setUniform3fv(t,e(r),i))}}},85086:(t,e,i)=>{i.d(e,{j:()=>a});var n=i(5457),r=i(20664),s=i(9392),o=i(86994);class a{get center(){return(0,s.fA)(this._data[0],this._data[1],this._data[2])}get radius(){return this._data[3]}get bbMin(){return(0,s.fA)(this._data[4],this._data[5],this._data[6])}get bbMax(){return(0,s.fA)(this._data[7],this._data[8],this._data[9])}constructor(t,e,i){this.primitiveIndices=t,this._numIndexPerPrimitive=e,this.position=i,this._data=[.1,0,0,0,0,0,0,0,0,0],this._children=void 0,(0,o.vA)(t.length>=1),(0,o.vA)(3===i.size||4===i.size);const{data:n,size:a,indices:c}=i;(0,o.vA)(c.length%this._numIndexPerPrimitive===0),(0,o.vA)(c.length>=t.length*this._numIndexPerPrimitive);const u=t.length;let h=a*c[this._numIndexPerPrimitive*t[0]];l.clear(),l.push(h);const d=(0,s.fA)(n[h],n[h+1],n[h+2]),f=(0,s.o8)(d);for(let r=0;r<u;++r){const e=this._numIndexPerPrimitive*t[r];for(let t=0;t<this._numIndexPerPrimitive;++t){h=a*c[e+t],l.push(h);let i=n[h];d[0]=Math.min(i,d[0]),f[0]=Math.max(i,f[0]),i=n[h+1],d[1]=Math.min(i,d[1]),f[1]=Math.max(i,f[1]),i=n[h+2],d[2]=Math.min(i,d[2]),f[2]=Math.max(i,f[2])}}for(let r=0;r<3;++r)this._data[4+r]=d[r],this._data[7+r]=f[r];const v=(0,r.l)((0,s.vt)(),this.bbMin,this.bbMax,.5);let p=.5*Math.max(Math.max(f[0]-d[0],f[1]-d[1]),f[2]-d[2]),g=p*p;for(let r=0;r<l.length;++r){h=l.at(r);const t=n[h]-v[0],e=n[h+1]-v[1],i=n[h+2]-v[2],s=t*t+e*e+i*i;if(s<=g)continue;const o=Math.sqrt(s),a=.5*(o-p);p+=a,g=p*p;const c=a/o;v[0]+=t*c,v[1]+=e*c,v[2]+=i*c}this._data[3]=p;for(let r=0;r<3;++r)this._data[0+r]=v[r];l.clear()}getChildren(){if(this._children||(0,r.s)(this.bbMin,this.bbMax)<=1)return this._children;const t=(0,r.l)((0,s.vt)(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length,i=new Uint8Array(e),n=new Array(8);for(let r=0;r<8;++r)n[r]=0;const{data:o,size:l,indices:c}=this.position;for(let r=0;r<e;++r){let e=0;const s=this._numIndexPerPrimitive*this.primitiveIndices[r];let a=l*c[s],u=o[a],h=o[a+1],d=o[a+2];for(let t=1;t<this._numIndexPerPrimitive;++t){a=l*c[s+t];const e=o[a],i=o[a+1],n=o[a+2];e<u&&(u=e),i<h&&(h=i),n<d&&(d=n)}u<t[0]&&(e|=1),h<t[1]&&(e|=2),d<t[2]&&(e|=4),i[r]=e,++n[e]}let u=0;for(let r=0;r<8;++r)n[r]>0&&++u;if(u<2)return;const h=new Array(8);for(let r=0;r<8;++r)h[r]=n[r]>0?new Uint32Array(n[r]):void 0;for(let r=0;r<8;++r)n[r]=0;for(let r=0;r<e;++r){const t=i[r];h[t][n[t]++]=this.primitiveIndices[r]}this._children=new Array;for(let r=0;r<8;++r)void 0!==h[r]&&this._children.push(new a(h[r],this._numIndexPerPrimitive,this.position));return this._children}static prune(){l.prune()}}const l=new n.A({deallocator:null})},85793:(t,e,i)=>{i.d(e,{ML:()=>h,WD:()=>c,Y1:()=>u,oF:()=>d});var n,r,s,o,a=i(57528),l=i(86955);function c(t){t.code.add((0,l.H)(n||(n=(0,a.A)(["struct MaskedColor {\nvec4 color;\nbvec4 mask;\n};"]))))}function u(t){t.include(c),t.code.add((0,l.H)(r||(r=(0,a.A)(["\n    MaskedColor createMaskedFromUInt8NaNColor(vec4 color) {\n      return MaskedColor(color * ",", equal(color, vec4(255)));\n    }\n  "])),l.H.float(1/254)))}function h(t){t.include(c),t.code.add((0,l.H)(s||(s=(0,a.A)(["vec4 maskedColorSelectOrOne(MaskedColor color) {\nreturn vec4(\ncolor.mask.r ? 1.0 : color.color.r,\ncolor.mask.g ? 1.0 : color.color.g,\ncolor.mask.b ? 1.0 : color.color.b,\ncolor.mask.a ? 1.0 : color.color.a\n);\n}\nMaskedColor multiplyMaskedColors(MaskedColor color1, MaskedColor color2) {\nvec4 masked1 = maskedColorSelectOrOne(color1);\nvec4 masked2 = maskedColorSelectOrOne(color2);\nreturn MaskedColor(masked1 * masked2, bvec4(ivec4(color1.mask) & ivec4(color2.mask)));\n}"]))))}function d(t){t.include(c),t.code.add((0,l.H)(o||(o=(0,a.A)(["MaskedColor createMaskedFromNaNColor(vec4 color) {\nreturn MaskedColor(color, isnan(color));\n}"]))))}},86955:(t,e,i)=>{i.d(e,{H:()=>n,If:()=>r});const n=function(t){let e="";for(let i=0;i<(arguments.length<=1?0:arguments.length-1);i++)e+=t[i]+(i+1<1||arguments.length<=i+1?void 0:arguments[i+1]);return e+=t[t.length-1],e};function r(t,e){return t?e:arguments.length>2&&void 0!==arguments[2]?arguments[2]:""}n.int=t=>Math.round(t).toString(),n.float=t=>t.toPrecision(8)},87003:(t,e,i)=>{i.d(e,{n:()=>n});i(81806);class n{constructor(t,e,i,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(this.name=t,this.type=e,this.arraySize=r,this.bind={0:null,1:null,2:null},n)switch(i){case void 0:break;case 0:this.bind[0]=n;break;case 1:this.bind[1]=n;break;case 2:this.bind[2]=n}}equals(t){return this.type===t.type&&this.name===t.name&&this.arraySize===t.arraySize}}},87236:(t,e,i)=>{i.d(e,{Q:()=>m});var n=i(57528),r=i(79138),s=i(86955),o=i(87003);class a extends o.n{constructor(t,e){super(t,"ivec2",0,(i,n)=>i.setUniform2iv(t,e(n)))}}var l,c,u,h,d,f,v=i(53908),p=i(4653);class g extends o.n{constructor(t,e){super(t,"usampler2D",0,(i,n)=>i.bindTexture(t,e(n)))}}function m(t,e){const{fragment:i}=t,{output:o,draped:m,hasHighlightMixTexture:_}=e;9===o?(i.uniforms.add(new v.W("highlightLevel",t=>{var e;return null!==(e=t.highlightLevel)&&void 0!==e?e:0}),new a("highlightMixOrigin",t=>t.highlightMixOrigin)),t.outputs.add("fragHighlight","uvec2",0),t.include(r.y),_?i.uniforms.add(new g("highlightMixTexture",t=>t.highlightMixTexture)).code.add((0,s.H)(l||(l=(0,n.A)(["uvec2 getAccumulatedHighlight() {\nreturn texelFetch(highlightMixTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;\n}\nvoid outputHighlight(bool occluded) {\nif (highlightLevel == 0) {\nuint bits = occluded ? 3u : 1u;\nfragHighlight = uvec2(bits, 0);\n} else {\nint ll = (highlightLevel & 3) << 1;\nint li = (highlightLevel >> 2) & 3;\nuint bits;\nif (occluded) {\nbits = 3u << ll;\n} else {\nbits = 1u << ll;\n}\nuvec2 combinedHighlight = getAccumulatedHighlight();\ncombinedHighlight[li] |= bits;\nfragHighlight = combinedHighlight;\n}\n}"])))):i.code.add((0,s.H)(c||(c=(0,n.A)(["void outputHighlight(bool occluded) {\nuint bits = occluded ? 3u : 1u;\nfragHighlight = uvec2(bits, 0);\n}"])))),m?i.code.add((0,s.H)(u||(u=(0,n.A)(["bool isHighlightOccluded() {\nreturn false;\n}"])))):i.uniforms.add(new p.x("depthTexture",t=>t.mainDepth)).code.add((0,s.H)(h||(h=(0,n.A)(["bool isHighlightOccluded() {\nfloat sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;\nreturn gl_FragCoord.z > sceneDepth + 5e-7;\n}"])))),i.code.add((0,s.H)(d||(d=(0,n.A)(["void calculateOcclusionAndOutputHighlight() {\noutputHighlight(isHighlightOccluded());\n}"]))))):i.code.add((0,s.H)(f||(f=(0,n.A)(["void calculateOcclusionAndOutputHighlight() {}"]))))}},89299:(t,e,i)=>{i.d(e,{u:()=>a});var n,r=i(57528),s=i(23148),o=i(86955);function a(t,e){let{code:i,uniforms:a}=t;a.add(new s.U("dpDummy",()=>1)),i.add((0,o.H)(n||(n=(0,r.A)(["vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\nvec3 hiD = hiA + hiB;\nvec3 loD = loA + loB;\nreturn  dpDummy * hiD + loD;\n}"]))))}},89595:(t,e,i)=>{i.d(e,{rQ:()=>o,lx:()=>a});var n=i(9392),r=i(82805);class s{constructor(t,e,i){this.object=t,this.geometryId=e,this.primitiveIndex=i}}class o extends r.i{constructor(){super(...arguments),this.intersector=1}}class a extends s{constructor(t,e){super(t.object,t.geometryId,t.primitiveIndex),this.center=(0,n.o8)(e)}}},89596:(t,e,i)=>{var n;i.d(e,{d:()=>r});class r{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1/0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1/0;this.near=t,this.far=e}set(t,e){this.near=t,this.far=e}union(t){null!=t&&(this.near=Math.min(this.near,t.near),this.far=Math.max(this.far,t.far))}within(t){return this.near<=t&&t<=this.far}equals(t){return this.near===t.near&&this.far===t.far}}(n=r).Zero=new n(0,0),n.Infinite=new n},90080:(t,e,i)=>{i.d(e,{g:()=>c});var n,r,s,o,a=i(57528),l=i(86955);function c(t,e){if(10!==e.output)return t.vertex.code.add((0,l.H)(n||(n=(0,a.A)(["void forwardObjectAndLayerIdColor() {}"])))),void t.fragment.code.add((0,l.H)(r||(r=(0,a.A)(["void outputObjectAndLayerIdColor() {}"]))));const i=e.instanced;t.varyings.add("objectAndLayerIdColorVarying","vec4");const c=i?"instanceOlidColor":"olidColor";t.attributes.add(c,"vec4"),t.vertex.code.add((0,l.H)(s||(s=(0,a.A)(["\n    void forwardObjectAndLayerIdColor() {\n      objectAndLayerIdColorVarying = "," * 0.003921568627451;\n    }"])),c)),t.fragment.code.add((0,l.H)(o||(o=(0,a.A)(["void outputObjectAndLayerIdColor() {\nfragColor = objectAndLayerIdColorVarying;\n}"]))))}},91911:(t,e,i)=>{i.d(e,{z:()=>d});var n,r,s=i(57528),o=i(34981),a=i(42717),l=i(87236),c=i(80883),u=i(86955),h=i(75569);function d(t,e){t.include(l.Q,e),t.include(a.NL,e),t.fragment.include(c.a);const{output:i,oitPass:d,discardInvisibleFragments:f,snowCover:v}=e,p=10===i,g=(0,o.LG)(i),m=(0,o.RN)(i)&&1===d,_=(0,o.RN)(i)&&1!==d;let y=0;(_||g||m)&&t.outputs.add("fragColor","vec4",y++),g&&t.outputs.add("fragEmission","vec4",y++),m&&t.outputs.add("fragAlpha","float",y++),t.fragment.code.add((0,u.H)(n||(n=(0,s.A)(["\n    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition, vec3 emissiveSymbolColor ",") {\n      ","\n\n      ","\n\n      finalColor = applySlice(finalColor, vWorldPosition);\n      ","\n      ","\n      ","\n      calculateOcclusionAndOutputHighlight();\n      ","\n    }\n  "])),(0,u.If)(v,", float snow"),(0,u.If)(p,"finalColor.a = 1.0;"),(0,u.If)(f,"if (finalColor.a < ".concat(u.H.float(h.Q),") { discard; }")),(0,u.If)(m,(0,u.H)(r||(r=(0,s.A)(["fragColor = premultiplyAlpha(finalColor);\n             fragAlpha = finalColor.a;"])))),(0,u.If)(_,"fragColor = finalColor;"),(0,u.If)(g,"fragEmission = ".concat((0,u.If)(v,"mix(finalColor.a * getEmissions(emissiveSymbolColor), vec4(0.0), snow);","finalColor.a * getEmissions(emissiveSymbolColor);"))),(0,u.If)(p,"outputObjectAndLayerIdColor();")))}},92656:(t,e,i)=>{i.d(e,{E:()=>o});var n=i(6326),r=i(9937),s=i(6485);class o extends r.n{constructor(){super(...arguments),this.output=0,this.oitPass=0,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=1,this.instanced=!1,this.writeDepth=!0}}(0,n.Cg)([(0,s.W)({count:11})],o.prototype,"output",void 0),(0,n.Cg)([(0,s.W)({count:3})],o.prototype,"oitPass",void 0),(0,n.Cg)([(0,s.W)()],o.prototype,"hasSlicePlane",void 0),(0,n.Cg)([(0,s.W)()],o.prototype,"hasHighlightMixTexture",void 0)},93684:(t,e,i)=>{i.d(e,{S:()=>r,p:()=>s});var n=i(63048);class r extends n.Gd{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}const s=8},94192:(t,e,i)=>{i.d(e,{Z:()=>l});var n,r=i(57528),s=i(65058),o=i(86955),a=i(4653);function l(t,e){let{occlusionPass:i,terrainDepthTest:l,cullAboveTerrain:c}=e;const{vertex:u,fragment:h,varyings:d}=t;if(!l)return u.code.add("void forwardViewPosDepth(vec3 pos) {}"),void h.code.add("".concat(i?"bool":"void"," discardByTerrainDepth() { ").concat((0,o.If)(i,"return false;"),"}"));d.add("viewPosDepth","float",{invariant:!0}),u.code.add("void forwardViewPosDepth(vec3 pos) {\n    viewPosDepth = pos.z;\n  }"),h.include(s.E),h.uniforms.add(new a.x("terrainDepthTexture",t=>{var e;return null===(e=t.terrainDepth)||void 0===e?void 0:e.attachment})).code.add((0,o.H)(n||(n=(0,r.A)(["\n    "," discardByTerrainDepth() {\n      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;\n      float linearDepth = linearizeDepth(depth);\n      ","\n    }"])),i?"bool":"void",i?"return viewPosDepth < linearDepth && depth < 1.0;":"if(viewPosDepth ".concat(c?">":"<="," linearDepth) discard;")))}},94759:(t,e,i)=>{i.d(e,{C:()=>a});var n,r=i(57528),s=i(99746),o=i(86955);function a(t){t.code.add((0,o.H)(n||(n=(0,r.A)(["\n    const float GAMMA = ",";\n    const float INV_GAMMA = ",";\n\n    vec4 delinearizeGamma(vec4 color) {\n      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);\n    }\n\n    vec3 linearizeGamma(vec3 color) {\n      return pow(color, vec3(GAMMA));\n    }\n  "])),o.H.float(s.Tf),o.H.float(1/s.Tf)))}},95352:(t,e,i)=>{i.d(e,{r:()=>c});var n,r,s=i(57528),o=i(97808),a=i(86955);function l(t){t.fragment.code.add((0,a.H)(n||(n=(0,s.A)(["vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {\nvec2 atlasScale = atlasRegion.zw - atlasRegion.xy;\nvec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;\nfloat maxdUV = 0.125;\nvec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nvec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;\nreturn textureGrad(tex, uvAtlas, dUVdx, dUVdy);\n}"]))))}function c(t,e){const{textureCoordinateType:i}=e;if(0===i||3===i)return;t.include(o.U,e);const n=2===i;n&&t.include(l),t.fragment.code.add((0,a.H)(r||(r=(0,s.A)(["\n    vec4 textureLookup(sampler2D tex, vec2 uv) {\n      return ",";\n    }\n  "])),n?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"))}},95756:(t,e,i)=>{i.d(e,{G:()=>r});var n=i(87003);class r extends n.n{constructor(t,e,i){super(t,"vec2",1,(n,r,s)=>n.setUniform2fv(t,e(r,s),i))}}},96342:(t,e,i)=>{i.d(e,{n:()=>d});var n=i(20664),r=i(9392),s=i(95925),o=i(33062),a=i(89595);class l{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerViewUids=[],this.store=2,this.normalRequired=!0,this.excludeLabels=!1}}var c=i(82805),u=i(97974);const h=1e-5;class d{constructor(t){this.options=new l,this._results=new v,this.transform=new u.dg,this.camera=new o.A,this.tolerance=h,this.verticalOffset=null,this._ray=(0,s.vt)(),this._rayEnd=(0,r.vt)(),this._rayBeginTransformed=(0,r.vt)(),this._rayEndTransformed=(0,r.vt)(),this.viewingMode=null!==t&&void 0!==t?t:1}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(t,e,i){this.resetWithRay((0,s.Cr)(t,e,this._ray),i)}resetWithRay(t,e){this.camera=e,t!==this._ray&&(0,s.C)(t,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,(0,n.g)(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;this.point=e,this.filterPredicate=n,this.tolerance=null!==i&&void 0!==i?i:h;const s=(0,u.ou)(this.verticalOffset);if(t&&t.length>0){const e=r?t=>{r(t)&&this.intersectObject(t)}:t=>{this.intersectObject(t)};for(const i of t){var o;const t=null===(o=i.getSpatialQueryAccelerator)||void 0===o?void 0:o.call(i);null!=t?(null!=s?t.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,e,s):t.forEachAlongRay(this._ray.origin,this._ray.direction,e),this.options.selectionMode&&this.options.hud&&t.forEachDegenerateObject(e)):i.objects.forEach(t=>e(t))}}this.sortResults()}intersectObject(t){const e=t.geometries;if(!e)return;const i=t.effectiveTransformation,r=(0,u.ou)(this.verticalOffset);for(const s of e){if(!s.visible)continue;const{material:e,id:o}=s;if(!e.visible)continue;this.transform.setAndInvalidateLazyTransforms(i,s.transformation),(0,n.t)(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),(0,n.t)(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const a=this.transform.transform;null!=r&&(r.objectTransform=this.transform),e.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(e,i,n,r)=>this.handleObjectIntersection({object:t,geometryId:o,primitiveIndex:n},e,i,a,r))}}handleObjectIntersection(t,e,i,n,r){if(e<0||null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,e))return;const s=r?this._results.hud:this._results;t=r?new a.lx(t,r):t;const o=r?n=>n.set(1,t,e,i):r=>r.set(4,t,e,i,n);if((null==s.min.distance||e<s.min.distance)&&o(s.min),0!==this.options.store&&(null==s.max.distance||e>s.max.distance)&&o(s.max),2===this.options.store)if(r){const t=new a.rQ(this._ray);o(t),this._results.hud.all.push(t)}else{const t=new c.i(this._ray);o(t),this._results.all.push(t)}}sortResults(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._results.all).sort((t,e)=>{var i,n;return t.distance!==e.distance?(null!==(i=t.distance)&&void 0!==i?i:0)-(null!==(n=e.distance)&&void 0!==n?n:0):t.drapedLayerOrder!==e.drapedLayerOrder?f(t.drapedLayerOrder,e.drapedLayerOrder):f(t.renderPriority,e.renderPriority)})}}function f(t,e){return(null!==e&&void 0!==e?e:-Number.MAX_VALUE)-(null!==t&&void 0!==t?t:-Number.MAX_VALUE)}class v{constructor(){this.min=new c.i((0,s.vt)()),this.max=new c.i((0,s.vt)()),this.hud={min:new a.rQ((0,s.vt)()),max:new a.rQ((0,s.vt)()),all:new Array},this.ground=new c.i((0,s.vt)()),this.all=[]}init(t){this.min.init(t),this.max.init(t),this.ground.init(t),this.all.length=0,this.hud.min.init(t),this.hud.max.init(t),this.hud.all.length=0}}},96643:(t,e,i)=>{i.d(e,{I$:()=>c,a9:()=>l,m:()=>n,mK:()=>u,qh:()=>a,r8:()=>o,sf:()=>r,v0:()=>s});const n={func:513},r={func:519},s={mask:255},o={mask:0},a={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},l={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},c={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},u={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}}},97808:(t,e,i)=>{i.d(e,{U:()=>c});var n,r,s,o=i(57528),a=i(4212),l=i(86955);function c(t,e){switch(e.textureCoordinateType){case 1:return t.attributes.add("uv0","vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add((0,l.H)(n||(n=(0,o.A)(["void forwardTextureCoordinates() { vuv0 = uv0; }"]))));case 2:return t.attributes.add("uv0","vec2"),t.attributes.add("uvRegion","vec4"),t.varyings.add("vuv0","vec2"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add((0,l.H)(r||(r=(0,o.A)(["void forwardTextureCoordinates() {\nvuv0 = uv0;\nvuvRegion = uvRegion;\n}"]))));default:(0,a.Xb)(e.textureCoordinateType);case 0:return void t.vertex.code.add((0,l.H)(s||(s=(0,o.A)(["void forwardTextureCoordinates() {}"]))));case 3:return}}},97974:(t,e,i)=>{i.d(e,{dg:()=>h,ou:()=>v});var n=i(86300),r=i(44680),s=i(34761),o=i(13191),a=i(20664),l=i(9392),c=i(78315),u=i(59231);class h{constructor(){this._transform=(0,o.vt)(),this._transformInverse=new d({value:this._transform},s.B8,o.vt),this._transformInverseTranspose=new d(this._transformInverse,s.mg,o.vt),this._transformTranspose=new d({value:this._transform},s.mg,o.vt),this._transformInverseRotation=new d({value:this._transform},n.dR,r.vt)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(t){(0,s.C)(this._transform,t)}multiplyTransform(t){(0,s.lw)(this._transform,this._transform,t)}set(t){(0,s.C)(this._transform,t),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(t,e){this.setTransformMatrix(t),this.multiplyTransform(e),this._invalidateLazyTransforms()}}class d{constructor(t,e,i){this._original=t,this._update=e,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}const f=new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=t,this.sphere=(0,c.c)(),this.tmpVertex=(0,l.vt)()}applyToVertex(t,e,i){const n=this.objectTransform.transform,r=(0,a.j)(p,t,e,i),s=(0,a.t)(r,r,n),o=this.offset/(0,a.b)(s);(0,a.c)(s,s,s,o);const l=this.objectTransform.inverse;return(0,a.t)(this.tmpVertex,s,l),this.tmpVertex}applyToMinMax(t,e){const i=this.offset/(0,a.b)(t);(0,a.c)(t,t,t,i);const n=this.offset/(0,a.b)(e);(0,a.c)(e,e,e,n)}applyToAabb(t){const e=this.offset/Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]+=t[0]*e,t[1]+=t[1]*e,t[2]+=t[2]*e;const i=this.offset/Math.sqrt(t[3]*t[3]+t[4]*t[4]+t[5]*t[5]);return t[3]+=t[3]*i,t[4]+=t[4]*i,t[5]+=t[5]*i,t}applyToBoundingSphere(t){const e=(0,c.a)(t),i=(0,a.b)(e),n=this.offset/i,r=(0,a.c)(x,e,e,n),s=t[3]+t[3]*this.offset/i;return(0,c.e)(this.sphere,r,s),this.sphere}};function v(t){return null!=t?(f.offset=t,f):null}new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=(0,l.vt)(),this._tmpMbs=(0,c.c)(),this._tmpObb=new u.ab,this._resetOffset(t)}_resetOffset(t){this._offset=t,this._totalOffset=t}set offset(t){this._resetOffset(t)}get offset(){return this._offset}set componentOffset(t){this._totalOffset=this._offset+t}set localOrigin(t){this.componentLocalOriginLength=(0,a.b)(t)}applyToVertex(t,e,i){const n=(0,a.j)(p,t,e,i),r=(0,a.j)(g,t,e,i+this.componentLocalOriginLength),s=this._totalOffset/(0,a.b)(r);return(0,a.c)(this._tmpVertex,n,r,s),this._tmpVertex}applyToAabb(t){const e=this.componentLocalOriginLength,i=t[0],n=t[1],r=t[2]+e,s=t[3],o=t[4],a=t[5]+e,l=Math.abs(i),c=Math.abs(n),u=Math.abs(r),h=Math.abs(s),d=Math.abs(o),f=Math.abs(a),v=.5*(1+Math.sign(i*s))*Math.min(l,h),p=.5*(1+Math.sign(n*o))*Math.min(c,d),g=.5*(1+Math.sign(r*a))*Math.min(u,f),m=Math.max(l,h),_=Math.max(c,d),y=Math.max(u,f),x=Math.sqrt(v*v+p*p+g*g),w=Math.sign(l+i),b=Math.sign(c+n),S=Math.sign(u+r),A=Math.sign(h+s),T=Math.sign(d+o),M=Math.sign(f+a),C=this._totalOffset;if(x<C)return t[0]-=(1-w)*C,t[1]-=(1-b)*C,t[2]-=(1-S)*C,t[3]+=A*C,t[4]+=T*C,t[5]+=M*C,t;const E=C/Math.sqrt(m*m+_*_+y*y),I=C/x,F=I-E,O=-F;return t[0]+=i*(w*O+I),t[1]+=n*(b*O+I),t[2]+=r*(S*O+I),t[3]+=s*(A*F+E),t[4]+=o*(T*F+E),t[5]+=a*(M*F+E),t}applyToMbs(t){const e=(0,c.a)(t),i=(0,a.b)(e),n=this._totalOffset/i,r=(0,a.c)(x,e,e,n),s=t[3]+t[3]*this._totalOffset/i;return(0,c.e)(this._tmpMbs,r,s),this._tmpMbs}applyToObb(t){return(0,u.gm)(t,this._totalOffset,this._totalOffset,1,this._tmpObb),this._tmpObb}};new class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.offset=t,this.tmpVertex=(0,l.vt)()}applyToVertex(t,e,i){const n=(0,a.j)(p,t,e,i),r=(0,a.g)(g,n,this.localOrigin),s=this.offset/(0,a.b)(r);return(0,a.c)(this.tmpVertex,n,r,s),this.tmpVertex}applyToAabb(t){const e=m,i=_,n=y;for(let a=0;a<3;++a)e[a]=t[0+a]+this.localOrigin[a],i[a]=t[3+a]+this.localOrigin[a],n[a]=e[a];const r=this.applyToVertex(e[0],e[1],e[2]);for(let a=0;a<3;++a)t[a]=r[a],t[a+3]=r[a];const s=e=>{const i=this.applyToVertex(e[0],e[1],e[2]);for(let n=0;n<3;++n)t[n]=Math.min(t[n],i[n]),t[n+3]=Math.max(t[n+3],i[n])};for(let a=1;a<8;++a){for(let t=0;t<3;++t)n[t]=a&1<<t?i[t]:e[t];s(n)}let o=0;for(let a=0;a<3;++a)e[a]*i[a]<0&&(o|=1<<a);if(0!==o&&7!==o)for(let a=0;a<8;++a)if(0===(o&a)){for(let t=0;t<3;++t)n[t]=o&1<<t?0:a&1<<t?e[t]:i[t];s(n)}for(let a=0;a<3;++a)t[a]-=this.localOrigin[a],t[a+3]-=this.localOrigin[a];return t}};const p=(0,l.vt)(),g=(0,l.vt)(),m=(0,l.vt)(),_=(0,l.vt)(),y=(0,l.vt)(),x=(0,l.vt)()},99362:(t,e,i)=>{i.d(e,{MB:()=>l,Um:()=>c,kE:()=>o});var n=i(18690),r=i(15941),s=i(12028);function o(t,e,i,n,s,o){let a=i.screenLength*t.pixelRatio;null!=s&&(u.update(n,e,s,o),a=u.apply(a));const l=a*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return(0,r.qE)(l*e,i.minWorldLength,i.maxWorldLength)}const a=(0,n.VO)();function l(t,e){let i=!1;for(const n in e){const r=e[n];void 0!==r&&(Array.isArray(r)?Array.isArray(t[n])&&a(r,t[n])||(t[n]=r.slice(),i=!0):t[n]!==r&&(i=!0,t[n]=r))}return i}const c={multiply:1,ignore:2,replace:3,tint:4},u=new s.PS},99643:(t,e,i)=>{function n(t,e,i){for(let n=0;n<i;++n)e[2*n]=t[n],e[2*n+1]=t[n]-e[2*n]}function r(t,e){const i=t.length;for(let n=0;n<i;++n)o[0]=t[n],e[n]=o[0];return e}function s(t,e){const i=t.length;for(let n=0;n<i;++n)o[0]=t[n],o[1]=t[n]-o[0],e[n]=o[1];return e}i.d(e,{Zo:()=>r,jA:()=>s,jS:()=>n});const o=new Float32Array(2)}}]);
//# sourceMappingURL=5971.1f73db56.chunk.js.map