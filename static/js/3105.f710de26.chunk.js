"use strict";(self.webpackChunkmmsp_land_hl=self.webpackChunkmmsp_land_hl||[]).push([[3105],{23105:(e,r,t)=>{t.d(r,{RouteLayerInteraction:()=>_});var i=t(89379),a=t(6326),s=t(91967),o=t(54901),l=t(30726),n=t(68134),c=t(46053),p=(t(81806),t(76460),t(47249),t(87990)),h=t(19451),y=t(63733),d=t(57562),u=t(26170),g=t(95808),m=t(75747),b=t(80220);function w(e,r){e.networkFeature=r}function v(e){return e.networkFeature}function k(e){return"point"===(null===e||void 0===e?void 0:e.type)||"polyline"===(null===e||void 0===e?void 0:e.type)||"polygon"===(null===e||void 0===e?void 0:e.type)}let _=class extends s.A{constructor(e){super(e),this._createMode=null,this._graphicsLayer=new y.A({internal:!0,listMode:"hide",title:"RouteLayerInteraction layer"}),this._updatingHandles=new h.U,this.enabled=!0,this._handleSketchViewModelEvents=async e=>{switch(e.type){case"update":switch(e.state){case"active":case"complete":for(const r of e.graphics)v(r).geometry=k(r.geometry)?r.geometry.clone():null}break;case"undo":case"redo":break;case"delete":for(const r of e.graphics){const e=v(r);this._removeNetworkFeature(e)}break;case"create":if(e.graphic&&"complete"===e.state&&this._createMode){var r,t;const i=null===(r=e.graphic.geometry)||void 0===r?void 0:r.clone(),a=null===(t=e.graphic.symbol)||void 0===t?void 0:t.clone();if(!i)break;switch(this._createMode){case"stop":{if("point"!==i.type)break;const{stops:r}=this.layer;if(r.length>0&&r.every(e=>{let{geometry:r}=e;return!r})){r.at(0).geometry=i;break}if(r.length>1&&r.filter((e,r)=>0!==r).every(e=>{let{geometry:r}=e;return!r})){r.at(1).geometry=i;break}const t=new m.A({geometry:i});r.add(t),w(e.graphic,t);break}case"point-barrier":{if("point"!==i.type)break;const r=new d.A({geometry:i,symbol:a});this.layer.pointBarriers.add(r),w(e.graphic,r);break}case"polyline-barrier":{if("polyline"!==i.type)break;const r=new g.A({geometry:i,symbol:a});this.layer.polylineBarriers.add(r),w(e.graphic,r);break}case"polygon-barrier":{if("polygon"!==i.type)break;const r=new u.A({geometry:i,symbol:a});this.layer.polygonBarriers.add(r),w(e.graphic,r);break}}}}(await this.view.whenLayerView(this.layer)).emit(e.type,"create"===e.type?function(e){const r=v(e.graphic);return(0,i.A)((0,i.A)({},e),{},{networkFeature:r})}(e):function(e){const r=e.graphics.map(e=>v(e));return(0,i.A)((0,i.A)({},e),{},{networkFeatures:r})}(e))}}initialize(){this._sketchViewModel=new b.A({layer:this._graphicsLayer,view:this.view}),this.addHandles([(0,n.wB)(()=>this.enabled,e=>{e?this._activate():this._deactivate()},n.Vh),(0,n.wB)(()=>{const{stops:e,pointBarriers:r,polylineBarriers:t,polygonBarriers:i}=this.layer;return{stops:e,pointBarriers:r,polylineBarriers:t,polygonBarriers:i}},()=>{this.enabled&&this._loadClonedGraphics()}),this._sketchViewModel.on(["create","delete","redo","undo","update"],this._handleSketchViewModelEvents),(0,o.DQ)(this._updatingHandles)])}destroy(){this.view.map.remove(this._graphicsLayer),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,l.pR)(this._graphicsLayer),this._sketchViewModel=(0,l.pR)(this._sketchViewModel)}get selectedNetworkFeatures(){return this._sketchViewModel.updateGraphics.map(e=>v(e))}get updating(){return this._updatingHandles.updating}create(e){var r;switch(this._createMode=e,e){case"stop":(null===(r=this.layer.defaultSymbols.stops)||void 0===r?void 0:r.unlocated)&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.stops.unlocated.clone());break;case"point-barrier":this.layer.defaultSymbols.pointBarriers&&(this._sketchViewModel.pointSymbol=this.layer.defaultSymbols.pointBarriers.clone());break;case"polyline-barrier":this.layer.defaultSymbols.polylineBarriers&&(this._sketchViewModel.polylineSymbol=this.layer.defaultSymbols.polylineBarriers.clone());break;case"polygon-barrier":this.layer.defaultSymbols.polygonBarriers&&(this._sketchViewModel.polygonSymbol=this.layer.defaultSymbols.polygonBarriers.clone())}switch(e){case"stop":case"point-barrier":return this._sketchViewModel.create("point");case"polyline-barrier":return this._sketchViewModel.create("polyline");case"polygon-barrier":return this._sketchViewModel.create("polygon")}}remove(e){const r=this._graphicsLayer.graphics.find(r=>v(r)===e);r&&this._graphicsLayer.remove(r),this._removeNetworkFeature(e)}_activate(){this._loadClonedGraphics(),this.view.map.add(this._graphicsLayer)}_deactivate(){var e;this._sketchViewModel.cancel(),null!==(e=this.view.map)&&void 0!==e&&e.remove(this._graphicsLayer),this._graphicsLayer.removeAll()}_loadClonedGraphics(){const e=[this.layer.stops,this.layer.pointBarriers,this.layer.polylineBarriers,this.layer.polygonBarriers].flatMap(e=>e.toArray().map(e=>{const r=e.toGraphic();return r.networkFeature=e,r}));this._graphicsLayer.removeAll().addMany(e)}_removeNetworkFeature(e){switch(e.type){case"stop":this.layer.stops.remove(e);break;case"point-barrier":this.layer.pointBarriers.remove(e);break;case"polyline-barrier":this.layer.polylineBarriers.remove(e);break;case"polygon-barrier":this.layer.polygonBarriers.remove(e)}}};(0,a.Cg)([(0,c.MZ)()],_.prototype,"enabled",void 0),(0,a.Cg)([(0,c.MZ)({constructOnly:!0})],_.prototype,"layer",void 0),(0,a.Cg)([(0,c.MZ)({readOnly:!0})],_.prototype,"selectedNetworkFeatures",null),(0,a.Cg)([(0,c.MZ)()],_.prototype,"updating",null),(0,a.Cg)([(0,c.MZ)({constructOnly:!0})],_.prototype,"view",void 0),_=(0,a.Cg)([(0,p.$)("esri.views.2d.layers.support.RouteLayerInteraction")],_)}}]);
//# sourceMappingURL=3105.f710de26.chunk.js.map