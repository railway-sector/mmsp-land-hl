"use strict";(self.webpackChunkmmsp_land_hl=self.webpackChunkmmsp_land_hl||[]).push([[339,3106],{20339:(e,t,a)=>{a.d(t,{save:()=>R,saveAs:()=>I});var o=a(50076),r=a(77717),n=a(68134),s=a(90534),i=a(37888),c=a(13312),l=a(80963),u=a(45417),p=a(13096),d=a(31933),f=a(65308),m=a(70652),h=a(79942),w=a(72945),y=a(71334),v=a(70414),g=a(63919),_=a(79880),b=a(24907);const O=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(e=>e.toLowerCase());async function R(e,t,a){null!==a&&void 0!==a||(a={}),function(e,t){if(!t.portalItem)throw new o.A("".concat(e.name,":portal-item-not-set"),"Portal item to save to has not been set on the WebMap");P(e,t.portalItem)}(e,t),await(0,n.C_)(()=>!t.updatingFromView),await t.load(),await S(t),await(0,b.dL)(t),await M(e,t);const r=t.portalItem,{json:s,jsonContext:i}=await A(t,r,e.origin);return(0,b.ci)(i,{errorName:"".concat(e.name,":save")},a),await W(t,r),await async function(e,t,a,o,r){await a.update({data:o}),H(e,t,a,o,r)}(e,t,r,s,i),await Promise.all([t.updateItemThumbnail(),(0,_.r)(t.resourceReferences,i)]),r}async function A(e,t,a){const o=(0,h.m)(t,a,!0),r=e.write({},o);return await Promise.all(o.resources.pendingOperations),{json:r,jsonContext:o}}async function I(e,t,a,r){null!==r&&void 0!==r||(r={});const i=function(e,t){let a=m.default.from(t);return a.id&&(a=a.clone(),a.id=null),a.type||(a.type=e.itemType),a.portal||(a.portal=f.A.getDefault()),P(e,a),a}(e,a);await(0,n.C_)(()=>!t.updatingFromView),await t.load(),await S(t),await(0,b.dL)(t),await M(e,t);const{json:c,jsonContext:l}=await A(t,i,e.origin);(0,b.ci)(l,{errorName:"".concat(e.name,":save")},r),await async function(e,t){(0,w.OM)(t,T),(0,w.OM)(t,F),(0,w.OM)(t,w.mm.METADATA),(0,w.OM)(t,k),(0,w.OM)(t,U),(0,w.OM)(t,E),(0,w.OM)(t,x),(0,w.OM)(t,D),await W(e,t)}(t,i);const u=t.getThumbnailState();return await async function(e,t,a,r,n,i){const c=t.portalItem,l={item:c,authenticated:!(null===c||void 0===c||!c.id||!c.portal.user)},u=a.portal;await u.signIn();const{copyAllowed:p,itemReloaded:d}=await async function(e,t){var a;const{item:o,authenticated:r}=e;return null!==o&&void 0!==o&&o.id&&null!==(a=o.typeKeywords)&&void 0!==a&&a.includes("useOnly")?o.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(r||await o.reload(),{copyAllowed:"admin"===o.itemControl||"update"===o.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}(l,u);if(l.authenticated||(l.authenticated=d),!p)throw new o.A("".concat(e.name,":save-as-copy-not-allowed"),"Owner of this map does not allow others to save a copy");const f=await async function(e,t,a,o){const r=e.portal,{item:n}=t,{folder:i,copyAllResources:c}=o;let l=!1;if(c&&null!==n&&void 0!==n&&n.id&&(0,s.b8)(n.portal.url,r.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:e}=await n.fetchResources();l=!!e}if(l){const t=await n.copy({copyResources:"all",folder:i});e.id=t.id,e.portal=t.portal;const o=e.toJSON();await e.load(),e.read(o),await e.update({data:a})}else await r.user.addItem({item:e,folder:i,data:a});return l}(a,l,r,i);return t.portalItem=a,H(e,t,a,r,n),f}(e,t,i,c,l,r)&&(t.resourceReferences.portalItem=i),t.restoreThumbnailFromState(u),await Promise.all([t.updateItemThumbnail(),(0,_.r)(t.resourceReferences,l)]),i}function P(e,t){if(t.type!==e.itemType)throw new o.A("".concat(e.name,":portal-item-wrong-type"),'Portal item needs to have type "'.concat(e.itemType,'"'))}async function M(e,t){var a;if("linkchart"===e.name)return;if(null===(a=t.basemap)||void 0===a||!a.baseLayers.length)throw new o.A("".concat(e.name,":save"),"Map does not have a valid basemap with a base layer.");let r=null;if(await(0,n.C_)(()=>{const e=(0,g.n8)(t.initialViewProperties,t.basemap);return r=e.spatialReference,!e.updating}),!(0,l.aI)(r,t.initialViewProperties.spatialReference))throw new o.A("".concat(e.name,":save"),"The spatial reference of the basemap is not compatible with the one from the map.",{expected:t.initialViewProperties.spatialReference,actual:r})}function S(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then(()=>{})}async function W(e,t){t.extent=await async function(e,t){const o=t.clone().normalize();let r;if(o.length>1)for(const a of o)r?a.width>r.width&&(r=a):r=a;else r=o[0];return async function(e,t){const o=t.spatialReference;if(o.isWGS84)return t.clone();if(o.isWebMercator)return(0,u.ci)(t);const{getGeometryServiceURL:r}=await a.e(9483).then(a.bind(a,39483)),n=await r(e),s=new v.A({geometries:[t],outSpatialReference:c.A.WGS84});return(await(0,y.C)(n,s))[0]}(e,r)}(e.portalItem,e.initialViewProperties.viewpoint.targetGeometry),await async function(e,t){(0,w.LG)(t,L),await function(e){const t=B(e).map(e=>e.load()).toArray();return Promise.allSettled(t).then(()=>{})}(e),function(e,t){(0,w.Y)(t,T)||(0,w.Y)(t,x)||(0,w.Y)(t,D)||(0,w.Y)(t,E)||!K(e)?(0,w.OM)(t,C):(0,w.LG)(t,C)}(e,t),function(e,t){K(e)?(0,w.LG)(t,j):(0,w.OM)(t,j)}(e,t),function(e,t){!(0,w.Y)(t,k)&&function(e){return B(e).filter(e=>"group"!==e.type).every(t=>t.loaded&&function(e,t){return(0,d.W_)(t)&&t.capabilities.operations.supportsSync||function(e){return(0,d.Ov)(e)||"map-notes"===e.type||"route"===e.type}(t)&&!t.portalItem||function(e){return("tile"===e.type||"vector-tile"===e.type)&&(e.capabilities.operations.supportsExportTiles||function(e){return"tile"===e.type&&(0,p.tK)(e.url)&&O.some(t=>{var a;return null===(a=e.url)||void 0===a?void 0:a.toLowerCase().includes("/"+t+"/")})}(e)||(0,g.JT)(e))}(t)&&!function(e){return"vector-tile"===e.type&&Object.keys(e.sourceNameToSource).length>1}(t)&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}(e,t))}(e)?(0,w.LG)(t,G):(0,w.OM)(t,G)}(e,t),function(e,t){(0,g.Rc)(e.basemap)?(0,w.LG)(t,V):(0,w.OM)(t,V)}(e,t),function(e,t){var a;null!==(a=e.utilityNetworks)&&void 0!==a&&a.length?(0,w.LG)(t,N):(0,w.OM)(t,N)}(e,t),function(e,t){e.ipsInfo?(0,w.LG)(t,q):(0,w.OM)(t,q)}(e,t),function(e,t){(0,w.Sm)(t,w.mm.CHARTS,(0,b.I6)(e))}(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((e,t,a)=>a.indexOf(e)===t))}(e,t)}const L=w.mm.JSAPI,T="CollectorDisabled",C="Collector",j="Data Editing",k="OfflineDisabled",G="Offline",x="Workforce Project",D="Workforce Worker",E="Workforce Dispatcher",U="Offline Map Areas",F="FieldMapsDisabled",V=w.mm.DEVELOPER_BASEMAP,N="UtilityNetwork",q="IPS";function B(e){return e.allLayers.concat(e.allTables)}function K(e){return B(e).some(e=>e.loaded&&(0,d.W_)(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some(e=>e.editingEnabled)))}function H(e,t,a,o,n){r.L.prototype.read.call(t,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:a.itemUrl?(0,s.An)(a.itemUrl):void 0}),(0,i.v)(n),t.resourceInfo=o}},33106:(e,t,a)=>{a.d(t,{addOrUpdateResources:()=>i,bg:()=>f,cL:()=>d,fetchResources:()=>s,removeAllResources:()=>l,removeResource:()=>c});var o=a(3825),r=a(50076),n=a(90534);async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;await e.load(a);const o=(0,n.fj)(e.itemUrl,"resources"),{start:r=1,num:s=10,sortOrder:i="asc",sortField:c="resource"}=t,l={query:{start:r,num:s,sortOrder:i,sortField:c,token:e.apiKey},signal:null===a||void 0===a?void 0:a.signal},u=await e.portal.request(o,l);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map(t=>{let{created:a,size:o,resource:r}=t;return{created:new Date(a),size:o,resource:e.resourceFromPath(r)}})}}async function i(e,t,a,o){const s=new Map;for(const{resource:n,content:c,compress:l,access:p}of t){if(!n.hasPath())throw new r.A("portal-item-resource-".concat(a,":invalid-path"),"Resource does not have a valid path");const[e,t]=u(n.path),o="".concat(e,"/").concat(null!==l&&void 0!==l?l:"","/").concat(null!==p&&void 0!==p?p:"");s.has(o)||s.set(o,{prefix:e,compress:l,access:p,files:[]}),s.get(o).files.push({fileName:t,content:c})}await e.load(o);const i=(0,n.fj)(e.userItemUrl,"add"===a?"addResources":"updateResources");for(const{prefix:r,compress:n,access:c,files:l}of s.values()){const t=25;for(let a=0;a<l.length;a+=t){const s=l.slice(a,a+t),u=new FormData;r&&"."!==r&&u.append("resourcesPrefix",r),n&&u.append("compress","true"),c&&u.append("access",c);let p=0;for(const{fileName:e,content:t}of s)u.append("file"+ ++p,t,e);u.append("f","json"),await e.portal.request(i,{method:"post",body:u,signal:null===o||void 0===o?void 0:o.signal})}}}async function c(e,t,a){if(!t.hasPath())throw new r.A("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(a);const o=(0,n.fj)(e.userItemUrl,"removeResources");await e.portal.request(o,{method:"post",query:{resource:t.path},signal:null===a||void 0===a?void 0:a.signal}),t.portalItem=null}async function l(e,t){await e.load(t);const a=(0,n.fj)(e.userItemUrl,"removeResources");return e.portal.request(a,{method:"post",query:{deleteAll:!0},signal:null===t||void 0===t?void 0:t.signal})}function u(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function p(e){const[t,a]=function(e){const t=(0,n.Zo)(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),".".concat(t)]}(e),[o,r]=u(t);return[o,r,a]}async function d(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await(0,o.A)(e.url,{responseType:"blob"})).data}function f(e,t){if(!e.hasPath())return null;const[a,,o]=p(e.path);return e.portalItem.resourceFromPath((0,n.fj)(a,t+o))}},37888:(e,t,a)=>{a.d(t,{v:()=>r});var o=a(24387);function r(e){(null===e||void 0===e?void 0:e.writtenProperties)&&e.writtenProperties.forEach(e=>{let{target:t,propName:a,newOrigin:r}=e;(0,o.H)(t)&&r&&t.originOf(a)!==r&&t.updateOrigin(a,r)})}},79880:(e,t,a)=>{a.d(t,{S:()=>c,r:()=>i});var o=a(50076),r=a(50346),n=a(49723),s=a(33106);async function i(e,t,a){const o=await l(e,t,a);await u(o,t,a)}async function c(e,t,a,o,r){const n=await l(a,o,r);await e.update({data:t}),await u(n,o,r)}async function l(e,t,i){if(null===t||void 0===t||!t.resources)return;const c=t.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=t.portalItem;const l=new Set(t.resources.toKeep.map(e=>e.resource.path)),u=new Set,p=[];l.forEach(t=>{c.delete(t),e.paths.push(t)});const d=[],f=[],m=[];for(const a of t.resources.toUpdate)if(c.delete(a.resource.path),l.has(a.resource.path)||u.has(a.resource.path)){const{resource:t,content:o,finish:r}=a,i=(0,s.bg)(t,(0,n.lk)());e.paths.push(i.path),d.push({resource:i,content:await(0,s.cL)(o),compress:a.compress}),r&&m.push(()=>r(i))}else{e.paths.push(a.resource.path),f.push({resource:a.resource,content:await(0,s.cL)(a.content),compress:a.compress});const t=a.finish;t&&m.push(()=>t(a.resource)),u.add(a.resource.path)}for(const a of t.resources.toAdd)if(e.paths.push(a.resource.path),c.has(a.resource.path))c.delete(a.resource.path);else{d.push({resource:a.resource,content:await(0,s.cL)(a.content),compress:a.compress});const e=a.finish;e&&m.push(()=>e(a.resource))}if(d.length||f.length){const{addOrUpdateResources:e}=await Promise.resolve().then(a.bind(a,33106));await e(t.portalItem,d,"add",i),await e(t.portalItem,f,"update",i)}if(m.forEach(e=>e()),0===p.length)return c;const h=await(0,r.Ol)(p);if((0,r.Te)(i),h.length>0)throw new o.A("save:resources","Failed to save one or more resources",{errors:h});return c}async function u(e,t,a){if(!e||!t.portalItem)return;const o=[];for(const r of e){const e=t.portalItem.resourceFromPath(r);o.push(e.portalItem.removeResource(e,a))}await(0,r.Lx)(o)}}}]);
//# sourceMappingURL=339.dbbc4fe4.chunk.js.map