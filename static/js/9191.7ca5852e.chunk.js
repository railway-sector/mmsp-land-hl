"use strict";(self.webpackChunkmmsp_land_hl=self.webpackChunkmmsp_land_hl||[]).push([[4429,7995,9191],{19208:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(6326),r=s(42553),n=s(46053),o=(s(81806),s(76460),s(47249),s(87990));let l=class extends r.o{constructor(e){super(e),this.type="wkb",this.primaryFieldName=null}};(0,i.Cg)([(0,n.MZ)({type:["wkb"],readOnly:!0,json:{write:!0}})],l.prototype,"type",void 0),(0,i.Cg)([(0,n.MZ)({json:{write:!0}})],l.prototype,"orientation",void 0),(0,i.Cg)([(0,n.MZ)({json:{write:!0}})],l.prototype,"primaryFieldName",void 0),l=(0,i.Cg)([(0,o.$)("esri.layers.support.ParquetEncodingWkb")],l)},20176:(e,t,s)=>{s.d(t,{N3:()=>u,Om:()=>l});var i=s(89379),r=s(97255),n=s(90321),o=s(1484);class l{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.geometry=e,this.attributes=t,this.centroid=s,this.objectId=i,this.displayId=r}static fromJSON(e){const t=e.geometry?o.A.fromJSON(e.geometry):null,s=e.centroid?o.A.fromJSON(e.centroid):null,i=e.objectId;return new l(t,e.attributes,s,i)}weakClone(){const e=new l(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){var e,t;const s=null===(e=this.geometry)||void 0===e?void 0:e.clone(),r=new l(s,(0,i.A)({},this.attributes),null===(t=this.centroid)||void 0===t?void 0:t.clone(),this.objectId);return r.displayId=this.displayId,r}ensureCentroid(e){var t;return null!==(t=this.centroid)&&void 0!==t||(this.centroid=(0,n.Q)(new o.A,this.geometry,e.hasZ,e.hasM)),this.centroid}get usedMemory(){var e,t;return 128+(0,r.lM)(this.attributes)+(null!==(e=null===(t=this.geometry)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0)}}function u(e){var t;return!(null===(t=e.geometry)||void 0===t||null===(t=t.coords)||void 0===t||!t.length)}},30178:(e,t,s)=>{s.d(t,{hG:()=>f,nc:()=>m,sA:()=>h});var i=s(89379),r=(s(19276),s(50076)),n=s(45802),o=s(13312),l=s(44135),u=s(36035),a=s(98141),d=s(19208),c=s(67103);const p=new n.J({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});function h(e){return p.toJSON(e)}function f(e){return p.fromJSON(e)}async function m(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.geometryType&&e.spatialReference&&e.encoding&&e.fields)return e;if(e.urls.length<1)throw new r.A("parquet:bad-input","At least one url must be specified",e);const s=await(0,c.DV)(e.urls.getItemAt(0),{getCustomParameters:()=>t.customParameters}),n=(0,c.hD)(s),p=(0,i.A)((0,i.A)({},e),{},{file:s});null==p.fields&&(p.fields=s.fields().map(e=>l.A.fromJSON({name:e.name,type:e.type}))),null==p.encoding&&(p.encoding=function(e,t){if(null!=e){var s;const t=e.primary_column,i=e.columns[t];return new d.A({primaryFieldName:t,orientation:null!==(s=i.orientation)&&void 0!==s?s:null})}const i=(0,u.i_)(t.map(e=>e.name));return i.latitudeFieldName&&i.latitudeFieldName?new a.A({latitudeFieldName:i.latitudeFieldName,longitudeFieldName:i.longitudeFieldName}):null}(n,p.fields));const h=(0,c.Hj)(s);if(h)switch(h.mode){case"z":p.displayOptimization={mode:"z"};break;case"xz":{const e=h.multiscale;if(!e)throw new r.A("bad-format","XZ display optimization requires multiscale geometries");p.displayOptimization={mode:"xz",multiscale:e};break}}if(!p.encoding)return p;switch(p.encoding.type){case"location":null==p.spatialReference&&(p.spatialReference=o.A.WGS84),null==p.geometryType&&(p.geometryType="point");break;case"wkb":{if(!n)return p;const e=n.primary_column,t=n.columns[e];if(p.geometryType||(p.geometryType=function(e){const{geometry_types:t}=e,s=new Set;for(const i of t){const e=y(i);e&&s.add(e)}if(s.size>1)throw new r.A("unsupported","Parquet mixed geometry types are not support",{geometryTypes:s});return 1===s.size?s.values().next().value:void 0}(t)),p.spatialReference||(p.spatialReference=function(e){var t;const s=null===(t=e.crs)||void 0===t||null===(t=t.id)||void 0===t?void 0:t.code;return s&&"number"==typeof s?new o.A({wkid:s}):void 0}(t)),p.fields)for(const s of Object.keys(n.columns))p.fields=p.fields.filter(e=>e.name!==s)}}return p}function y(e){switch(e){case"Point":return"point";case"Polygon":case"MultiPolygon":return"polygon";case"LineString":return"polyline";case"MultiPoint":return"multipoint";default:return null}}},34429:(e,t,s)=>{s.d(t,{QueueProcessor:()=>d});var i=s(30726),r=s(50346),n=s(59649),o=s(67993),l=s(52394),u=s(75540);class a{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class d{constructor(e){this._schedule=null,this._deferreds=new o.A,this._controllers=new o.A,this._processingItems=new o.A,this._pausedSignal=(0,u.v)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new n.A(e.peeker),this.process=e.process}destroy(){this.clear(),this._schedule=(0,i.xt)(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(t=>e.push(t)),this._controllers.clear(),e.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((t,s)=>e(s))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const s=this.get(e);if(s)return s;const i=new AbortController;let n=null;t&&(n=(0,r.u7)(t,()=>i.abort()));const o=()=>{l.remove(),null!=n&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=(0,r.NY)(i.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),u.reject((0,r.NK)())}),u=(0,r.Tw)();return this._deferreds.set(e,u),this._controllers.set(e,i),u.promise.then(o,o),this._queue.push(e),this._scheduleNext(),u.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){var e;const t=this._queue.popLast();return t&&(null!==(e=this._deferreds.get(t))&&void 0!==e&&e.reject((0,r.NK)()),this._removeItem(t)),t}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=(0,l._)(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const s=new AbortController,i=new a(e,s);this._processingItems.set(e,i);try{t=this.process(e,s.signal)}catch(n){this._processError(i,n)}(0,r.$X)(t)?(i.promise=t,t.then(e=>this._processResult(i,e),e=>this._processError(i,e))):this._processResult(i,t)}}},36035:(e,t,s)=>{s.d(t,{i_:()=>r});var i=s(53430);function r(e,t,s){var r,l;t=null===(r=(0,i.rS)(t))||void 0===r?void 0:r.toLowerCase(),s=null===(l=(0,i.rS)(s))||void 0===l?void 0:l.toLowerCase();const u=e.map(e=>e.toLowerCase()),a=t?e[u.indexOf(t)]:null,d=s?e[u.indexOf(s)]:null;return{longitudeFieldName:a||e[u.indexOf(o.find(e=>u.includes(e)))],latitudeFieldName:d||e[u.indexOf(n.find(e=>u.includes(e)))]}}const n=["lat","lat83","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],o=["lon","lng","lng83","long","long83","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"]},75146:(e,t,s)=>{s.d(t,{A:()=>i});class i{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new i;return e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},77408:(e,t,s)=>{s.d(t,{h:()=>o,i:()=>n});var i=s(13312),r=s(1900);class n{static minimal(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new n({geometryType:e,fieldsIndex:new r.A(s).toJSON(),featureIdInfo:{type:"object-id",fieldName:t},subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null})}static createFeature(e){return new n(e)}constructor(e){var t,s,n,o,l;let u;this._options=e,this._fieldsIndex=r.A.fromJSON(e.fieldsIndex),e.spatialReference&&(e.spatialReference instanceof i.A?this._spatialReference=e.spatialReference:this._spatialReference=i.A.fromJSON(e.spatialReference)),e.outSpatialReference&&(e.outSpatialReference instanceof i.A?this._outSpatialReference=e.outSpatialReference:this._outSpatialReference=i.A.fromJSON(e.outSpatialReference)),"object-id"===e.featureIdInfo.type&&(u=e.featureIdInfo.fieldName),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:u,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:null!==(t=this._options.typeIdField)&&void 0!==t?t:void 0,types:null!==(s=this._options.types)&&void 0!==s?s:void 0,subtypeField:this._options.subtypeField,subtypes:null!==(n=this._options.subtypes)&&void 0!==n?n:void 0,datesInUnknownTimezone:null!==(o=this._options.timeReferenceUnknownClient)&&void 0!==o?o:void 0,dateFieldsTimeZone:null!==(l=this._options.dateFieldsTimeZone)&&void 0!==l?l:void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get featureIdInfo(){return this._options.featureIdInfo}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get outSpatialReference(){return this._outSpatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}weakCloneWithAdditionalFields(e){return new n({fieldsIndex:{fields:[...this._fieldsIndex.fields,...e],timeZoneByFieldName:null},geometryType:this.geometryType,globalIdField:this.globalIdField,featureIdInfo:this.featureIdInfo,spatialReference:this.spatialReference,outSpatialReference:this.outSpatialReference,subtypeField:this.subtypeField,subtypes:this._options.subtypes,timeInfo:this.timeInfo,timeReferenceUnknownClient:this.timeReferenceUnknownClient,dateFieldsTimeZone:this._options.dateFieldsTimeZone,typeIdField:this._options.typeIdField,types:this._options.types})}}class o extends n{static createGraphics(e){return new o({fieldsIndex:(new r.A).toJSON(),featureIdInfo:{type:"object-id",fieldName:"uid"},geometryType:null,spatialReference:e,outSpatialReference:e,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null})}}},90321:(e,t,s)=>{function i(e,t){return e?t?4:3:t?3:2}function r(e,t,s,r){if(null===t||void 0===t||!t.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const l=e.coords,u=[],a=s?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:d,coords:c}=t,p=i(s,r);let h=0;for(const i of d){const e=n(a,c,h,i,s,r);e&&u.push(e),h+=i*p}if(u.sort((e,t)=>{let i=e[2]-t[2];return 0===i&&s&&(i=e[4]-t[4]),i}),u.length){let e=6*u[0][2];l[0]=u[0][0]/e,l[1]=u[0][1]/e,s&&(e=6*u[0][4],l[2]=0!==e?u[0][3]/e:0),(l[0]<a[0]||l[0]>a[1]||l[1]<a[2]||l[1]>a[3]||s&&(l[2]<a[4]||l[2]>a[5]))&&(l.length=0)}if(!l.length){const e=t.lengths[0]?o(c,0,d[0],s,r):null;if(!e)return null;l[0]=e[0],l[1]=e[1],s&&e.length>2&&(l[2]=e[2])}return e}function n(e,t,s,r,n,o){const l=i(n,o);let u=s,a=s+l,d=0,c=0,p=0,h=0,f=0;for(let i=0,y=r-1;i<y;i++,u+=l,a+=l){const s=t[u],i=t[u+1],r=t[u+2],o=t[a],l=t[a+1],m=t[a+2];let y=s*l-o*i;h+=y,d+=(s+o)*y,c+=(i+l)*y,n&&(y=s*m-o*r,p+=(r+m)*y,f+=y),s<e[0]&&(e[0]=s),s>e[1]&&(e[1]=s),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),n&&(r<e[4]&&(e[4]=r),r>e[5]&&(e[5]=r))}if(h>0&&(h*=-1),f>0&&(f*=-1),!h)return null;const m=[d,c,.5*h];return n&&(m[3]=p,m[4]=.5*f),m}function o(e,t,s,r,n){const o=i(r,n);let c=t,p=t+o,h=0,f=0,m=0,y=0;for(let i=0,g=s-1;i<g;i++,c+=o,p+=o){const t=e[c],s=e[c+1],i=e[c+2],n=e[p],o=e[p+1],g=e[p+2],_=r?u(t,s,i,n,o,g):l(t,s,n,o);if(_)if(h+=_,r){const e=d(t,s,i,n,o,g);f+=_*e[0],m+=_*e[1],y+=_*e[2]}else{const e=a(t,s,n,o);f+=_*e[0],m+=_*e[1]}}return h>0?r?[f/h,m/h,y/h]:[f/h,m/h]:s>0?r?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function l(e,t,s,i){const r=s-e,n=i-t;return Math.sqrt(r*r+n*n)}function u(e,t,s,i,r,n){const o=i-e,l=r-t,u=n-s;return Math.sqrt(o*o+l*l+u*u)}function a(e,t,s,i){return[e+.5*(s-e),t+.5*(i-t)]}function d(e,t,s,i,r,n){return[e+.5*(i-e),t+.5*(r-t),s+.5*(n-s)]}s.d(t,{Q:()=>r})},95341:(e,t,s)=>{s.r(t),s.d(t,{default:()=>E});var i=s(89379),r=s(19495),n=s(56218),o=s(10600),l=s(6326),u=s(19276),a=s(4212),d=s(50076),c=s(81806),p=s(76460),h=s(34429),f=s(13312),m=s(42294),y=s(12034),g=s(9345),_=s(40296),I=s(44135),v=s(1900),w=s(53430),F=s(98141),b=s(19208);function R(e){switch(e.type){case"wkb":return b.A.fromJSON(e);case"location":return F.A.fromJSON(e)}}var x=s(30178),N=s(67103),S=s(77859),A=s(61137),T=s(21666),q=s(77408),C=s(27428);const O=new S.Z,P=8e3,G="__OBJECTID";class E{constructor(){this._fileInfos=new Map,this._queue=new h.QueueProcessor({concurrency:4,process:(e,t)=>this._executeQuery(e,t)})}async load(e){var t,s,r,n,o,a,c,h,y,g,w;const F=e.spatialReference?f.A.fromJSON(e.spatialReference):void 0;if(F&&!F.isWGS84&&!F.isWebMercator)throw new d.A("parquet:unsupported-projection","Only WGS84 and Web Mercator are supported");const b=await(0,x.nc)({urls:new u.A(e.urls),fields:null===(t=e.fields)||void 0===t?void 0:t.map(e=>I.A.fromJSON(e)),encoding:e.encoding?R(e.encoding):e.encoding,geometryType:e.geometryType?(0,x.hG)(e.geometryType):null,spatialReference:F},{customParameters:e.customParameters});let S;if(b.geometryType&&b.encoding){if(!b.spatialReference)throw new d.A("parquet:unsupported","SpatialReference must be defined");if(!b.spatialReference.isGeographic&&!b.spatialReference.isWebMercator)throw new d.A("parquet:unsupported-projection","Only WGS84 and Web Mercator are supported");b.spatialReference.isGeographic&&!b.spatialReference.isWGS84&&(p.A.getLogger("parquet:unsupported-projection").warn("Found a geographic projection that is not WGS84. Handling as WGS84.",{spatialReference:b.spatialReference}),b.spatialReference=f.A.WGS84),S={geometryType:(0,x.sA)(b.geometryType),spatialReference:b.spatialReference.toJSON(),encoding:b.encoding.toJSON(),displayOptimization:b.displayOptimization}}this.setCustomParameters(e.customParameters),this._geometryInfo=S;const A=e.urls;for(const i of A){const e=await(0,N.DV)(i,{geometryInfo:S,outSpatialReference:null,getCustomParameters:()=>this._customParameters});this._fileInfos.set(i,{index:this._fileInfos.size,file:e})}this._capabilities=Q(await this.getFileStatistics());const T=null===(s=this._fileInfos.values().next().value)||void 0===s?void 0:s.file;if(!T)return{layerDefinition:{},capabilities:Q(null)};const{fields:C}=b;if(null==C)throw new d.A("parquet-layer:missing-metadata","Unable to create parquet source: cannot infer fields",C);C.push(new I.A({name:G,type:"oid",alias:G}));const O={fields:C.map(e=>(0,i.A)((0,i.A)({},e.toJSON()),{},{column:T.columnForFieldName(e.name)})),timeZoneByFieldName:null},P=v.A.fromJSON(O);this._fieldsIndex=P;const E=(0,x.sA)(null!==(r=b.geometryType)&&void 0!==r?r:"point");if(this._metadata=q.i.createFeature({fieldsIndex:O,geometryType:E,featureIdInfo:{type:"object-id",fieldName:"rowId"},subtypes:null,subtypeField:null,types:null,typeIdField:null,globalIdField:null,spatialReference:b.spatialReference,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null}),this._queryEngineParams={fieldsIndex:this._metadata.fieldsIndex,geometryType:null!==(n=null===(o=S)||void 0===o?void 0:o.geometryType)&&void 0!==n?n:"esriGeometryPoint",featureIdInfo:{type:"object-id",fieldName:"rowId"},hasM:!1,hasZ:!1,spatialReference:null!==(a=null===(c=S)||void 0===c?void 0:c.spatialReference)&&void 0!==a?a:{wkid:4326},aggregateAdapter:null,timeInfo:null,definitionExpression:null},b.spatialReference&&(this._fullExtent=function(e,t){const s=(0,m.hZ)((0,m.vt)(),m.qv);for(const i of e){const e=(0,N.hD)(i.file);if(!e)return null;const t=e.columns[e.primary_column];if(!t.bbox)return null;const r=j(t.bbox);(0,m.RF)(s,r)}return{xmin:s[0],ymin:s[1],xmax:s[3],ymax:s[4],spatialReference:t}}(this._fileInfos.values(),b.spatialReference.toJSON())),null==this._fullExtent&&"location"===(null===(h=b.encoding)||void 0===h?void 0:h.type)){var k,M,z;const{latitudeFieldName:e,longitudeFieldName:t}=b.encoding,s=null===(k=this._fieldsIndex.get(e))||void 0===k?void 0:k.column,i=null===(M=this._fieldsIndex.get(t))||void 0===M?void 0:M.column,r=(0,m.hZ)((0,m.vt)(),m.qv);for(const n of this._fileInfos.values())for(const e of n.file.rowGroups()){const t={stack:[],error:void 0,hasError:!1};try{const n=(0,l.mS)(t,e.columnDescriptorForAttribute(s),!1),o=(0,l.mS)(t,e.columnDescriptorForAttribute(i),!1),u=[o.minValue(),n.minValue(),o.maxValue(),n.maxValue()];(0,m.DC)(r,u),e.free()}catch(D){t.error=D,t.hasError=!0}finally{(0,l.hk)(t)}}this._fullExtent={xmin:r[0],ymin:r[1],xmax:r[3],ymax:r[4],spatialReference:null===(z=b.spatialReference)||void 0===z?void 0:z.toJSON()}}return{capabilities:this._capabilities,layerDefinition:{fields:null===(y=b.fields)||void 0===y?void 0:y.map(e=>e.toJSON()),drawingInfo:(0,_.F0)(E),extent:null!==(g=this._fullExtent)&&void 0!==g?g:void 0,geometryType:E,encoding:null===(w=b.encoding)||void 0===w?void 0:w.toJSON(),displayOptimization:b.displayOptimization}}}destroy(){for(const e of this._fileInfos.values())e.file.free();this._fileInfos.clear(),this._queue.destroy()}setCustomParameters(e){this._customParameters=e}getFileStatistics(){if(!this._fileInfos.size)return null;const e=Array.from(this._fileInfos.values()).reduce((e,t)=>e+t.file.byteLength(),0);return{featureCount:this._getFeatureCount(),byteLength:e}}async updateFiles(e){const t=new Set(e);for(const[s,i]of this._fileInfos.entries())t.has(s)?t.delete(s):(i.file.free(),this._fileInfos.delete(s));for(const s of t){const e=await(0,N.DV)(s,{geometryInfo:this._geometryInfo,outSpatialReference:null,getCustomParameters:()=>this._customParameters});this._fileInfos.set(s,{index:this._fileInfos.size,file:e})}}async queryFeatures(e,t){var s;return this._validateQuery(e),function(e){var t,s;return!!(null!==(t=e.objectIds)&&void 0!==t&&t.length||e.outStatistics||null!==(s=e.orderByFields)&&void 0!==s&&s.length||e.returnDistinctValues)}(e)||(e.resultRecordCount=e.resultRecordCount?Math.min(e.resultRecordCount,8e3):8e3,e.resultOffset=null!==(s=e.resultOffset)&&void 0!==s?s:0),(e.outStatistics||e.returnDistinctValues)&&delete e.returnGeometry,(await this._enqueueQuery(e,t)).createQueryResponse()}async queryFeatureCount(e,t){return this._validateQuery(e),k(e)?(delete e.outFields,delete e.returnGeometry,(await this._enqueueQuery(e,t)).createQueryResponseForCount()):this._getFeatureCount()}async queryObjectIds(e,t){var s;return this._validateQuery(e),k(e)?(e.resultRecordCount=e.resultRecordCount?Math.min(e.resultRecordCount,8e3):8e3,e.resultOffset=null!==(s=e.resultOffset)&&void 0!==s?s:0,delete e.returnGeometry,delete e.outFields,(await this._enqueueQuery(e,t)).items.map(e=>e.getObjectId())):Array.from({length:this._getFeatureCount()},(e,t)=>t)}async queryExtent(e,t){if(this._validateQuery(e),this._fullExtent&&!k(e))return{count:this._getFeatureCount(),extent:this._fullExtent};const s=(0,a.zI)(this._metadata.spatialReference);e.returnGeometry=!0,delete e.outFields;const i=(0,m.hZ)((0,m.vt)(),m.qv),r=(0,m.vt)(),n=await this._enqueueQuery(e,t);let o=0;for(const l of n.items)l.getBounds(r)&&((0,m.RF)(i,r),o+=1);return{count:o,extent:(0,y.Wc)(i,s,e.outSR?(0,a.zI)(e.outSR):s,s,!1)}}_getFeatureCount(){return Array.from(this._fileInfos.values()).reduce((e,t)=>e+t.file.numRows(),0)}_validateQuery(e){var t;if(!this._capabilities.query.supportsStatistics&&e.outStatistics)throw new d.A("parquet:unsupported","Statistics queries are not supported",{query:e});if(!this._capabilities.query.supportsOrderBy&&null!==(t=e.orderByFields)&&void 0!==t&&t.length)throw new d.A("parquet:unsupported","Queries using orderBy are not supported",{query:e});if(!this._capabilities.query.supportsDistinct&&e.returnDistinctValues)throw new d.A("parquet:unsupported","Queries using returnDistinctValues are not supported",{query:e})}_fetchChunks(e,t){var s=this;return(0,o.A)(function*(){for(const i of s._fileInfos.values()){const r=i.file.numRows(),o=Math.ceil(r/P);for(let l=0;l<o;l++){const r=l*P,o=yield(0,n.A)(i.file.readChunk(r,P,e.fields,e.returnGeometry,t));for(const e of o){const t=new C.s(s._metadata,s._fieldsIndex,e,0,i.index),r=M([new A.j(t,null,0,!1)],s._queryEngineParams);yield r}}}})()}_enqueueQuery(e,t){return this._queue.push(e,t)}async _executeQuery(e,t){var s,i,n;const o=await this._getReadParams(e);if(null!==(s=e.objectIds)&&void 0!==s&&s.length)for(const r of this._fileInfos.values()){const s=[],i=M((await r.file.readChunksByRowId(new Uint32Array(e.objectIds),o.fields,o.returnGeometry,t)).map((e,t)=>new C.s(this._metadata,this._fieldsIndex,e,t,r.index)).map((e,t)=>new A.j(e,null,t,!1)),this._queryEngineParams),n=await i.executeQueryForOpaqueFeatures(e,t);for(const e of n)s.push(e);return new g.G(s,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:O})}let l=null!==(i=e.resultRecordCount)&&void 0!==i?i:this._getFeatureCount(),u=null!==(n=e.resultOffset)&&void 0!==n?n:0;delete e.resultRecordCount,delete e.resultOffset;const a=[];var d,c=!1,p=!1;try{for(var h,f=(0,r.A)(this._fetchChunks(o,t));c=!(h=await f.next()).done;c=!1){const s=h.value;{const i=await s.executeQueryForOpaqueFeatures(e,t);if(i.length>u){const t=i.slice(u,Math.min(u+l,i.length));for(const e of t)a.push(e);if(u=0,l-=t.length,0===l)return new g.G(a,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:O})}else u-=i.length}}}catch(m){p=!0,d=m}finally{try{c&&null!=f.return&&await f.return()}finally{if(p)throw d}}return new g.G(a,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:O})}async _getReadParams(e){const t=new Set;if(e.where&&await(0,w.hz)(t,this._fieldsIndex,e.where),e.outStatistics)for(const s of e.outStatistics)null!=s.onStatisticField&&t.add(s.onStatisticField);if(e.outFields)for(const s of e.outFields)t.add(s);return{fields:this._getAttributeIds(Array.from(t)),returnGeometry:!!e.returnGeometry||!!e.geometry}}_getAttributeIds(e){if(null==e)return new Uint32Array;if(e.includes("*"))return new Uint32Array(this._fieldsIndex.fields.map(e=>e.column).filter(e=>null!=e));const t=[];for(const s of e){const e=this._fieldsIndex.get(s);if(null==e)throw new d.A("unknown-field","Field ".concat(s," does not exist"));null==e.column||t.push(e.column)}return new Uint32Array(t)}}function k(e){return Object.keys(e).some(e=>function(e){switch(e){case"resultOffset":case"resultRecordCount":case"aggregateIds":case"distance":case"gdbVersion":case"geometry":case"having":case"timeExtent":case"where":case"objectIds":case"historicMoment":return!0;default:return!1}}(e))}function M(e,t){const s=new T.I;for(const i of e)s.insert(i);return new y.do((0,i.A)((0,i.A)({},t),{},{featureStore:s}))}function j(e){switch(e.length){case 4:return(0,m.Jt)((0,m.vt)(),e);case 6:return e;default:throw new d.A("parquet:protocol-violation","Invalid Geoparquet file. BoundingBox size must be 4 or 6.",{bbox:e})}}function Q(e){const t=null===e||void 0===e?void 0:e.featureCount;let s=!1;return null!=t&&t<(0,c.A)("parquetlayer-full-query-feature-count")&&(s=!0),{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!1,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:8e3,maxRecordCountFactor:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!0,supportsCentroidOnDegeneratedQuantizedGeometry:!1,supportsCurrentUser:!1,supportsDegeneratedQuantizedGeometry:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:s,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:s,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsPercentileStatistics:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsReturnMesh:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:s,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,supportsTrueCurve:!1,tileMaxRecordCount:void 0},queryAttributeBins:{supportsDate:!1,supportsFixedInterval:!1,supportsAutoInterval:!1,supportsFixedBoundaries:!1,supportsStackBy:!1,supportsSplitBy:!1,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},98141:(e,t,s)=>{s.d(t,{A:()=>l});var i=s(6326),r=s(42553),n=s(46053),o=(s(81806),s(76460),s(47249),s(87990));let l=class extends r.o{constructor(e){super(e),this.type="location",this.latitudeFieldName=null,this.longitudeFieldName=null}};(0,i.Cg)([(0,n.MZ)({type:["location"],readOnly:!0,json:{write:!0}})],l.prototype,"type",void 0),(0,i.Cg)([(0,n.MZ)({json:{write:!0}})],l.prototype,"latitudeFieldName",void 0),(0,i.Cg)([(0,n.MZ)({json:{write:!0}})],l.prototype,"longitudeFieldName",void 0),l=(0,i.Cg)([(0,o.$)("esri.layers.support.ParquetEncodingLocation")],l)}}]);
//# sourceMappingURL=9191.7ca5852e.chunk.js.map