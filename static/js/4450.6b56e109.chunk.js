"use strict";(self.webpackChunkmmsp_land_hl=self.webpackChunkmmsp_land_hl||[]).push([[4450],{1898:(e,t,i)=>{i.d(t,{i:()=>a});var r=i(1723);function a(e){var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:r.Tv}},24450:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var r=i(6326),a=i(18690),s=i(19276),n=i(73763),o=i(54901),h=i(68134),l=i(46053),c=(i(81806),i(76460),i(87990)),d=i(58380),p=i(75258),u=i(57562),_=i(26170),g=i(95808),w=i(65146),y=i(75747),v=i(56286),m=i(31394),f=i(43321),k=i(91196),M=i(1898);const A=["route-info","direction-line","direction-point","polygon-barrier","polyline-barrier","point-barrier","stop"],C={graphic:null,property:null,oldValue:null,newValue:null};function F(e){return e instanceof d.A||e instanceof p.A||e instanceof u.A||e instanceof _.A||e instanceof g.A||e instanceof w.A||e instanceof y.A}let V=class extends((0,v.e)(k.A)){constructor(){super(...arguments),this._graphics=new s.A,this._networkFeatureMap=new Map,this._networkGraphicMap=new Map,this._interaction=null,this._loadInteractionPromise=null,this.interactive=!1}get _routeItems(){return new n.A({getCollections:()=>null==this.layer||this.destroyed?[]:[null!=this.layer.routeInfo?new s.A([this.layer.routeInfo]):null,this.layer.directionLines,this.layer.directionPoints,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.pointBarriers,this.layer.stops]})}initialize(){this.addHandles((0,h.wB)(()=>{const{interactive:e,suspended:t}=this;return{interactive:e,suspended:t}},e=>{let{interactive:t,suspended:i}=e;const r=t&&!i;r&&this._getInteractionLoadPromise().then(e=>{e.enabled=this.interactive&&!this.suspended}),this._interaction&&(this._interaction.enabled=r)},h.pc)),this._updatingHandles.addOnCollectionChange(()=>this._routeItems,e=>this._routeItemsChanged(e),h.Vh)}destroy(){var e;this._networkFeatureMap.clear(),this._networkGraphicMap.clear(),this._graphics.removeAll(),null===(e=this._get("_routeItems"))||void 0===e||e.destroy()}attach(){this._createGraphicsView()}detach(){var e;this._destroyGraphicsView(),(null===(e=this._interaction)||void 0===e?void 0:e.enabled)&&(this._interaction.enabled=!1)}get selectedNetworkFeatures(){var e,t;return null!==(e=null===(t=this._interaction)||void 0===t?void 0:t.selectedNetworkFeatures)&&void 0!==e?e:null}async create(e){if(this.interactive)return(await this._getInteractionLoadPromise()).create(e)}async fetchPopupFeaturesAtLocation(e,t){return this._graphicsView.hitTest(e).filter(e=>{let{popupTemplate:t}=e;return!!t})}highlight(e,t){let i;i=F(e)?[this._getNetworkFeatureUid(e)]:function(e){return Array.isArray(e)&&e.length>0&&F(e[0])}(e)?e.map(e=>this._getNetworkFeatureUid(e)):function(e){return s.A.isCollection(e)&&e.length&&F(e.at(0))}(e)?e.map(e=>this._getNetworkFeatureUid(e)).toArray():[e.uid];const r=i.filter(a.Ru);if(!r.length)return(0,o.hA)();const n=(0,M.i)(t);return this._addHighlights(r,n),(0,o.hA)(()=>this._removeHighlights(r,n))}async hitTest(e,t){if(this.suspended)return null;const i=this._graphicsView.hitTest(e).filter(a.Ru).map(e=>this._networkGraphicMap.get(e));if(!i.length)return null;const{layer:r}=this;return i.reverse().map(t=>({type:"route",layer:r,mapPoint:e,networkFeature:t}))}isUpdating(){return this._graphicsView.updating}moveEnd(){}remove(e){var t;null===(t=this._interaction)||void 0===t||t.remove(e)}update(e){this._graphicsView.processUpdate(e)}viewChange(){this._graphicsView.viewChange()}_createGraphic(e){const t=e.toGraphic();return t.layer=this.layer,t.sourceLayer=this.layer,t}_createGraphicsView(){const e=this.view,t=new m.A(e.featuresTilingScheme);this._graphicsView=new f.A({container:t,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate(),view:e}),this.container.addChild(t),this._processHighlight()}_destroyGraphicsView(){this.container.removeChild(this._graphicsView.container),this._graphicsView.destroy()}_getDrawOrder(e){const t=this._networkGraphicMap.get(e);return A.indexOf(t.type)}_getInteractionLoadPromise(){return this._loadInteractionPromise||(this._loadInteractionPromise=this._loadInteraction(),this._updatingHandles.addPromise(this._loadInteractionPromise)),this._loadInteractionPromise}_getNetworkFeatureUid(e){return this._networkFeatureMap.has(e)?this._networkFeatureMap.get(e).uid:null}async _loadInteraction(){const{layer:e,view:t}=this,{RouteLayerInteraction:r}=await Promise.all([i.e(5164),i.e(5987),i.e(220),i.e(3105)]).then(i.bind(i,23105));return this._interaction=new r({view:t,layer:e}),this._interaction}_routeItemsChanged(e){if(e.removed.length){this._graphics.removeMany(e.removed.map(e=>{const t=this._networkFeatureMap.get(e);return this._networkFeatureMap.delete(e),this._networkGraphicMap.delete(t),t}));for(const t of e.removed)this.removeHandles(t)}if(e.added.length){this._graphics.addMany(e.added.map(e=>{const t=this._createGraphic(e);return null==t.symbol?null:(this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),t)}).filter(a.Ru));for(const t of e.added)this.addHandles([(0,h.wB)(()=>t.geometry,(e,i)=>{this._updateGraphic(t,"geometry",e,i)}),(0,h.wB)(()=>t.symbol,(e,i)=>{this._updateGraphic(t,"symbol",e,i)}),(0,h.wB)(()=>t.popupTemplate,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).popupTemplate=e)}),(0,h.wB)(()=>t.toGraphic().attributes,e=>{this._networkFeatureMap.has(t)&&(this._networkFeatureMap.get(t).attributes=e)})],t);this._graphics.sort((e,t)=>this._getDrawOrder(e)-this._getDrawOrder(t))}}_updateGraphic(e,t,i,r){if(!this._networkFeatureMap.has(e)){const t=this._createGraphic(e);return this._networkFeatureMap.set(e,t),this._networkGraphicMap.set(t,e),void this._graphics.add(t)}const a=this._networkFeatureMap.get(e);a[t]=i,C.graphic=a,C.property=t,C.oldValue=r,C.newValue=i,this._graphicsView.graphicUpdateHandler(C)}_processHighlight(){var e;const t=this._getHighlights();null===(e=this._graphicsView)||void 0===e||e.setHighlight(t)}};(0,r.Cg)([(0,l.MZ)()],V.prototype,"_graphics",void 0),(0,r.Cg)([(0,l.MZ)()],V.prototype,"_routeItems",null),(0,r.Cg)([(0,l.MZ)()],V.prototype,"_interaction",void 0),(0,r.Cg)([(0,l.MZ)()],V.prototype,"interactive",void 0),(0,r.Cg)([(0,l.MZ)({readOnly:!0})],V.prototype,"selectedNetworkFeatures",null),V=(0,r.Cg)([(0,c.$)("esri.views.2d.layers.RouteLayerView2D")],V);const b=V},31394:(e,t,i)=>{i.d(t,{A:()=>s});var r=i(8995),a=i(13692);class s extends r.f{renderChildren(e){for(const t of this.children)t.setTransform(e.state);if(super.renderChildren(e),this._updateAttributeView(),this.children.some(e=>e.hasData)){switch(e.drawPhase){case 1:this._renderChildren(e,0);break;case 16:this.hasHighlight&&this._renderHighlight(e)}this._boundsRenderer&&this._boundsRenderer.doRender(e)}}_renderHighlight(e){(0,a.lB)(e,!1,e=>{this._renderChildren(e,1)})}}}}]);
//# sourceMappingURL=4450.6b56e109.chunk.js.map