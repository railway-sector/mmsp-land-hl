"use strict";(self.webpackChunkmmsp_land_hl=self.webpackChunkmmsp_land_hl||[]).push([[9045],{1898:(e,t,i)=>{i.d(t,{i:()=>s});var r=i(1723);function s(e){var t;return null!==(t=null===e||void 0===e?void 0:e.name)&&void 0!==t?t:r.Tv}},2257:(e,t,i)=>{i.d(t,{D8:()=>n,TO:()=>s,d0:()=>a});var r=i(53430);async function s(e){var t,i;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.popupTemplate;if(null==s)return[];const n=await s.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:a}=s,{objectIdField:o,typeIdField:l,globalIdField:h,relationships:d}=e;if(n.includes("*"))return["*"];const c=a?(0,r.eX)(e):[],u=(0,r.DB)(e.fieldsIndex,[...n,...c]);return l&&u.push(l),u&&o&&null!==(t=e.fieldsIndex)&&void 0!==t&&t.has(o)&&!u.includes(o)&&u.push(o),u&&h&&null!==(i=e.fieldsIndex)&&void 0!==i&&i.has(h)&&!u.includes(h)&&u.push(h),null!==d&&void 0!==d&&d.forEach(t=>{var i;const{keyField:r}=t;u&&r&&(null===(i=e.fieldsIndex)||void 0===i?void 0:i.has(r))&&!u.includes(r)&&u.push(r)}),u}function n(e,t){return e&&"object"==typeof e?null!==t&&void 0!==t&&t.checkPopupEnabled&&"popupEnabled"in e&&!e.popupEnabled?null:"popupTemplate"in e&&e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate?e.defaultPopupTemplate:null:null}function a(e,t){return null!=n(e,{defaultPopupTemplateEnabled:t})}},7342:(e,t,i)=>{i.d(t,{Cc:()=>l,CC:()=>h,RF:()=>o});var r=i(89379),s=i(69539),n=(i(81806),i(76931)),a=i(55855);function o(e){return e&&e.enabled&&(function(e){return"extrude"===e.type}(e)||function(e){return"fill"===e.type}(e))&&null!=e.edges}function l(e,t){return function(e,t){if(null==e)return null;const i=null!=e.color?(0,a.ci)(s.A.toUnitRGBA(e.color)):(0,a.fA)(0,0,0,0),o=(0,n.Lz)(e.size),l=(0,n.Lz)(e.extensionLength);switch(e.type){case"solid":return h((0,r.A)({color:i,size:o,extensionLength:l},t));case"sketch":return function(e){return(0,r.A)((0,r.A)((0,r.A)({},c),e),{},{type:1})}((0,r.A)({color:i,size:o,extensionLength:l},t));default:return}}(function(e){return e&&e.enabled&&e.edges||null}(e),t)}function h(e){return(0,r.A)((0,r.A)((0,r.A)({},d),e),{},{type:0})}const d={color:(0,a.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:1,hasSlicePlane:!1},c={color:(0,a.fA)(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:1,hasSlicePlane:!1}},9612:(e,t,i)=>{i.d(t,{p:()=>r});i(17345);function r(e){return null!=e.mapPositions}},10708:(e,t,i)=>{i.d(t,{H:()=>l});var r,s=i(57528),n=i(65058),a=i(86955),o=i(4653);function l(e){e.include(n.E),e.uniforms.add(new o.x("geometryDepthTexture",e=>{var t;return null===(t=e.geometryDepth)||void 0===t?void 0:t.attachment})),e.code.add((0,a.H)(r||(r=(0,s.A)(["bool geometryDepthTest(vec2 pos, float elementDepth) {\nfloat geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos);\nreturn (elementDepth < (geometryDepth - 1.0));\n}"]))))}},11687:(e,t,i)=>{i.d(t,{$:()=>r});class r{constructor(e,t){this.renderer=e,this.symbol=t,this.color=null,this.size=null,this.opacity=null,this.outlineSize=null,this.heading=null,this.tilt=null,this.roll=null}}},19045:(e,t,i)=>{i.r(t),i.d(t,{default:()=>pr});var r=i(6326),s=i(50076),n=i(30726),a=i(68134),o=i(46053),l=i(81806),h=i(76460),d=(i(47249),i(87990)),c=i(54901),u=i(50346),p=i(47700);const g=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.slicePlaneEnabled=!1,this.supportsHeightUnitConversion=!1}postscript(){super.postscript(),(0,p.jI)(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())}async _validateHeightModelInfo(){const e=new AbortController,t=e.signal;this.addHandles((0,c.hA)(()=>e.abort())),await(0,a.C_)(()=>{var e;return null===(e=this.view.defaultsFromMap)||void 0===e?void 0:e.heightModelInfoReady},t),(0,u.Te)(t);const i=(0,p.Hu)(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion);if(i)throw i}};return(0,r.Cg)([(0,o.MZ)()],i.prototype,"view",void 0),(0,r.Cg)([(0,o.MZ)()],i.prototype,"slicePlaneEnabled",void 0),i=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.LayerView3D")],i),i};var y=i(9392),v=i(13312),m=i(64232),b=i(18117),f=i(12482),_=i(67425),C=i(49296),S=i(41595);var w=i(89379),x=i(39356),P=i(91967),G=i(15011),E=i(19451),O=i(25515),A=i(32535),I=i(86486),R=i(38865),L=i(18690),D=i(87663),F=i(79369),M=i(5457),T=i(59649),V=i(52394),U=i(20664),z=i(76797),j=i(19247),B=i(56611),Z=i(45308),k=i(14487),H=i(91789),N=i(42294),W=i(2413),q=i(80963),Q=i(61024),Y=i(99784),$=i(35039),X=i(66048),J=i(11687),K=i(63919),ee=i(76386),te=i(16911),ie=i(86659),re=i(89579),se=i(46265),ne=i(87708),ae=i(48989);class oe{constructor(e,t,i){this.maximumTotalNumberOfVertices=e,this.maximumNumberOfFeatures=t,this.averageSymbolComplexity=i}}i(66388);var le=i(59752);class he{constructor(e,t){this.spatialReference=e,this._view=t}getElevation(e,t,i){return this._view.elevationProvider.getElevation(e,t,0,this.spatialReference,i)}async queryElevation(e,t,i,r,s){return this._view.elevationProvider.queryElevation(e,t,0,this.spatialReference,s,i,r)}}var de=i(54099),ce=i(20176),ue=i(1484),pe=i(33376);const ge=(0,N.vt)();let ye=class extends P.A{constructor(e){super(e),this.events=new de.bk,this.hasZ=null,this.hasM=null,this.objectIdField=null,this.featureAdapter={getAttribute:(e,t)=>"graphic"in e?e.graphic.attributes[t]:pe.T.getAttribute(e,t),getAttributeAsTimestamp(e,t){const i=this.getAttribute(e,t);return"number"==typeof i?i:new Date(i).getTime()},getAttributes:e=>"graphic"in e?e.graphic.attributes:pe.T.getAttributes(e),getObjectId:e=>{var t;return"graphic"in e?null!==(t=(0,Y.RW)(e.graphic,this.objectIdField))&&void 0!==t?t:void 0:pe.T.getObjectId(e)},getGeometry:e=>"graphic"in e?e.getAsOptimizedGeometry(this.hasZ,this.hasM):pe.T.getGeometry(e),getCentroid:(e,t)=>{if("graphic"in e){let i=null;null!=e.centroid?i=e.centroid:"point"===e.graphic.geometry.type&&(0,B.projectPoint)(e.graphic.geometry,ve,this.viewSpatialReference)&&(i=ve);const r=new Array(2+(t.hasZ?1:0)+(t.hasM?1:0));return null==i?(r[0]=0,r[1]=0,r[2]=0,r[3]=0):(r[0]=i.x,r[1]=i.y,t.hasZ&&(r[2]=i.hasZ?i.z:0),t.hasM&&(r[t.hasZ?3:2]=i.hasM?i.m:0)),new ue.A([],r)}return pe.T.getCentroid(e,t)},cloneWithGeometry:(e,t)=>"graphic"in e?new ce.Om(t,this.featureAdapter.getAttributes(e),null,this.featureAdapter.getObjectId(e)):pe.T.cloneWithGeometry(e,t)}}forEachInBounds(e,t){this.getSpatialIndex().forEachInBounds(e,t)}forEachBounds(e,t){const i=this.getSpatialIndex();for(const r of e){const e=this.featureAdapter.getObjectId(r);null!=i.getBounds(e,ge)&&t(ge)}}};(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ye.prototype,"getSpatialIndex",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ye.prototype,"forEach",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ye.prototype,"hasZ",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ye.prototype,"hasM",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ye.prototype,"objectIdField",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ye.prototype,"viewSpatialReference",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ye.prototype,"featureSpatialReference",void 0),ye=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],ye);const ve={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};class me{constructor(e,t,i){this.graphic=e,this.renderingInfo=t,this.layer=i}}class be{constructor(e,t,i,r){this.scheduler=e,this.schedule=t,this.layerViewUid=i,this.compressionTracker=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}get spherical(){return 1===this.stage.view.state.viewingMode}}var fe=i(98773),_e=i(82041),Ce=i(69539),Se=i(76931),we=i(55855),xe=i(29308),Pe=i(99057),Ge=i(28350),Ee=i(24947),Oe=i(36423),Ae=i(88265),Ie=i(90346),Re=i(50468),Le=i(17345),De=i(57528),Fe=i(88685),Me=i(59422),Te=i(34981),Ve=i(59696),Ue=i(45463),ze=i(52757),je=i(48549),Be=i(16506),Ze=i(59246),ke=i(40431),He=i(57162);class Ne extends Ze.w{constructor(e,t){super(e,t,new Be.$(ke.L,()=>i.e(9873).then(i.bind(i,99873))),We.locations)}initializePipeline(e){const{hudDepth:t,terrainDepthTest:i}=e,r={func:i?519:513};return(0,He.Ey)(t?{depthTest:r,depthWrite:He.Uy}:{blending:(0,He.p3)(1,770,771,771),depthTest:r,colorWrite:He.kn})}}const We=(0,je.BP)().vec3f("position").vec3f("normal").vec2f16("uv0").vec4f("centerOffsetAndDistance");var qe=i(6485),Qe=i(92656);class Ye extends Qe.E{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hudDepth=!1,this.hudDepthAlignStart=!1,this.terrainDepthTest=!1,this.draped=!1}}(0,r.Cg)([(0,qe.W)()],Ye.prototype,"screenCenterOffsetUnitsEnabled",void 0),(0,r.Cg)([(0,qe.W)()],Ye.prototype,"occlusionTestEnabled",void 0),(0,r.Cg)([(0,qe.W)()],Ye.prototype,"hasVerticalOffset",void 0),(0,r.Cg)([(0,qe.W)()],Ye.prototype,"hasScreenSizePerspective",void 0),(0,r.Cg)([(0,qe.W)()],Ye.prototype,"hudDepth",void 0),(0,r.Cg)([(0,qe.W)()],Ye.prototype,"hudDepthAlignStart",void 0),(0,r.Cg)([(0,qe.W)()],Ye.prototype,"terrainDepthTest",void 0);var $e,Xe=i(75569);class Je extends Ue.i{constructor(e,t){super(e,tt),this.intersectDraped=void 0,this.produces=new Map([[15,e=>(0,Te.RN)(e)],[16,e=>(0,Te.RN)(e)]]),this._configuration=new Ye(t),this._uniqueMaterialIdentifier=Ke(this.parameters)}passParameters(){return this.parameters}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=null!=this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=null!=this.parameters.screenSizePerspective,this._configuration.hudDepth=16===t.slot,this._configuration.hudDepthAlignStart=!!this.parameters.hudDepthAlignStart,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration}get visible(){var e,t;return this.parameters.color[3]>=Xe.Q||(null!==(e=null===(t=this.parameters.borderColor)||void 0===t?void 0:t[3])&&void 0!==e?e:0)>=Xe.Q}intersect(){}createGLMaterial(e){return new et(e)}createBufferWriter(){return new rt}validateParameters(e){this._uniqueMaterialIdentifier=Ke(e)}get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}}function Ke(e){let{renderOccluded:t,isDecoration:i,horizontalScreenOffset:r,color:s,size:n,occlusionTest:a,shaderPolygonOffset:o,hudDepthAlignStart:l,centerOffsetUnits:h,hasSlicePlane:d,screenSizePerspective:c,verticalOffset:u,borderColor:p}=e;return(0,Fe.ML)($e||($e=(0,De.A)(["",":",":",":[","]:",":",":",":",":",":",":",":{",":",":","}:[","]"])),t,i,r,s,n,a,o,l,h,d,null!=c,null===u||void 0===u?void 0:u.screenLength,null===u||void 0===u?void 0:u.minWorldLength,null===u||void 0===u?void 0:u.maxWorldLength,p)}class et extends Ve.A{beginSlot(e){return this.getTechnique(Ne,e)}}class tt extends Ue.q{constructor(){super(...arguments),this.horizontalScreenOffset=0,this.color=(0,we.fA)(0,0,0,1),this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.hudDepthAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}}const it=[(0,Me.fA)(0,0),(0,Me.fA)(1,0),(0,Me.fA)(0,1),(0,Me.fA)(1,0),(0,Me.fA)(1,1),(0,Me.fA)(0,1)];class rt{constructor(){this.layout=We}elementCount(e){return 6*e.get("position").indices.length}write(e,t,i,r,s,n){(0,ze.Hk)(i.get("position"),e,s.position,n,6),(0,ze.p1)(i.get("normal"),t,s.normal,n,6),(0,ze.Ut)(i.get("centerOffsetAndDistance"),s.centerOffsetAndDistance,n,6);for(let a=0;a<it.length;++a)s.uv0.setVec(n+a,it[a]);return null}}class st extends Ee.UF{constructor(e,t){super(e,null,t,ot),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._materials[0]=new Je(this._materialParameters,this._context.spherical)}_perInstanceMaterialParameters(e){var t;const i=this._materialParameters;return i.horizontalScreenOffset=null!==(t=e.horizontalScreenOffset)&&void 0!==t?t:0,i.centerOffsetUnits=e.centerOffsetUnits||"world",i}get _materialParameters(){var e;const t=new tt,i=this.symbol,r=i.callout;if(r.color){const e=Ce.A.toUnitRGBA(r.color);e[3]*=this._getLayerOpacity(),t.color=e}else t.color=we.uY;if(t.size=(0,Se.Lz)(r.size||0),i.verticalOffset){const{screenLength:e,minWorldLength:r,maxWorldLength:s}=i.verticalOffset;t.verticalOffset={screenLength:(0,Se.Lz)(e),minWorldLength:r||0,maxWorldLength:null!=s?s:1/0}}t.borderColor=null!=(null===(e=r.border)||void 0===e?void 0:e.color)?Ce.A.toUnitRGBA(r.border.color):null;const s="object"===i.symbolLayers.at(0).type,n="label-3d"===i.type;return t.occlusionTest=!s&&!(0,l.A)("enable-feature:non-occluded-hud"),s&&(t.shaderPolygonOffset=0),t.hudDepthAlignStart=n,t.hasSlicePlane=this._context.slicePlaneEnabled,t.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this.view.screenSizePerspective.parameters:null,t}_defaultElevationInfoNoZ(){return at}createGraphics3DGraphic(e,t){const i=e.renderingInfo,r=e.graphic,s=this.createElevationContextForGraphic(r,i.elevationOffset||0),n=i.symbol,a="on-the-ground"===this._elevationContext.mode&&("cim"===n.type||!n.symbolLayers.some(e=>"object"===e.type||"text"===e.type));if("label-3d"!==n.type&&a)return null;if("point-3d"===n.type&&n.symbolLayers.every(e=>"text"===e.type&&!(0,_e.Ie)(e)))return null;const o=(0,Oe.W$)(r.geometry);return null==o?null:this._createAs3DShape(o,s,i,r.uid,t)}layerOpacityChanged(){var e;null===(e=this._materials[0])||void 0===e||e.setParameters(this._materialParameters)}layerScreenSizePerspectiveChanged(){var e;const t=this._context.screenSizePerspectiveEnabled?this.view.screenSizePerspective.parameters:null;null===(e=this._materials[0])||void 0===e||e.setParameters({screenSizePerspective:t})}layerElevationInfoChanged(e,t,i){const r=this._elevationContext.mode,s=(0,_.I2)(st.elevationModeChangeTypes,i,r);return 1!==s||null!==e&&void 0!==e&&e.forEach(e=>{const i=t(e);null!=i&&this.graphics3DGraphicLayerElevationInfoChanged(e.graphic,i)}),s}slicePlaneEnabledChanged(){var e;return null!==(e=this._materials[0])&&void 0!==e&&e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}createElevationContextForGraphic(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=super.createElevationContextForGraphic(e);return i.addOffsetRenderUnits(t),i}updateElevationContextForGraphic(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super.updateElevationContextForGraphic(e,t),e.addOffsetRenderUnits(i)}graphics3DGraphicLayerElevationInfoChanged(e,t){var i;const{elevationContext:r,metadata:s}=t;this.updateElevationContextForGraphic(r,e,null!==(i=null===s||void 0===s?void 0:s.elevationOffset)&&void 0!==i?i:0),t.needsElevationUpdates=(0,_.nu)(r.mode)}computeComplexity(){return new Ie.rz({verticesPerFeature:6})}_getOrCreateMaterial(e,t){var i;const r=this._perInstanceMaterialParameters(e),s=Ke(r);if(s===(null===(i=this._materials[0])||void 0===i?void 0:i.uniqueMaterialIdentifier))return this._materials[0];if(t){let e=t.get(s);return null==e&&(e=new Je(r,this._context.spherical),t.set(s,e)),e}return new Je(r,this._context.spherical)}_createAs3DShape(e,t,i,r,s){const n=this._context.layerViewUid,a=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:r,layerViewUid:n}),o=this._getOrCreateMaterial(i,s),l=new Le.V(o,function(e){const{translation:t,centerOffset:i}=e,r=new Re.n(t?[t[0],t[1],t[2]]:[0,0,0],nt,3,!0),s=new Re.n(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],nt,4,!0);return[["position",r],["normal",new Re.n([0,0,1],nt,3,!0)],["centerOffsetAndDistance",s]]}(i),null,1,a),h=(0,Ae.SZ)(this._context,e,l,t,r);if(null==h)return null;const d=new Pe.Y(this,h.object,null,xe.G8,t);return d.metadata=new Ge.Z(i.elevationOffset),d.alignedSampledElevation=h.sampledElevation,d.needsElevationUpdates=(0,_.nu)(t.mode),(0,Ae.d2)(d,e,this._context.elevationProvider),d}}st.elevationModeChangeTypes={definedChanged:1,staysOnTheGround:1,onTheGroundChanged:2};const nt=[0],at={mode:"relative-to-ground",offset:0},ot={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};class lt extends J.${constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:(0,y.vt)(),r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,we.vt)(),s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"world",a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;super(e,t),this.translation=i,this.centerOffset=r,this.horizontalScreenOffset=s,this.centerOffsetUnits=n,this.elevationOffset=a}}const ht=()=>h.A.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");const dt={line:st};var ct=i(97255),ut=i(3789),pt=i(19555),gt=i(72745),yt=i(65215);function vt(e,t,i,r){return null!=e&&((0,q.aI)(t,r)?((0,W.C)(i,e),!0):(mt[0]=e[0],mt[1]=e[1],mt[2]=0,!!(0,Z.projectBuffer)(mt,t,0,mt,r,0)&&(i[0]=mt[0],i[1]=mt[1],mt[0]=e[2],mt[1]=e[3],mt[2]=0,!!(0,Z.projectBuffer)(mt,t,0,mt,r,0)&&(i[2]=mt[0],i[3]=mt[1],!0))))}const mt=(0,y.vt)();var bt=i(98618);const ft=new ut.A(()=>(0,N.vt)(),e=>(0,N.hZ)(e,N.v_),null,10,5),_t=(0,W.vt)();class Ct{get labelLayers(){return this._labelLayers||L.tR}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>null===e||void 0===e?void 0:e.isElevationSource)}constructor(e,t,i){this.graphic=e,this.graphics3DSymbol=t,this.layers=i,this._visibleFlags=255,++t.referenced}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(t=>{t.initialize(e),t.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return null==this.layers}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,t){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(t),e.setVisibility(this.isVisible(16))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(t=>{"draped"===t.type&&(e=!0)}),e}isVisible(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0;const i=t?this._visibleFlags|t|16*t:this._visibleFlags;return 1===e?!(15&~i):!(255&~i)}setVisibilityFlag(e,t,i){const r=this.isVisible(e);i?this._visibleFlags|=e*t:this._visibleFlags&=~(e*t);const s=this.isVisible(e);if(r===s)return!1;if(16===e)this._forEachLabelGraphic(e=>e.setVisibility(s));else{this._forEachSymbolLayerGraphic(e=>e.setVisibility(s));const e=this.isVisible(16);this._forEachLabelGraphic(t=>t.setVisibility(e))}return!0}getVisibilityFlag(e,t){return 0!==(this._visibleFlags&e*t)}computeExtent(e){if(!this._extent){const t=this.graphic.geometry;if(null==t)return!1;this._extent=(0,W.vt)(),(0,Y.iQ)(t,this._extent);const i=t.spatialReference;if(!(0,q.aI)(i,e)&&!vt(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,t){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,t)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,t,i){let r=e.geometry;return"mesh"!==r.type&&"extent"!==r.type||(r=yt.A.fromExtent("mesh"===r.type?r.extent:r)),(0,bt.Ux)(r,t,i)}get usedMemory(){let e=(0,ct.lM)(this.graphic.attributes);return this._forEachSymbolLayerGraphic(t=>e+=t.usedMemory),e}computeAttachmentOrigin(){const e={render:{origin:(0,y.vt)(),num:0},draped:{origin:(0,gt.vt)(),num:0}};for(const t of this.layers)null!=t&&t.computeAttachmentOrigin(e);return e.render.num>1&&(0,U.h)(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&(0,pt.hs)(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,t,i,r,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?(0,N.Ie)(s.boundingBox):s.boundingBox=(0,N.Ie)(),s.requiresDrapedElevation=!1,await(0,fe.jJ)(this.layers,async n=>{if(null==n)return;const a="draped"===n.type?t:e,o=ft.acquire(),l=await n.getProjectedBoundingBox(a,i,s.screenSpaceObjects,r,o);isFinite(l[2])&&isFinite(l[5])||(s.requiresDrapedElevation=!0),l&&(0,N.RF)(s.boundingBox,o),ft.release(o)}),(0,N.vQ)(s.boundingBox)||(0,W.vQ)((0,N.ES)(s.boundingBox,_t))?s:null}needsElevationUpdates(){var e,t;for(const i of this.layers)if(null!=i&&("object3d"===i.type||"lod-instance"===i.type)&&i.needsElevationUpdates)return!0;return null!==(e=null===(t=this._labelLayers)||void 0===t?void 0:t.some(e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.needsElevationUpdates)&&void 0!==t&&t}))&&void 0!==e&&e}alignWithElevation(e,t,i){this._forEachRenderedGraphic(r=>{"object3d"!==r.type&&"lod-instance"!==r.type||r.alignWithElevation(e,t,i)})}alignWithAbsoluteElevation(e,t,i){this._forEachRenderedGraphic(r=>{"object3d"===r.type&&r.alignWithAbsoluteElevation(e,t,i)})}addObjectStateSet(e){this._forEachSymbolLayerGraphic(t=>t.addObjectState(e))}removeObjectState(e){this._forEachSymbolLayerGraphic(t=>t.removeObjectState(e))}updateHighlights(e){this._forEachSymbolLayerGraphic(t=>t.updateHighlights(e))}_forEachGraphicList(e,t){null===e||void 0===e||e.forEach(e=>e&&t(e))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this.labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){}}var St=i(75646);function wt(e){return 2216+4096*e.symbolLayers.length+e.complexity.memory.resourceBytes}class xt extends St.x{set symbol(e){this._symbol=e,e.symbolLayers.forEach((t,i)=>{const r=this.symbolLayers[i];null!=r&&(r.symbol=e,r.symbolLayer=t)})}get symbol(){return this._symbol}constructor(e,t,i){super(t.schedule),this._symbol=e,this._context=t,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let t=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(t=this._backgroundLayers.concat(t));const r=t.length;for(;this.symbolLayers.length<t.length;)this.symbolLayers.push(null);this.symbolLayers.length=t.length;const s=[];if(!Pt){const{make:e}=await Promise.all([i.e(9996),i.e(1821),i.e(2665),i.e(9513),i.e(622)]).then(i.bind(i,41921));Pt=e}for(let i=0;i<r;i++){const n=t.at(i);if(!1===n.enabled)continue;Gt.renderPriority=1-(1+i)/r,Gt.renderPriorityStep=1/r,Gt.ignoreDrivers=n.ignoreDrivers;const a=Pt(this.symbol,n,this._context,Gt),o=(0,u.NY)(e,()=>{this.symbolLayers[i]=null,a.destroy()});o&&s.push(o),this.symbolLayers[i]=a}if(await(0,fe.jJ)(this.symbolLayers,async(e,t)=>{if(null!=e)try{await e.load(),this._extentPadding+=Math.max(this._extentPadding,e.extentPadding)}catch(i){this.symbolLayers[t]=null}}),s.forEach(e=>e.remove()),(0,u.Te)(e),this.symbolLayers.length&&!this.symbolLayers.some(e=>!!e))throw new Error}getSymbolLayerSize(e){const t=this.symbolLayers[e];return null!=t?t.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>null===e||void 0===e?void 0:e.queryForSnapping)}get needsUpdateFocus(){return this.symbolLayers.some(e=>!0===(null===e||void 0===e?void 0:e.needsUpdateFocus))}createGraphics3DGraphic(e,t){const{graphic:i}=e,r=this.symbolLayers.map(t=>{var i;return null!==(i=null===t||void 0===t?void 0:t.createGraphics3DGraphic(e))&&void 0!==i?i:null});return new Ct(i,t||this,r)}get complexity(){return(0,ae.Tf)(this.symbolLayers.map(e=>null===e||void 0===e?void 0:e.complexity))}globalPropertyChanged(e,t){const i=this.symbolLayers.length;for(let r=0;r<i;r++){const i=this.symbolLayers[r],s=e=>{const t=e.layers[r];return t instanceof Pe.Y?t:null};if(null!=i&&!i.globalPropertyChanged(e,t,s))return!1}return!0}applyRendererDiff(e,t){return 1!==this.loadStatus?0:this.symbolLayers.reduce((i,r)=>0!==i&&null!=r?Math.min(i,r.applyRendererDiff(e,t)):i,2)}prepareSymbolPatch(e){if(2===this.loadStatus)return;if("partial"!==e.diff.type)return;const t=e.diff.diff;if(!t.symbolLayers||"partial"!==t.symbolLayers.type)return;const i=t.symbolLayers.diff;this.symbolLayers.forEach((t,r)=>{if(null==t)return;const s=i[r];if(s){const i={diff:s,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};t.prepareSymbolLayerPatch(i),e.symbolStatePatches.push(...i.symbolLayerStatePatches),i.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((e,t)=>{const s=e.layers[r];null!=s&&i.graphics3DGraphicPatches.forEach(e=>e(s,t))})}})}updateGeometry(e){return this._updateGeometryOrTransform(e,(t,i)=>!!t.updateGeometry&&t.updateGeometry(e.graphic,i))}updateTransform(e,t,i,r){return this._updateGeometryOrTransform(e,(e,s)=>!!e.updateTransform&&e.updateTransform(s,t,i,r))}_updateGeometryOrTransform(e,t){for(let i=0;i<this.symbolLayers.length;i++){const r=this.symbolLayers[i];if(null==r)continue;const s=e.layers[i];if(!s||!t(r,s))return!1}return!0}onRemoveGraphic(e){for(let t=0;t<this.symbolLayers.length;t++){const i=this.symbolLayers[t];if(null==i)continue;const r=e.layers[t];null!=r&&i.onRemoveGraphic(r)}}getFastUpdateStatus(){let e=!1,t=!1;for(const i of this.symbolLayers)if(null!=i){if(0===i.loadStatus)return 3;i.isFastUpdatesEnabled()?t=!0:e=!0}return t?e?2:1:e?0:4}async queryForSnapping(e,t,i,r){const s=this.symbolLayers.filter(L.Ru).filter(e=>null!=e.queryForSnapping).map(s=>s.queryForSnapping(e,t,i,r)),n=await Promise.all(s);return(0,u.Te)(r),n.flat()}destroy(){if(!this.destroyed){super.destroy();for(const e of this.symbolLayers)null!=e&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}get usedMemory(){return wt(this)}}let Pt=null;const Gt=new class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};class Et extends xt{constructor(e,t,i){super(e,t,i),this._calloutSymbolLayer=null,this.symbol.hasVisibleCallout()&&(this._calloutSymbolLayer=function(e,t){if(!(0,_e.YX)(e))return ht().error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '".concat(e.type,"' does not support callouts")),null;if(!e.callout)return null;const i=dt[e.callout.type];return i?new i(e,t):(ht().error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type ".concat(e.callout.type)),null)}(this.symbol,t))}async doLoad(e){const t=this._calloutSymbolLayer?(0,fe.Ke)(this._calloutSymbolLayer.load()):null;try{await super.doLoad(e),(0,u.Te)(e)}catch(g){var i;throw null!==(i=this._calloutSymbolLayer)&&void 0!==i&&i.abortLoad(),g}t&&await t}destroy(){super.destroy(),this._calloutSymbolLayer=(0,n.pR)(this._calloutSymbolLayer)}createGraphics3DGraphic(e,t){const i=super.createGraphics3DGraphic(e,t);if(null!=this._calloutSymbolLayer&&null!=i){const t=this._createCalloutGraphic(e);t&&i.setCalloutGraphic(t)}return i}globalPropertyChanged(e,t){return!!super.globalPropertyChanged(e,t)&&(!this._calloutSymbolLayer||this._calloutSymbolLayer.globalPropertyChanged(e,t,e=>e.calloutLayer))}updateGeometry(e){const t=super.updateGeometry(e);if(t&&this._calloutSymbolLayer){var i,r,s;const t=e.calloutLayer;if(t)return null!==(i=null===(r=(s=this._calloutSymbolLayer).updateGeometry)||void 0===r?void 0:r.call(s,e.graphic,t))&&void 0!==i&&i}return t}_createCalloutGraphic(e){const t=e.renderingInfo;return e.renderingInfo=new lt(t.renderer,t.symbol),this._calloutSymbolLayer.createGraphics3DGraphic(e)}}class Ot extends St.x{constructor(e,t,i){super(t),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const t=await this.symbol.fetchSymbol({signal:e});t.id=this.symbol.id,this.graphics3DSymbol=this._convert(t),null!=this.graphics3DSymbol&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return null!=this.graphics3DSymbol?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return null!=this.graphics3DSymbol?this.graphics3DSymbol.complexity:ae.uD}globalPropertyChanged(e,t){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.globalPropertyChanged(e,t)}applyRendererDiff(e,t){return null!=this.graphics3DSymbol?this.graphics3DSymbol.applyRendererDiff(e,t):0}prepareSymbolPatch(e){null!=this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e){return null!=this.graphics3DSymbol&&this.graphics3DSymbol.updateGeometry(e)}updateTransform(e,t,i,r){var s,n;return null!==(s=null===(n=this.graphics3DSymbol)||void 0===n?void 0:n.updateTransform(e,t,i,r))&&void 0!==s&&s}onRemoveGraphic(){}get needsUpdateFocus(){return!1}getFastUpdateStatus(){var e,t;return null!==(e=null===(t=this.graphics3DSymbol)||void 0===t?void 0:t.getFastUpdateStatus())&&void 0!==e?e:3}destroy(){null!=this.graphics3DSymbol&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return void 0===this.graphics3DSymbol}get usedMemory(){return wt(this)}}class At{constructor(e,t,i,r){this.total=e,this.visible=t,this.missing=i,this.pending=r}}class It{constructor(e){var t;this._graphicsCore=e,this._idToState=new Map,this._states=new Set;const i=null===(t=e.owner.layer)||void 0===t?void 0:t.objectIdField;i?(this._getGraphicId=e=>(0,Y.RW)(e,i),this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicByObjectId(e)):(this._getGraphicId=e=>e.uid,this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicById(e))}destroy(){this._idToState.clear(),this._states.forEach((e,t)=>this.remove(t))}add(e){var t,i;const r=(0,c.hA)(()=>this.remove(e));if(this._states.has(e))return r;const s=this._getGraphicId(e.graphic),n=this._getGraphics3DGraphicById(s);return this._states.has(e)||this._states.add(e),this._ensureStateList(s).push(e),e.displaying=null!==(t=null===n||void 0===n?void 0:n.isVisible())&&void 0!==t&&t,e.isDraped=null!==(i=null===n||void 0===n?void 0:n.isDraped)&&void 0!==i&&i,e.tracking=!0,null!=n&&e.emit("changed"),r}remove(e){if(this._states.has(e)){if(this._idToState.size){const t=this._getGraphicId(e.graphic),i=this._idToState.get(t);i&&((0,L.TF)(i,e),0===i.length&&this._idToState.delete(t))}this._states.delete(e),e.tracking=!1,e.displaying=!1}}addGraphic(e){this._forEachState(e.graphic,t=>{t.displaying=e.isVisible(),t.isDraped=e.isDraped,t.emit("changed")})}removeGraphic(e){this._forEachState(e.graphic,e=>{e.displaying=!1,e.isDraped=!1})}updateGraphicGeometry(e){this._forEachState(e.graphic,e=>e.emit("changed"))}updateGraphicVisibility(e){this._forEachState(e.graphic,t=>t.displaying=e.isVisible())}updateGraphicError(e,t){this._forEachState(e,e=>e.error=t)}allGraphicsDeleted(){this._states.forEach(e=>e.displaying=!1)}_ensureStateList(e){const t=this._idToState.get(e);if(t)return t;const i=new Array;return this._idToState.set(e,i),i}_forEachState(e,t){if(0===this._states.size||0===this._idToState.size)return;const i=this._getGraphicId(e),r=this._idToState.get(i);null!=r&&r.forEach(t)}}var Rt=i(70373);let Lt=class extends P.A{constructor(e){super(e),this._index=new Rt.wq(9,(0,l.A)("esri-csp-restrictions")?e=>({minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),this._missing=new Set,this._boundsByFeature=new Map,this.spatialReference=null,this.hasZ=null,this.hasM=null,this.objectIdField=null,this.updating=!1}setup(e){this._addMany(e)}destroy(){this._missing.clear(),this._index=(0,n.pR)(this._index),this._boundsByFeature.clear(),this._boundsByFeature=null}update(){this._missing.size>0&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}get updatingRemaining(){return this._missing.size}queryGraphicUIDsInExtent(e,t,i){null!=t&&t.equals(this.spatialReference)&&(Dt.minX=e[0],Dt.minY=e[1],Dt.maxX=e[2],Dt.maxY=e[3],this.update(),this._index.search(Dt,e=>i(e.graphic.uid)))}add(e){this._missing.add(e),this.updating=!0}remove(e){if(this._missing.delete(e))return void(this.updating=this._missing.size>0);if(!e.extent)return;this._index.remove(e);const t=(0,Y.RW)(e.graphic,this._get("objectIdField"));null!=t&&this._boundsByFeature.delete(t)}_addMany(e){if(0===e.length)return;const t=this._get("objectIdField");for(const i of e){i.computeExtent(this.spatialReference);const e=(0,Y.RW)(i.graphic,t);null!=e&&this._boundsByFeature.set(e,i.extent)}this._index.load(e)}clear(){this._index.clear(),this._missing.clear(),this._boundsByFeature.clear(),this.updating=!1}forEachInBounds(e,t){Dt.minX=e[0],Dt.minY=e[1],Dt.maxX=e[2],Dt.maxY=e[3],this.update(),this._index.search(Dt,e=>{t(e)})}getBounds(e,t){this.update();const i=this._boundsByFeature.get(e);return i?(0,N.Jt)(t,i):null}};(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],Lt.prototype,"spatialReference",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],Lt.prototype,"hasZ",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],Lt.prototype,"hasM",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],Lt.prototype,"objectIdField",void 0),(0,r.Cg)([(0,o.MZ)()],Lt.prototype,"updating",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],Lt.prototype,"updatingRemaining",null),Lt=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.graphics.SpatialIndex2D")],Lt);const Dt={minX:0,minY:0,maxX:0,maxY:0};var Ft=i(31633),Mt=i(81478);var Tt=i(96342),Vt=i(66470);const Ut=Symbol("layerHandles");let zt=class extends de.nJ{get spatialReference(){return this.view.spatialReference}constructor(e){super(e),this._elevationOffset=0}initialize(){this._renderCoordsHelper=this.view.renderCoordsHelper,this._intersectLayers=[this.stageLayer],this._intersector=new Tt.n(this.view.state.viewingMode),this._intersector.options.store=0;const e=this._computeLayerExtent(this.spatialReference,this.stageLayer);this._zmin=e[2],this._zmax=e[5];const t=this.stageLayer.events;this.addHandles([t.on(["layerObjectAdded","layerObjectRemoved","transformationChanged","shaderTransformationChanged"],e=>this._objectChanged(e)),t.on(["geometryAdded","geometryRemoved"],e=>{let{object:t}=e;return this._objectChanged(t)}),t.on("attributesChanged",e=>{let{attribute:t,object:i}=e;return(0,Vt.b)(t)&&this._objectChanged(i)})],Ut)}destroy(){this.removeHandles(Ut)}elevationInfoChanged(){const e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"on-the-ground"!==e.mode){var t,i;const r=(0,Ft.G9)(this.layer.spatialReference),s=(0,Mt.Ao)(null!==(t=e.unit)&&void 0!==t?t:"meters");this._elevationOffset=(null!==(i=e.offset)&&void 0!==i?i:0)*s/r}else this._elevationOffset=0}getElevation(e,t,i,r){if(Zt[0]=e,Zt[1]=t,Zt[2]=i,!this._renderCoordsHelper.toRenderCoords(Zt,r,Zt))return h.A.getLogger(this).error("could not project point for elevation alignment"),null;const s=this._elevationOffset,n=this._zmin+s,a=this._zmax+s;this._renderCoordsHelper.setAltitude(kt,a,Zt),this._renderCoordsHelper.setAltitude(Ht,n,Zt);return this._intersector.reset(kt,Ht,null),this._intersector.intersect(this._intersectLayers,null,1,null,e=>!!e.lastValidElevationBB),this._intersector.results.min.getIntersectionPoint(Zt)?this._renderCoordsHelper.getAltitude(Zt):null}_objectChanged(e){const t=this.spatialReference;if(!e.lastValidElevationBB||!t)return;(0,N.Ie)(jt);const i=e.lastValidElevationBB;i.isEmpty()||this._expandExtent(t,i.min,i.max,jt);const{min:r,max:s}=e.boundingVolumeWorldSpace;this._expandExtent(t,r,s,jt),(0,N.ES)(jt,Bt.extent),this._zmin=Math.min(this._zmin,jt[2]),this._zmax=Math.max(this._zmax,jt[5]),Bt.spatialReference=t,this.emit("elevation-change",Bt),Bt.spatialReference=null,i.assignMinMax(r,s)}_computeLayerExtent(e,t){return(0,N.Ie)(jt),null!=e&&t.objects.forEach(t=>this._expandExtent(e,t.boundingVolumeWorldSpace.min,t.boundingVolumeWorldSpace.max,jt)),jt}_expandExtent(e,t,i,r){for(let s=0;s<8;++s)Zt[0]=1&s?t[0]:i[0],Zt[1]=2&s?t[1]:i[1],Zt[2]=4&s?t[2]:i[2],this._renderCoordsHelper.fromRenderCoords(Zt,Zt,e),(0,N.iT)(r,Zt);return r}};(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],zt.prototype,"layer",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],zt.prototype,"stageLayer",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],zt.prototype,"view",void 0),(0,r.Cg)([(0,o.MZ)()],zt.prototype,"spatialReference",null),zt=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.support.StageLayerElevationProvider")],zt);const jt=(0,N.Ie)(),Bt=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scene";this.context=e,this.extent=(0,W.Ie)(),this.spatialReference=null}};const Zt=(0,y.vt)(),kt=(0,y.vt)(),Ht=(0,y.vt)();const Nt=(0,y.vt)();var Wt=i(97583),qt=i(12028),Qt=i(8918),Yt=i(84248),$t=i(2257),Xt=i(60161),Jt=i(5890),Kt=i(75540);class ei{constructor(){this._pendingCompressionTasks=(0,Kt.v)(0)}get compressing(){return!!this._pendingCompressionTasks.value}increment(){this._pendingCompressionTasks.value++}decrement(){this._pendingCompressionTasks.value--}}var ti,ii,ri=i(22856);const si=(0,y.vt)(),ni=(0,N.vt)();let ai=(ti=class extends P.A{get _viewSpatialReference(){return this.owner.view.spatialReference}get spatialIndex(){var e;return this._spatialIndex||(this._spatialIndex=new Lt({objectIdField:null===(e=this.owner.layer)||void 0===e?void 0:e.objectIdField,spatialReference:this._viewSpatialReference,hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))),this._spatialIndex.update(),this._spatialIndex}get deconflictor(){return this._deconflictor}get labeler(){return this._labeler}get numberOfGraphics(){return this._numberOfGraphics}get effectiveUpdatePolicy(){var e;return null!=this.currentRenderer&&"dictionary"===this.currentRenderer.type?0:null!==(e=this._forcedUpdatePolicy)&&void 0!==e?e:this.preferredUpdatePolicy}get featureStore(){return this._featureStore}get initializePromise(){return this._initializePromise}get scaleVisibility(){return this._scaleVisibility}get elevationAlignment(){return this._elevationAlignment}get objectStates(){return this._objectStates}get filterVisibility(){return this._filterVisibility}get updating(){var e,t,i;return!!(this.dataUpdating||null!==(e=this._elevationAlignment)&&void 0!==e&&e.updating||null!==(t=this._scaleVisibility)&&void 0!==t&&t.updating||null!==(i=this._filterVisibility)&&void 0!==i&&i.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._frameTaskHandle.updating||this._updateQueue.updating||this.readyToRun)}get dataUpdating(){var e;return!!(this._graphicsWaitingForSymbol.size>0||this._pendingUpdates.size>0||null!==(e=this._spatialIndex)&&void 0!==e&&e.updating||this._updatingPendingLoadedGraphicsChange||this._dataUpdateQueue.updating||this._loadingSymbols>0||this.compressionTracker.compressing)}get readyToRun(){var e;return this._pendingUpdates.size>0||!(null===(e=this._spatialIndex)||void 0===e||!e.updating)||this._dataUpdateQueue.readyToRun||this._updateQueue.readyToRun||this._focusAreasGraphicsQueue.length>0}get suspendedOrOutsideOfView(){var e;return this.owner.suspended||!(null===(e=this.owner.suspendInfo)||void 0===e||!e.outsideOfView)}get updatingRemaining(){var e,t;return this.updating?this._pendingUpdates.size+.1*((null===(e=this._spatialIndex)||void 0===e?void 0:e.updatingRemaining)||0)+.1*((null===(t=this._elevationAlignment)||void 0===t?void 0:t.updatingRemaining)||0):0}get displayFeatureLimit(){var e,t,i,r,s;const n=this.owner&&this.owner.view&&this.owner.view.qualitySettings,a=null!==(e=null===n||void 0===n?void 0:n.graphics3D.minTotalNumberOfFeatures)&&void 0!==e?e:0,o=null!==(t=null===n||void 0===n?void 0:n.graphics3D.maxTotalNumberOfFeatures)&&void 0!==t?t:0,l=null!==(i=null===n||void 0===n?void 0:n.graphics3D.maxNumberOfDrawCalls)&&void 0!==i?i:0,h=null!==(r=null===n||void 0===n?void 0:n.graphics3D.maxTotalNumberOfVertices)&&void 0!==r?r:0,d=this.averageSymbolComplexity,c=Math.max(1,null!==(s=null===d||void 0===d?void 0:d.verticesPerFeature)&&void 0!==s?s:1),u=d&&d.drawCallsPerFeature>0&&l>0?l/d.drawCallsPerFeature:o,p=Math.ceil(h/c),g=Math.max(a,Math.min(o,p,u)),y=this._get("displayFeatureLimit");return y&&y.maximumTotalNumberOfVertices===h&&y.averageSymbolComplexity===d&&y.maximumNumberOfFeatures===g?y:new oe(h,g,d)}get averageSymbolComplexity(){const e=(0,ae.k9)(this._symbolComplexities),t=this._get("averageSymbolComplexity");return 0===e.numComplexities||null!=t&&(e.estimated&&(t.verticesPerFeature>=e.verticesPerFeature||t.verticesPerCoordinate>=e.verticesPerCoordinate||t.drawCallsPerFeature>=e.drawCallsPerFeature)||t.verticesPerFeature===e.verticesPerFeature&&t.verticesPerCoordinate===e.verticesPerCoordinate&&t.drawCallsPerFeature===e.drawCallsPerFeature)?t:e}get usedMemory(){var e,t;const i=this.labelsEnabled?(null!==(e=null===(t=this.averageSymbolComplexity)||void 0===t?void 0:t.memory.bytesPerFeatureLabel)&&void 0!==e?e:0)*this._numberOfGraphics:0,r=this._getSymbolComplexitiesUsed().reduce((e,t)=>e+t.memory.resourceBytes,0);if(null==this._symbolMaterials){this._symbolMaterials=[];for(const e of this._symbols.values())if(null!=e)for(const t of e.symbolLayers)if(t)for(const e of t.materials)e&&this._symbolMaterials.push(e)}const s=this.owner.view.stage.renderer,n=this.owner.view.overlayManager.renderer,a=this._symbolMaterials.reduce((e,t)=>{var i,r;return e+(null!==(i=null===(r=s.getMaterialRenderer(t)||n.getMaterialRenderer(t))||void 0===r?void 0:r.usedMemory)&&void 0!==i?i:0)},0);return this._usedMemory+i+r+a}get usedMemoryPerGraphic(){if(this._usedMemory&&this._numberOfGraphics){const e=this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves));return this._usedMemory/this._numberOfGraphics*e}if(null!=this.averageSymbolComplexity){const e=this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0;return this.averageSymbolComplexity.memory.bytesPerFeature+e}return 0}get unprocessedMemoryEstimate(){return(this._pendingAdds-this._pendingRemoves)*this.usedMemoryPerGraphic}get _symbolComplexities(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}get visible(){return this._visible}_getConvertedSymbol(e){var t,i;const r=e;if("web-style"===r.type)return r.clone();const s=this._symbolConversionCache.get(r.id);if(null!=s)return s;const n=(0,ne.t)(r,{geometryType:null!==(t=null===(i=this.layer)||void 0===i?void 0:i.geometryType)&&void 0!==t?t:void 0,retainId:!0,hasLabelingContext:this._hasLabelingContext(r),cimFallbackEnabled:!0}),a=n.symbol||null;return null==a&&n.error&&h.A.getLogger(this).error(n.error.message),this._symbolConversionCache.set(r.id,a),a}_getSymbolComplexitiesUsedOrRenderer(e){if(null==e)return[];const t=e.symbols,i="backgroundFillSymbol"in e?e.backgroundFillSymbol:null;if(!i&&!t.length)return[];const r=[],s=this._getSymbolComplexityUsedOrRenderer(i);null!=s&&r.push(s);for(const n of t){const e=this._getSymbolComplexityUsedOrRenderer(n);null!=e&&r.push(e)}return r}_getSymbolComplexityUsedOrRenderer(e){if(null==e)return null;const t=this._symbols.get(e.id);if(null!=t)return t.complexity;const i=this._getConvertedSymbol(e);return null!=i?(0,ae.Eg)(i):null}_getSymbolComplexitiesUsed(){const e=[];return this._symbols.forEach(t=>{null!=t&&e.push(t.complexity)}),e}get _objectIdField(){return this.layer.objectIdField}constructor(e){super(e),this._propertiesPool=new Jt.M({computedExtent:()=>new z.A},this),this.computedExtent=null,this.currentRenderer=null,this.rendererHasGeometryOperations=!1,this._graphicStateTracking=null,this.graphics3DGraphics=new Map,this.stageLayer=null,this.stage=null,this._graphicsDrapedUids=new Set,this._graphicsBySymbol=new Map,this._symbolConversionCache=new Map,this._symbols=new Map,this._graphicsWithoutSymbol=new Map,this._graphicsWaitingForSymbol=new Map,this._graphicsUpdateId=0,this._frameTaskHandle=le.nu,this._dataUpdateQueue=new Xt.T,this._updateQueue=new Xt.T,this._focusAreasGraphicsQueue=new T.A,this._suspendSymbolCleanup=!1,this._arcadeOnDemand=null,this._rendererChangeAbortController=null,this._elevationInfoChangeAbortController=null,this._initializeAbortController=null,this._elevationAlignment=null,this._scaleVisibility=null,this._filterVisibility=null,this._spatialIndex=null,this.extentPadding=0,this._updatingPendingLoadedGraphicsChange=null,this._featureStore=null,this._deconflictor=null,this._labeler=null,this._objectStates=null,this._viewElevationProvider=null,this._stageLayerElevationProvider=null,this._whenGraphics3DGraphicRequests={},this._pendingUpdates=new Map,this._numberOfGraphics=0,this._numberOfGraphicsProvidingElevation=0,this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1,this._loadingSymbols=0,this.compressionTracker=new ei,this._symbolWarningLogged=!1,this._geometryWarningLogged=!1,this._objectIdInvisibleSet=new Set,this._whenSymbolRemoved=new M.A,this.preferredUpdatePolicy=1,this._forcedUpdatePolicy=null,this.elevationFeatureExpressionEnabled=!0,this.owner=null,this.layer=null,this.graphicSymbolSupported=!0,this.getRenderingInfoWithoutRenderer=!1,this.setUidToIdOnAdd=!0,this.hasZ=null,this.hasM=null,this._usedMemory=0,this._visible=!1,this._startCreateGraphics=!1,this._unusedSymbolsCache=e.owner.view.resourceController.memoryController.newCache("graphics-3d-unused-symbols",e=>e.destroy()),this.symbolCreationContext=new be(e.owner.view.resourceController.scheduler,(e,t)=>this._updateQueue.push(e,t),e.owner.layerViewUid,this.compressionTracker)}initialize(){var e,t,i,r,s,n,o;this._featureStore=new ye({objectIdField:null===(e=this.owner.layer)||void 0===e?void 0:e.objectIdField,hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:e=>this.graphics3DGraphics.forEach(e)});const l=(e,t,i)=>this.spatialIndex.queryGraphicUIDsInExtent(e,t,i),{componentFactories:h}=this;this._elevationAlignment=null===(t=h.elevationAlignment)||void 0===t?void 0:t.call(h,this,l),this._scaleVisibility=null===(i=h.scaleVisibility)||void 0===i?void 0:i.call(h,this,l),this._filterVisibility=null===(r=h.filterVisibility)||void 0===r?void 0:r.call(h,{featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:e=>this.modifyGraphics3DGraphicVisibilities(t=>t.setVisibilityFlag(1,4,e((0,Y.RW)(t.graphic,this._objectIdField)))),setAllFeaturesVisibility:e=>this.modifyGraphics3DGraphicVisibilities(t=>t.setVisibilityFlag(1,4,e)),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities(e=>e.setVisibilityFlag(1,4,!0))}),this._deconflictor=null===(s=h.deconflictor)||void 0===s?void 0:s.call(h,this),this._labeler=null===(n=h.labeler)||void 0===n?void 0:n.call(h,this,this._scaleVisibility),this._objectStates=null===(o=h.objectStates)||void 0===o?void 0:o.call(h,this),this._initializeAbortController=new AbortController,this.addHandles((0,a.z7)(()=>this.owner.view.state.highlights,()=>{const{highlightOrderMap:e}=this.owner.view.state;this.graphics3DGraphics.forEach(t=>t.updateHighlights(e))})),this._initializePromise=this._initializeAsync()}async _initializeAsync(){var e,t,i;const r=null===(e=this._initializeAbortController)||void 0===e?void 0:e.signal,s=this.owner.view;this._viewElevationProvider=new he(this._viewSpatialReference,s),this._initializeStage(s,this.owner.layerViewUid);const n=s.sharedSymbolResources;this.symbolCreationContext.sharedResources=n,null!=this.currentRenderer&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=n.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=s.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.graphicsCoreOwner=this.owner,this.symbolCreationContext.localOriginFactory=new Wt.g(s.renderSpatialReference),this.symbolCreationContext.elevationProvider=s.elevationProvider,this.symbolCreationContext.notifyGraphicGeometryChanged=e=>this.notifyGraphicGeometryChanged(e),this.symbolCreationContext.notifyGraphicVisibilityChanged=e=>this.notifyGraphicVisibilityChanged(e);const o=(0,S.MF)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);if(this.symbolCreationContext.featureExpressionInfoContext=await(0,S.q6)(o,this._viewSpatialReference,r,h.A.getLogger(this)),(0,u.Te)(r),this.symbolCreationContext.screenSizePerspectiveEnabled=(0,qt.tl)(this.layer.screenSizePerspectiveEnabled),this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!(null===(t=this.owner.view.qualitySettings)||void 0===t||!t.physicallyBasedRenderingEnabled),this.symbolCreationContext.skipHighSymbolLods=!(null===(i=this.owner.view.qualitySettings)||void 0===i||null===(i=i.graphics3D)||void 0===i||!i.skipHighSymbolLods),"drapeSourceType"in this.owner){const{owner:e}=this;this.symbolCreationContext.drapeSourceRenderer=s.overlayManager.registerGeometryDrapeSource(e)}this.addHandles([(0,a.wB)(()=>this.suspendedOrOutsideOfView,()=>this._updateQueue.unshift(()=>this._updateLayerVisibility(),null).catch(u.QZ)),(0,a.wB)(()=>{var e;return(0,qt.tl)(null===(e=this.layer)||void 0===e?void 0:e.screenSizePerspectiveEnabled)},e=>{e!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=e,this._screenSizePerspectiveEnabledChange())}),(0,a.wB)(()=>this.owner.slicePlaneEnabled,e=>this._slicePlaneEnabledChange(!!e)),(0,a.wB)(()=>{var e;return null===(e=this.owner.view.state)||void 0===e?void 0:e.rasterPixelRatio},()=>this._pixelRatioChange()),(0,a.wB)(()=>{var e;return!(null===(e=this.owner.view.qualitySettings)||void 0===e||!e.physicallyBasedRenderingEnabled)},e=>this._physicalBasedRenderingChange(e)),(0,a.wB)(()=>{var e;return!(null===(e=this.owner.view.qualitySettings)||void 0===e||null===(e=e.graphics3D)||void 0===e||!e.skipHighSymbolLods)},e=>this._skipHighSymbolLoDsChange(e)),(0,a.wB)(()=>{var e;return null===(e=this.owner.view.focusAreasView)||void 0===e?void 0:e.polygons},()=>this._updateFocusedLabels()),(0,a.wB)(()=>{var e;return null===(e=this.owner.view.map)||void 0===e?void 0:e.focusAreas.style},()=>this.recreateAllGraphicsAndSymbols()),(0,a.z7)(()=>{var e;return null===(e=s.basemapTerrain)||void 0===e?void 0:e.tilingScheme},e=>{if(e.spatialReference.equals(this.symbolCreationContext.overlaySR)||null==s.basemapTerrain.spatialReference||(this.symbolCreationContext.overlaySR=s.basemapTerrain.spatialReference),this.hasHandles("loaded-graphics"))this.recreateAllGraphics();else{const e=()=>{var e;return null===(e=this.owner)||void 0===e?void 0:e.loadedGraphics};this.addHandles([(0,a.on)(e,"change",e=>{this._graphicsCollectionChanged(e),this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics(),this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")}},{initial:!0}),(0,a.wB)(()=>this.effectiveUpdatePolicy,e=>{null!=this.stageLayer&&(this.stageLayer.updatePolicy=e),this.symbolCreationContext.isAsync=0===this.effectiveUpdatePolicy,1===e&&this.runTask(le.Bb)},a.pc)]),this._frameTaskHandle=s.resourceController.scheduler.registerTask(le.W6.GRAPHICS_CORE,this),this.layer&&"featureReduction"in this.layer&&this.addHandles((0,a.wB)(()=>this.layer.featureReduction,()=>{var e;return null===(e=this._deconflictor)||void 0===e?void 0:e.featureReductionChange()})),this.notifyChange("averageSymbolComplexity"),this.rendererChange(this.owner.renderer).catch(()=>{}),this._initializeAbortController=null}_abortInitialize(){this._initializeAbortController=(0,n.DC)(this._initializeAbortController)}_updateFocusedLabels(){this._focusAreasGraphicsQueue.clear(),this.forEachGraphics3DSymbol((e,t)=>{t&&e.needsUpdateFocus&&t.forEach(e=>{this._focusAreasGraphicsQueue.push(e)})})}destroy(){if(this._unusedSymbolsCache.destroy(),this._abortInitialize(),this._rendererChangeAbortController=(0,n.DC)(this._rendererChangeAbortController),this._abortElevationInfoChange(),this._frameTaskHandle.remove(),this._frameTaskHandle=le.nu,this._dataUpdateQueue.cancelAll(),this._updateQueue.cancelAll(),this._deconflictor=(0,n.xt)(this._deconflictor),this._labeler=(0,n.xt)(this._labeler),this._elevationAlignment=(0,n.pR)(this._elevationAlignment),this._scaleVisibility=(0,n.pR)(this._scaleVisibility),this._filterVisibility=(0,n.pR)(this._filterVisibility),this._objectStates=(0,n.pR)(this._objectStates),this.clear(),"drapeSourceType"in this.owner){const{owner:e}=this;this.stage.view.overlayManager.unregisterDrapeSource(e)}this._featureStore=(0,n.pR)(this._featureStore),this._updatingPendingLoadedGraphicsChange=(0,n.xt)(this._updatingPendingLoadedGraphicsChange),this._graphicStateTracking=(0,n.pR)(this._graphicStateTracking),this.stage&&(this.stageLayer=(0,n.pR)(this.stageLayer),this.stage=null),this._set("owner",null);for(const e in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[e].reject(new s.A("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null,this._propertiesPool=(0,n.pR)(this._propertiesPool),this._whenSymbolRemoved.prune(),this._symbolConversionCache.clear(),this._objectIdInvisibleSet.clear(),this._spatialIndex=(0,n.pR)(this._spatialIndex),this._symbolMaterials=null}clear(){var e,t,i,r;null!==(e=this._objectStates)&&void 0!==e&&e.allGraphicsDeleted(),null!=this._graphicStateTracking&&this._graphicStateTracking.allGraphicsDeleted(),this.graphics3DGraphics.forEach(e=>e.destroy()),null!==(t=this._spatialIndex)&&void 0!==t&&t.clear(),this.graphics3DGraphics.clear(),this._numberOfGraphics=0,this._usedMemory=0,this._updateLayerVisibility(),this._symbols.forEach(n.pR),this._symbols.clear(),this._symbolMaterials&&(this._symbolMaterials.length=0,this._symbolMaterials=null),this._graphicsBySymbol.clear(),this._graphicsWithoutSymbol.clear(),this._graphicsWaitingForSymbol.clear(),this._pendingUpdates.clear(),this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1,this.notifyChange("dataUpdating"),this.notifyChange("readyToRun"),this.notifyChange("updatingRemaining"),this._featureStore.events.emit("changed"),null===(i=(r=this.owner).notifyContentGeometryUpdate)||void 0===i||i.call(r)}_initializeStage(e,t){this.stage=e.stage,this.stageLayer=new Qt.x(this.stage,{visible:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},t);const i=this.stageLayer.events;i.on("transformationChanged",e=>this.notifyGraphicGeometryChanged(e.graphicUid)),i.on("shaderTransformationChanged",e=>this.notifyGraphicGeometryChanged(e.graphicUid)),i.on("visibilityChanged",e=>this.notifyGraphicVisibilityChanged(e.graphicUid)),i.on("geometryAdded",e=>this.notifyGraphicGeometryChanged(e.object.graphicUid)),i.on("geometryRemoved",e=>this.notifyGraphicGeometryChanged(e.object.graphicUid)),i.on("attributesChanged",e=>(0,Vt.b)(e.attribute)&&this.notifyGraphicGeometryChanged(e.object.graphicUid))}notifyGraphicGeometryChanged(e){var t,i;if(null!==(t=(i=this.owner).notifyContentGeometryUpdate)&&void 0!==t&&t.call(i),null==this._graphicStateTracking||null==e)return;const r=this.graphics3DGraphics.get(e);r&&this._graphicStateTracking.updateGraphicGeometry(r)}notifyGraphicVisibilityChanged(e){var t,i;if(null!==(t=(i=this.owner).notifyContentGeometryUpdate)&&void 0!==t&&t.call(i),null==this._graphicStateTracking||null==e)return;const r=this.graphics3DGraphics.get(e);r&&this._graphicStateTracking.updateGraphicVisibility(r)}_updateLayerVisibility(){const e=this.displayFeatureLimit.maximumNumberOfFeatures,t=this._numberOfGraphics>e*li,i=!this.suspendedOrOutsideOfView&&!t;i!==this._visible&&(this._visible=i,this._updateStageLayerVisibility())}_updateStageLayerVisibility(){var e,t;const i=this._visible&&(null==this.layer.opacity||this.layer.opacity>=Xe.Q);this.stageLayer.visible!==i&&(this.stageLayer.visible=i,i?this.updateGraphicsVisibilities():this._hideAllGraphics(),null===(e=(t=this.owner).notifyContentGeometryUpdate)||void 0===e||e.call(t))}getGraphics3DGraphicById(e){return null!=e?this.graphics3DGraphics.get(e):void 0}getGraphics3DGraphicByObjectId(e){var t;return null!==(t=this.owner.layer)&&void 0!==t&&t.objectIdField?this._findGraphics3DGraphicByObjectId(e):null}_getGraphicObjectID(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null===(t=this.owner.layer)||void 0===t?void 0:t.objectIdField;return(0,Y.RW)(e,i)}get graphics3DGraphicsByObjectID(){var e;const t=null===(e=this.owner.layer)||void 0===e?void 0:e.objectIdField;if(!t)return;const i=new Map;return this.graphics3DGraphics.forEach(e=>{if(!e)return;const r=e.graphic,s=this._getGraphicObjectID(r,t);null!=s&&i.set(s,e)}),i}get labelsEnabled(){var e;return!(null===(e=this._labeler)||void 0===e||!e.layerLabelsEnabled())}async updateLabelingInfo(e){var t,i;const r=null===(t=this._deconflictor)||void 0===t?void 0:t.labelingInfoChange(e),s=null===(i=this._labeler)||void 0===i?void 0:i.labelingInfoChange(e);await Promise.allSettled([r,s])}updateVisibilityInfo(){var e,t;null!==(e=this._deconflictor)&&void 0!==e&&e.labelingInfoChange(),null===(t=this._labeler)||void 0===t||t.visibilityInfoChange()}get symbolUpdateType(){if(this._pendingUpdates.size>0)return"unknown";let e=!1,t=!1;for(const[i,r]of this._symbols)if(null!=r)switch(r.getFastUpdateStatus()){case 3:return"unknown";case 1:this._graphicsBySymbol.has(i)&&(t=!0);break;case 0:this._graphicsBySymbol.has(i)&&(e=!0);break;case 2:this._graphicsBySymbol.has(i)&&(t=e=!0)}return t?e?"mixed":"fast":e?"slow":"mixed"}runTask(e){if(this._dataUpdateQueue.runTask(e),this._updateQueue.runTask(e),this._applyPendingUpdates(e),this._applyFocusAreasUpdates(e),this.notifyChange("readyToRun"),this.readyToRun||this.notifyChange("dataUpdating"),this.notifyChange("updatingRemaining"),!e.hasProgressed)return ri.G}setObjectIdVisibility(e,t){t?this._objectIdInvisibleSet.delete(e):this._objectIdInvisibleSet.add(e);const i=this._findGraphics3DGraphicByObjectId(e);null!=i&&this._updateUserVisibility(i)}_findGraphics3DGraphicByObjectId(e){return(0,D.$n)(this.graphics3DGraphics,t=>this._getGraphicObjectID(t.graphic)===e)}_updateUserVisibility(e){if(null==e)return!1;const t=e.graphic,i=this._getGraphicObjectID(t),r=t.visible&&!this.owner.suspended&&this.stageLayer.visible&&(null==i||!this._objectIdInvisibleSet.has(i));return e.setVisibilityFlag(1,1,r)}_whenGraphics3DGraphic(e){const t=this.graphics3DGraphics.get(e.uid);if(t)return Promise.resolve(t);const i=this._whenGraphics3DGraphicRequests[e.uid];if(i)return i.promise;const r=(0,u.Tw)();return this._whenGraphics3DGraphicRequests[e.uid]=r,r.promise}async _boundsForGraphics3DGraphic(e,t){const i=this._viewSpatialReference,r=this.owner.view.renderSpatialReference,s=this.owner.view.basemapTerrain.spatialReference,n=this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:null!=t&&!!t.useViewElevation,minDemResolution:null!=t?t.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null,a=await e.getProjectedBoundingBox((e,t,s)=>(0,Z.projectBuffer)(e,r,t,e,i,t,s),(e,t,r)=>(0,Z.projectBuffer)(e,s,t,e,i,t,r),n,null===t||void 0===t?void 0:t.signal);if(!a)return null;const o=a.boundingBox;if(a.requiresDrapedElevation){const e=this.symbolCreationContext.elevationProvider;if(e){var l;(0,N.gX)(o,si);const t=null!==(l=e.getElevation(si[0],si[1],0,i,"ground"))&&void 0!==l?l:0;o[2]=Math.min(o[2],t),o[5]=Math.max(o[5],t)}}return{boundingBox:o,screenSpaceObjects:a.screenSpaceObjects}}async whenGraphicBounds(e,t){var i;await(0,a.C_)(()=>{var e;return null===(e=this.owner)||void 0===e?void 0:e.loadedGraphics});const r=null===(i=this.owner.layer)||void 0===i?void 0:i.objectIdField,n=this.owner.loadedGraphics.find(t=>t===e||null!=r&&null!=t.attributes&&e.attributes&&t.attributes[r]===e.attributes[r]);if(!n)throw new s.A("internal:graphic-not-part-of-view","Graphic is not part of this view");const o=await this._whenGraphics3DGraphic(n);return this._boundsForGraphics3DGraphic(o,t)}computeAttachmentOrigin(e,t){const i=this.graphics3DGraphics.get(e.uid);if(!i)return null;const r=i.computeAttachmentOrigin();if(0===r.render.num&&0===r.draped.num)return null;(0,U.j)(hi,0,0,0);let s=0;if(r.render.num>0){if(!(0,k.F)(r.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,di,t))return null;(0,U.g)(hi,hi,di),s++}if(r.draped.num>0){var n;const[e,i]=r.draped.origin,a=null!==(n=this._viewElevationProvider.getElevation(e,i,"ground"))&&void 0!==n?n:0;if((0,U.j)(di,e,i,a),!(0,k.F)(di,this._viewElevationProvider.spatialReference,di,t))return null;(0,U.g)(hi,hi,di),s++}return s>1&&(0,U.h)(hi,hi,1/s),new j.A({x:hi[0],y:hi[1],z:hi[2],spatialReference:t})}getSymbolLayerSize(e,t){const i=this._symbols.get(e.id);if(null==i)throw new s.A("internal:symbol-not-part-of-view","Symbol is not part of this view");const r=e.symbolLayers.indexOf(t);if(-1===r)throw new s.A("internal:missing-symbol-layer","Symbol layer is not in symbol");const n=i.getSymbolLayerSize(r);if(null==n)throw new s.A("internal:missing-size","Symbol layer has no valid size");return n}_graphicsCollectionChanged(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))}graphicUpdateHandler(e){const t=e.graphic.uid,i=this.graphics3DGraphics.get(t);if(null!=i||null!=this._graphicsWithoutSymbol.get(t)){var r,s;switch(e.property){case"visible":this._graphicUpdateVisibleHandler(i);break;case"geometry":this._graphicUpdateGeometryHandler(i,e.graphic);break;case"symbol":this._graphicUpdateSymbolHandler(i,e);break;case"attributes":{const t=this.symbolCreationContext.featureExpressionInfoContext;(null===t||void 0===t?void 0:t.arcade)&&this._graphicUpdateGeometryHandler(i,e.graphic)}break;case"popupTemplate":break;case"origin-transform":this._graphicUpdateTransformHandler(i,e)}null===(r=(s=this.owner).notifyContentGeometryUpdate)||void 0===r||r.call(s)}}_graphicUpdateGeometryHandler(e,t){this._graphicUpdateGeometryOrTransformHandler(e,t,()=>{var t,i,r;return!(null==e||!e.graphics3DSymbol.updateGeometry(e)||null!==(t=null===(i=this._labeler)||void 0===i?void 0:i.updateGraphicGeometry(e))&&void 0!==t&&!t)&&(null!==(r=this._labeler)&&void 0!==r&&r.setDirty(),!0)});const i=t.geometry;null!=i&&this._expandComputedExtent(i)}_graphicUpdateTransformHandler(e,t){const i=t.graphic.geometry;this._graphicUpdateGeometryOrTransformHandler(e,t.graphic,()=>null!=t.newValue&&null!=e&&null!=i&&e.graphics3DSymbol.updateTransform(e,i.spatialReference,t.newValue,t.action))}_graphicUpdateGeometryOrTransformHandler(e,t,i){if(null!=t.geometry){if(null==e){var r;const e=null===(r=t.symbol)||void 0===r?void 0:r.id;if(e){const t=this._symbols.get(e);if(null!=t&&0===t.loadStatus)return}return void this._recreateGraphic(t)}i()||this._recreateGraphic(e.graphic)}else this._recreateGraphic(t)}_graphicUpdateSymbolHandler(e,t){const i=t.graphic,r=null!=e?e.graphics3DSymbol:null!=t.oldValue?this._symbols.get(t.oldValue.id):null;if(null==r||null==t.newValue)return void this._recreateGraphic(i);const s=r.symbol,n=this._getConvertedSymbol(t.newValue);if(null!=n&&(n.type!==s.type||"web-style"===n.type)||"web-style"===s.type)return void this._recreateGraphic(i);const a=this._graphicsBySymbol.get(s.id);if(a&&1!==a.size)return void this._recreateGraphic(i);const o=(0,G.Ui)(s,n);if(null==o)return void this._updateSymbolMapping(s.id,n);const l={diff:o,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(r.prepareSymbolPatch(l),!(0,G.Im)(l.diff))return void this._recreateGraphic(i);const h=this._getRenderingInfo(i,!1);if(null==h)return void this._recreateGraphic(i);const d=r.extentPadding;for(const c of l.symbolStatePatches)c();if(d!==r.extentPadding&&this._recomputeExtentPadding(),null!=e)for(const c of l.graphics3DGraphicPatches)c(e,h);this._updateSymbolMapping(s.id,n)}_graphicUpdateVisibleHandler(e){var t,i;this._updateUserVisibility(e)&&(null!==(t=this._labeler)&&void 0!==t&&t.setDirty(),null===(i=this._deconflictor)||void 0===i||i.setDirty())}recreateGraphics(e){this._suspendSymbolCleanup=!0,this.remove(e),this.add(e),this._suspendSymbolCleanup=!1,1===this.effectiveUpdatePolicy&&this._cleanupSymbols()}_recreateGraphic(e){this.recreateGraphics([e])}_beginGraphicUpdate(e){const t=this._graphicsUpdateId;return this._graphicsUpdateId++,this._graphicsWaitingForSymbol.set(e.uid,t),1===this._graphicsWaitingForSymbol.size&&this.notifyChange("dataUpdating"),t}_endGraphicUpdate(e,t){var i;e&&(t&&null!==(i=this._graphicStateTracking)&&void 0!==i&&i.updateGraphicError(e,t),this._graphicsWaitingForSymbol.delete(e.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating")))}_recomputeExtentPadding(){let e=0;this._symbols.forEach(t=>{null!=t&&(e=Math.max(e,t.extentPadding))}),this._set("extentPadding",e)}_expandComputedExtent(e){const t=ni,i=e.spatialReference;(0,Y.w9)(e,t);const r=this._viewSpatialReference,s=ii.tmpVec;if((0,q.aI)(i,r)||(0,H.L)(t[0],t[1],0,i,s,r)&&(t[0]=s[0],t[1]=s[1],(0,H.L)(t[3],t[4],0,i,s,r),t[3]=s[0],t[4]=s[1]),!(isFinite(t[0])&&isFinite(t[3])&&isFinite(t[1])&&isFinite(t[4])))return;const n=this.computedExtent;let a=null;const o=isFinite(t[2])&&isFinite(t[5]),l=o&&(null==(null===n||void 0===n?void 0:n.zmin)||t[2]<n.zmin),h=o&&(null==(null===n||void 0===n?void 0:n.zmax)||t[5]>n.zmax);n?(t[0]<n.xmin||t[1]<n.ymin||t[3]>n.xmax||t[4]>n.ymax||l||h)&&(a=this._propertiesPool.get("computedExtent"),a.xmin=Math.min(t[0],n.xmin),a.ymin=Math.min(t[1],n.ymin),a.xmax=Math.max(t[3],n.xmax),a.ymax=Math.max(t[4],n.ymax),a.spatialReference=r):(a=this._propertiesPool.get("computedExtent"),a.xmin=t[0],a.ymin=t[1],a.xmax=t[3],a.ymax=t[4],a.spatialReference=r),a&&(l&&(a.zmin=t[2]),h&&(a.zmax=t[5]),this._set("computedExtent",a))}_abortElevationInfoChange(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),this._elevationInfoChangeAbortController=null)}async elevationInfoChange(){var e,t;this._abortElevationInfoChange();const i=new AbortController;this._elevationInfoChangeAbortController=i;const r=(0,S.MF)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await(0,S.q6)(r,this._viewSpatialReference,i.signal,h.A.getLogger(this)),(0,u.Te)(i.signal),this._elevationInfoChangeAbortController=null,null!==(e=this._labeler)&&void 0!==e&&e.elevationInfoChange(),this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("elevationInfo",t)?null===t||void 0===t||t.forEach(e=>{const t=e.graphic,i=e.labelLayers;for(const r of i)r.graphics3DSymbolLayer.graphics3DGraphicLayerElevationInfoChanged(t,r)}):this._recreateSymbol(i)}),this.updateStageLayerElevationProvider(),null===(t=this._elevationAlignment)||void 0===t||t.elevationInfoChange()}updateStageLayerElevationProvider(){this._stageLayerElevationProvider?(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=(0,n.pR)(this._stageLayerElevationProvider)):(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&this._numberOfGraphicsProvidingElevation>0&&(this._stageLayerElevationProvider=new zt({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register(2,this._stageLayerElevationProvider))}_clearSymbolsAndGraphics(){var e,t,i,r;this.clear(),null!=this._filterVisibility&&this._filterVisibility.clear(),null!==(e=this._labeler)&&void 0!==e&&e.reset(),null!==(t=this._deconflictor)&&void 0!==t&&t.clear(),null!==(i=this._elevationAlignment)&&void 0!==i&&i.clear(),null!==(r=this.stageLayer)&&void 0!==r&&r.invalidateSpatialQueryAccelerator(),this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=(0,n.pR)(this._stageLayerElevationProvider))}startCreateGraphics(){this._startCreateGraphics=!0,this.recreateAllGraphics()}recreateAllGraphics(){this._recreateAllGraphics(!1)}recreateAllGraphicsAndSymbols(){this._recreateAllGraphics(!0)}_recreateAllGraphics(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._startCreateGraphics)return;const{loadedGraphics:i,view:r}=this.owner,s=null!==(e=r.basemapTerrain)&&void 0!==e&&e.tilingScheme&&null!==i&&void 0!==i&&i.length?i.toArray():null;!t&&s||this._clearSymbolsAndGraphics(),this.symbolCreationContext.screenSizePerspectiveEnabled=(0,qt.tl)(this.layer.screenSizePerspectiveEnabled),this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this._set("computedExtent",null),s&&(t?this.add(s):this.recreateGraphics(s))}_recreateSymbol(e){const t=this._graphicsBySymbol.get(e),i=[];t&&(t.forEach((e,t)=>{var r,s,n;const a=e.usedMemory;this._conditionalRemove(e,t),null!==(r=this._spatialIndex)&&void 0!==r&&r.remove(e),i.push(e.graphic),e.destroy(),this._removeGraphics3DGraphic(t,a),this._updateLayerVisibility(),this._featureStore.events.emit("changed"),null===(s=(n=this.owner).notifyContentGeometryUpdate)||void 0===s||s.call(n)}),this._graphicsBySymbol.set(e,new Map));const r=this._symbols.get(e);(0,n.pR)(r),this._symbols.delete(e),this._symbolMaterials=null,(0,n.pR)(this._unusedSymbolsCache.pop(e)),this.add(i)}_recreateGraphicsForSymbol(e){const t=this._graphicsBySymbol.get(e);if(t){const e=[];t.forEach(t=>e.push(t.graphic)),this.recreateGraphics(e)}}_conditionalRemove(e,t){var i,r,s;this._graphicsDrapedUids.delete(t),null!==(i=this._objectStates)&&void 0!==i&&i.removeGraphic(e),null!==(r=this._labeler)&&void 0!==r&&r.removeGraphic(e),null!==(s=this._deconflictor)&&void 0!==s&&s.removeGraphic(e),null!=this._graphicStateTracking&&this._graphicStateTracking.removeGraphic(e)}add(e){var t;e&&0!==e.length&&(null!==(t=this.owner.view.basemapTerrain)&&void 0!==t&&t.tilingScheme?(0===this._updatePolicyForGraphics(e)?this._addDelayed(e):this._addImmediate(e),this.notifyChange("dataUpdating")):h.A.getLogger(this).error("#add()","Cannot add graphics before terrain surface has been initialized"))}_updatePolicyForGraphics(e){if(1===this.effectiveUpdatePolicy&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const t of e)if(null!=t.geometry&&"mesh"===t.geometry.type&&!t.geometry.loaded)return 0;return this.effectiveUpdatePolicy}_addImmediate(e){var t,i;this._geometryWarningLogged=!1,this._symbolWarningLogged=!1;for(const r of e)this._addGraphic(r,this._getRenderingInfo(r),1);this._cleanupSymbols(),null!==(t=this._labeler)&&void 0!==t&&t.setDirty(),null===(i=this._deconflictor)||void 0===i||i.setDirty()}_addDelayed(e){for(const i of e){var t;const e=i.uid;let r=this._pendingUpdates.get(e);r?r.add?0!==r.state&&(null===(t=r.abortController)||void 0===t||t.abort()):this._pendingAdds++:(r=new oi,this._pendingAdds++,this._pendingUpdates.set(e,r)),r.add=i}this.notifyChange("readyToRun"),this.notifyChange("updatingRemaining"),this.notifyChange("dataUpdating")}remove(e){0===this.effectiveUpdatePolicy?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("dataUpdating")}_removeImmediate(e){var t,i;for(const r of e)this._removeGraphic(r);this._cleanupSymbols(),null!==(t=this._labeler)&&void 0!==t&&t.setDirty(),null===(i=this._deconflictor)||void 0===i||i.setDirty()}_removeDelayed(e){for(const i of e){var t;const e=i.uid,r=this._pendingUpdates.get(e);if(r)r.add&&(r.remove?r.add=null:this._pendingUpdates.delete(e),1===r.state&&null!==(t=r.abortController)&&void 0!==t&&t.abort(),this._pendingAdds--);else{const t=new oi;t.remove=i,this._pendingUpdates.set(e,t),this._pendingRemoves++,this._applyPendingRemovesFirst=!0}}0===this._pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("readyToRun"),this.notifyChange("updatingRemaining"),this.notifyChange("dataUpdating")}_finishPendingUpdates(){this._cleanupSymbols(),(this._pendingAdds||this._pendingRemoves)&&h.A.getLogger(this).warn("pendingAdds/Removes in inconsistent state!"),this._pendingAdds=0,this._pendingRemoves=0,this._applyPendingRemovesFirst=!1}_applyFocusAreasUpdates(e){for(;this._focusAreasGraphicsQueue.length>0&&!e.done;){var t,i;e.madeProgress();const r=this._focusAreasGraphicsQueue.pop(),s=(0,Ae.ZX)(r.graphic.geometry);if(null==s)continue;const n=null===(t=null===(i=this.stage.view.focusAreasView)||void 0===i?void 0:i.containsGeometry(s))||void 0===t||t;r.layers.forEach(e=>{e.stageObject&&e.stageObject.geometries.some(e=>e.material instanceof Yt.R&&e.material.parameters.isFocused!==n)&&this.recreateGraphics([r.graphic])})}0===this._focusAreasGraphicsQueue.length&&this.notifyChange("readyToRun")}_applyPendingUpdates(e){var t;if(this._geometryWarningLogged=!1,this._symbolWarningLogged=!1,0===this._pendingUpdates.size&&null!==(t=this._spatialIndex)&&void 0!==t&&t.updating)return this._spatialIndex.update(),void e.madeProgress();if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const[t,i]of this._pendingUpdates){if(e.done){this._applyPendingRemovesFirst=!0;break}if(i.remove&&!i.add&&(this._pendingRemoves--,e.madeProgress(),this._removeGraphic(i.remove),i.remove=null,this._pendingUpdates.delete(t),0===this._pendingRemoves))break}}for(const[i,r]of this._pendingUpdates){if(e.done)break;r.add&&0===r.state&&this._processPendingUpdateNew(r);let t=this.effectiveUpdatePolicy;if(!r.remove||r.add&&2!==r.state||(this._pendingRemoves--,e.madeProgress(),this._removeGraphic(r.remove),r.remove=null,t=1),r.add)switch(r.state){case 2:this._addGraphic(r.add,r.renderingInfo,t),r.add=null,this._pendingAdds--,e.madeProgress();break;case 3:r.add=null,this._pendingAdds--}null==r.remove&&null==r.add&&this._pendingUpdates.delete(i)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("readyToRun"),this.notifyChange("dataUpdating"))}_processPendingUpdateNew(e){if(!e.add)return void(e.state=2);const t=e.add.geometry;null==t||"mesh"!==t.type||t.loaded?this._processPendingUpdateNewRenderingInfo(e):this._processPendingUpdateNewMesh(e,t)}async _processPendingUpdateNewMesh(e,t){e.state=1,e.abortController=new AbortController;const i=e.abortController.signal;try{await t.load({signal:i})}catch(r){return this._processPendingUpdateNewError(e,r)}e.abortController=null,this._processPendingUpdateNewRenderingInfo(e)}_processPendingUpdateNewError(e,t){e.abortController=null,(0,u.zf)(t)?e.state=0:e.state=3}async _processPendingUpdateNewRenderingInfo(e){var t;if(null==this.layer.renderer||"dictionary"!==this.layer.renderer.type)return e.renderingInfo=this._getRenderingInfo(e.add),void(e.state=2);e.state=1,e.abortController=new AbortController;let i=null;try{i=await this._getRenderingInfoAsync(e.add,{signal:e.abortController.signal})}catch(r){return e.abortController=null,void((0,u.zf)(r)?e.state=0:e.state=3)}null==(null===(t=i)||void 0===t?void 0:t.symbol)?(this._symbolWarningLogged||(this._symbolWarningLogged=!0,h.A.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," has no symbol and will not render"))),e.renderingInfo=null):e.renderingInfo=i,e.state=2}_addGraphic(e,t,i){if(this._graphicsWithoutSymbol.set(e.uid,e),null==(null===t||void 0===t?void 0:t.symbol)||!(0,Y.N3)(e))return;const r=this.stage.renderView.olidRenderHelper;if(r&&this.setUidToIdOnAdd){var s;const t=(0,K.sG)(this.owner.view,this.owner.layerViewUid);r.setUidToObjectAndLayerId(e.objectId,e.uid,this.layer.id,this.owner.layerViewUid,(0,Q.K0)(this.layer)&&!!this.layer.popupEnabled&&!t&&(0,$t.d0)(this.layer,null===(s=this.owner.view.popup)||void 0===s?void 0:s.defaultPopupTemplateEnabled))}const n=t.symbol,a=this.getOrCreateGraphics3DSymbol(n,t.renderer);if(null==a)return;this._expandComputedExtent(e.geometry);const o=this._beginGraphicUpdate(e),l=new me(e,t,this.layer);let h=!1;const d=e=>{e===a.symbol.id&&(h=!0)};this._whenSymbolRemoved.push(d);const c=()=>{var t,i,r;if(--this._loadingSymbols,!this.destroyed){if(this._whenSymbolRemoved.removeUnordered(d),this._graphicsWaitingForSymbol.get(e.uid)!==o||h||a.destroyed||this.graphicSymbolSupported&&e.symbol&&e.symbol.id!==a.symbol.id)--a.referenced,this._cleanupSymbols();else{const t=this._createGraphics3DGraphic(a,l);this._spatialIndex&&null!=t&&this._spatialIndex.add(t),--a.referenced,this._endGraphicUpdate(e)}this._featureStore.events.emit("changed"),null!==(t=(i=this.owner).notifyContentGeometryUpdate)&&void 0!==t&&t.call(i),null===(r=this._labeler)||void 0===r||r.setDirty()}},p=t=>{--this._loadingSymbols,this.destroyed||(this._whenSymbolRemoved.removeUnordered(d),h||((0,u.zf)(t)?this.add([e]):a.destroyed||this._endGraphicUpdate(e,t)))};++this._loadingSymbols,0===i?a.load(()=>this._dataUpdateQueue.push(c,null).catch(u.QZ),e=>this._dataUpdateQueue.push(()=>p(e),null).catch(u.QZ)):a.load(c,p)}_removeGraphic(e){const t=e.uid,i=this.graphics3DGraphics.get(t);if(i){var r,s,n,a;i.graphics3DSymbol.onRemoveGraphic(i);const e=i.usedMemory,o=i.isElevationSource;this._conditionalRemove(i,t),null===(r=this._spatialIndex)||void 0===r||r.remove(i);const l=i.graphics3DSymbol.symbol.id;null!==(s=this._graphicsBySymbol.get(l))&&void 0!==s&&s.delete(t),this._graphicsWithoutSymbol.delete(t),this._removeGraphics3DGraphic(t,e,o),i.destroy(),this._featureStore.events.emit("changed"),null===(n=(a=this.owner).notifyContentGeometryUpdate)||void 0===n||n.call(a)}else this._graphicsWithoutSymbol.delete(t),this._graphicsWaitingForSymbol.delete(t),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("dataUpdating"))}_hasLabelingContext(e){if(e instanceof te.A||e instanceof ie.A){const t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some(t=>t.symbol===e)}return!1}_hasValidSymbolCreationContext(e){return!(e instanceof te.A&&!this._hasLabelingContext(e))||(h.A.getLogger(this).error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1)}_getRenderingInfo(e){var t;let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const r=e.geometry;if(null==r)return i&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,h.A.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," has no geometry and will not render"))),null;if(!(0,B.canProjectWithoutEngine)(r.spatialReference,this._viewSpatialReference))return i&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,h.A.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," has incompatible spatial reference and will not render"))),null;if(!this.graphicSymbolSupported&&null!=e.symbol)return i&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,h.A.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," is not allowed to have a symbol, use a renderer instead"))),null;const s=this.rendererHasGeometryOperations?(0,A.wP)(e,this.layer,null):e;let n;if(this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||null!=this.currentRenderer))n=this.owner.getRenderingInfo(s,this.currentRenderer,this._arcadeOnDemand);else{const e=s.symbol||(0,se.dX)(s.geometry);n=new J.$(null,e)}return null==(null===(t=n)||void 0===t?void 0:t.symbol)?(i&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,h.A.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," has no symbol and will not render"))),null):n}_getRenderingInfoAsync(e,t){if(null==e.geometry)return this._geometryWarningLogged||(this._geometryWarningLogged=!0,h.A.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," has no geometry and will not render"))),null;if(!this.graphicSymbolSupported&&null!=e.symbol)return this._symbolWarningLogged||(this._symbolWarningLogged=!0,h.A.getLogger(this).warn("Graphic in layer ".concat(this.layer.id," is not allowed to have a symbol, use a renderer instead"))),null;const i=this.rendererHasGeometryOperations?(0,A.wP)(e,this.layer,null):e;return this.owner.getRenderingInfoAsync(i,this.currentRenderer,this._arcadeOnDemand,t)}_createGraphics3DSymbol(e,t){if(!this._hasValidSymbolCreationContext(e))return null;const i=this._getConvertedSymbol(e);if(!i)return null;let r;if(null!=t&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){const e=(0,ne.t)(t.backgroundFillSymbol,{ignoreDrivers:!0});null!=e.symbol&&(r=e.symbol.symbolLayers)}const s=function(e,t,i){return"point-3d"===e.type?new Et(e,t,i):new xt(e,t,i)}(i,this.symbolCreationContext,r);return s.load(()=>{const e=s.extentPadding;e>this.extentPadding&&this._set("extentPadding",e),this.notifyChange("averageSymbolComplexity")},()=>{}),s}getOrCreateGraphics3DSymbol(e,t){let i=this._symbols.get(e.id);if(void 0===i){const r=this._unusedSymbolsCache.pop(e.id);i=null!=r?r:e instanceof re.A?new Ot(e,e=>this._dataUpdateQueue.push(e,null),e=>this._createGraphics3DSymbol(e,t)):this._createGraphics3DSymbol(e,t),this._symbols.set(e.id,i),this._symbolMaterials=null}return null!=i&&++i.referenced,i}trackGraphicState(e){return null==this._graphicStateTracking&&(this._graphicStateTracking=new It(this)),this._graphicStateTracking.add(e)}_addGraphics3DGraphic(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this._numberOfGraphics++,e.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}_removeGraphics3DGraphic(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._usedMemory-=t,this.graphics3DGraphics.delete(e),this._numberOfGraphics--,i&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider()),this._updateLayerVisibility()}_createGraphics3DGraphic(e,t){var i,r,s;const{graphic:n}=t;if(this._graphicsWithoutSymbol.delete(n.uid),!this._symbols.has(e.symbol.id))return this.add([n]),null;if(this.graphics3DGraphics.has(n.uid))return null;const a=e.createGraphics3DGraphic(t);if(null==a)return null;this._addGraphics3DGraphic(a);const o=e.symbol.id;if(this._graphicsBySymbol.has(o)||this._graphicsBySymbol.set(o,new Map),this._graphicsBySymbol.get(o).set(n.uid,a),a.isDraped&&this._graphicsDrapedUids.add(n.uid),a.centroid=null,null!=n.geometry&&"point"!==n.geometry.type&&(a.centroid=(0,Oe.W$)(n.geometry,this._viewSpatialReference)),this._updateUserVisibility(a),null!=this._scaleVisibility&&this._scaleVisibility.updateVisibility(a),null!=this._filterVisibility){const{defaultVisibility:e}=this._filterVisibility;a.setVisibilityFlag(1,4,e),e||this._filterVisibility.reapply()}null!==(i=this._deconflictor)&&void 0!==i&&i.addGraphic(a),null!==(r=this._labeler)&&void 0!==r&&r.addGraphic(a),null!==(s=this._objectStates)&&void 0!==s&&s.addGraphic(a),a.initialize(this.stageLayer),null!=this._graphicStateTracking&&this._graphicStateTracking.addGraphic(a);const l=this._whenGraphics3DGraphicRequests[n.uid];return l&&(delete this._whenGraphics3DGraphicRequests[n.uid],l.resolve(a)),this._symbolMaterials=null,a}async rendererChange(e){if(this._rendererChangeAbortController=(0,n.DC)(this._rendererChangeAbortController),e!==this.currentRenderer)if(this._validateRenderer(e),null==e&&this._currentRendererChange(null,!1),(0,X.l)(e))if(null!==e&&void 0!==e&&e.arcadeRequired){const t=new AbortController;this._rendererChangeAbortController=t;const{arcadeUtils:i}=await this._ensureArcade();(0,u.Te)(t);const r=i.hasGeometryOperations(e);r&&(await i.enableGeometryOperations(),(0,u.Te)(t)),0===this.effectiveUpdatePolicy?await this._updateQueue.push(()=>this._currentRendererChange(e,r),t.signal):this._currentRendererChange(e,r),this._rendererChangeAbortController=null}else if(0===this.effectiveUpdatePolicy){const t=new AbortController;this._rendererChangeAbortController=t,await this._updateQueue.push(()=>this._currentRendererChange(e,!1),t.signal),this._rendererChangeAbortController=null}else this._currentRendererChange(e,!1);else this._currentRendererChange(e,!1)}async _ensureArcade(){return null==this._arcadeOnDemand?(this._arcadeOnDemand=await(0,ee.l)(),this._arcadeOnDemand):this._arcadeOnDemand}_currentRendererChange(e,t){var i;this.currentRenderer=e,this.rendererHasGeometryOperations=t,this.symbolCreationContext.arcade=this._arcadeOnDemand;const r=this.symbolCreationContext.renderer;if(e===r)return;if(this._symbolConversionCache.clear(),this._unusedSymbolsCache.clear(),null==e)return this.symbolCreationContext.renderer=null,void this.recreateAllGraphicsAndSymbols();const s=(0,G.Ui)(r,e);this._updateUnchangedSymbolMappings(s,e,r),this.symbolCreationContext.renderer=e,null!=s&&("complete"===s.type?this.recreateAllGraphicsAndSymbols():"partial"===s.type&&(this._applyRendererDiff(s,e,r)?null===(i=this._labeler)||void 0===i||i.reset():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}_diffHasSymbolChange(e){for(const t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"uniqueValueGroups":case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1}_applySymbolSetDiff(e,t,i){var r,s;e=e||[],t=t||[];const n=[];for(const a of t){const t=this._graphicsBySymbol.get(a.id);t&&t.forEach((r,s)=>{const o=r.graphic,l=this.layer instanceof O.A?this.layer:null,h=this._arcadeOnDemand;if(a===i.defaultSymbol&&i.getSymbol((0,A.wP)(o,l,null),{arcade:h})===i.defaultSymbol)return;const d=r.usedMemory;e.length||i.defaultSymbol?n.push(o):this._graphicsWithoutSymbol.set(s,o);const c=this.graphics3DGraphics.get(s);this._conditionalRemove(c,s),r.destroy(),t.delete(s),this._removeGraphics3DGraphic(s,d),this._updateLayerVisibility()}),this._whenSymbolRemoved.forAll(e=>e(a.id))}(e.length||n.length)&&(this._graphicsWithoutSymbol.forEach(e=>n.push(e)),this._graphicsWithoutSymbol.clear(),this.add(n)),this._cleanupSymbols(),null!==(r=this._labeler)&&void 0!==r&&r.setDirty(),null===(s=this._deconflictor)||void 0===s||s.setDirty()}_applyUniqueValueRendererDiff(e,t,i){const r=e.diff.defaultSymbol,s=e.diff.uniqueValueInfos;if(r||s){const n=null===s||void 0===s?void 0:s.changed,a=null===s||void 0===s?void 0:s.unchanged;if(n&&a&&n.some(e=>a.some(t=>{var i,r;return(null===(i=t.oldValue.symbol)||void 0===i?void 0:i.id)===(null===(r=e.oldValue.symbol)||void 0===r?void 0:r.id)})))return!1;const o=s?s.added.map(e=>e.symbol).filter(L.Ru):[],l=s?s.removed.map(e=>e.symbol).filter(L.Ru):[];if(n)for(let e=0;e<n.length;e++)o.push(n[e].newValue.symbol),l.push(n[e].oldValue.symbol);return r?(i.defaultSymbol&&l.push(i.defaultSymbol),t.defaultSymbol&&o.push(t.defaultSymbol)):i.defaultSymbol&&o.length&&l.push(t.defaultSymbol),this._applySymbolSetDiff(o,l,t),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1}_calculateUnchangedSymbolMapping(e,t,i){if("unique-value"!==(null===t||void 0===t?void 0:t.type)||"unique-value"!==(null===i||void 0===i?void 0:i.type)||null!=e&&"partial"!==e.type)return[];const r=e=>null!=e?e.id:null,s=e&&e.diff,n=null===s||void 0===s?void 0:s.defaultSymbol,a=s&&s.uniqueValueInfos;let o;if(a)o=a.unchanged.map(e=>({oldId:r(e.oldValue.symbol),newId:r(e.newValue.symbol)}));else{o=[];for(const e of null!==(l=i.uniqueValueInfos)&&void 0!==l?l:[]){var l,h;const i=r(e.symbol),s=null===(h=t.uniqueValueInfos)||void 0===h?void 0:h.find(t=>t.value===e.value);s&&i!==r(s.symbol)&&o.push({oldId:i,newId:r(s.symbol)})}}return!n&&i.defaultSymbol&&o.push({oldId:r(i.defaultSymbol),newId:r(t.defaultSymbol)}),o}_updateSymbolMapping(e,t){const i=null!=t&&t?"string"==typeof t?t:t.id:null;if(null==e||e===i)return;const r=this._graphicsBySymbol.get(e);this._graphicsBySymbol.delete(e),void 0!==r&&this._graphicsBySymbol.set(i,r);const s=this._symbols.get(e);if(void 0!==s&&(this._symbols.delete(e),this._symbols.set(i,s),this._symbolMaterials=null,null!=s)){const e="string"==typeof t?null:t;null!=e?s.symbol=e:s.symbol.id=i}}_updateUnchangedSymbolMappings(e,t,i){const r=this._calculateUnchangedSymbolMapping(e,t,i);for(const{oldId:s,newId:n}of r)this._updateSymbolMapping(s,n)}_applyRendererDiff(e,t,i){if(this._diffHasSymbolChange(e))return!1;if(t instanceof $.A&&i instanceof $.A&&this._applyUniqueValueRendererDiff(e,t,i)&&0===Object.keys(e.diff).length)return!0;for(const r of this._graphicsBySymbol.keys()){const i=this._symbols.get(r);if(null!=i)switch(i.applyRendererDiff(e,t)){case 0:this._recreateSymbol(r);break;case 1:this._recreateGraphicsForSymbol(r)}}return!0}opacityChange(){this._updateStageLayerVisibility(),this.forEachGraphics3DSymbol((e,t)=>e.globalPropertyChanged("opacity",t))}_screenSizePerspectiveEnabledChange(){var e,t;this.forEachGraphics3DSymbol((e,t)=>e.globalPropertyChanged("screenSizePerspectiveEnabled",t)),null!==(e=this._labeler)&&void 0!==e&&e.screenSizePerspectiveEnabledChanged(),null===(t=this._deconflictor)||void 0===t||t.screenSizePerspectiveEnabledChanged()}_slicePlaneEnabledChange(e){var t,i;e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.sliceable=e,this.forEachGraphics3DSymbol((e,t)=>e.globalPropertyChanged("slicePlaneEnabled",t)),null!==(t=this._deconflictor)&&void 0!==t&&t.slicePlaneEnabledChange(),null===(i=this._labeler)||void 0===i||i.slicePlaneEnabledChange())}_physicalBasedRenderingChange(e){this.symbolCreationContext.physicalBasedRenderingEnabled=e,this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("physicalBasedRenderingEnabled",t)||this._recreateSymbol(i)})}_skipHighSymbolLoDsChange(e){this.symbolCreationContext.skipHighSymbolLods=e,this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("skipHighSymbolLods",t)||this._recreateSymbol(i)})}_pixelRatioChange(){this.forEachGraphics3DSymbol((e,t,i)=>{e.globalPropertyChanged("pixelRatio",t)||this._recreateSymbol(i)})}_signalUpdatingDuringAsyncLoadedGraphicsChange(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=(0,V._)(()=>{this._updatingPendingLoadedGraphicsChange=null})}setClippingExtent(e,t){const i=this.symbolCreationContext.clippingExtent,r=(0,W.vt)();return function(e,t,i){if(null==e||null==i)return!1;let r=!0;return Nt[0]=null!=e.xmin?e.xmin:0,Nt[1]=null!=e.ymin?e.ymin:0,Nt[2]=null!=e.zmin?e.zmin:0,r=r&&(0,Z.projectBuffer)(Nt,e.spatialReference,0,Nt,i,0),t[0]=Nt[0],t[1]=Nt[1],Nt[0]=null!=e.xmax?e.xmax:0,Nt[1]=null!=e.ymax?e.ymax:0,Nt[2]=null!=e.zmax?e.zmax:0,r=r&&(0,Z.projectBuffer)(Nt,e.spatialReference,0,Nt,i,0),t[2]=Nt[0],t[3]=Nt[1],null==e.xmin&&(t[0]=-1/0),null==e.ymin&&(t[1]=-1/0),null==e.xmax&&(t[2]=1/0),null==e.ymax&&(t[3]=1/0),r}(e,r,t)?this.symbolCreationContext.clippingExtent=(0,N.Jt)((0,N.vt)(),r):this.symbolCreationContext.clippingExtent=null,!(0,N.aI)(this.symbolCreationContext.clippingExtent,i)}modifyGraphics3DGraphicVisibilities(e){var t,i;if(this.destroyed)return;let r=!1;this.graphics3DGraphics.forEach(t=>{e(t)&&(r=!0)}),r&&(null!==(t=this._labeler)&&void 0!==t&&t.setDirty(),null===(i=this._deconflictor)||void 0===i||i.setDirty())}forEachGraphics3DSymbol(e,t){for(const[i,r]of this._symbols){if(null==r)return;e(r,this._graphicsBySymbol.get(i)||ci,i)}if(null===t||void 0===t||!t.excludeUnused)for(const i of this._unusedSymbolsCache)e(i,void 0,i.symbol.id)}updateGraphicsVisibilities(){null!=this._filterVisibility&&this._filterVisibility.reapply(),this.modifyGraphics3DGraphicVisibilities(e=>{var t;const i=this._updateUserVisibility(e),r=!(null===(t=this._scaleVisibility)||void 0===t||!t.updateVisibility(e));return i||r})}_hideAllGraphics(){this.modifyGraphics3DGraphicVisibilities(e=>e.setVisibilityFlag(1,1,!1))}_validateRenderer(e){var t;const i=()=>"'".concat(this.layer.title?"".concat(this.layer.title,", "):"","id:").concat(this.layer.id,"'"),r=(0,X.b)(e,{geometryType:null===(t=this.layer)||void 0===t?void 0:t.geometryType,logWarning:(e,t)=>h.A.getLogger(this).warn(e,"Symbology conversion for layer ".concat(i(),": ").concat(t))});if(r){const e="Renderer for layer ".concat(i," is not supported in a SceneView");h.A.getLogger(this).warn(e,r.message)}}_cleanupSymbols(){if(this._graphicsWaitingForSymbol.size>0||this._suspendSymbolCleanup)return;let e=!1;this._symbols.forEach((t,i)=>{if(null==t||t.referenced>0)return;const r=this._graphicsBySymbol.get(i);r&&0!==r.size||(this._graphicsBySymbol.delete(i),this._symbols.delete(i),this._symbolMaterials=null,this._unusedSymbolsCache.put(i,t,F.Ti),e=!0)}),e&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}get test(){}get performanceInfo(){return new At(this.graphics3DGraphics.size,Array.from(this.graphics3DGraphics.values()).reduce((e,t)=>e+(t.isVisible()?1:0),0),this._graphicsWithoutSymbol.size,this._pendingUpdates.size)}},ii=ti,ti.tmpVec=(0,y.vt)(),ti);(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"computedExtent",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"currentRenderer",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"rendererHasGeometryOperations",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_frameTaskHandle",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_dataUpdateQueue",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_updateQueue",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"_viewSpatialReference",null),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_rendererChangeAbortController",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_elevationInfoChangeAbortController",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_initializeAbortController",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_elevationAlignment",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_scaleVisibility",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_filterVisibility",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_initializePromise",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_spatialIndex",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"extentPadding",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_updatingPendingLoadedGraphicsChange",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_featureStore",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_objectStates",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_loadingSymbols",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"compressionTracker",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"preferredUpdatePolicy",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_forcedUpdatePolicy",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"effectiveUpdatePolicy",null),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"elevationFeatureExpressionEnabled",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"owner",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"layer",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"graphicSymbolSupported",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"getRenderingInfoWithoutRenderer",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"componentFactories",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"setUidToIdOnAdd",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"featureStore",null),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"initializePromise",null),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"scaleVisibility",null),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"elevationAlignment",null),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"objectStates",null),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"filterVisibility",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"updating",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"dataUpdating",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"readyToRun",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"suspendedOrOutsideOfView",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0,dependsOn:[]})],ai.prototype,"updatingRemaining",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ai.prototype,"displayFeatureLimit",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0,dependsOn:[]})],ai.prototype,"averageSymbolComplexity",null),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"hasZ",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],ai.prototype,"hasM",void 0),(0,r.Cg)([(0,o.MZ)()],ai.prototype,"_objectIdField",null),ai=ii=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.graphics.Graphics3DCore")],ai);class oi{constructor(){this.add=null,this.renderingInfo=null,this.state=0,this.abortController=null,this.remove=null}clear(){this.add=null,this.renderingInfo=null,this.state=0,this.abortController=null,this.remove=null}}const li=10,hi=(0,y.vt)(),di=(0,y.vt)(),ci=new Map;class ui{constructor(){this._extents=new M.A({allocator:e=>e||(0,W.vt)()}),this._tmpExtent=(0,W.vt)(),this._dirty=!1}destroy(){this._extents.prune()}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(e){this._contains(e)||(this._removeContained(e),(0,W.C)(this._extents.pushNew(),e),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(e){return this._mergeTight(e),e.hasProgressed}_mergeTight(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:le.Bb;const t=this._extents,i=new Set;let r=0;for(;r!==t.length;){t.sort((e,t)=>e[0]-t[0]),r=t.length,i.clear();for(let r=0;r<t.length;++r){if(e.done)return;const s=t.at(r);if(s){for(let e=r+1;e<t.length;++e){const r=t.at(e);if(null==r||r[0]>=s[2])break;i.add(r)}i.forEach(r=>{if(s===r)return;if(r[2]<=s[0])return void i.delete(r);const n=(0,W.Wc)(s),a=(0,W.Wc)(r),o=this._tmpExtent;(0,W.fT)(s,r,o);const l=n+a;((0,W.Wc)(o)-l)/l<.05&&((0,W.C)(s,o),i.delete(r),t.remove(r),e.madeProgress())}),i.add(s)}}}this._dirty=!1}_contains(e){return this._extents.some(t=>(0,W.gR)(t,e))}_removeContained(e){this._extents.filterInPlace(t=>!(0,W.gR)(e,t))}get test(){}}let pi=class extends P.A{constructor(e){super(e),this._dirtyExtents=new ui,this._globalDirty=!1,this._averageExtentUpdateSize=0,this._dirtyGraphicsSet=new Set,this._updateElevation=!1,this.graphicsCoreOwner=null,this.graphicsCore=null,this.events=new de.bk}initialize(){var e;const t=this.elevationProvider,i=this.graphicsCoreOwner.view.resourceController.scheduler;this._task=i.registerTask(gi(null===(e=this.graphicsCore.layer.elevationInfo)||void 0===e?void 0:e.mode),this),this.addHandles([t.on("elevation-change",e=>this._elevationChanged(e)),(0,a.wB)(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),this._task,(0,a.wB)(()=>{var e;return gi(null===(e=this.graphicsCore.layer.elevationInfo)||void 0===e?void 0:e.mode)},e=>this._task.priority=e)])}destroy(){this._dirtyGraphicsSet.clear(),this.graphicsCoreOwner=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null,this.elevationProvider=null,this._dirtyExtents.destroy()}clear(){this._dirtyGraphicsSet.clear(),this.notifyChange("updating")}_suspendedChange(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))}elevationInfoChange(){this._globalDirty=!0,this.notifyChange("updating")}get updating(){return this.readyToRun}get readyToRun(){return this._dirtyGraphicsSet.size>0||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}get updatingRemaining(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}runTask(e){for(this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,e.madeProgress()),e.run(()=>this._dirtyExtents.merge(e));this.readyToRun&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.notifyChange("updating")}_updateDirtyGraphics(e){const t=this.graphicsCoreOwner.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy;for(const s of this._dirtyGraphicsSet.keys()){var r;const n=this.graphicsCore.getGraphics3DGraphicById(s);if(this._dirtyGraphicsSet.delete(s),null!=n&&(n.alignWithElevation(this.elevationProvider,t,i),null!==(r=this.graphicsCore.deconflictor)&&void 0!==r&&r.setDirty(),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this._dirtyExtents.empty&&!e.done;){const t=this._dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:t,spatialReference:i});const r=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);null!=t&&t.needsElevationUpdates()&&this._dirtyGraphicsSet.add(e)}),this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-r)+.9*this._averageExtentUpdateSize,e.madeProgress()}}_markAllGraphicsElevationDirty(){this._dirtyExtents.clear(),this._dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((e,t)=>this._dirtyGraphicsSet.add(t))}_elevationChanged(e){if("scene"===e.context&&(!this.graphicsCore.layer.elevationInfo||"relative-to-scene"!==this.graphicsCore.layer.elevationInfo.mode))return;const t=e.extent;if(this.graphicsCoreOwner.suspended){if(!this._updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this._updateElevation=!0)}this.events.emit("invalidate-elevation",e)}else t[0]===-1/0?this._globalDirty=!0:this._dirtyExtents.add(t),this.notifyChange("updating")}};function gi(e){return null==e?le.W6.ELEVATION_ALIGNMENT:"relative-to-scene"===e?le.W6.ELEVATION_ALIGNMENT_SCENE:le.W6.ELEVATION_ALIGNMENT}(0,r.Cg)([(0,o.MZ)()],pi.prototype,"graphicsCoreOwner",void 0),(0,r.Cg)([(0,o.MZ)()],pi.prototype,"graphicsCore",void 0),(0,r.Cg)([(0,o.MZ)()],pi.prototype,"queryGraphicUIDsInExtent",void 0),(0,r.Cg)([(0,o.MZ)()],pi.prototype,"elevationProvider",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],pi.prototype,"updating",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],pi.prototype,"updatingRemaining",null),pi=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],pi);var yi=i(34111),vi=i(4212),mi=i(15941),bi=i(34761),fi=i(13191),_i=i(5809),Ci=i(44230),Si=i(13927),wi=i(95925);function xi(e,t,i,r){return Oi(e,t,i,Gi(r,t,i,!0))}const Pi={dir:(0,y.vt)(),len:0,clip:(0,gt.vt)()};function Gi(e,t,i,r){const s=Pi;return e?(i&&r&&(s.len=(0,U.k)(t,i)),(0,U.d)(s.dir,e)):r?(s.len=(0,U.k)(t,i),(0,U.e)(s.dir,i,t),(0,U.h)(s.dir,s.dir,1/s.len)):((0,U.e)(s.dir,i,t),(0,U.n)(s.dir,s.dir)),s}function Ei(e,t,i){const r=(0,U.f)((0,Si.Qj)(e),i.dir),s=-(0,Si.mN)(e,t);if(s<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return s>0;if((s<0||r<0)&&!(s<0&&r<0))return!0;const n=s/r;return r>0?n<i.clip[1]&&(i.clip[1]=n):n>i.clip[0]&&(i.clip[0]=n),i.clip[0]<=i.clip[1]}function Oi(e,t,i,r){r.clip[0]=0,r.clip[1]=i?r.len:Number.MAX_VALUE;for(let s=0;s<e.length;s++)if(!Ei(e[s],t,r))return!1;return!0}const Ai=.5*Math.PI,Ii=Ai/Math.PI*180;class Ri{constructor(e){this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:(0,y.vt)(),direction:(0,y.vt)()},this._renderCoordsHelper=e.renderCoordsHelper;for(let t=0;t<4;t++)this._extent[t]={origin:(0,y.vt)(),direction:(0,y.vt)(),cap:{next:null,direction:(0,y.vt)()}},this._planes[t]=(0,Si.vt)();this._planes[4]=(0,Si.vt)(),this._planes[5]=(0,Si.vt)(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,t,i){let r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const s=this._extent;this._toRenderBoundingExtent(e,t,i),(0,U.g)(this._center.origin,s[0].origin,s[2].origin),(0,U.h)(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),r||(0,U.h)(this._center.direction,this._center.direction,-1);for(let n=0;n<4;n++){const e=s[n];this._renderCoordsHelper.worldUpAtPosition(e.origin,e.direction);const t=s[3===n?0:n+1];e.cap.next=t.origin,(0,U.E)(e.cap.direction,e.origin,t.origin),(0,Si.mR)(e.direction,e.cap.direction,e.origin,this._planes[n]),r||(0,U.h)(e.direction,e.direction,-1)}(0,Si.mR)(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[4]),r?(0,Si.ze)(this._planes[4],this._planes[5]):((0,Si.C)(this._planes[5],this._planes[4]),(0,Si.ze)(this._planes[4],this._planes[4])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=t,this._minGlobalAltitude=.9*(0,yi.tO)(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e)return!1;if(1===this._renderCoordsHelper.viewingMode){const i=this._maxSpanSpatialReference.isGeographic?Ii:Ai*t;if(this._maxSpan>i)return!0;if(null!=e.altitude&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(0===this._maxSpan){const t=this._extent[0];return!(i||!e.intersectsRay((0,wi.LV)(t.origin,t.direction)))}for(let s=0;s<this._extent.length;s++){const t=this._extent[s];if(!i&&e.intersectsRay((0,wi.LV)(t.origin,t.direction)))return!0;if(e.intersectsLineSegment((0,Ci.Cr)(t.origin,t.cap.next,Ui),t.cap.direction))return!0}const r=i?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const t=e.lines[s];if(xi(r,t.origin,t.endpoint,t.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,t,i){(0,W.gX)(e,Di),Di[2]=i,(0,_i.l)(t,Di,Fi,this._renderCoordsHelper.spatialReference),(0,bi.B8)(Mi,Fi),(0,N.Ie)(Ti);for(const{x0:r,x1:s,y0:n,y1:a}of Li)for(let o=0;o<5;o++){const l=o/4;Di[0]=(0,mi.Cc)(e[r],e[s],l),Di[1]=(0,mi.Cc)(e[n],e[a],l),Di[2]=i,(0,k.F)(Di,t,Di,this._renderCoordsHelper.spatialReference),(0,U.t)(Di,Di,Mi),(0,N.iT)(Ti,Di)}(0,U.j)(this._extent[0].origin,Ti[0],Ti[1],Ti[2]),(0,U.j)(this._extent[1].origin,Ti[3],Ti[1],Ti[2]),(0,U.j)(this._extent[2].origin,Ti[3],Ti[4],Ti[2]),(0,U.j)(this._extent[3].origin,Ti[0],Ti[4],Ti[2]);for(let r=0;r<4;++r)(0,U.t)(this._extent[r].origin,this._extent[r].origin,Fi)}_toRenderBoundingExtentLocal(e,t,i){vt(e,t,Vi,this._renderCoordsHelper.spatialReference),(0,U.j)(this._extent[0].origin,Vi[0],Vi[1],i),(0,U.j)(this._extent[1].origin,Vi[2],Vi[1],i),(0,U.j)(this._extent[2].origin,Vi[2],Vi[3],i),(0,U.j)(this._extent[3].origin,Vi[0],Vi[3],i)}_toRenderBoundingExtent(e,t,i){switch(this._renderCoordsHelper.viewingMode){case 1:this._toRenderBoundingExtentGlobal(e,t,i);break;case 2:this._toRenderBoundingExtentLocal(e,t,i);break;default:(0,vi.Xb)(this._renderCoordsHelper.viewingMode)}}_isVisibleInFrustumGlobal(e){if((0,Si.mN)(e.planes[4],this._center.origin)<0&&(0,U.f)(this._center.direction,e.direction)<0)return!0;for(let t=0;t<4;t++){const i=this._extent[t];if((0,Si.mN)(e.planes[4],i.origin)<0&&(0,U.f)(i.direction,e.direction)<0)return!0}return!1}}const Li=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Di=(0,y.vt)(),Fi=(0,fi.vt)(),Mi=(0,fi.vt)(),Ti=(0,N.vt)(),Vi=(0,W.vt)(),Ui=(0,Ci.vt)();let zi=class extends P.A{constructor(e){super(e),this.suspended=!1,this._extent=null,this._extentIntersectionDirty=!0,this._isVisibleBelowSurfaceInternal=!1,this.graphicsCoreOwner=null,this.updating=!0}initialize(){const{graphicsCoreOwner:e}=this;this._extentIntersection=new Ri({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,i=t.basemapTerrain,r=t.resourceController.scheduler;this.addHandles([t.on("resize",()=>this._viewChange()),(0,a.wB)(()=>t.state.camera,()=>this._viewChange(),a.OH),r.registerTask(le.W6.FRUSTUM_VISIBILITY,this),(0,a.wB)(()=>i.visibleElevationBounds,()=>this._elevationBoundsChange())]),"local"===t.viewingMode?this._isVisibleBelowSurface=!0:this.addHandles([(0,a.wB)(()=>{var e;return[i.baseOpacity,i.wireframe,null===(e=t.map)||void 0===e||null===(e=e.ground)||void 0===e||null===(e=e.navigationConstraint)||void 0===e?void 0:e.type]},()=>this._updateIsVisibleBelowSurface(),a.Vh)])}destroy(){this._set("graphicsCoreOwner",null),this._extent=null,this._extentIntersection=null}_setDirty(){this.updating||this._set("updating",!0)}setExtent(e){this._extent=e,this._extentIntersectionDirty=!0,this._setDirty()}_viewChange(){this._setDirty()}_elevationBoundsChange(){this._setDirty(),this._extentIntersectionDirty=!0}set _isVisibleBelowSurface(e){this._isVisibleBelowSurfaceInternal=e,this._setDirty(),this._extentIntersectionDirty=!0}_updateIsVisibleBelowSurface(){var e;const t=this.graphicsCoreOwner.view,i=t.basemapTerrain,r="local"===t.viewingMode,s="none"===(null===(e=t.map.ground)||void 0===e||null===(e=e.navigationConstraint)||void 0===e?void 0:e.type);this._isVisibleBelowSurface=r||!i.opaque||s}_updateExtentIntersection(){if(!this._extentIntersectionDirty)return;this._extentIntersectionDirty=!1;const e=this.graphicsCoreOwner.view;let t;if(this._isVisibleBelowSurfaceInternal)t=-.3*(0,yi.tO)(e.spatialReference).radius;else{const{min:i,max:r}=e.basemapTerrain.visibleElevationBounds;t=i-Math.max(1,(r-i)*(1.2-1))}this._extentIntersection.update(this._extent,e.spatialReference,t)}get readyToRun(){return this.updating}runTask(e){if(this._set("updating",!1),!this._extent)return this._set("suspended",!1),ri.G;this._updateExtentIntersection();const t=this.graphicsCoreOwner.view.frustum,i=(0,yi.tO)(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(t,i)),e.madeProgress()}};(0,r.Cg)([(0,o.MZ)({readOnly:!0})],zi.prototype,"suspended",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],zi.prototype,"graphicsCoreOwner",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],zi.prototype,"updating",void 0),zi=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],zi);class ji{}class Bi extends ji{constructor(e,t){super(),this.objectStateId=e,this.object=t}remove(){this.object.removeStateID(this.objectStateId)}}class Zi extends ji{constructor(e,t,i){super(),this.objectStateId=e,this.object=t,this.owner=i}remove(){this.owner.removeRenderGeometryObjectState(this.object,this.objectStateId)}}class ki extends ji{constructor(e,t){super(),this.objectStateId=e,this._removeCallback=t,this.object=null}remove(){this._removeCallback(this.objectStateId)}}class Hi{constructor(){this._items=[]}addObject(e,t){this._items.push(new Bi(t,e))}addRenderGeometry(e,t,i){this._items.push(new Zi(t,e,i))}addExternal(e,t){this._items.push(new ki(t,e))}remove(e){this._remove(t=>t.objectStateId===e)}removeByObject(e){this._remove(t=>t.object===e)}removeAll(){this._items.forEach(e=>e.remove()),this._items=[]}_remove(e){const{_items:t}=this;for(let i=t.length-1;i>=0;--i){const r=t[i];e(r)&&(r.remove(),t.splice(i,1))}}}class Ni extends Hi{constructor(){super(...arguments),this.stateType=1}}class Wi extends Hi{constructor(e){super(),this.highlightName=e,this.stateType=0}}class qi{constructor(e){this.objectIdField=e,this.ids=new Set,this.paused=!1}hasGraphic(e){const t=this.objectIdField?e.graphic.attributes[this.objectIdField]:e.graphic.uid;return this.ids.has(t)}}class Qi extends qi{constructor(e){super(e),this.stateType=1,this.objectStateSet=new Ni}}class Yi extends qi{constructor(e,t){super(t),this.highlightName=e,this.stateType=0,this.objectStateSet=new Wi(e)}}class $i{constructor(e){this._graphicsCore=e,this._stateSets=new Array}destroy(){this.reset(),this._stateSets=null}reset(){this._stateSets&&(this._stateSets.forEach(e=>e.objectStateSet.removeAll()),this._stateSets.length=0)}acquireOccludeeSet(e){const t=new Qi(e);this._stateSets.push(t);const i=(0,c.hA)(()=>this.releaseSet(t));return{set:t,handle:i}}acquireHighlightSet(e,t){const i=new Yi(e,t);this._stateSets.push(i);const r=(0,c.hA)(()=>this.releaseSet(i));return{set:i,handle:r}}releaseSet(e){e.objectStateSet.removeAll();const t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}setUid(e,t){e.ids.add(t);const i=this._graphicsCore.graphics3DGraphics.get(t);i&&i.addObjectStateSet(e.objectStateSet)}setUids(e,t){t.forEach(t=>this.setUid(e,t))}setObjectIds(e,t){t.forEach(t=>e.ids.add(t)),this._initializeSet(e)}addGraphic(e){this._stateSets.forEach(t=>{!t.paused&&t.hasGraphic(e)&&e.addObjectStateSet(t.objectStateSet)})}removeGraphic(e){this._stateSets.forEach(t=>{t.hasGraphic(e)&&e.removeObjectState(t.objectStateSet)})}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach(e=>e.objectStateSet.removeAll())}_initializeSet(e){const t=this._graphicsCore.graphics3DGraphics;e.objectIdField?t.forEach(t=>{t&&e.hasGraphic(t)&&t.addObjectStateSet(e.objectStateSet)}):e.ids.forEach(i=>{const r=t.get(i);r&&r.addObjectStateSet(e.objectStateSet)})}get test(){}}var Xi=i(90992);let Ji=class extends P.A{constructor(e){super(e),this._scaleRangeActive=!1,this._layerScaleRangeVisibilityQuery=!1,this._extent=null,this._updatingHandles=new E.U,this.graphicsCoreOwner=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null,this.basemapTerrain=null,this.layerScaleEnabled=!0,this.suspended=!1,this._dirty=!0}initialize(){this.updateScaleRangeActive();const e=this.graphicsCoreOwner.view.resourceController.scheduler;this.addHandles(e.registerTask(le.W6.SCALE_VISIBILITY,this)),this._updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())}destroy(){this._updatingHandles.destroy(),this.removeHandles(),this._dirty=!1,this._extent=null,this.graphicsCoreOwner=null,this.layer=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null,this.basemapTerrain=null}get updating(){return this._dirty||this._updatingHandles.updating}_setDirty(){this._dirty=!0}setExtent(e){const t=this.graphicsCoreOwner.view.spatialReference,i=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(t===i)this._extent=null!==e&&void 0!==e?e:null;else{const r=(0,W.vt)();vt(e,t,r,i)?this._extent=r:this._extent=null}this._setDirty()}scaleRangeActive(){return this._scaleRangeActive}updateScaleRangeActive(){const e=this.layer,t=e.effectiveScaleRange;let i=this.layerScaleEnabled&&null!=t&&Ki(t.minScale,t.maxScale);e.labelingInfo&&!i&&(i=e.labelingInfo.some(e=>{var t,i;return e&&Ki(null!==(t=e.minScale)&&void 0!==t?t:0,null!==(i=e.maxScale)&&void 0!==i?i:0)}));const r=this._scaleRangeActive!==i;return this._scaleRangeActive=i,i&&!this.hasHandles(er)&&this.basemapTerrain?(this.addHandles(this.basemapTerrain.on("scale-change",e=>this._scaleUpdateHandler(e)),er),this.layerScaleEnabled&&this.addHandles(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),er)):!i&&this.hasHandles(er)&&this.removeHandles(er),r}get readyToRun(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}runTask(e){const t=this.graphicsCoreOwner.view.basemapTerrain;if(this._extent&&t&&t.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return ri.G;{this._layerScaleRangeVisibilityQuery=!0;const{minScale:e,maxScale:i}=this.layer.effectiveScaleRange;t.queryVisibleScaleRange(this._extent,e,i,e=>this._finishUpdate(e))}}else this._finishUpdate(!0);e.madeProgress()}_finishUpdate(e){this._layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e),this._dirty=!1}_visibleAtLayerScale(e){const t=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||(0,Xi.JU)(e,t.minScale||0,t.maxScale||0)}_visibleAtLabelScale(e,t){return(0,Xi.JU)(e,t.minScale||0,t.maxScale||0)}_graphicScale(e){let t;return null!=e.centroid?t=e.centroid:null!=e.graphic.geometry&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(t):1:null}_graphicVisible(e){if(!this.layerScaleEnabled)return!0;const t=this._graphicScale(e);return this._visibleAtLayerScale(t)}updateVisibility(e){if(!this._scaleRangeActive)return!1;const t=this._graphicVisible(e);return e.setVisibilityFlag(1,2,t)}updateGraphicLabelScaleVisibility(e){var t,i;if(!this._scaleRangeActive)return!1;if(!e.labelLayers.length)return!1;const r=this._graphicScale(e),s=this._updateLabelScaleVisibility(e,r);return s&&(null!==(t=this.graphicsCore.deconflictor)&&void 0!==t&&t.setDirty(),null!==(i=this.graphicsCore.labeler)&&void 0!==i&&i.setDirty()),s}_updateLabelScaleVisibility(e,t){if(!e.labelLayers.length)return!1;const i=e.labelLayers[0].labelClass;if(null!=(null===i||void 0===i?void 0:i.minScale)&&null!=i.maxScale){const r=this._visibleAtLabelScale(t,i);if(e.setVisibilityFlag(16,2,r))return!0}return!1}_scaleUpdateHandler(e){var t,i;if(this._setDirty(),!this.graphicsCore.visible)return;const r=e.extent,s=e.scale,n=this._visibleAtLayerScale(s);let a=!1;const o=this.graphicsCoreOwner.view.spatialReference,l=e.spatialReference;if(null==l)return void h.A.getLogger(this).error("scaleUpdate: Internal error, no SpatialReference given for tiles");const d=!l.equals(o);if(d&&!vt(r,l,tr,o))return void h.A.getLogger(this).error("scaleUpdate: Internal error, cannot project AABR from "+l+" to wkid "+o);const c=d?tr:r;this.queryGraphicUIDsInExtent(c,o,e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);if(null==t)return;const i=t.centroid;null!=i&&(r[0]>i.x||r[1]>i.y||r[2]<i.x||r[3]<i.y)||(t.setVisibilityFlag(1,2,n)&&(a=!0),this._updateLabelScaleVisibility(t,s)&&(a=!0))}),a&&(null!==(t=this.graphicsCore.deconflictor)&&void 0!==t&&t.setDirty(),null===(i=this.graphicsCore.labeler)||void 0===i||i.setDirty())}layerMinMaxScaleChangeHandler(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(e=>e.setVisibilityFlag(1,2,!0)):this._scaleRangeActive&&this.graphicsCore.updateGraphicsVisibilities(),this._setDirty()}};function Ki(e,t){return e>0||t>0}(0,r.Cg)([(0,o.MZ)()],Ji.prototype,"graphicsCoreOwner",void 0),(0,r.Cg)([(0,o.MZ)()],Ji.prototype,"layer",void 0),(0,r.Cg)([(0,o.MZ)()],Ji.prototype,"queryGraphicUIDsInExtent",void 0),(0,r.Cg)([(0,o.MZ)()],Ji.prototype,"graphicsCore",void 0),(0,r.Cg)([(0,o.MZ)()],Ji.prototype,"basemapTerrain",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],Ji.prototype,"layerScaleEnabled",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],Ji.prototype,"suspended",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],Ji.prototype,"updating",null),(0,r.Cg)([(0,o.MZ)()],Ji.prototype,"_dirty",void 0),Ji=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],Ji);const er="terrain-events",tr=(0,W.vt)();var ir=i(19276),rr=i(85632);const sr=[];(0,c.hA)();let nr=class extends P.A{constructor(e){super(e),this.drapeSourcePriorityOffset=0,this.type="graphics-3d",this.graphicsCore=null,this.drapeSourceType=1,this.scaleVisibilityEnabled=!1,this.frustumVisibilityEnabled=!1,this._suspendResumeExtent=null,this._updatingHandles=new E.U}initialize(){const{layer:e}=this,t="effectiveScaleRange"in e?e:null,i=!(0,Xi.j)()&&this.scaleVisibilityEnabled&&null!=t,r=new ai({owner:this,layer:this.owner.layer,preferredUpdatePolicy:1,graphicSymbolSupported:!0,componentFactories:{elevationAlignment:(e,t)=>new pi({graphicsCoreOwner:this,graphicsCore:e,queryGraphicUIDsInExtent:t,elevationProvider:this.view.elevationProvider}),scaleVisibility:i?(e,i)=>new Ji({graphicsCoreOwner:this,layer:t,queryGraphicUIDsInExtent:i,graphicsCore:e,basemapTerrain:this.owner.view.basemapTerrain}):null,objectStates:e=>new $i(e)}});if(this._set("graphicsCore",r),this.frustumVisibilityEnabled&&this._set("frustumVisibility",new zi({graphicsCoreOwner:this})),"fullOpacity"in this.owner){const e=this.owner;this._updatingHandles.add(()=>e.fullOpacity,()=>this.graphicsCore.opacityChange())}if("elevationInfo"in e){const t=e;this._updatingHandles.add(()=>t.elevationInfo,(e,t)=>{(0,G.Ui)(e,t)&&this._updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())})}this._set("initializePromise",this._initializeAsync()),this._updatingHandles.addPromise(this.initializePromise)}async _initializeAsync(){try{await this.graphicsCore.initializePromise}catch(e){if((0,u.zf)(e))return;throw e}this.destroyed||(this.addHandles((0,a.wB)(()=>this.view.clippingArea,()=>this._updateClippingExtent(),a.OH)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())}destroy(){this._updatingHandles.destroy(),this._set("frustumVisibility",(0,n.pR)(this.frustumVisibility)),this._set("graphicsCore",(0,n.pR)(this.graphicsCore))}get layer(){return this.owner.layer}get layerViewUid(){return this.owner.uid}get view(){return this.owner.view}get scaleVisibility(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.scaleVisibility}get elevationAlignment(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.elevationAlignment}get scaleVisibilitySuspended(){return!(null==this.scaleVisibility||!this.scaleVisibility.suspended)}get frustumVisibilitySuspended(){return null!=this.frustumVisibility&&this.frustumVisibility.suspended}get suspended(){var e;return null!==(e=this.owner.suspended)&&void 0!==e&&e}get updating(){var e;return!!(null!==(e=this.graphicsCore)&&void 0!==e&&e.updating||null!=this.scaleVisibility&&this.scaleVisibility.updating||null!=this.frustumVisibility&&this.frustumVisibility.updating||this._updatingHandles.updating)}get graphics3DGraphics(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.graphics3DGraphics}get graphics3DGraphicsByObjectID(){var e;return null===(e=this.graphicsCore)||void 0===e?void 0:e.graphics3DGraphicsByObjectID}get loadedGraphics(){return this.owner.loadedGraphics}get fullOpacity(){var e;return null!==(e=this.owner.fullOpacity)&&void 0!==e?e:1}get slicePlaneEnabled(){return this.owner.slicePlaneEnabled}get updatePolicy(){return this.owner.updatePolicy}notifyGraphicGeometryChanged(e){this.graphicsCore.notifyGraphicGeometryChanged(e)}notifyGraphicVisibilityChanged(e){this.graphicsCore.notifyGraphicVisibilityChanged(e)}notifyContentGeometryUpdate(){var e,t;null===(e=(t=this.owner).notifyContentGeometryUpdate)||void 0===e||e.call(t)}getRenderingInfo(e,t,i){const r=(0,I.vl)(e,{renderer:t,arcade:i});if(null!==r&&void 0!==r&&r.color){const e=r.color;e[0]=e[0]/255,e[1]=e[1]/255,e[2]=e[2]/255}return r}getRenderingInfoAsync(e,t,i,r){return(0,I.LO)(e,(0,w.A)({renderer:t,arcade:i},r))}getHit(e,t){if(this.owner.loadedGraphics){const i=this.owner.loadedGraphics.find(t=>t.uid===e);if(i){const e=this.layer instanceof O.A?this.layer:null,r=(0,A.wP)(i,e,t);return{type:"graphic",graphic:r,layer:r.layer}}}return null}whenGraphicBounds(e,t){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(e,t):Promise.reject()}computeAttachmentOrigin(e,t){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(e,t):null}getSymbolLayerSize(e,t){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(e,t):null}maskOccludee(e){var t;const i=null===(t=this.graphicsCore)||void 0===t?void 0:t.objectStates;if(!i)return(0,c.hA)();const{set:r,handle:s}=i.acquireOccludeeSet(null);return i.setUid(r,e.uid),s}highlight(e,t){var i;const r=null===(i=this.graphicsCore)||void 0===i?void 0:i.objectStates;if(!r)return ar;const s=function(e){return ir.A.isCollection(e)?e.toArray():Array.isArray(e)?e:function(e){return"number"==typeof e||"string"==typeof e}(e)||(0,rr.DU)(e)||function(e){return"esri.views.3d.layers.i3s.PointCloudGraphic"===e.declaredClass}(e)?[e]:sr}(e);if(0===s.length)return ar;if(s[0]instanceof x.A){const e=s.map(e=>e.uid),{set:i,handle:n}=r.acquireHighlightSet(t,null);return r.setUids(i,e),n}if("number"==typeof s[0]){const e=s,{set:i,handle:n}=r.acquireHighlightSet(t,null);return r.setObjectIds(i,e),n}return ar}_setupSuspendResumeExtent(){const{scaleVisibility:e,frustumVisibility:t}=this;if(null==e&&null==t)return;const i=i=>{let{computedExtent:r,extentPadding:s}=i;this._suspendResumeExtent=(0,Oe.t8)(r,this._suspendResumeExtent,R.qD,s),null!=e&&e.setExtent(this._suspendResumeExtent),null!=t&&t.setExtent(this._suspendResumeExtent)};this.addHandles((0,a.wB)(()=>{var e,t;return{computedExtent:null===(e=this.graphicsCore)||void 0===e?void 0:e.computedExtent,extentPadding:null===(t=this.graphicsCore)||void 0===t?void 0:t.extentPadding}},e=>i(e),a.pc))}_updateClippingExtent(){const e=this.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()}};(0,r.Cg)([(0,o.MZ)()],nr.prototype,"drapeSourcePriorityOffset",void 0),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"type",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],nr.prototype,"owner",void 0),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"layer",null),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"layerViewUid",null),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"view",null),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],nr.prototype,"graphicsCore",void 0),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"scaleVisibility",null),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],nr.prototype,"frustumVisibility",void 0),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"elevationAlignment",null),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"scaleVisibilitySuspended",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],nr.prototype,"frustumVisibilitySuspended",null),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"suspended",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],nr.prototype,"updating",null),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"loadedGraphics",null),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"fullOpacity",null),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"slicePlaneEnabled",null),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"drapeSourceType",void 0),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"updatePolicy",null),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],nr.prototype,"scaleVisibilityEnabled",void 0),(0,r.Cg)([(0,o.MZ)({constructOnly:!0})],nr.prototype,"frustumVisibilityEnabled",void 0),(0,r.Cg)([(0,o.MZ)()],nr.prototype,"initializePromise",void 0),nr=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.graphics.GraphicsProcessor")],nr);const ar=(0,c.hA)();const or={candidates:[],sourceCandidateIndices:[]};class lr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this.usedMemory=e,this.displayedFeatures=t,this.totalFeatures=i,this.maximumFeatures=r,this.nodes=s,this.core=n}}var hr=i(91196),dr=i(1898),cr=i(53963);let ur=class extends(g(hr.A)){constructor(){super(...arguments),this.type="graphics-3d",this.symbologySnappingSupported=!0,this._slicePlaneEnabled=!1,this.fullExtentInLocalViewSpatialReference=null,this.ignoresMemoryFactor=!0}get highlightOptions(){return null}initialize(){this._set("processor",new nr({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0})),this.addResolvingPromise(this.processor.initializePromise),this.addHandles(this.layer.on("graphic-update",e=>this.processor.graphicsCore.graphicUpdateHandler(e))),this.layer.internal?this.notifyChange("updating"):("local"===this.view.viewingMode&&this.addResolvingPromise((async()=>this.fullExtentInLocalViewSpatialReference=await(0,cr.n)(this.layer.fullExtent,this.view.spatialReference))()),this.addHandles((0,a.z7)(()=>{var e;return null===(e=this.view)||void 0===e||null===(e=e.basemapTerrain)||void 0===e?void 0:e.ready},()=>()=>this.notifyChange("updating"),{once:!0})))}destroy(){this._updatingHandles.removeAll(),this._set("processor",(0,n.pR)(this.processor))}get loadedGraphics(){return this.layer.graphics}get legendEnabled(){var e;return this.canResume()&&!(null!==(e=this.processor)&&void 0!==e&&e.frustumVisibilitySuspended)}get visibleAtCurrentScale(){var e;return(0,Xi.j)()?(0,Xi.E5)(this.layer.effectiveScaleRange,this.view.scale):!(null!==(e=this.processor)&&void 0!==e&&e.scaleVisibilitySuspended)}get slicePlaneEnabled(){const e=this.layer.internal;return this._slicePlaneEnabled&&!e}set slicePlaneEnabled(e){this._slicePlaneEnabled=e}getSuspendInfo(){var e,t;const i=super.getSuspendInfo();return i.outsideOfView=null!==(e=null===(t=this.processor)||void 0===t?void 0:t.frustumVisibilitySuspended)&&void 0!==e&&e,i}getHit(e){return this.processor.getHit(e,null)}whenGraphicBounds(e,t){return this.processor.whenGraphicBounds(e,t)}computeAttachmentOrigin(e,t){var i;return null===(i=this.processor)||void 0===i?void 0:i.computeAttachmentOrigin(e,t)}getSymbolLayerSize(e,t){return this.processor.getSymbolLayerSize(e,t)}queryGraphics(){return Promise.resolve(this.loadedGraphics)}maskOccludee(e){return this.processor.maskOccludee(e)}highlight(e,t){return this.processor.highlight(e,(0,dr.i)(t))}notifyContentGeometryUpdate(){this.emit("visible-geometry-changed")}async elevationAlignPointsInFeatures(e,t){const{processor:i}=this;if(null==(null===i||void 0===i?void 0:i.graphics3DGraphics))throw new s.A("graphicslayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");const{graphics3DGraphics:r}=i;return async function(e,t,i,r,s){var n;const{elevationProvider:a,renderCoordsHelper:o}=e,{elevationInfo:l}=t,{pointsInFeatures:h,spatialReference:d}=r,c=v.A.fromJSON(d),p=(0,S.MF)(l,!0),g=await(0,S.q6)(p,c,s);(0,u.Te)(s);const w=[],x=new Set,P=new Set,G=new C.F,E=(0,b.TH)(0,0,0,v.A.WGS84),O=new _.Uk,A=(0,y.vt)();E.spatialReference=c;const I=null!==(n=e.elevationProvider.spatialReference)&&void 0!==n?n:e.spatialReference;for(const{objectId:u,points:y}of h){const e=i(u);if(null==e){for(const e of y){var R;w.push(null!==(R=e.z)&&void 0!==R?R:0)}x.add(u);continue}e.isDraped&&P.add(u);const r=e.graphic.geometry;G.setFromElevationInfo((0,f.ze)(r,l)),g&&G.updateFeatureExpressionInfoContextForGraphic(g,e.graphic,t);for(const{x:t,y:i,z:n}of y)E.x=t,E.y=i,E.z=null!==n&&void 0!==n?n:0,await(0,m.W)(E,A,I,0,{signal:s}),(0,_.sE)(A,a,G,o,O),w.push(O.z)}return{elevations:w,drapedObjectIds:P,failedObjectIds:x}}(this.view,this.layer,e=>"number"==typeof e?r.get(e):void 0,e,t)}async queryForSymbologySnapping(e,t){return async function(e,t,i){var r;if(null==e||0===t.candidates.length)return or;const s=null!==(r=e.graphics3DGraphicsByObjectID)&&void 0!==r?r:e.graphics3DGraphics,n=[],a=[],{renderer:o}=e,l=null!=o&&"arcadeRequired"in o&&o.arcadeRequired?(0,ee.l)():null,h=async(t,r)=>{let{graphic:s,graphics3DSymbol:n}=r;const a=await l,h=await e.getRenderingInfoAsync(s,o,a,{signal:i});return null==h?[]:n.queryForSnapping(t,c,h,i)},{candidates:d,spatialReference:c}=t;for(let u=0;u<d.length;++u){const e=d[u],{objectId:t}=e,i="number"==typeof t?null===s||void 0===s?void 0:s.get(t):void 0;if(null==i)continue;const{graphics3DSymbol:r}=i;r.symbologySnappingSupported&&(n.push(h(e,i)),a.push(u))}if(0===n.length)return or;const p=await Promise.all(n);(0,u.Te)(i);const g=[],y=[];for(let u=0;u<p.length;++u){const e=p[u],t=a[u];for(const i of e)g.push(i),y.push(t)}return{candidates:g,sourceCandidateIndices:y}}(this.processor,e,t)}get updatePolicy(){var e;return(null===(e=this.processor)||void 0===e?void 0:e.graphicsCore.effectiveUpdatePolicy)||1}isUpdating(){var e,t;return this.view&&this.layer&&!((null===(e=this.processor)||void 0===e||!e.updating)&&(this.layer.internal||null!==(t=this.view.basemapTerrain)&&void 0!==t&&t.ready))}get performanceInfo(){return new lr(this.usedMemory,this.loadedGraphics.length,-1,-1)}get usedMemory(){var e,t;return null!==(e=null===(t=this.processor)||void 0===t||null===(t=t.graphicsCore)||void 0===t?void 0:t.usedMemory)&&void 0!==e?e:0}get unloadedMemory(){var e;return null===(e=this.processor)||void 0===e||null===(e=e.graphicsCore)||void 0===e?void 0:e.unprocessedMemoryEstimate}get test(){return{graphics3DProcessor:this.processor,loadedGraphics:this.loadedGraphics}}};(0,r.Cg)([(0,o.MZ)()],ur.prototype,"highlightOptions",null),(0,r.Cg)([(0,o.MZ)()],ur.prototype,"loadedGraphics",null),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ur.prototype,"legendEnabled",null),(0,r.Cg)([(0,o.MZ)()],ur.prototype,"layer",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ur.prototype,"processor",void 0),(0,r.Cg)([(0,o.MZ)({readOnly:!0})],ur.prototype,"visibleAtCurrentScale",null),(0,r.Cg)([(0,o.MZ)()],ur.prototype,"_slicePlaneEnabled",void 0),(0,r.Cg)([(0,o.MZ)({type:Boolean})],ur.prototype,"slicePlaneEnabled",null),ur=(0,r.Cg)([(0,d.$)("esri.views.3d.layers.GraphicsLayerView3D")],ur);const pr=ur},24947:(e,t,i)=>{i.d(t,{UF:()=>m,Z$:()=>S});var r=i(69539),s=(i(81806),i(76460)),n=i(9392),a=i(43047),o=i(55855),l=i(5262),h=i(48989),d=i(49296),c=i(41595),u=i(36423),p=i(75646),g=i(63048),y=i(51990);const v=()=>s.A.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");class m extends p.x{constructor(e,t,i,r){let s=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];super(i.schedule),this.symbol=e,this.symbolLayer=t,this._context=i,this._drivenOpacityFallbackAlwaysOpaque=s,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1,rotation:!1},this._materials=[],this.logger=v(),this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=r.renderPriority,this._renderPriorityStep=r.renderPriorityStep,this._elevationContext=new d.F,this.updateComplexity(),this.ignoreDrivers=r.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=b(this._context.renderer,s)),this._updateElevationContext()}destroy(){this.complexity=null,this._materials.length=0,super.destroy()}get view(){return this._context.stage.view}getCachedSize(){return null}get extentPadding(){return 0}get materials(){return this._materials}get estimatedMemory(){const{complexity:e}=this;return null==e?0:(this.draped?e.memory.draped:e.memory).bytesPerFeature}get usedMemory(){return this.estimatedMemory}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const t=this._drivenProperties,i=b(e,this._drivenOpacityFallbackAlwaysOpaque);return i.color!==t.color||i.opacity!==t.opacity||i.opacityAlwaysOpaque!==t.opacityAlwaysOpaque||i.size!==t.size||i.rotation!==t.rotation}get needsDrivenTransparentPass(){return this._hasDrivenColorOrOpacity&&!this._drivenProperties.opacityAlwaysOpaque}get _hasDrivenColorOrOpacity(){return this._drivenProperties.color||this._drivenProperties.opacity}_logGeometryCreationWarnings(e,t,i,r){const s=e.projectionSuccess,n="polygons"in e?e.polygons:null,a="".concat(r," geometry failed to be created");s?!this._logGeometryValidationWarnings(t,i,r)&&n&&0===n.length&&"rings"===i&&t.length>0&&t[0].length>2&&v().warnOncePerTick("".concat(a," (filled rings should use clockwise winding - try reversing the order of vertices)")):v().warnOncePerTick("".concat(a," (failed to project geometry to view spatial reference)"))}get needsUpdateFocus(){return!1}_logGeometryValidationWarnings(e,t,i){const r="".concat(i," geometry failed to be created");return!e.length||1===e.length&&!e[0].length?(v().warnOncePerTick("".concat(r," (no ").concat(t," were defined)")),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(v().warnOncePerTick("".concat(r," (").concat(t," should be defined as a 2D array)")),!0)}_validateGeometry(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(null!=t&&!t.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+" symbol: ".concat(e.type)),!1;switch(e.type){case"point":{const t=e;if(!isFinite(t.x)||!isFinite(t.y))return v().warn("point coordinate is not a valid number, graphic skipped"),!1;break}case"polygon":(0,l.m3)(e)}return!0}_defaultElevationInfoNoZ(){return f}_defaultElevationInfoZ(){return _}_updateElevationContext(){null!=this._elevationInfoOverride?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.setFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.setFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getDefaultElevationInfo(e);return this._elevationContext.mode||t.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}createElevationContextForGraphic(e){const t=new d.F;return this.updateElevationContextForGraphic(t,e),t}updateElevationContextForGraphic(e,t){var i,r;const s=t.geometry,n=this.getDefaultElevationInfo(s);e.unit=null!=this._elevationContext.unit?this._elevationContext.unit:n.unit,e.mode=this.getGeometryElevationMode(s,n),e.offsetMeters=null!==(i=null!==(r=this._elevationContext.meterUnitOffset)&&void 0!==r?r:n.offset)&&void 0!==i?i:0;const a=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===e.mode;a&&(e.mode="relative-to-ground",e.offsetMeters=0);const o=a?c.KF:this._elevationContext.featureExpressionInfoContext;o?e.updateFeatureExpressionInfoContextForGraphic(o,t,this._context.layer):e.setFeatureExpressionInfoContext(null)}prepareSymbolLayerPatch(e){}onRemoveGraphic(e){}_getLayerOpacity(){var e;if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return null!==(e=this._context.graphicsCoreOwner.fullOpacity)&&void 0!==e?e:0;const t=this._context.layer.opacity;return null!==t&&void 0!==t?t:1}_getCombinedOpacity(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C;const i=this.draped?1:this._getLayerOpacity();return this._drivenProperties.color?i:e?i*(this._drivenProperties.opacity?1:e.a):t.hasIntrinsicColor?i:0}_getCombinedOpacityAndColor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:C;const i=this._getCombinedOpacity(e,t);if(this._drivenProperties.color)return(0,u.$C)(null,i);const s=null!=e?r.A.toUnitRGB(e):n.Un;return(0,u.$C)(s,i)}_getDrivenUInt8Color(e,t,i){var s;let{color:n,opacity:a}=e;const{color:l,opacity:h}=this._drivenProperties,d=null!==(s=r.A.toUnitRGBA(t))&&void 0!==s?s:i?o.Un:o.uY,c=l?null!==n&&void 0!==n?n:d:null,p=n||t||i,g=l?null:d[3];return(0,u.$C)(c,h&&p?null!==a&&void 0!==a?a:g:null,255)}_getDrivenUInt8ColorWithNaNSupport(e,t,i){let{color:s,opacity:n}=e;const l=t?(0,o.ci)(r.A.toUnitRGBA(t)):(0,o.fA)(NaN,NaN,NaN,i?NaN:0);return this._drivenProperties.color&&null!=s&&(0,a.d)(l,s),this._drivenProperties.opacity&&null!=n&&(l[3]=n),(0,a.c)(l,l,255),(0,y.K_)(l,l)}isFastUpdatesEnabled(){return null!=this._fastUpdates}updateComplexity(){this.complexity=this.computeComplexity()}computeComplexity(){return(0,h.JV)(this.symbol,this.symbolLayer)}globalPropertyChanged(e,t,i){switch(e){case"opacity":return this.layerOpacityChanged(t,i),!0;case"screenSizePerspectiveEnabled":return this.layerScreenSizePerspectiveChanged(t,i),!0;case"elevationInfo":{const e=this._elevationContext.mode;return this._updateElevationContext(),2!==this.layerElevationInfoChanged(t,i,e)}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,t,i){let r=1;return null!==e&&void 0!==e&&e.forEach(e=>{const s=t(e);if(null!=s){const t=e.graphic;this.updateElevationContextForGraphic(s.elevationContext,t),s.needsElevationUpdates=i(s.elevationContext.mode)}else r=2}),r}applyRendererDiff(e,t){return 0}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const t=this._fastUpdates.visualVariables,i=t.size?(0,g.ul)(t.size.field,e):0,r=t.color?(0,g.ul)(t.color.field,e):0,s=t.opacity?(0,g.ul)(t.opacity.field,e):0;return(0,o.fA)(i,r,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return null==this._draped?(this._draped=e,!0):(e!==this.draped&&v().warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>{var e,t,i,r,s,n,a,o;return{size:null!==(e=null===(t=this._fastUpdates)||void 0===t||null===(t=t.visualVariables.size)||void 0===t?void 0:t.field)&&void 0!==e?e:null,color:null!==(i=null===(r=this._fastUpdates)||void 0===r||null===(r=r.visualVariables.color)||void 0===r?void 0:r.field)&&void 0!==i?i:null,opacity:null!==(s=null===(n=this._fastUpdates)||void 0===n||null===(n=n.visualVariables.opacity)||void 0===n?void 0:n.field)&&void 0!==s?s:null,rotation:null!==(a=null===(o=this._fastUpdates)||void 0===o||null===(o=o.visualVariables.rotation)||void 0===o?void 0:o.field)&&void 0!==a?a:null}}}}}function b(e,t){const i={color:!1,opacity:!1,opacityAlwaysOpaque:t,size:!1,rotation:!1};return e&&"visualVariables"in e&&e.visualVariables&&e.visualVariables.forEach(e=>{switch(e.type){case"color":if(i.color=!0,e.stops)for(let t=0;t<e.stops.length;t++){const r=e.stops[t].color;r&&r.a<1&&(i.opacityAlwaysOpaque=!1)}break;case"opacity":i.opacity=!0,i.opacityAlwaysOpaque=!1;break;case"size":i.size=!0;break;case"rotation":i.rotation=!0}}),i}const f={mode:"on-the-ground",offset:0,unit:"meters"},_={mode:"absolute-height",offset:0,unit:"meters"},C={hasIntrinsicColor:!1},S=(0,o.fA)(NaN,NaN,NaN,NaN)},28350:(e,t,i)=>{i.d(t,{Z:()=>r});class r{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.labelText=t,this.elevationOffset=null!==e&&void 0!==e?e:0}}},28660:(e,t,i)=>{i.d(t,{B1:()=>n,VS:()=>a,an:()=>s,iW:()=>o});var r=i(81806);function s(){return(0,r.A)("curve-densification-coarse-segments")}function n(){return(0,r.A)("curve-densification-max-segments")}function a(){return(0,r.A)("curve-densification-min-segments")}function o(){return(0,r.A)("curve-densification-pixel-deviation")}},29308:(e,t,i)=>{i.d(t,{B6:()=>p,G8:()=>g,Jf:()=>v,Zd:()=>m});var r=i(34761),s=i(13191),n=i(20664),a=i(9392),o=i(5809),l=i(45308),h=i(67425),d=i(22955),c=i(80935),u=i(9612);function p(e,t,i,r,s){const n=e.stageObject,a=n.geometries;let o=0;for(const l of a){if(!(0,u.p)(l))continue;const{update:e,averageGeometrySampledElevation:a}=P(l,t,i,r,s);o+=a,e&&n.geometryVertexAttributeUpdated(l,"position")}return o/a.length}function g(e,t,i,s,a,l){const c=e.stageObject,u=t.centerInElevationSR;let p=0;s(u,x),c.usesVerticalDistanceToGround?((0,h.ai)(c,x.verticalDistanceToGround),p=x.sampledElevation):"absolute-height"!==t.mode&&(p=x.sampledElevation);const g=(0,r.C)(y,null!==l&&void 0!==l?l:c.transformation),v=(0,n.j)(w,g[12],g[13],g[14]);d.b.TESTS_DISABLE_OPTIMIZATIONS?(f[0]=u[0],f[1]=u[1],f[2]=x.z,(0,o.l)(i,f,g,a.spatialReference)&&(l?(0,r.C)(l,g):c.transformation=g)):a.setAltitudeOfTransformation(x.z,g);const m=b/a.unitInMeters;return(Math.abs(g[12]-v[0])>=m||Math.abs(g[13]-v[1])>=m||Math.abs(g[14]-v[2])>=m)&&(l?(0,r.C)(l,g):c.transformation=g),p}const y=(0,s.vt)();function v(e,t,i,r,s){const a=e.graphics3DSymbolLayer.lodRenderer;if(null==a)return 0;const l=t.centerInElevationSR;r(l,x);const h="absolute-height"!==t.mode?x.sampledElevation:0,c=a.instanceData,u=e.instanceIndex,p=S;c.getGlobalTransform(u,p);const g=(0,n.j)(w,p[12],p[13],p[14]);d.b.TESTS_DISABLE_OPTIMIZATIONS?(f[0]=l[0],f[1]=l[1],f[2]=x.z,(0,o.l)(i,f,p,s.spatialReference)&&c.setGlobalTransform(u,p)):s.setAltitudeOfTransformation(x.z,p);const y=b/s.unitInMeters;return(d.b.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(p[12]-g[0])>=y||Math.abs(p[13]-g[1])>=y||Math.abs(p[14]-g[2])>=y)&&c.setGlobalTransform(u,p),h}function m(e,t,i,r,s){const n=e.stageObject,a=n.geometries;if(0===a.length)return 0;let o=0,l=null,h=0,d=!1;for(const c of a){if(!(0,u.p)(c))continue;const e=c.attributes.get("position");if(e!==l){const{update:n,averageGeometrySampledElevation:a}=P(c,t,i,r,s);h=a,l=e,d=n}d&&n.geometryVertexAttributeUpdated(c,"position"),o+=h}return o/a.length}const b=.01,f=(0,a.vt)(),_=(0,a.vt)(),C=(0,a.vt)(),S=(0,s.vt)(),w=(0,a.vt)(),x=new h.Uk;function P(e,t,i,r,s){let n=!1;const a=e.transformation,o=t.requiresSampledElevationInfo;_[0]=a[12],_[1]=a[13],_[2]=a[14],e.invalidateBoundingInfo();const h=e.getMutableAttribute("position"),u=h.data,p=h.size,g=u.length/p,y=new c.aY(e.mapPositions,i);let v=0,m=0;for(let c=0;c<g;c++){if(C[0]=u[v],C[1]=u[v+1],C[2]=u[v+2],r(y,x),o&&(m+=x.sampledElevation),d.b.TESTS_DISABLE_OPTIMIZATIONS)u[v]=y.array[y.offset],u[v+1]=y.array[y.offset+1],u[v+2]=x.z,(0,l.projectBuffer)(u,i,v,u,s.spatialReference,v,1),u[v]-=_[0],u[v+1]-=_[1],u[v+2]-=_[2],n=!0;else{f[0]=u[v]+_[0],f[1]=u[v+1]+_[1],f[2]=u[v+2]+_[2],s.setAltitude(f,x.z),u[v]=f[0]-_[0],u[v+1]=f[1]-_[1],u[v+2]=f[2]-_[2];const e=b/s.unitInMeters;(Math.abs(C[0]-u[v])>=e||Math.abs(C[1]-u[v+1])>=e||Math.abs(C[2]-u[v+2])>=e)&&(n=!0)}v+=p,y.offset+=3}return m/=g,{update:n,averageGeometrySampledElevation:m}}},33376:(e,t,i)=>{i.d(t,{T:()=>s});var r=i(20176);const s={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new r.Om(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)}},38865:(e,t,i)=>{i.d(t,{qD:()=>s,r4:()=>n});var r=i(55855);const s=1.2,n=r.uY},40431:(e,t,i)=>{i.d(t,{L:()=>A,b:()=>E});var r,s,n,a,o,l,h,d=i(57528),c=i(19555),u=i(72745),p=i(55855),g=i(26917),y=i(98720),v=i(40318),m=i(62374),b=i(10708),f=i(69817),_=i(28450),C=i(95756),S=i(51596),w=i(58350),x=i(21390),P=i(86955),G=i(2687);function E(e){const t=new G.N5,{vertex:i,fragment:u}=t,{terrainDepthTest:E}=e;return i.include(y.K),t.include(v.Q,e),t.vertex.include(g.rA,e),t.attributes.add("uv0","vec2"),i.uniforms.add(new S.I("viewport",e=>e.camera.fullViewport),new x.m("lineSize",(e,t)=>e.size>0?Math.max(1,e.size)*t.camera.pixelRatio:0),new _.E("pixelToNDC",e=>(0,c.hZ)(O,2/e.camera.fullViewport[2],2/e.camera.fullViewport[3])),new x.m("borderSize",(e,t)=>e.borderColor?t.camera.pixelRatio:0),new C.G("screenOffset",(e,t)=>(0,c.hZ)(O,e.horizontalScreenOffset*t.camera.pixelRatio,0))),t.varyings.add("coverageSampling","vec4"),t.varyings.add("lineSizes","vec2"),E&&t.varyings.add("depth","float"),e.occlusionTestEnabled&&t.include(m.y),e.hasScreenSizePerspective&&(0,f.OH)(i),i.main.add((0,P.H)(r||(r=(0,d.A)(["\n    ProjectHUDAux projectAux;\n    vec4 endPoint = projectPositionHUD(projectAux);\n\n    vec3 vpos = projectAux.posModel;\n    if (rejectBySlice(vpos)) {\n      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n      return;\n    }\n    ","\n\n    ","\n    // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the\n    // correct depth value\n    vec3 posView = (view * vec4(position, 1.0)).xyz;\n    ","\n\n    applyHUDViewDependentPolygonOffset(centerOffsetAndDistance.w, projectAux.absCosAngle, posView);\n    vec4 startPoint = proj * vec4(posView, 1.0);\n\n    // Apply screen offset to both start and end point\n    vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;\n    startPoint.xy += screenOffsetNorm * startPoint.w;\n    endPoint.xy += screenOffsetNorm * endPoint.w;\n\n    // Align start and end to pixel origin\n    vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);\n    vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);\n    ","\n    vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);\n\n    // The direction of the line in screen space\n    vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\n    vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\n    ","\n    float halfPixelSize = lineSizeScaled * 0.5;\n\n    // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\n    float padding = 1.0 + borderSizeScaled;\n    vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\n\n    // Offset x/y from the center of the line in screen space\n    projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\n\n    // Compute a coverage varying which we can use in the fragment shader to determine\n    // how much a pixel is actually covered by the line (i.e. to anti alias the line).\n    // This works by computing two coordinates that can be linearly interpolated and then\n    // subtracted to find out how far away from the line edge we are.\n    float edgeDirection = (uv0.x * 2.0 - 1.0);\n\n    float halfBorderSize = 0.5 * borderSizeScaled;\n    float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;\n    float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\n\n    float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);\n\n    coverageSampling = vec4(\n      // Edge coordinate\n      outerEdgeCoverageSampler,\n\n      // Border edge coordinate\n      outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\n\n      // Line offset\n      halfPixelSize - 0.5,\n\n      // Border offset\n      halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\n    );\n\n    lineSizes = vec2(lineSizeScaled, borderSizeScaled);\n    gl_Position = projectedPosition;"])),(0,P.If)(e.occlusionTestEnabled,(0,P.H)(s||(s=(0,d.A)(["if (!testHUDVisibility(endPoint)) {\n             gl_Position = vec4(1e38, 1e38, 1e38, 1.0);\n             return;\n           }"])))),e.hasScreenSizePerspective?(0,P.H)(n||(n=(0,d.A)(["vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\n               vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);"]))):"vec2 screenOffsetScaled = screenOffset;",(0,P.If)(E,"depth = posView.z;"),(0,P.If)(e.hudDepth,e.hudDepthAlignStart?"endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);":"startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);"),e.hasScreenSizePerspective?(0,P.H)(a||(a=(0,d.A)(["float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\n               float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);"]))):(0,P.H)(o||(o=(0,d.A)(["float lineSizeScaled = lineSize;\n               float borderSizeScaled = borderSize;"]))))),u.uniforms.add(new w.E("uColor",e=>{var t;return null!==(t=e.color)&&void 0!==t?t:p.uY}),new w.E("borderColor",e=>{var t;return null!==(t=e.borderColor)&&void 0!==t?t:p.uY})),E&&(u.include(b.H,e),u.uniforms.add(new _.E("inverseViewport",e=>e.inverseViewport))),u.main.add((0,P.H)(l||(l=(0,d.A)(["\n    ","\n\n    vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\n\n    float borderAlpha = uColor.a * borderColor.a * coverage.y;\n    float colorAlpha = uColor.a * coverage.x;\n\n    float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);\n    ",""])),(0,P.If)(E,"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }"),(0,P.If)(!e.hudDepth,(0,P.H)(h||(h=(0,d.A)(["vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);\n           fragColor = vec4(finalRgb, finalAlpha);"])))))),t}const O=(0,u.vt)(),A=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}))},48989:(e,t,i)=>{i.d(t,{Eg:()=>p,GI:()=>b,JV:()=>m,Tf:()=>g,k9:()=>y,pg:()=>f,uD:()=>u});var r=i(89379),s=i(4212),n=i(81806),a=i(47675),o=i(64573),l=i(73177),h=i(90346),d=i(7342),c=i(65131);const u=new h.hk({});function p(e){return"web-style"===e.type?u:g(e.symbolLayers.toArray().map(t=>m(e,t)))}function g(e){let t=0,i=0,r=0,s=!1,n=0;const a=new h.i3;for(const o of e)null!=o&&(t+=o.verticesPerFeature,i+=o.verticesPerCoordinate,r+=o.drawCallsPerFeature,a.bytesPerFeature+=o.memory.bytesPerFeature,a.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,a.resourceBytes+=o.memory.resourceBytes,a.draped.bytesPerFeature+=o.memory.bytesPerFeature,a.draped.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,s=s||o.estimated,++n);return s?new h.a8(n,{verticesPerFeature:t,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:a}):new h.MT(n,{verticesPerFeature:t,verticesPerCoordinate:i,drawCallsPerFeature:r,memory:a})}function y(e){const t=g(e);return t.numComplexities>0&&(t.verticesPerFeature/=t.numComplexities,t.verticesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.resourceBytes/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities),t}const v={};function m(e,t){var i,n,u;const p=b(e,t),g=(0,d.RF)(t)?2:0;switch(t.type){case"extrude":return new h.rz({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:g,memory:p});case"fill":if("mesh-3d"===e.type)return new h.rz({drawCallsPerFeature:g,memory:p});if(null!=t.outline&&t.outline.size>0)return new h.rz({verticesPerFeature:-12,verticesPerCoordinate:9,memory:p});case"water":return new h.rz({verticesPerFeature:-6,verticesPerCoordinate:3,memory:p});case"line":return new h.rz({verticesPerFeature:-6,verticesPerCoordinate:6,memory:p});case"object":return null!==(i=t.resource)&&void 0!==i&&i.href?new h.hk({verticesPerFeature:100,memory:p}):(0,r.A)((0,r.A)({},function(e){const t=v[e];if(t)return t;const i=f((0,l._)(e,new c.$U({},{spherical:!0})).levels);return v[e]=new h.rz({verticesPerFeature:i}),v[e]}(null!==(n=null===(u=t.resource)||void 0===u?void 0:u.primitive)&&void 0!==n?n:a.r)),{},{memory:p});case"path":{let e=0,i=0;switch(t.profile){case"circle":e=o.ZC;break;case"quad":e=4;break;default:return void(0,s.Xb)(t.profile)}switch(t.join){case"round":i=o.kf;break;case"miter":case"bevel":i=1;break;default:return}const r=2*e,n=e*i*2,a=n+r;let l=-2*n-r;switch(t.cap){case"none":break;case"butt":case"square":l+=2*(e-1);break;case"round":l+=2*(e*(o.RL-1)*2+e);break;default:return}return new h.rz({verticesPerFeature:l,verticesPerCoordinate:a,memory:p})}case"text":{const t="label-3d"===e.type?0:2;return new h.rz({verticesPerFeature:6,memory:p,drawCallsPerFeature:t})}case"icon":return new h.rz({verticesPerFeature:6,memory:p});default:return}}function b(e,t){const i="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?_.EXTRUDE_EDGES:_.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?_.FILL_OUTLINE:_.FILL;case"water":return _.FILL;case"line":return"round"===t.join?_.LINE_ROUND:_.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return _.PATH_ROUND_CIRCLE;case"quad":return _.PATH_ROUND_QUAD;default:return void(0,s.Xb)(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return _.PATH_MITER_CIRCLE;case"quad":return _.PATH_MITER_QUAD;default:return void(0,s.Xb)(t.profile)}default:return}case"object":return i?_.OBJECT_POINT:_.OBJECT_POLYGON;case"icon":case"text":return i?_.ICON_POINT:_.ICON_POLYGON;default:return}}function f(e){return e.reduce((e,t,i)=>e+t.numVertices*(1/10**i),0)/e.reduce((e,t,i)=>e+1/10**i,0)}const _={ICON_POINT:{bytesPerFeature:2658,bytesPerFeatureLabel:3484,resourceBytes:0,draped:{bytesPerFeature:1845,bytesPerFeatureLabel:3498}},ICON_POLYGON:{bytesPerFeature:3086,bytesPerFeatureLabel:2996,resourceBytes:0,draped:{bytesPerFeature:2694,bytesPerFeatureLabel:3014}},OBJECT_POINT:{bytesPerFeature:497,bytesPerFeatureLabel:2933,resourceBytes:0,draped:{bytesPerFeature:497,bytesPerFeatureLabel:2933}},OBJECT_POLYGON:{bytesPerFeature:867,bytesPerFeatureLabel:2491,resourceBytes:0,draped:{bytesPerFeature:867,bytesPerFeatureLabel:2491}},LINE_MITER:{bytesPerFeature:2337,bytesPerFeatureLabel:2658,resourceBytes:0,draped:{bytesPerFeature:1864,bytesPerFeatureLabel:2656}},LINE_ROUND:{bytesPerFeature:2341,bytesPerFeatureLabel:2672,resourceBytes:0,draped:{bytesPerFeature:1873,bytesPerFeatureLabel:2643}},PATH_MITER_CIRCLE:{bytesPerFeature:22374,bytesPerFeatureLabel:2558,resourceBytes:0,draped:{bytesPerFeature:22374,bytesPerFeatureLabel:2558}},PATH_ROUND_CIRCLE:{bytesPerFeature:24004,bytesPerFeatureLabel:2598,resourceBytes:0,draped:{bytesPerFeature:24004,bytesPerFeatureLabel:2598}},PATH_MITER_QUAD:{bytesPerFeature:24040,bytesPerFeatureLabel:2940,resourceBytes:0,draped:{bytesPerFeature:24040,bytesPerFeatureLabel:2940}},PATH_ROUND_QUAD:{bytesPerFeature:23088,bytesPerFeatureLabel:2886,resourceBytes:0,draped:{bytesPerFeature:23088,bytesPerFeatureLabel:2886}},FILL:{bytesPerFeature:3059,bytesPerFeatureLabel:2838,resourceBytes:0,draped:{bytesPerFeature:2352,bytesPerFeatureLabel:2808}},FILL_OUTLINE:{bytesPerFeature:3093,bytesPerFeatureLabel:2632,resourceBytes:0,draped:{bytesPerFeature:2480,bytesPerFeatureLabel:2601}},EXTRUDE:{bytesPerFeature:5075,bytesPerFeatureLabel:2559,resourceBytes:0,draped:{bytesPerFeature:5075,bytesPerFeatureLabel:2559}},EXTRUDE_EDGES:{bytesPerFeature:2843,bytesPerFeatureLabel:2139,resourceBytes:0,draped:{bytesPerFeature:2843,bytesPerFeatureLabel:2139}}};if((0,n.A)("esri-tests-disable-symbol-memory-estimators"))for(const C in _){const e=_[C];e.bytesPerFeature=0,e.bytesPerFeatureLabel=0,e.draped.bytesPerFeature=0,e.draped.bytesPerFeatureLabel=0}},51990:(e,t,i)=>{i.d(t,{K_:()=>r});i(15941);function r(e,t){for(let i=0;i<4;i++)e[i]=s(t[i]);return e}function s(e){return isNaN(e)?255:e*(254/255)}},64573:(e,t,i)=>{i.d(t,{RL:()=>s,ZC:()=>n,kf:()=>r});const r=3,s=3,n=10},75646:(e,t,i)=>{i.d(t,{x:()=>n});var r=i(30726),s=i(50346);class n{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=0,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,t){var i,r;return 1===this._loadStatus?(e&&e(),null!==(i=this._loader)&&void 0!==i?i:Promise.resolve()):2===this._loadStatus?(t&&t(this._loadError),null!==(r=this._loader)&&void 0!==r?r:Promise.resolve()):(null==this._loader&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=1},e=>{throw this._loadError=e,this._abortController=null,this._loadStatus=2,!(0,s.zf)(e)&&this.logger&&e.message&&this.logger.warn(e.message),e})),this._loader.then(e,t).catch(()=>{}),this._loader)}abortLoad(){null!=this._abortController?this._abortController=(0,r.DC)(this._abortController):0===this._loadStatus&&(this._loadStatus=2),this._loader=null}}},86486:(e,t,i)=>{i.d(t,{LO:()=>o,kg:()=>l,or:()=>h,vl:()=>a});var r=i(69539),s=i(11687),n=i(15492);function a(e,t){var i;const r=function(e,t){if(null!=e.symbol)return e.symbol;const i=null===t||void 0===t?void 0:t.renderer;return null!=i&&"dot-density"!==i.type?i.getSymbol(e,t):null}(e,t);if(null==r)return null;const a=null===t||void 0===t?void 0:t.renderer,o=new s.$(a,r);if(null==a||!("visualVariables"in a)||!a.visualVariables)return o;const l=null!==(i=(0,n.getVisualVariableValues)(a,e,t))&&void 0!==i?i:[],h=["proportional","proportional","proportional"];for(const{variable:s,value:n}of l)if(null!=n||"size"===s.type&&s.useSymbolValue)switch(s.type){case"color":o.color=null===n||void 0===n?void 0:n.toRgba();break;case"size":if("outline"===s.target)o.outlineSize=n;else{const e=s.axis,t=s.useSymbolValue?"symbol-value":null!==n&&void 0!==n?n:"proportional";switch(e){case"width":h[0]=t;break;case"depth":h[1]=t;break;case"height":h[2]=t;break;case"width-and-depth":h[0]=h[1]=t;break;default:h[0]=h[1]=h[2]=t}}break;case"opacity":o.opacity=n;break;case"rotation":switch(s.axis){case"tilt":o.tilt=n;break;case"roll":o.roll=n;break;default:o.heading=n}}return"proportional"===h[0]&&"proportional"===h[1]&&"proportional"===h[2]||(o.size=h),o}async function o(e,t){var i;const a=await async function(e,t){var i,r;return null!=e.symbol?e.symbol:null!==(i=null===t||void 0===t||null===(r=t.renderer)||void 0===r?void 0:r.getSymbolAsync(e,t))&&void 0!==i?i:null}(e,t);if(!a)return null;const o=null===t||void 0===t?void 0:t.renderer,l=new s.$(o,a);if(!o||!("visualVariables"in o)||!o.visualVariables)return l;const h=null!==(i=(0,n.getVisualVariableValues)(o,e,t))&&void 0!==i?i:[],d=["proportional","proportional","proportional"];for(const{variable:s,value:n}of h)if("color"===s.type)l.color=r.A.toUnitRGBA(n);else if("size"===s.type)if("outline"===s.target)l.outlineSize=n;else{const e=s.axis,t=s.useSymbolValue?"symbol-value":n;"width"===e?d[0]=t:"depth"===e?d[1]=t:"height"===e?d[2]=t:d[0]=d[1]="width-and-depth"===e?t:d[2]=t}else"opacity"===s.type?l.opacity=n:"rotation"===s.type&&"tilt"===s.axis?l.tilt=n:"rotation"===s.type&&"roll"===s.axis?l.roll=n:"rotation"===s.type&&(l.heading=n);return(isFinite(d[0])||isFinite(d[1])||isFinite(d[2]))&&(l.size=d),l}function l(e){const t=e[arguments.length>1&&void 0!==arguments[1]?arguments[1]:0];return"number"==typeof t&&isFinite(t)?t:null}function h(e){for(let t=0;t<3;t++){const i=e[t];if("number"==typeof i)return isFinite(i)?i:0}return 0}},88265:(e,t,i)=>{i.d(t,{R$:()=>v,SZ:()=>c,ZX:()=>y,d2:()=>g,hS:()=>u});var r=i(9392),s=i(64232),n=i(42294),a=i(5262),o=i(18117),l=i(67425),h=i(36423),d=i(37046);function c(e,t,i,r,s){if(p(e,t))return null;i.localOrigin=v(e,t);const n=new d.B({geometries:[i],castShadow:!1,layerViewUid:e.layerViewUid,graphicUid:s,usesVerticalDistanceToGround:!0});return{object:n,sampledElevation:(0,l.fe)(n,t,e.elevationProvider,e.renderCoordsHelper,r)}}function u(e,t,i,r){return p(t,i)?null:(0,l.fe)(e,i,t.elevationProvider,t.renderCoordsHelper,r)}function p(e,t){const i=e.clippingExtent;return!!i&&((0,s.g)(t,m,e.elevationProvider.spatialReference),!(0,n.Uc)(i,m))}function g(e,t,i){const n=e.elevationContext,a=i.spatialReference;(0,s.g)(t,m,a),n.centerInElevationSR=(0,r.fA)(m[0],m[1],t.hasZ?m[2]:0)}function y(e){switch(e.type){case"point":return e;case"polygon":case"extent":return(0,h.W$)(e);case"polyline":{const t=e.paths[0];if(!t||0===t.length)return null;const i=(0,a.$H)(t,(0,a.Yl)(t)/2);return(0,o.TH)(i[0],i[1],i[2],e.spatialReference)}case"mesh":return e.extent.center}return null}function v(e,t){return(0,s.g)(t,m,e.renderCoordsHelper.spatialReference),e.localOriginFactory.getOrigin(m)}const m=(0,r.vt)()},90346:(e,t,i)=>{i.d(t,{MT:()=>n,a8:()=>a,hk:()=>s,i3:()=>o,rz:()=>r});class r{constructor(e){var t,i,r,s;this.estimated=!1,this.verticesPerFeature=null!==(t=e.verticesPerFeature)&&void 0!==t?t:0,this.verticesPerCoordinate=null!==(i=e.verticesPerCoordinate)&&void 0!==i?i:0,this.drawCallsPerFeature=null!==(r=e.drawCallsPerFeature)&&void 0!==r?r:0,this.memory=null!==(s=e.memory)&&void 0!==s?s:new o}}class s extends r{constructor(e){super(e),this.estimated=!0}}class n extends r{constructor(e,t){super(t),this.numComplexities=e}}class a extends s{constructor(e,t){super(t),this.numComplexities=e}}class o{constructor(){this.bytesPerFeature=0,this.bytesPerFeatureLabel=0,this.resourceBytes=0,this.draped={bytesPerFeature:0,bytesPerFeatureLabel:0}}}},91196:(e,t,i)=>{i.d(t,{A:()=>p});var r=i(6326),s=i(54099),n=i(5632),a=i(76460),o=i(30726),l=i(91291),h=i(46053),d=(i(81806),i(47249),i(87990)),c=i(19451),u=i(90992);let p=class extends((0,n.sA)((0,l.g)(s.nJ))){get spatialReferenceSupported(){return!0}constructor(e){super(e),this._updatingHandles=new c.U,this.layer=null,this.parent=null}initialize(){this.when().catch(e=>{if("layerview:create-error"!==e.name){var t;const i=this.layer&&this.layer.id||"no id",r=(null===(t=this.layer)||void 0===t?void 0:t.title)||"no title";a.A.getLogger(this).error("#resolve()","Failed to resolve layer view (layer title: '".concat(r,"', id: '").concat(i,"')"),e)}})}destroy(){this._updatingHandles=(0,o.pR)(this._updatingHandles),this._set("parent",null)}get fullOpacity(){var e,t,i,r;return(null!==(e=null===(t=this.layer)||void 0===t?void 0:t.opacity)&&void 0!==e?e:1)*(null!==(i=null===(r=this.parent)||void 0===r?void 0:r.fullOpacity)&&void 0!==i?i:1)}get suspended(){return this.destroyed||!this.canResume()}get suspendInfo(){return this.getSuspendInfo()}get legendEnabled(){var e;return!this.suspended&&!0===(null===(e=this.layer)||void 0===e?void 0:e.legendEnabled)}get updating(){var e;return!((null===(e=this._updatingHandles)||void 0===e||!e.updating)&&!this.isUpdating())}get updatingProgress(){return this.updating?0:1}get updateSuspended(){return this.suspended}get visible(){var e;return!0===(null===(e=this.layer)||void 0===e?void 0:e.visible)}set visible(e){this._overrideIfSome("visible",e)}get visibleAtCurrentScale(){return!0}get visibleAtCurrentTimeExtent(){var e;const t=this.view.timeExtent,i=null===(e=this.layer)||void 0===e?void 0:e.visibilityTimeExtent;return!t||!i||!t.intersection(i).isEmpty}canResume(){var e,t;const i=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return this.visible&&(null===(e=this.layer)||void 0===e?void 0:e.loaded)&&this.parent&&!this.parent.suspended&&(null===(t=this.view)||void 0===t?void 0:t.ready)&&(0,u.g7)(i)&&this.visibleAtCurrentScale&&this.visibleAtCurrentTimeExtent||!1}getSuspendInfo(){var e,t;const i=null!==(e=this.parent)&&void 0!==e&&e.suspended?this.parent.suspendInfo:{};null!==(t=this.view)&&void 0!==t&&t.ready||(i.viewNotReady=!0),this.layer&&this.layer.loaded||(i.layerNotLoaded=!0);const r=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return(0,u.g7)(r)&&this.visibleAtCurrentScale||(i.outsideScaleRange=!0),this.visibleAtCurrentTimeExtent||(i.outsideVisibilityTimeExtent=!0),this.visible||(i.layerInvisible=!0),i}isUpdating(){return!1}};(0,r.Cg)([(0,h.MZ)({readOnly:!0})],p.prototype,"spatialReferenceSupported",null),(0,r.Cg)([(0,h.MZ)()],p.prototype,"view",void 0),(0,r.Cg)([(0,h.MZ)()],p.prototype,"fullOpacity",null),(0,r.Cg)([(0,h.MZ)()],p.prototype,"layer",void 0),(0,r.Cg)([(0,h.MZ)()],p.prototype,"parent",void 0),(0,r.Cg)([(0,h.MZ)({readOnly:!0})],p.prototype,"suspended",null),(0,r.Cg)([(0,h.MZ)({readOnly:!0})],p.prototype,"suspendInfo",null),(0,r.Cg)([(0,h.MZ)({readOnly:!0})],p.prototype,"legendEnabled",null),(0,r.Cg)([(0,h.MZ)({type:Boolean,readOnly:!0})],p.prototype,"updating",null),(0,r.Cg)([(0,h.MZ)({readOnly:!0})],p.prototype,"updatingProgress",null),(0,r.Cg)([(0,h.MZ)()],p.prototype,"updateSuspended",null),(0,r.Cg)([(0,h.MZ)()],p.prototype,"visible",null),(0,r.Cg)([(0,h.MZ)({readOnly:!0})],p.prototype,"visibleAtCurrentScale",null),(0,r.Cg)([(0,h.MZ)({readOnly:!0})],p.prototype,"visibleAtCurrentTimeExtent",null),p=(0,r.Cg)([(0,d.$)("esri.views.layers.LayerView")],p)},99057:(e,t,i)=>{i.d(t,{H:()=>h,Y:()=>d});var r=i(20664),s=i(9392),n=i(42294),a=i(78315),o=i(67425),l=i(36423);class h{constructor(e,t,i){this.baseMaterial=e,this.edgeMaterial=t,this.hasSlicePlane=i}}class d{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,t,i,r,s){let n=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;this.graphics3DSymbolLayer=e,this.stageObject=t,this._sharedResource=i,this.elevationAligner=r,this.elevationContext=s,this._edgeState=n,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e}destroy(){var e,t;if(!this._stageLayer)return;const i=this._stageLayer.stage;this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1),null!==(e=i.renderer.edgeView)&&void 0!==e&&e.removeObject(this.stageObject),this.stageObject.dispose(),null!==(t=this._sharedResource)&&void 0!==t&&t.release(),this._visible=!1,this._stageLayer=null}get usedMemory(){return this.graphics3DSymbolLayer.usedMemory}layerOpacityChanged(e,t){const{stageObject:i,_edgeState:r,_stageLayer:s}=this;if(null==r)return;const n=c(r.baseMaterial);r.edgeMaterial.objectTransparency!==n&&(r.edgeMaterial.objectTransparency=n,this.resetEdgeObject(t)),s.stage.renderer.withEdgeView(t=>t.updateAllComponentOpacities(i,[e]))}updateHighlights(e){}slicePlaneEnabledChanged(e,t){const{stageObject:i,_edgeState:r,_stageLayer:s}=this;null!=r&&s.stage.renderer.withEdgeView(s=>{s.updateAllComponentMaterials(i,r.edgeMaterial,e,!t),r.hasSlicePlane=e})}setVisibility(e){const{_edgeState:t,stageObject:i,_stageLayer:r}=this;null!=r&&this.visible!==e&&(this._visible=e,i.visible=e,e&&!this._addedToStage&&(r.add(i),this._addedToStage=!0),null!=t&&r.stage.renderer.withEdgeView(r=>{r.hasObject(i)?r.updateObjectVisibility(i,e):e&&this._addOrUpdateEdgeObject(t,r,!1)}))}get visible(){return this._visible}alignWithElevation(e,t,i){if(null==this.elevationAligner)return;this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,(i,r)=>(0,o.sE)(i,e,this.elevationContext,t,r),t),this.resetEdgeObject(i)}alignWithAbsoluteElevation(e,t,i){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,this.graphics3DSymbolLayer.view.spatialReference,(t,i)=>{i.sampledElevation=e,i.verticalDistanceToGround=0,i.z=e},t),this.resetEdgeObject(i)}getCenterObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,s.vt)();return(0,r.d)(e,(0,a.a)(this.stageObject.boundingVolumeObjectSpace.bounds))}getBoundingBoxObjectSpace(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,n.vt)();const t=this.stageObject.boundingVolumeObjectSpace;return(0,n.Ne)(e,t.min),(0,n.vI)(e,t.max),e}computeAttachmentOrigin(e){const t=this.stageObject.effectiveTransformation;if(this.useObjectOriginAsAttachmentOrigin)e.render.origin[0]+=t[12],e.render.origin[1]+=t[13],e.render.origin[2]+=t[14],e.render.num++;else for(const i of this.stageObject.geometries)i.computeAttachmentOrigin(g)&&((0,r.t)(g,g,t),(0,r.g)(e.render.origin,e.render.origin,g),e.render.num++)}async getProjectedBoundingBox(e,t,i,s,a){const o=this.getBoundingBoxObjectSpace(a),h=y,c=(0,n.fT)(o)?1:h.length;for(let n=0;n<c;n++){const e=h[n];p[0]=o[e[0]],p[1]=o[e[1]],p[2]=o[e[2]],(0,r.t)(p,p,this.stageObject.transformation),u[3*n]=p[0],u[3*n+1]=p[1],u[3*n+2]=p[2]}if(!e(u,0,c))return null;(0,n.Ie)(o);let v=null;this.calculateRelativeScreenBounds&&(v=this.calculateRelativeScreenBounds());for(let r=0;r<3*c;r+=3){for(let e=0;e<3;e++)o[e]=Math.min(o[e],u[r+e]),o[e+3]=Math.max(o[e+3],u[r+e]);v&&i.push({location:u.slice(r,r+3),screenSpaceBoundingRect:v})}if(null!==t&&void 0!==t&&t.service&&"absolute-height"!==this.elevationContext.mode){var m;(0,n.gX)(o,g);const e="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let i=0;if(t.useViewElevation)i=null!==(m=t.service.getElevation(g[0],g[1],e))&&void 0!==m?m:0;else try{var b;const r=(0,l.vY)(o,t.service.spatialReference,t);i=null!==(b=await t.service.queryElevation(g[0],g[1],s,r,e))&&void 0!==b?b:0}catch(d){}(0,n.cY)(o,0,0,-this.alignedSampledElevation+i)}return o}addObjectState(e){0===e.stateType&&e.addObject(this.stageObject,this.stageObject.highlight(e.highlightName)),1===e.stateType&&e.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeByObject(this.stageObject)}resetEdgeObject(e){const{_edgeState:t,stageObject:i,_stageLayer:r,_visible:s}=this;null!=t&&r.stage.renderer.withEdgeView(r=>{s?this._addOrUpdateEdgeObject(t,r,e):r.removeObject(i)})}_addOrUpdateEdgeObject(e,t,i){const r=c(e.baseMaterial);e.edgeMaterial.objectTransparency=r,t.addOrUpdateObject3D(this.stageObject,e.edgeMaterial,e.hasSlicePlane,!i).then(()=>{var e;return null===(e=this._stageLayer)||void 0===e?void 0:e.sync()})}}function c(e){return e.transparent?0:1}const u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=(0,s.vt)(),g=(0,s.vt)(),y=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]]},99784:(e,t,i)=>{i.d(t,{HP:()=>o,N3:()=>l,RW:()=>p,Uz:()=>g,gR:()=>d,iQ:()=>u,jy:()=>h,w9:()=>c});i(81806);var r=i(97255),s=(i(13312),i(42294)),n=i(2413),a=(i(76279),i(31608),i(44135),i(28660));i(74e3);class o{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}}function l(e){return null!=e.geometry}class h{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}}function d(e){if(null==e)return 0;switch(e.type){case"point":return r.qK+10+8+24;case"polyline":case"polygon":{let t=0;const i=2+(e.hasZ?1:0)+(e.hasM?1:0),s="polyline"===e.type?e.paths:e.rings,n="polyline"===e.type?e.curvePaths:e.curveRings;if(null!==n&&void 0!==n&&n.length){const e=3*(0,a.B1)()*128;t=8*e*i+128*e+32*(s.length+1)}else t=(0,r.Qh)(s);return r.qK+64+t+34}case"multipoint":{const t=(0,r.Qh)(e.points);return r.qK+t+64+34+32}case"extent":return r.qK+10+64+34;case"mesh":{const t=e.vertexAttributes;return r.qK+(0,r.Qf)(t.position,t.normal,t.uv,t.tangent)}default:return r.qK}}function c(e,t){switch((0,s.Ie)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)(0,s.Jf)(t,e.paths[i],!!e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)(0,s.Jf)(t,e.rings[i],!!e.hasZ);break;case"multipoint":(0,s.Jf)(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}return t}function u(e,t){switch((0,n.Ie)(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)(0,n.Jf)(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)(0,n.Jf)(t,e.rings[i]);break;case"multipoint":(0,n.Jf)(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}}function p(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}function g(e,t,i,r){if(null!==t&&void 0!==t&&t.size&&null!=i&&e)for(const s in e){if(!t.has(s))continue;const n=e[s];"string"==typeof n&&n.length>i&&(r(s),e[s]="")}}}}]);
//# sourceMappingURL=9045.59df6205.chunk.js.map